{"pages":[{"title":"","text":"å”è‰ºæ˜• å”è‰ºæ˜• ææ² æä¸€æ¡ gakki å›¾ç‰‡æœé›†äºäº’è”ç½‘ï¼Œä¾µæƒè¯·ç•™è¨€ï¼Œé©¬ä¸Šå¤„ç†ğŸ˜Šã€‚","link":"/album/index.html"},{"title":"","text":"ç”³è¯·å‹é“¾é¡»çŸ¥ åŸåˆ™ä¸Šåªå’ŒæŠ€æœ¯ç±»åšå®¢äº¤æ¢ï¼Œä½†ä¸åŒ…æ‹¬å«æœ‰å’Œè‰²æƒ…ã€æš´åŠ›ã€æ”¿æ²»æ•æ„Ÿçš„ç½‘ç«™ã€‚ ä¸å’Œå‰½çªƒã€ä¾µæƒã€æ— è¯šä¿¡çš„ç½‘ç«™äº¤æ¢ï¼Œä¼˜å…ˆå’Œå…·æœ‰åŸåˆ›ä½œå“çš„ç½‘ç«™äº¤æ¢ã€‚ ç”³è¯·è¯·æä¾›ï¼šç«™ç‚¹åç§°ã€ç«™ç‚¹é“¾æ¥ã€ç«™ç‚¹æè¿°ã€logoæˆ–å¤´åƒï¼ˆä¸è¦è®¾ç½®é˜²ç›—é“¾ï¼‰ã€‚ æ’åä¸åˆ†å…ˆåï¼Œåˆ·æ–°åé‡æ’ï¼Œæ›´æ–°ä¿¡æ¯åè¯·ç•™è¨€å‘ŠçŸ¥ã€‚ ä¼šå®šæœŸæ¸…ç†å¾ˆä¹…å¾ˆä¹…ä¸æ›´æ–°çš„ã€ä¸ç¬¦åˆè¦æ±‚çš„å‹é“¾ï¼Œä¸å†å¦è¡Œé€šçŸ¥ã€‚ æœ¬ç«™ä¸å­˜å‚¨å‹é“¾å›¾ç‰‡ï¼Œå¦‚æœå‹é“¾å›¾ç‰‡æ¢äº†æ— æ³•æ›´æ–°ã€‚å›¾ç‰‡è£‚äº†çš„ä¼šæ›¿æ¢æˆé»˜è®¤å›¾ï¼Œéœ€è¦æ›´æ¢çš„è¯·ç•™è¨€å‘ŠçŸ¥ã€‚ æœ¬ç«™å‹é“¾ä¿¡æ¯å¦‚ä¸‹ï¼Œç”³è¯·å‹é“¾å‰è¯·å…ˆæ·»åŠ æœ¬ç«™ä¿¡æ¯ï¼š ç½‘ç«™å›¾æ ‡ï¼šhttps://removeif.github.io/images/avatar.jpg ç½‘ç«™åç§°ï¼šè¾£æ¤’ã®é…± ç½‘ç«™åœ°å€ï¼šhttps://removeif.github.io ç½‘ç«™ç®€ä»‹ï¼šåç«¯å¼€å‘ï¼ŒæŠ€æœ¯åˆ†äº« åŠ è½½ä¸­ï¼Œç¨ç­‰å‡ ç§’...","link":"/friend/index.html"},{"title":"","text":"&nbsp;&nbsp;å¬å¬éŸ³ä¹ éŸ³ä¹æ’­æ”¾å™¨ç”±mePlayeræä¾›ï¼Œå¸ƒå±€å‚ç…§ç½‘å‹åšå®¢æ‰€ä½œï¼Œæ„Ÿè°¢ä½œè€…çš„è¾›å‹¤ä»˜å‡ºã€‚æ›´å¤šéŸ³ä¹åˆ†äº«è¯·æŸ¥çœ‹æ­Œå•ã€‚ &nbsp;&nbsp;çœ‹çœ‹è§†é¢‘ ->ç‚¹å‡»ä»¥ä¸‹æ¡ç›®å¼€å§‹æ’­æ”¾è§†é¢‘,å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š","link":"/media/index.html"},{"title":"","text":"æ¥è€Œä¸å¾€éç¤¼ä¹Ÿç•…æ‰€æ¬²è¨€ï¼Œæœ‰ç•™å¿…åº”","link":"/message/index.html"},{"title":"éŸ³ä¹æ­Œå•æ”¶è—","text":"--- æ¸©é¦¨æç¤ºï¼šé€‰æ‹©å–œæ¬¢çš„éŸ³ä¹åŒå‡»æ’­æ”¾ï¼Œç”±äºç‰ˆæƒåŸå› éƒ¨åˆ†ä¸èƒ½æ’­æ”¾ã€‚å¦‚æœå–œæ¬¢æ­Œå•æ”¶è—ä¸€ä¸‹ï¼Œå»ç½‘æ˜“äº‘éƒ½èƒ½æ’­æ”¾å“Ÿï¼","link":"/music/index.html"},{"title":"","text":"ä¸ªäººç®€ä»‹ åˆ†äº«å¾ˆå–œæ¬¢çš„è€ç½—çš„ä¸€æ®µè¯ï¼š â€œæ¯ä¸€ä¸ªç”Ÿå‘½æ¥åˆ°ä¸–é—´éƒ½æ³¨å®šæ”¹å˜ä¸–ç•Œï¼Œåˆ«æ— é€‰æ‹©ã€‚è¦ä¹ˆå˜å¾—å¥½ä¸€ç‚¹ï¼Œè¦ä¹ˆå˜å¾—åä¸€ç‚¹ã€‚ä½ å¦‚æœèµ°è¿›ç¤¾ä¼šä¸ºäº†ç”Ÿå­˜ä¸ºäº†ä»€ä¹ˆä¸è¦è„¸çš„ç†ç”±ï¼Œå˜æˆäº†ä¸€ä¸ªæ¶å¿ƒçš„æˆå¹´äººç¤¾ä¼šä¸­çš„ä¸€å‘˜ï¼Œé‚£ä½ å°±æŠŠè¿™ä¸ªä¸–ç•Œå˜å¾—æ¶å¿ƒäº†ä¸€ç‚¹ç‚¹ã€‚å¦‚æœä½ ä¸€ç”Ÿåˆšæ­£ä¸é˜¿ï¼Œå¦‚æœä½ ä¸€ç”Ÿè€¿ç›´ï¼Œæ²¡æœ‰åšä»»ä½•æ¶å¿ƒçš„äº‹æƒ…ï¼Œæ²¡åšå¯¹åˆ«äººæœ‰å®³çš„äº‹æƒ…ï¼Œä¸€è¾ˆå­æ‹¼äº†è€å‘½å‹‰å¼ºæŠŠè‡ªå·±èº«è¾¹çš„å‡ ä¸ªäººç…§é¡¾å¥½äº†ï¼Œæ²¡æœ‰æˆåæ²¡æœ‰å‘è´¢ï¼Œæ²¡æœ‰æˆå°±ä¼Ÿå¤§çš„äº‹ä¸šï¼Œç„¶åè€¿ç€è„–å­ä¸€ç”Ÿæ­£ç›´ï¼Œåˆ°äº†ä¸ƒå…«åå²è€¿ç€è„–å­å»ä¸–äº†ã€‚ä½ è¿™ä¸€ç”Ÿæ˜¯ä¸æ˜¯æ²¡æœ‰æ”¹å˜ä¸–ç•Œï¼Ÿä½ è¿˜æ˜¯æ”¹å˜ä¸–ç•Œäº†ï¼Œä½ æŠŠè¿™ä¸ªä¸–ç•Œå˜å¾—ç¾å¥½äº†ä¸€ç‚¹ç‚¹ã€‚å› ä¸ºä¸–ç•Œä¸Šåˆå¤šäº†ä¸€ä¸ªå¥½äººã€‚â€œ å–„æ¶ç»ˆæœ‰æŠ¥,å¤©é“å¥½è½®å›ã€‚ä¸ä¿¡æŠ¬å¤´çœ‹,è‹å¤©é¥¶è¿‡è°ã€‚æ— è®ºä½•æ—¶ä½•åœ°ï¼Œæˆ‘ä»¬éƒ½è¦ä¿æŒä¸€é¢—ç§¯æä¹è§‚ã€å–„è‰¯æ„Ÿæ©çš„å¿ƒã€‚ä½†è¡Œå¥½äº‹è«é—®å‰ç¨‹ï¼Œæ°¸è¿œå¹´è½»ï¼Œæ°¸è¿œçƒ­å†…ç›ˆçœ¶ï¼Œæ°¸è¿œä¿æŒæ­£èƒ½é‡ã€‚ğŸ’ªğŸ’ªğŸ’ªğŸ’ªğŸ’ªğŸ’ªå†²é¸­ï¼ï¼ï¼ï¼ -&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;ä¸ªäººä¿¡æ¯ï¼šè®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šä»äº‹JAVAåç«¯å¼€å‘ç ç•œä¸€æšåšä¿¡ä»£ç æ”¹å˜ä¸–ç•Œ åšå®¢ä¿¡æ¯ ç½‘ç«™é‡‡ç”¨çš„Icarusä¸»é¢˜ è¿½æ±‚å°½å¯èƒ½çš„ç®€æ´ï¼Œæ¸…æ™°ï¼Œæ˜“ç”¨ã€‚ åœ¨Icarusä¸»é¢˜ä¹‹ä¸Šè¿›è¡Œäº†éƒ¨åˆ†ä¿®æ”¹ã€‚ æ›´æ–°æ—¥å¿—ï¼šâ€“2020.01.18ï¼šicarus3.0é€‚é…â€“2019.11.17ï¼šå¢åŠ æ·±è‰²ä¸»é¢˜å¼€å…³â€“2019.10.30ï¼šå»å›¾ï¼Œç²¾ç®€å¡ç‰‡â€“2019.10.22ï¼šæ”¹ç‰ˆéƒ¨åˆ†æ˜¾ç¤ºï¼Œä¼˜åŒ–é€Ÿåº¦â€“2019.10.16ï¼šæ–‡ç« åˆ—è¡¨åŠ ä¸Šè¯„è®ºæ•°æ˜¾ç¤ºâ€“2019.10.13ï¼šæ”¹ç‰ˆè¯„è®ºâ€“2019.09.25ï¼šå›¾ç‰‡ã€èµ„æºæ¥å…¥CDNå…è´¹jsDelivrã€æ–‡ç« åŠ å…¥ç½®é¡¶â€“2019.09.19ï¼šå¼€æºåšå®¢ä»£ç â€“2019.09.19ï¼šä¿®æ”¹å¸ƒå±€ï¼Œæ‹‰ä¼¸å¸ƒå±€ï¼Œæ›´å®½çš„å±•ç¤ºâ€“2019.09.18ï¼šä¿®æ”¹å‹é“¾uiä¸ºä¸€è¡Œä¸‰ä¸ªï¼Œå¹¶é€‚é…ç§»åŠ¨ç«¯ï¼Œæš—é»‘æ¨¡å¼æ–‡ç« å¢åŠ è¯„è®ºé“¾æ¥ï¼Œå¢åŠ ç•™è¨€é“¾æ¥â€“2019.09.14ï¼šå¢åŠ ç²¾ç®€nextä¸»é¢˜â€“2019.09.14ï¼šåˆ©ç”¨ä¸­ç§‹èŠ‚æ”¾å‡ï¼Œé‡åšäº†é¦–é¡µçš„çƒ­é—¨æ¨èã€åŠ ä¸ªwidgetæœ€æ–°è¯„è®ºæ¡†ã€å½’æ¡£é¡µåŠ å…¥æ–‡ç« è´¡çŒ®æ¦‚è§ˆé¢æ¿ æœ¬ç«™æ¨èç´¢å¼• åšå®¢ä¸»é¢˜ç›¸å…³ github Issue ä½œä¸ºåšå®¢å¾®å‹æ•°æ®åº“çš„åº”ç”¨ github pageç½‘ç«™cdnä¼˜åŒ–åŠ é€Ÿ åšå®¢æºç åˆ†äº« åšå®¢æ¢è‚¤çš„ä¸€ç§å®ç°æ–¹å¼æ€è·¯ åšå®¢ä¸­gitalkæœ€æ–°è¯„è®ºçš„è·å– åšå®¢å›¾ç‰‡ä¸Šä¼ picgoå·¥å…·githubå›¾ä¼ ä½¿ç”¨ å®‰è£…ã€éƒ¨åˆ†é…ç½®icarusä¸»é¢˜ä¸­æ–‡ç‰ˆ æŠ€æœ¯çŸ¥è¯†ç‚¹ Javaå¹¶å‘çŸ¥è¯†ç‚¹ æ³•å¾‹æ³•è§„ æ³•å¾‹æ³•è§„æ•°æ®åº“ ä¸­åäººæ°‘å…±å’Œå›½å›½æ——æ³• ä¸­åäººæ°‘å…±å’Œå›½å®ªæ³• ä¸­åäººæ°‘å…±å’Œå›½æ¶ˆè´¹è€…æƒç›Šä¿æŠ¤æ³• ä¸­åäººæ°‘å…±å’Œå›½åˆ‘äº‹è¯‰è®¼æ³• ä¸­åäººæ°‘å…±å’Œå›½å©šå§»æ³• ä¸­åäººåå…±å’Œå›½ç½‘ç»œå®‰å…¨æ³• ä¸­åäººæ°‘å…±å’Œå›½åŠ³åŠ¨æ³• å…¶ä»– ç½‘æ˜“äº‘éŸ³ä¹æ­Œå•åˆ†äº« è®¡åˆ’2020è®¡åˆ’ 2019.12.31 2020-GOALS è·‘ä¸¤ä¸‰åœºé©¬æ‹‰æ¾ 2019è®¡åˆ’ 2018.12.31/21:59:00-&gt;æ›´æ–°äº2019.12.31 2019-GOALS è´­ä¹°çš„ä¸“ä¸šä¹¦ç±è‡³å°‘çœ‹å®Œä¸€éï¼ˆå¹¶å‘ã€é‡æ„ã€è®¾è®¡æ¨¡å¼â€¦ï¼‰-&gt; 95% é¢å¤–ï¼š è¿½äº†å¾ˆå¤šå‰§ æ€»ç»“ï¼š æœ‰ä¼˜ç‚¹æœ‰ç¼ºç‚¹ï¼Œæ²¡åšæŒä¸‹æ¥çš„è¿˜æ˜¯å¤ªå¤šï¼Œè¿½äº†å¤ªå¤šå‰§ã€‚ä»¥åå¤šå­¦ä¹ ï¼Œå¤šæ€è€ƒï¼ æ—¶é—´è½´è®°å½•","link":"/about/index.html"},{"title":"","text":"ç¢ç¢å¿µ tipsï¼šgithubç™»å½•åæŒ‰æ—¶é—´æ­£åºæŸ¥çœ‹ã€å¯ç‚¹èµåŠ â¤ï¸ã€æœ¬æ’ä»¶åœ°å€..ã€Œ+99æ¬¡æŸ¥çœ‹ã€ var gitalk = new Gitalk({ clientID: '46a9f3481b46ea0129d8', clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24', id: '666666', repo: 'issue_database', owner: 'removeif', admin: \"removeif\", createIssueManually: true, distractionFreeMode: false }) gitalk.render('comment-container1')","link":"/self-talking/index.html"}],"posts":[{"title":"å…¶å®ƒ","text":"æŸ¥çœ‹javaçš„å¹¶å‘æ•°ï¼šnetstat -np|grep java|wc -l ä¸¤æ–‡ä»¶å¤¹åŒæ­¥ï¼š rsync -ru â€“progress â€“delete /opt/rsync_test/f1/ /opt/rsync_test/f2/","link":"/2017/08/21/%E5%85%B6%E5%AE%83/"},{"title":"ç”¨Clonezillaå†ç”Ÿé¾™å¤‡ä»½ç³»ç»ŸåŠè¿˜åŸç³»ç»Ÿ","text":"å¤šå°æœºå™¨ç³»ç»Ÿçš„å…‹éš†å‡†å¤‡ï¼š2ä¸ªUç›˜1ã€ ä¸‹è½½Clonezillaç³»ç»Ÿ http://clonezilla.nchc.org.tw/clonezilla-live/download/2ã€ ä½¿ç”¨UltraISOåˆ¶ä½œå¯åŠ¨ç›˜ å¯å‚è€ƒï¼šhttp://www.ultraiso.net/review/uplus.htm3ã€å¤‡ä»½ï¼šåœ¨è¦å¤‡ä»½çš„ç³»ç»Ÿä½¿ç”¨Uç›˜å¯åŠ¨ å¯å‚è€ƒï¼šhttp://forum.ubuntu.org.cn/viewtopic.php?p=26435834ã€è¿˜åŸï¼šåœ¨è¦è¿˜åŸçš„ç³»ç»Ÿä½¿ç”¨Uç›˜å¯åŠ¨ å¯å‚è€ƒï¼šhttp://tiancong.blog.51cto.com/783138/776309 å› å›¾ç‰‡è¿˜ä¸ä¼šç”¨ï¼Œå¾…å®Œå–„ã€‚","link":"/2017/08/21/%E7%94%A8Clonezilla%E5%86%8D%E7%94%9F%E9%BE%99%E5%A4%87%E4%BB%BD%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%BF%98%E5%8E%9F%E7%B3%BB%E7%BB%9F/"},{"title":"CodePushéƒ¨ç½²","text":"ç®€ä»‹CodePushæ˜¯ä¸€ä¸ªå¾®è½¯å¼€å‘çš„äº‘æœåŠ¡å™¨ã€‚é€šè¿‡å®ƒï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥åœ¨ç”¨æˆ·çš„è®¾å¤‡ä¸Šéƒ¨ç½²æ‰‹æœºåº”ç”¨æ›´æ–°ã€‚CodePushç›¸å½“äºä¸€ä¸ªä¸­å¿ƒä»“åº“ï¼Œå¼€å‘è€…å¯ä»¥æ¨é€å½“å‰çš„æ›´æ–°ï¼ˆåŒ…æ‹¬JS/HTML/CSS/IMAGEç­‰ï¼‰åˆ°CoduPushï¼Œç„¶ååº”ç”¨å°†ä¼šæŸ¥è¯¢æ˜¯å¦æœ‰æ›´æ–°ã€‚ å®‰è£…nodejsé‡‡ç”¨æºç åŒ…ç¼–è¯‘çš„æ–¹å¼1ã€ä¸‹è½½nodejsæºç åŒ… https://github.com/nodejs/LTS/ ç³»ç»Ÿç¯å¢ƒéœ€æ±‚ï¼š gcc and g++ 4.9.4 or newer Python 2.6 or 2.7 GNU Make 3.81 or neweræŸ¥çœ‹ç³»ç»Ÿç¯å¢ƒæ˜¯å¦æ»¡è¶³ 123456789101112131415161718192021222324$ gcc --versiongcc (Ubuntu 5.5.0-12ubuntu1~14.04) 5.5.0 20171010Copyright (C) 2015 Free Software Foundation, Inc.This is free software; see the source for copying conditions. There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.$ g++ --versiong++ (Ubuntu 5.5.0-12ubuntu1~14.04) 5.5.0 20171010Copyright (C) 2015 Free Software Foundation, Inc.This is free software; see the source for copying conditions. There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.$ /usr/bin/pythonPython 2.7.6 (default, Oct 26 2016, 20:30:19)[GCC 4.8.4] on linux2Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; quit();$ make -vGNU Make 3.81Copyright (C) 2006 Free Software Foundation, Inc.This is free software; see the source for copying conditions.There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR APARTICULAR PURPOSE. ä¸æ»¡è¶³çš„è¯è¿›è¡Œå®‰è£…æˆ–è€…æ›´æ–°ã€‚ 1ã€å®‰è£…nodejs 12345$ wget http://nodejs.org/dist/latest-v8.x/node-v8.11.1.tar.gz$ tar -zxvf node-v8.11.1.tar.gz$ cd node-v8.11.1$ ./configure$ make &amp;&amp; make install 2ã€å®‰è£…npm 12$ wget http://npmjs.org/install.sh$ sh install.sh 3ã€è®¾ç½®æ·˜å®é•œåƒ 12vi ~/.npmrcregistry = https://registry.npm.taobao.org é‡‡ç”¨å®˜æ–¹ç¼–è¯‘å¥½çš„å®‰è£…åŒ…1ã€ä¸‹è½½ç¼–è¯‘å¥½çš„å®‰è£…åŒ… 123$ wget https://nodejs.org/dist/v8.11.1/node-v8.11.1-linux-x64.tar.xz$ tar -xvJf node-v8.11.1-linux-x64.tar.xz$ cd node-v8.11.1-linux-x64 2ã€æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ vim /etc/profile 123#NODEJSexport NODEJS_HOME=/usr/local/nodejs/node-v8.11.1-linux-x64export PATH=$NODEJS_HOME/bin:$PATH source /etc/profile 3ã€éªŒè¯ç‰ˆæœ¬ 1234$ node --version v8.11.1$ npm --version 5.6.0 å®‰è£… code-push-server1ã€å…¨å±€å®‰è£… 1npm install code-push-server -g 2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶vim /dbdata/nodejs/node-v8.11.1/lib/node_modules/code-push-server/config/config.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152db: { username: &quot;root&quot;, password: &quot;123456&quot;, database: &quot;codepush&quot;, host: &quot;127.0.0.1&quot;, port: 3306, dialect: &quot;mysql&quot;, logging: false }, qiniu: { accessKey: &quot;&quot;, secretKey: &quot;&quot;, bucketName: &quot;CodePush&quot;, downloadUrl: &quot;http://codepush.zyzsks.com/download&quot; }, s3: { accessKeyId: process.env.AWS_ACCESS_KEY_ID, secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY, sessionToken: process.env.AWS_SESSION_TOKEN, //(optional) bucketName: process.env.BUCKET_NAME, region: process.env.REGION, downloadUrl: process.env.DOWNLOAD_URL, // binary files download host address. }, oss: { accessKeyId: &quot;&quot;, secretAccessKey: &quot;&quot;, endpoint: &quot;&quot;, bucketName: &quot;&quot;, prefix: &quot;&quot;, // Key prefix in object key downloadUrl: &quot;&quot;, // binary files download host address. }, //æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°é…ç½® å½“storageTypeä¸ºlocalæ—¶éœ€è¦é…ç½® local: { storageDir: &quot;/dbdata/nodejs/workspaces/storage&quot;, storage in storageDir. //æ–‡ä»¶ä¸‹è½½åœ°å€ CodePush Server åœ°å€ + '/download' downloadå¯¹åº”app.jsé‡Œé¢çš„åœ°å€ downloadUrl: &quot;http://127.0.0.1:3000/download&quot;, public: '/download' }, jwt: { // ç™»å½•jwtç­¾åå¯†é’¥ï¼Œå¿…é¡»æ›´æ”¹ï¼Œå¦åˆ™æœ‰å®‰å…¨éšæ‚£ï¼Œå¯ä»¥ä½¿ç”¨éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸² // Generate using: https://www.grc.com/passwords.htm tokenSecret: '6o1uI6A45I6buu9w4Wxlf1U1NyOS6vI5QkQssNcxTbw0TnPKy6h9bNfV5q7ZfU6' }, common: { tryLoginTimes: 0, diffNums: 3, dataDir: &quot;/dbdata/nodejs/workspaces/data&quot;, // é€‰æ‹©å­˜å‚¨ç±»å‹ï¼Œç›®å‰æ”¯æŒlocal,oss,qiniu,s3é…ç½® storageType: &quot;qiniu&quot;, // options value is (true | false), when it's true, it will cache updateCheck results in redis. updateCheckCache: true 3ã€ åˆå§‹åŒ–æ•°æ®åº“ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ª database åå­—æ˜¯ codepush 1code-push-server-db init --dbhost localhost --dbuser root --dbpassword password 4ã€å¯åŠ¨æœåŠ¡ 12$ code-push-server$ nohup code-push-server &gt; /var/log/codepush.log 2&gt;&amp;1 &amp; //åå°å¯åŠ¨ å¯åŠ¨å®Œæˆåï¼Œæ‰“å¼€ yourIp:3000 è¿›è¡Œç™»å½•ï¼Œé»˜è®¤å¯†ç ä¸º admin,123456 å®‰è£… code-push-cli1ã€å…¨å±€å®‰è£… 1npm install code-push-cli@latest -g 2ã€ç›¸å…³å‘½ä»¤ ç™»å½•ï¼š code-push login http://127.0.0.1:3000 ä¿®æ”¹å¯†ç ï¼š 1$ curl -X PATCH -H \"Authorization: Bearer ç™»å½•è·å–çš„token\" -H \"Accept: application/json\" -H \"Content-Type:application/json\" -d '{\"oldPassword\":\"123456\",\"newPassword\":\"654321\"}'http://yourIp:3000/users/password æ³¨é”€ï¼š code-push logout åˆ—å‡ºç™»é™†çš„tokenï¼š code-push access-key ls åˆ é™¤æŸä¸ª keyå€¼ï¼š code-push access-key rm åœ¨è´¦å·é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„appï¼šcode-push app add code-push app å®‰è£…code-push-webcode-push-web æ˜¯ code-push-server webå®¢æˆ·ç«¯ï¼Œç•Œé¢åŒ–æ“ä½œï¼Œæ¯”è¾ƒç®€å•ã€‚å¯è£…å¯ä¸è£…ï¼Œå¦‚æœä¸ç”¨ï¼Œè¯·æŠŠ code-push-server é…ç½®æ–‡ä»¶ä¸­çš„ codePushWebUrl è¿™é¡¹æ³¨é‡Šã€‚1ã€å®‰è£… 1234$ cd /dbdata/nodejs/node-v8.11.1/lib/node_modules/$ git clone https://github.com/lisong/code-push-web.git$ cd code-push-web$ npm install 2ã€ä¿®æ”¹é…ç½®vim src/config.js 123456export const common = { api: { URL: 'http://localhost:3000', // production code-push-server address devURL: 'http://localhost:3000', // development code-push-server address },}; 3ã€å¯åŠ¨ 123456$ npm run build -- --release$ cd ./build$ npm install//å¯åŠ¨æœåŠ¡$ node ./server.js$ nohup node ./server.js 2&gt;&amp;1 &amp; //åå°å¯åŠ¨ å‚è€ƒï¼šhttps://segmentfault.com/a/1190000008159508 http://www.code-push.com/ https://www.npmjs.com/package/code-push-server https://blog.csdn.net/wnma3mz/article/details/77618475 node:https://www.cnblogs.com/lyzg/p/6012886.html","link":"/2018/05/02/CodePush/CodePush%E9%83%A8%E7%BD%B2/"},{"title":"vsftpdæ­å»ºFTPæ–‡ä»¶æœåŠ¡å™¨","text":"1ã€æŸ¥çœ‹æ˜¯å¦å®‰è£… 1vsftpd -version 2ã€å®‰è£…vsftpd 1apt-get install vsftpd 3ã€é…ç½®vsftpdvim /etc/vsftpd.conf 12345678910111213#ç¦æ­¢åŒ¿åè®¿é—®anonymous_enable=NO#æ¥å—æœ¬åœ°ç”¨æˆ·local_enable=YES#å…è®¸ä¸Šä¼ write_enable=YES#ç”¨æˆ·åªèƒ½è®¿é—®é™åˆ¶çš„ç›®å½•chroot_local_user=YES#è®¾ç½®å›ºå®šç›®å½•ï¼Œåœ¨ç»“å°¾æ·»åŠ ã€‚å¦‚æœä¸æ·»åŠ è¿™ä¸€è¡Œï¼Œå„ç”¨æˆ·å¯¹åº”è‡ªå·±çš„ç›®å½•ï¼ˆç”¨æˆ·å®¶ç›®å½•ï¼‰ï¼Œå½“ç„¶è¿™ä¸ªæ–‡ä»¶å¤¹è‡ªå·±å»ºlocal_root=/home/uftpuserlist_file=/etc/vsftpd.user_listuserlist_enable=YESuserlist_deny=NO 4ã€æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºFTPçš„å·¥ä½œç›®å½• 1$ mkdir /home/uftp 5ã€æ–°å»ºFTPç”¨æˆ·å¹¶è®¾ç½®å¯†ç ä»¥åŠå·¥ä½œç›®å½• 12$ useradd -d /home/ftp -s /bin/bash uftp$ passwd uftp 6ã€å¯åŠ¨æœåŠ¡ 1$ service vsftpd start 7ã€è®¿é—®ftp://192.168.1.90/ å¾…è¡¥å……ï¼Œé…ç½®å¾…äº†è§£ å‚è€ƒï¼šhttp://wiki.ubuntu.org.cn/Vsftpdhttps://www.cnblogs.com/stinson/p/5730681.html","link":"/2018/04/24/FTP/vsftpd%E6%90%AD%E5%BB%BAFTP%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"gitæœåŠ¡å™¨çš„æƒé™æ§åˆ¶","text":"æƒé™æ§åˆ¶gitçš„æƒé™æ§åˆ¶æ˜¯é‡‡ç”¨çš„gitoliteï¼Œè‡ªèº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“ï¼ˆgitolite-adminï¼‰ï¼Œä»–ä»¬çš„ç®¡ç†ä¸é…ç½®éƒ½å¯ä»¥é€šè¿‡gitçš„æ–¹å¼ï¼Œåˆ†å¸ƒå¼çš„è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé€šè¿‡pushçš„æ–¹å¼æäº¤åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡æ‰€è°“çš„é’©å­è„šæœ¬è‡ªåŠ¨æ›´æ–°æƒé™æ§åˆ¶æ–‡ä»¶ã€‚1ã€åˆ‡æ¢åˆ°gitç”¨æˆ·ä¸‹(gitä»“åº“æ˜¯åœ¨gitç”¨æˆ·ä¸‹) 1su git gitoliteæœ¬è´¨å°±æ˜¯æ ¹æ®ä½ çš„é…ç½®ï¼Œè‡ªåŠ¨ç”Ÿæˆauthorized_keysæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒè¦æ±‚ä½ çš„authorized_keysæ–‡ä»¶å¿…é¡»æ˜¯ç©ºçš„ï¼Œæˆ–è€…ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹²è„†åˆ äº†å®ƒ 1rm ~/.ssh/authorized_keys gitoliteåœ¨åˆå§‹åŒ–æ—¶éœ€è¦é€šè¿‡æŸä¸€ç”¨æˆ·çš„å…¬é’¥æ–‡ä»¶æŒ‡å®šä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ï¼Œgitoliteå®‰è£…æˆåŠŸåï¼Œåªæœ‰è¿™ä¸ªè¶…çº§ç®¡ç†å‘˜å¯ä»¥æ›´æ–°gitoliteä»¥æ›´æ–°å„ç§æƒé™æ§åˆ¶ï¼ˆåŒ…æ‹¬å¯¹å…¶è‡ªèº«çš„æ›´æ–°æƒé™æ§åˆ¶ï¼‰ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æŒ‡å®šè¯¥è¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„å…¬é’¥æ–‡ä»¶ï¼ˆæœ€å¥½ç›´æ¥å°†å…¶æ‹·è´åˆ°gitç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼ˆä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºä½¿ç”¨åŒä¸€æœåŠ¡å™¨ä¸Šçš„å¦ä¸€å¸¸ç”¨ç®¡ç†å‘˜ç”¨æˆ·adminï¼‰ã€‚ æ–°å»ºadminç”¨æˆ· 12root@ubuntu:~# useradd -m adminroot@ubuntu:~# passwd admin åˆ‡æ¢åˆ°adminä¸‹ï¼Œç”Ÿæˆè¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„å…¬é’¥æ–‡ä»¶ 123root@ubuntu:~# su adminadmin@ubuntu:~$ ssh-keygenadmin@ubuntu:~$ sudo cp .ssh/id_rsa.pub /home/git/id_rsa.pub 2ã€å®‰è£…gitolite``admin@ubuntu:/home/git$ su gitgit@ubuntu:$ cd ~git@ubuntu:$ git clone git://github.com/sitaramc/gitolitegit@ubuntu:$ mkdir -p $HOME/bin #ä¸ºgitoliteçš„äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆåˆ›å»ºç›®å½•git@ubuntu:$ gitolite/install -to $HOME/bin/ # ç¼–è¯‘ç”Ÿæˆå®‰è£…æ–‡ä»¶git@ubuntu:~$ $HOME/bin/gitolite setup -pk id_rsa.pub # å®‰è£…å¹¶åˆå§‹åŒ–ï¼ŒæŒ‡å®šid_rsa.pubå…¬é’¥æ–‡ä»¶å¯¹åº”çš„ç”¨æˆ·ä¸ºè¶…çº§ç®¡ç†å‘˜ 1234 gitoliteå®‰è£…åæœ¬èº«æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“â€”â€”gitolite-adminï¼Œåˆ†å¸ƒå¼çš„è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé€šè¿‡pushçš„æ–¹å¼æäº¤ï¼Œå…¶ä¼šé€šè¿‡é’©å­è„šæœ¬æ‰§è¡Œæƒé™æ›´æ–°ã€‚gitoliteè‡ªåŠ¨ç”Ÿæˆäº†ä¸¤ä¸ªç‰ˆæœ¬åº“ï¼šgitolite-admin.gitå’Œtesting.gitï¼Œå…¶ä¸­çš„gitol-admin.gitå°±æ˜¯é‚£ä¸ªæƒé™æ§åˆ¶çš„ç‰ˆæœ¬åº“ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯å›åˆ°ä½ åˆšåˆšæŒ‡å®šçš„è¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„ç”µè„‘è·Ÿè´¦æˆ·ä¸‹ï¼Œcloneå‡ºgitolite-adminè¿™ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“ï¼ˆå½“å‰æƒ…å†µä¸‹ï¼Œåªæœ‰è¯¥è¶…çº§ç®¡ç†å‘˜è´¦æˆ·å¯ä»¥cloneå¹¶æ›´æ–°gitolite-adminè¿™ä¸ªç‰ˆæœ¬åº“ï¼‰ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„éœ€è¦å¯¹å…¶è¿›è¡Œé…ç½®ï¼ˆå¦‚æ·»åŠ æ›´å¤šçš„ç®¡ç†å‘˜è´¦æˆ·ã€æ·»åŠ æ–°çš„ç‰ˆæœ¬åº“å¹¶ä¸ºä¸åŒçš„ç”¨æˆ·æŒ‡å®šæƒé™ï¼‰3ã€æƒé™è®¾ç½® * root@ubuntu:# su adminadmin@ubuntu:/root$ cd ~admin@ubuntu:$ git clone git@192.168.1.32:gitolite-admin.git 123456å¦‚æœä¸Šé¢çš„æ­¥éª¤éƒ½æˆåŠŸäº†çš„è¯ï¼Œåº”è¯¥å¯ä»¥æŸ¥çœ‹åˆ°æœ‰ä¸€ä¸ªgitolite-adminçš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸¤ä¸ªç›®å½•confã€keydirã€‚cloneé»˜è®¤è·¯å¾„æ˜¯/home/git/repositoriesï¼Œæƒé™æ§åˆ¶æ˜¯åªæœ‰å½“å‰çš„è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·å¯ä»¥è®¿é—®gitolite-adminå’Œtestingä¸¤ä¸ªç‰ˆæœ¬åº“ï¼Œä½ ä¹‹å‰æµ‹è¯•åˆ›å»ºçš„ç‰ˆæœ¬åº“ä¹Ÿå·²ç»æ— æ³•è®¿é—®ï¼Œå¦‚æœä½ å°è¯•å†æ¬¡cloneä¹‹å‰åˆ›å»ºçš„æµ‹è¯•ç‰ˆæœ¬åº“ï¼Œå°±ä¼šæç¤ºæ²¡æœ‰æƒé™ã€‚è¦ç»§ç»­è®¿é—®ä¹‹å‰åˆ›å»ºçš„é¡¹ç›®ï¼Œéœ€è¦å°†è¿™ä¸ªé¡¹ç›®æ·»åŠ åˆ°gitoliteçš„æƒé™æ§åˆ¶å†…ã€‚ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹ä¸ºå½“å‰çš„è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·æŒ‡å®šä¹‹å‰åˆ›å»ºçš„helloworldæµ‹è¯•ç‰ˆæœ¬åº“çš„è¯»å†™æƒé™ï¼ˆå¯è¯»å¯å†™ï¼‰ï¼Œä»¥æ­¤æ¼”ç¤ºgitoliteæŒ‡å®šæƒé™çš„ä¸€èˆ¬æµç¨‹ï¼š1ã€å°†éœ€è¦æŒ‡å®šæƒé™çš„ç”¨æˆ·çš„sshå…¬é’¥æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨gitolite-adminç‰ˆæœ¬åº“çš„keydirç›®å½•ä¸‹ï¼ˆå¦‚æœæäº¤çš„éƒ½æ˜¯id_rsa.pubï¼Œå¯ä»¥å°†å…¶é‡å‘½åä¸ºè¯¥ç”¨æˆ·çš„idæˆ–è€…åç§°ï¼ŒåŒæ—¶ä¹Ÿæ¨èè¿™æ ·é‡å‘½åï¼Œä»¥æ˜ç¤ºå“ªä¸ªå…¬é’¥æ–‡ä»¶æ˜¯å“ªä¸ªç”¨æˆ·çš„ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬åˆå§‹åŒ–æ—¶ï¼Œgitoliteå·²ç»å°†è¯¥è¶…çº§ç®¡ç†å‘˜çš„å…¬é’¥æ–‡ä»¶è‡ªåŠ¨æ‹·è¿›å»äº†ï¼Œæ‰€ä»¥çœç•¥æ­¤æ­¥éª¤ã€‚2ã€ç¼–è¾‘confç›®å½•ä¸‹çš„gitolite.confæ–‡ä»¶ï¼Œæ·»åŠ helloworldç‰ˆæœ¬åº“ç®¡ç†ç»„ï¼Œä¸ºè¶…çº§ç®¡ç†å‘˜æŒ‡å®šè¯»å†™æƒé™ï¼ˆRW+ï¼Œå…·ä½“çš„æƒé™å®šä¹‰ï¼Œå‚è€ƒgitoliteå®˜æ–¹æ–‡æ¡£ï¼‰ repo gitolite-adminRW+ = id_rsa repo testing RW+ = @all repo helloworld RW+ = id_rsa 13ã€commitåˆ°æœ¬åœ° git commit -am â€˜add the helloworld repo and add RW+ to id_rsaâ€™ 1æäº¤æ—¶ï¼Œé¦–å…ˆè¦ç”¨åç§° git config â€“global user.email â€œyou@example.comâ€œgit config â€“global user.name â€œYour Nameâ€ 14ã€pushåˆ°gitä»“åº“ git push pushæˆåŠŸï¼Œå½“å‰è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·åº”è¯¥å°±å¯ä»¥æˆåŠŸclone helloworldç‰ˆæœ¬åº“ï¼Œå¹¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ä¸pushç­‰æ“ä½œäº†ã€‚ å‚è€ƒï¼šhttp://blog.csdn.net/xsl1990/article/details/25486211 https://github.com/sitaramc/gitolite","link":"/2017/08/28/Git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"gitæœåŠ¡å™¨çš„åˆæ­¥ç®€å•éƒ¨ç½²","text":"gitæœåŠ¡å™¨çš„åˆæ­¥ç®€å•éƒ¨ç½²ç¯å¢ƒï¼šgitæœåŠ¡å™¨Ubuntuï¼Œå¼€å‘æœºå™¨Windows 7ã€‚ 1ã€å®‰è£…git 1$ apt-get install git2.åˆ›å»ºgitç”¨æˆ·åŠæƒé™ 12root@ubuntu:/# adduser -m gitroot@ubuntu:/# passwd git æ·»åŠ gitç”¨æˆ·åä¼šåœ¨/homeä¸‹ç”Ÿæˆgitç›®å½•ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›è¿™ä¸ªç”¨æˆ·é€šè¿‡sshè¿æ¥åˆ°æœåŠ¡å™¨ä¸Šé¢å»ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ç¦æ­¢è¿™ä¸ªç”¨æˆ·ä½¿ç”¨sshè¿æ¥ä¸Šå»è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬é€šè¿‡ç¼–è¾‘/etc/passwdæƒé™æ–‡ä»¶æ¥å¤„ç†ã€‚ 12#git:x:1001:1001:,,,:/home/git:/bin/bashgit:x:1001:1001:,,,:/home/git:/usr/bin/git-shell3ã€åœ¨å¼€å‘æœºå™¨ä¸Šç”Ÿæˆå…¬é’¥ é¦–å…ˆä¸‹è½½å®‰è£…git åœ¨æœ¬æœºç”Ÿæˆå¯†é’¥ï¼š1234567891011121314151617181920212223admin@admin-PC MINGW64 ~$ ssh-keygen.exeGenerating public/private rsa key pair.Enter file in which to save the key (/c/Users/admin/.ssh/id_rsa):Created directory '/c/Users/admin/.ssh'.Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in /c/Users/admin/.ssh/id_rsa.Your public key has been saved in /c/Users/admin/.ssh/id_rsa.pub.The key fingerprint is:SHA256:49440Ss8DHEeufZG9U7sQWhe+zUOkkCvyEMjReHdwcg admin@admin-PCThe key's randomart image is:+---[RSA 2048]----+| .oo o. || ...E... || ...o.. . || ..o+. .+ o || ++S+o+.= . || .==ooo..*..|| =o+ ..+ooo|| .*o+ o..|| o=. |+----[SHA256]-----+ æŠŠC:\\Users\\admin.sshä¸‹çš„id_rsa.pubå‘é€åˆ°gitæœåŠ¡å™¨ä¸Š4ã€åœ¨æœåŠ¡å™¨é…ç½®å…¬é’¥1234$ cd /home/git/$ mkdir .ssh$ cd .ssh$ vi authorized_keys æŠŠå¼€å‘æœºå™¨ä¸Šçš„id_rsa.pubæ–‡ä»¶å†…å®¹æ·»åŠ ä¿å­˜åˆ°authorized_keysæ–‡ä»¶ã€‚5ã€åˆå§‹åŒ–ä¸€ä¸ªgitä»“åº“12345678root@ubuntu:/home/git# su gitgit@ubuntu:~$ mkdir /home/git/repositoriesgit@ubuntu:~$ chown git:git /home/git/repositories/git@ubuntu:~$ chmod 755 /home/git/repositories/git@ubuntu:~$ cd repositories/git@ubuntu:~/repositories$ mkdir helloworld.gitgit@ubuntu:~/repositories$ cd helloworld.git/git@ubuntu:~/repositories/helloworld.git$ git --bare init 6ã€åœ¨æœ¬åœ°å…‹éš†testä»“åº“1$ git clone git@192.168.1.32:/home/git/repositories/helloworld.git 7ã€å¤šç”¨æˆ·ä¸æƒé™ç®¡ç†å¦‚æœå›¢é˜Ÿäººæ•°è¾ƒå°‘ï¼ŒæŠŠæ¯ä¸ªäººçš„å…¬é’¥æ”¶é›†èµ·æ¥æ”¾åˆ°æœåŠ¡å™¨çš„/home/git/.ssh/authorized_keysæ–‡ä»¶é‡Œå°±æ˜¯å¯è¡Œçš„ã€‚å¦‚æœå›¢é˜Ÿäººæ•°è¾ƒå¤šï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨Gitosisæ¥ç®¡ç†å…¬é’¥ã€‚","link":"/2017/08/23/Git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"gitæœåŠ¡å™¨çš„ç”¨æˆ·ç®¡ç†","text":"1ã€æ·»åŠ ç”¨æˆ· è¦æ·»åŠ æ–°ç”¨æˆ·aliceï¼Œbobå’Œcarolï¼Œé¦–å…ˆè·å–ä»–ä»¬çš„å…¬é’¥ï¼Œå¹¶å°†å®ƒä»¬åˆ†åˆ«æ·»åŠ åˆ°ç®¡ç†å‘˜â€œgitolite-admin/keydirâ€ä½œä¸ºalice.pubï¼Œbob.pubå’Œcarol.pubã€‚(ä»¥ç”¨æˆ·åè¿›è¡Œå‘½åã€‚) è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ä»“åº“repo:foo,å¹¶ç»™äºˆä¸Šè¿°è¿™äº›ç”¨æˆ·ä¸åŒçº§åˆ«çš„è®¿é—®æƒé™ç¼–è¾‘ vim conf/gitolite.conf1234repo foo RW+ = alice RW = bob R = carol å®Œæˆè¿™äº›æ›´æ”¹åï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š1234git add confgit add keydirgit commit -m &quot;added foo, gave access to alice, bob, carol&quot;git push pushå®Œä¹‹åï¼Œgitoliteå°†æ·»åŠ æ–°çš„ç”¨æˆ·åˆ° ~/.ssh/authorized_keysæœåŠ¡å™¨ä¸Šï¼Œä»¥åŠåˆ›å»ºä¸€ä¸ªåä¸ºfooçš„ç©ºçš„repoã€‚ 2ã€è®¿é—®è§„åˆ™ 1234567repo foo RW+ = alice - master = bob - refs/tags/v[0-9] = bob RW = bob RW refs/tags/v[0-9] = carol R = dave aliceå¯ä»¥å¯¹ä»»ä½•åˆ†æ”¯æˆ–æ ‡ç­¾åšä»»ä½•äº‹æƒ…, åˆ›å»ºï¼Œæ¨é€ï¼Œåˆ é™¤,æ’¤å›ï¼Œè¦†ç›–ç­‰ã€‚ bob å¯ä»¥åˆ›å»ºæˆ–æ¨é€åç§°ä¸ä»¥â€œmasterâ€å¼€å¤´çš„åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºåç§°ä¸ä»¥â€œvâ€+æ•°å­—å¼€å¤´çš„ä»»ä½•æ ‡ç­¾ã€‚ carolå¯ä»¥åˆ›å»ºåç§°ä»¥â€œvâ€+æ•°å­—å¼€å¤´çš„æ ‡ç­¾ã€‚ daveä»…å¯ä»¥å…‹éš†ã€‚3ã€ç»„ æ–¹ä¾¿ç¾¤ç»„ç”¨æˆ·ç®¡ç†ï¼Œä¸‹é¢æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªç»„123456789@staff = alice bob carol@interns = ashokrepo secret RW = @staffrepo foss RW+ = @staff RW = @interns ç»„åˆ—è¡¨ç´¯ç§¯ã€‚ä»¥ä¸‹ä¸¤è¡Œä¸ä¸Šé¢çš„@staffçš„æ—©æœŸå®šä¹‰å…·æœ‰ç›¸åŒçš„æ•ˆæœï¼š12@staff = alice bob@staff = carol å¯ä»¥åœ¨å…¶å®ƒç»„ä¸­ä½¿ç”¨ç»„å1@all-devs = @staff @interns å¸®åŠ©ç”¨æˆ·1ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ git clone git@host:reponameçš„å½¢å¼å…‹éš†ä»“åº“ã€‚2ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ ssh git@host info æŸ¥çœ‹å¯è®¿é—®çš„ä»“åº“åŠæƒé™ã€‚3ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ ssh git@host helpè·å–å¸®åŠ©ã€‚","link":"/2017/08/28/Git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%B8%89%EF%BC%89/"},{"title":"åˆ©ç”¨Antè¿›è¡Œå¯¹Jenkinsè‡ªåŠ¨éƒ¨ç½²é¡¹ç›®","text":"æ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ é€‰æ‹© â€æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®â€ é¡¹ç›®åç§°ä¸æè¿° github project :é‡Œé¢é…ç½®å“åº”çš„urlå’Œéœ€è¦æ˜¾ç¤ºçš„åç§°å°±å¯ä»¥äº†ã€‚ throttle buildsï¼šèŠ‚æµæ„å»ºï¼Œé€šè¿‡è®¾ç½®æ—¶é—´æ®µå†…å…è®¸å¹¶å‘çš„æ¬¡æ•°æ¥å®ç°æ„å»ºçš„æ§åˆ¶ã€‚ ä¸¢å¼ƒæ—§çš„æ„å»ºï¼šè®¾ç½®æ„å»ºå†å²çš„ä¿å­˜ç­–ç•¥ã€‚ å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼šé‡Œé¢å¯ä»¥é…ç½®ä¸åŒçš„å‚æ•°ï¼Œä¾¿äºåœ¨æ„å»ºæ—¶å¼•ç”¨è¿™äº›å‚æ•°ã€‚ å…³é—­æ„å»ºï¼šè¿™æ ·é¡¹ç›®å°±æ²¡æ³•è¿›è¡Œæ„å»ºäº†ã€‚ åœ¨å¿…è¦æ—¶è¿›è¡Œå¹¶å‘æ„å»ºï¼šæ»¡è¶³ç­–ç•¥è¦æ±‚æ—¶å°±ä¼šè¿›è¡Œå¹¶å‘æ„å»ºã€‚ å®‰é™æœŸï¼šè®¾ç½®ä¸€ä¸ªæ—¶é—´æ¥é—´éš”æ¯æ¬¡æ„å»ºçš„é—´éš”ã€‚ é‡è¯•æ¬¡æ•°ï¼šè¿™ä¸ªå’Œç³»ç»Ÿè®¾ç½®çš„ä¸€æ ·ï¼Œæ‹‰å–æºç é‡è¯•çš„æ¬¡æ•°ã€‚ è¯¥é¡¹ç›®çš„ä¸Šæ¸¸é¡¹ç›®æ­£åœ¨æ„å»ºæ—¶é˜»æ­¢è¯¥é¡¹ç›®æ„å»ºä¸è¯¥é¡¹ç›®çš„ä¸‹æ¸¸é¡¹ç›®æ­£åœ¨æ„å»ºæ—¶é˜»æ­¢è¯¥é¡¹ç›®æ„å»ºï¼šç”¨äºä¸Šä¸‹æ¸¸é¡¹ç›®æœ‰å…³è”çš„æ„å»ºç­–ç•¥ã€‚ ä½¿ç”¨è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ï¼šä½¿è¯¥é¡¹ç›®ç‹¬ç«‹äºç³»ç»Ÿçš„å·¥ä½œç©ºé—´ã€‚ ä¿ç•™æ„å»ºçš„ä¾èµ–æ—¥å¿—ã€‚ æºç ç®¡ç† ä»¥svnä¸ºä¾‹ repository url:å¡«å†™ä»“åº“çš„åœ°å€ Credentialsï¼šè¿™é‡Œéœ€è¦é…ç½®æ‹‰å–svnæºç çš„ç”¨æˆ·åå’Œå¯†ç  Local module directoryï¼šå…·ä½“çš„é¡¹ç›®çš„è·¯å¾„ï¼Œé»˜è®¤ä»æ ¹ç›®å½•æ‹‰å– Additional Credentialsï¼šå¢åŠ é¢å¤–è®¤è¯ Check-out Strategyï¼šä»£ç æ£€å‡ºç­–ç•¥ æºç åº“æµè§ˆå™¨ï¼šè¿™é‡Œé»˜è®¤å°±å¯ä»¥äº† æ„å»ºè§¦å‘å™¨ è§¦å‘è¿œç¨‹æ„å»º (ä¾‹å¦‚,ä½¿ç”¨è„šæœ¬)ï¼šè¿™é‡Œä½¿ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºï¼Œæ‹¼æ¥urlåå†™å…¥ä»£ç ä¸­å¯ä»¥å®ç°åœ¨è„šæœ¬æˆ–è€…å·¥å…·æ‰§è¡Œæ„å»º Build after other projects are built:æ„å»ºä¸å…¶ä»–é¡¹ç›®æ„å»ºåï¼Œç”¨äºä¸Šä¸‹æ¸¸é¡¹ç›®æœ‰å…³è”çš„æ—¶å€™ Build periodicallyï¼šå®šæ—¶æ‰§è¡Œæ„å»º æ—¥ç¨‹è¡¨çš„å‚æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯åˆ†é’Ÿ minuteï¼Œå–å€¼ 059ï¼›ç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯å°æ—¶ hourï¼Œå–å€¼ 023ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯å¤© dayï¼Œå–å€¼ 131ï¼›ç¬¬å››ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯æœˆ monthï¼Œå–å€¼ 112ï¼›æœ€åä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯æ˜ŸæœŸ weekï¼Œå–å€¼ 0~7ï¼Œ0 å’Œ 7 éƒ½æ˜¯è¡¨ç¤ºæ˜ŸæœŸå¤©ã€‚ Poll SCMï¼šè®¾ç½®å®šæ—¶æ£€æŸ¥ä»£ç ä»“åº“æ˜¯å¦æœ‰å˜æ›´ï¼Œæœ‰å˜æ›´åˆ™æ„å»º æ„å»ºç¯å¢ƒ Delete workspace before build startsï¼šåœ¨æ„å»ºä¹‹å‰æ¸…ç©ºå·¥ä½œç©ºé—´ Abort the build if itâ€™s stuckï¼šå¦‚æœæ„å»ºå‡ºç°é—®é¢˜åˆ™ç»ˆæ­¢æ„å»º Add timestamps to the Console Outputï¼šç»™æ§åˆ¶å°è¾“å‡ºå¢åŠ æ—¶é—´æˆ³ Use secret text(s) or file(s)ï¼šä½¿ç”¨åŠ å¯†æ–‡ä»¶æˆ–è€…æ–‡æœ¬ æ„å»º execute windows batch command:æ‰§è¡Œwindowsçš„cmdã€‚ execute shell:æ‰§è¡Œshellå‘½ä»¤ã€‚ invoke ant:è°ƒç”¨ant ,è°ƒç”¨antçš„æ‰§è¡Œè„šæœ¬æ¥è¿›è¡Œæ„å»ºã€‚ invoke gradle script :è°ƒç”¨gradeè„šæœ¬ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨æ‰“åŒ…ã€‚ invoke top-level maven targets:è°ƒç”¨mavenã€‚ æ„å»ºåæ“ä½œ build other projects:æ„å»ºå…¶ä»–é¡¹ç›® e-mail notification:å‘é€é‚®ä»¶ editable email notification:å‘é€é‚®ä»¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œä»¥åä¼šå•ç‹¬ä»‹ç»è¿™ä¸ªæ’ä»¶ï¼‰ delete workspace when build is done:æ„å»ºååˆ é™¤å·¥ä½œç©ºé—´ Deploy war/ear to a containerï¼šéƒ¨ç½²waråŒ…åˆ°æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šwaråŒ…åœ°å€å¿…é¡»ä¸ºç›¸å¯¹è·¯å¾„ã€‚å…¶ç»å¯¹è·¯å¾„ä¸º/root/.jenkins/workspace/materielshop/materielshop.warä¿®æ”¹ç›¸åº”tomcaté…ç½®æ–‡ä»¶ config/tomcat-users.xmlæ·»åŠ å¦‚ä¸‹ï¼š 1234&lt;role rolename=&quot;manager-script&quot;/&gt;&lt;role rolename=&quot;manager-gui&quot;/&gt;&lt;role rolename=&quot;manager-status&quot;/&gt; &lt;user username=&quot;deploy&quot; password=&quot;deploy&quot; roles=&quot;manager-script,manager-gui,manager-status&quot;/&gt; å¦‚tomcatç®¡ç†ä¸åœ¨æœåŠ¡æœ¬æœºç®¡ç†ï¼Œéœ€ä¿®æ”¹ï¼šwebapps/manager/META-INF/context.xmlæ³¨é‡Šæ‰å¦‚ä¸‹ä¿¡æ¯ï¼š 1234&lt;!-- &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt; --&gt; å…¶å®ƒï¼šantæ„å»ºæ—¶çš„build.xml(ä»…å‚è€ƒ) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt; &lt;project basedir=&quot;.&quot; default=&quot;warFile&quot; name=&quot;materielshop&quot;&gt; &lt;property environment=&quot;env&quot;/&gt; &lt;property name=&quot;destdir&quot; value=&quot;${basedir}/build/classes&quot; /&gt; &lt;property name=&quot;srcdir&quot; value=&quot;${basedir}/src&quot; /&gt; &lt;property name=&quot;classpath_lib&quot; value=&quot;${basedir}/web/WEB-INF/lib&quot; /&gt; &lt;property name=&quot;tomcat&quot; value=&quot;/opt/tomcat/tomcat9100&quot; /&gt; &lt;property name=&quot;war.output.dir&quot; value=&quot;${basedir}&quot;&gt;&lt;/property&gt; &lt;property name=&quot;warFileName&quot; value=&quot;materielshop.war&quot;&gt;&lt;/property&gt; &lt;property name=&quot;debuglevel&quot; value=&quot;source,lines,vars&quot;/&gt; &lt;property name=&quot;target&quot; value=&quot;1.8&quot;/&gt; &lt;property name=&quot;source&quot; value=&quot;1.8&quot;/&gt; &lt;path id=&quot;tomcatlib&quot;&gt; &lt;fileset dir=&quot;${tomcat}/lib&quot;&gt; &lt;include name=&quot;*.jar&quot;/&gt; &lt;/fileset&gt; &lt;/path&gt; &lt;path id=&quot;classpath&quot;&gt; &lt;path refid=&quot;tomcatlib&quot;/&gt; &lt;fileset dir=&quot;${classpath_lib}&quot;&gt; &lt;include name=&quot;*.jar&quot;/&gt; &lt;/fileset&gt; &lt;/path&gt; &lt;target name=&quot;init&quot;&gt; &lt;mkdir dir=&quot;build/classes&quot;/&gt; &lt;copy includeemptydirs=&quot;false&quot; todir=&quot;build/classes&quot;&gt; &lt;fileset dir=&quot;src&quot;&gt; &lt;exclude name=&quot;**/*.launch&quot;/&gt; &lt;exclude name=&quot;**/*.java&quot;/&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;copy includeemptydirs=&quot;false&quot; todir=&quot;build/classes&quot;&gt; &lt;fileset dir=&quot;resources&quot;&gt; &lt;exclude name=&quot;**/*.launch&quot;/&gt; &lt;exclude name=&quot;**/*.java&quot;/&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;copy includeemptydirs=&quot;false&quot; todir=&quot;build/classes&quot;&gt; &lt;fileset dir=&quot;dbmodel&quot;&gt; &lt;exclude name=&quot;**/*.launch&quot;/&gt; &lt;exclude name=&quot;**/*.java&quot;/&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;/target&gt; &lt;target name=&quot;clean&quot;&gt; &lt;delete dir=&quot;build/classes&quot;/&gt; &lt;/target&gt; &lt;target depends=&quot;init&quot; name=&quot;build&quot;&gt; &lt;echo message=&quot;${ant.project.name}: ${ant.file}&quot;/&gt; &lt;javac debug=&quot;true&quot; debuglevel=&quot;${debuglevel}&quot; srcdir=&quot;${srcdir}&quot; destdir=&quot;${destdir}&quot; includeantruntime=&quot;false&quot; source=&quot;${source}&quot; target=&quot;${target}&quot;&gt; &lt;src path=&quot;src&quot;/&gt; &lt;src path=&quot;resources&quot;/&gt; &lt;src path=&quot;dbmodel&quot;/&gt; &lt;compilerarg line=&quot;-encoding UTF-8 &quot;/&gt; &lt;classpath refid=&quot;classpath&quot;/&gt; &lt;/javac&gt;&lt;/target&gt; &lt;target name=&quot;warFile&quot; depends=&quot;build&quot;&gt; &lt;!-- åˆ é™¤åŸæœ‰waråŒ…ã€‚ --&gt; &lt;delete dir=&quot;${war.output.dir}/${warFileName}&quot; /&gt; &lt;!-- å»ºç«‹æ–°waråŒ…ã€‚ --&gt; &lt;war destfile=&quot;${war.output.dir}/${warFileName}&quot; webxml=&quot;${basedir}/web/WEB-INF/web.xml&quot;&gt; &lt;!-- æ‹·è´webä¸‹é™¤äº†WEB-INFå’ŒMETA-INFçš„ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚ --&gt; &lt;fileset dir=&quot;web&quot;&gt; &lt;include name=&quot;**/**.*&quot; /&gt; &lt;exclude name=&quot;**/WEB-INF/lib/**&quot;/&gt; &lt;/fileset&gt; &lt;!-- å°†jarå’Œclassæ–‡ä»¶æ‹·è´åˆ°waråŒ…çš„å¯¹åº”è·¯å¾„ä¸‹ã€‚ --&gt; &lt;lib dir=&quot;${basedir}/web/WEB-INF/lib&quot; /&gt; &lt;classes dir=&quot;${basedir}/build/classes&quot; /&gt; &lt;/war&gt;&lt;/target&gt;&lt;/project&gt; å‚è€ƒï¼šhttps://www.jianshu.com/p/a154f2a1d0c3","link":"/2018/01/18/Jenkins/jenkins%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%9B%9B%EF%BC%89/"},{"title":"jenkins","text":"åœ¨æ„å»ºæœåŠ¡å™¨å®‰è£…ä¸€ä¸ªjenkins æœåŠ¡åœ¨æœ¬æœºéƒ¨ç½²å®‰è£…Jenkinså¾ˆç®€å•ï¼Œä½†è¦åœ¨ä¸€ä¸ªåˆé€‚çš„æ„å»ºæœåŠ¡å™¨ä¸Šå®‰è£…Jenkinså°±éœ€è¦ç¨å¾®å¸ƒç½®ä¸€ä¸‹äº†ã€‚ åœ¨Linuxä¸Šå®‰è£…Jenkinsï¼Œå¥½çš„åšæ³•æ˜¯ä¸ºJenkinså¸¸è§ä¸€ä¸ªç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œè¿™ä½¿å¾—åœ¨ç›‘æ§æ„å»ºæ‰€ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºåŠæ’æŸ¥é—®é¢˜æ„å»ºæ›´æ–¹ä¾¿ã€‚ ä¸¤ç§å®‰è£…å¯åŠ¨æ–¹å¼##ä¸€ã€Jenkinsç”¨æˆ·waråŒ…å¯åŠ¨ å‡†å¤‡æ„å»ºæœåŠ¡å™¨1ã€åˆ›å»ºJenkinsç”¨æˆ·åŠç”¨æˆ·ç»„ã€‚ 12$ sudo groupadd build$ sudo useradd --create-home --shell /bin/bash --groups build jenkins 2ã€ä¸ºJenkinsç”¨æˆ·é…ç½®ç¯å¢ƒå˜é‡vim /home/jenkins/.bashrc 12export JAVA_HOME=/opt/java/jdk1.8.0_101export PATH=$JAVA_HOME/bin:$PATH è¿™æ ·å°±å¯ä»¥åœ¨ç‹¬ç«‹çš„ç¯å¢ƒä¸­ä½¿ç”¨jenkinsè¿™ä¸ªç”¨æˆ·è¿è¡ŒJenkinsäº†ã€‚ Jenkinsä¸»ç›®å½•æ— è®ºæŠŠwaræ–‡ä»¶æ”¾åœ¨å“ªå„¿ï¼ŒJenkinsåœ¨è¿è¡ŒæœåŠ¡åéƒ½ä¼šæŠŠå®ƒæ‰€æœ‰é‡è¦çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªä¸“ç”¨çš„ã€éš”ç¦»çš„Jenkinsç›®å½•ä¸‹ã€‚ä¼šå­˜å‚¨å…³äºæ„å»ºæœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€æ„å»ºä½œä¸šã€æ„å»ºäº§ç‰©ã€æ’ä»¶å’Œä¸€äº›å…¶ä»–çš„ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹Jenkinsä¸»ç›®å½•åœ¨å½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.jenkinsã€‚å¯ä»¥é€šè¿‡å®šä¹‰JENKINS_HONMEç¯å¢ƒå˜é‡æ”¹å˜Jenkinsçš„ä¸»ç›®å½• ä»¥jenkinsç”¨æˆ·å¯åŠ¨Jenkins12$ sudo su - jenkins$ java -jar /usr/local/jenkins/jenkins.war å…¶ä»–å‚æ•°ï¼šâ€“httpPort=8080 â€“prefix=jenkins â€“daemon â€“logfile=/var/logs/jenkins.log ##äºŒã€å®‰è£…ä¸ºæœåŠ¡ åœ¨debianæˆ–ubuntuä¸Šå®‰è£…Jenkins1234$ wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -$ sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'$ sudo apt-get update$ sudo apt-get install jenkins è¿™ç§æ–¹å¼æŠŠJenkinså®‰è£…æˆä¸€ä¸ªæœåŠ¡ï¼Œåœ¨/etc/init.d/jenkinsé…ç½®äº†å¯åŠ¨è„šæœ¬ã€‚åŒæ—¶æœ‰ä¸€ä¸ªç›¸åº”çš„ç³»ç»Ÿç”¨æˆ·åâ€˜jenkinsâ€™ã€‚Jenkinsçš„ä¸»ç›®å½•ä¸º/var/lib/jenkinsã€‚æ—¥å¿—æ–‡ä»¶åœ¨/var/log/jenkins/jenkins.logã€‚è°ƒæ•´é…ç½®å‚æ•°åœ¨/etc/default/jenkinsã€‚ å…¶ä»–å®‰è£…å‚è€ƒï¼šjenkins_install","link":"/2019/11/06/Jenkins/jenkins/"},{"title":"Jenkinsåº”ç”¨--ä¸Šä¼ æ–‡ä»¶è‡³ä¸ƒç‰›","text":"ä¸Šä¼ å‰ç«¯æ–‡ä»¶è‡³ä¸ƒç‰› åœ¨UbuntuæœåŠ¡å™¨ä¸Šæ­å»ºäº†SambaæœåŠ¡ã€‚ æ›´æ–°å‰ç«¯æ–‡ä»¶æ—¶ï¼Œåªè¦æŠŠå‹ç¼©åŒ…ä¸Šä¼ è‡³å…±äº«æ–‡ä»¶å¤¹çš„æŒ‡å®šç›®å½•ï¼Œç„¶åé€šè¿‡jenkinsè¿›è¡Œæ„å»ºæ—¶ï¼Œä¼šè§£å‹å‰ç«¯çš„å‹ç¼©åŒ…ï¼Œç„¶åæŠŠè§£å‹åçš„æ–‡ä»¶æ‹·è´åˆ°jenkinså·¥ä½œç©ºé—´ï¼Œç„¶åé€šè¿‡ä¸ƒç‰›ä¸Šä¼ æ’ä»¶ä¸Šä¼ åˆ°ä¸ƒç‰›ç©ºé—´ï¼Œå¹¶æŠŠindexæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨nginxæ–‡ä»¶å¤¹ä¸‹ã€‚ 12345678910111213141516171819202122232425262728#!/bin/bashQINIUPREFIX=jndjrd #ä¸ƒç‰›å‰ç¼€FILE_DIR=/ssdb2/share/front/qiniu/jndjrdUNPACK_DIR=$FILE_DIR/unpack #è§£å‹è¾“å‡ºç›®å½•PROJECT_DIR=$WORKSPACE/$QINIUPREFIX #ä¸Šä¼ æ–‡ä»¶ç›®å½•cd $FILE_DIRzipCnt=`ls -l |grep \"^-\"|wc -l`echo \"zipCnt=$zipCnt\"if [ \"$zipCnt\" -eq \"1\" ];then cp $FILE_DIR/* /ssdb2/share/front/backup/ #å¤‡ä»½ zipName=`find *.zip` echo \"zipName=$zipName\" unzip $zipName -d $UNPACK_DIRelse echo \"å‹ç¼©æ–‡ä»¶å­˜åœ¨ $zipCnt ä¸ªï¼Œæ„å»ºé€€å‡º\" set -e #æ³¨æ„ï¼Œä¸€å®šè¦å…ˆè®¾ç½®è¿™ä¸ª exit 1 #ç„¶åå†é€€å‡ºï¼Œjenkinså°±ä¼šæŠ¥çº¢æ˜¾ç¤ºæ„å»ºå¤±è´¥fiecho $WORKSPACErm -r $PROJECT_DIR/mkdir $PROJECT_DIRcd $UNPACK_DIR/*/cp -r ./ $PROJECT_DIRrm -r $FILE_DIR/* #æ¸…ç©ºç›®å½•ï¼Œæ³¨æ„ï¼šåˆ é™¤é«˜å±æ“ä½œï¼ï¼ï¼ï¼ è„šæœ¬å®ç°çš„ä¸»è¦æ˜¯åˆ¤æ–­ä¸Šä¼ è¦æ›´æ–°çš„æ–‡ä»¶å¤¹çš„å‰ç«¯å‹ç¼©åŒ…ä¸ªæ•°ï¼Œå¦‚æœå‹ç¼©åŒ…ä¸ªæ•°ä¸º1ï¼Œåˆ™ æ‹·è´å‹ç¼©åŒ…è‡³å¤‡ä»½ç›®å½•ä¸‹ï¼Œç„¶åè§£å‹å‹ç¼©åŒ…åˆ°unpackæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åæ¸…ç©ºjenkinså·¥ä½œç©ºé—´ä¸Šæ¬¡æ„å»ºçš„æ–‡ä»¶ï¼Œæ¥ç€æŠŠè§£å‹åçš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç©ºé—´ï¼Œç­‰å¾…ç€é€šè¿‡jenkinsæ’ä»¶è¿›è¡Œä¸Šä¼ ã€‚ç„¶åæ¸…ç©ºä¸Šä¼ çš„ç›®å½•ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ›´æ–°ä¸Šä¼ å‹ç¼©åŒ…ã€‚","link":"/2019/12/27/Jenkins/jenkins%E5%BA%94%E7%94%A8--%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E8%87%B3%E4%B8%83%E7%89%9B/"},{"title":"Jenkinså…¨å±€å·¥å…·é…ç½®","text":"jenkinsç³»ç»Ÿç®¡ç†ã€‹å…¨å±€å·¥å…·é…ç½® å®‰è£…å¥½Jenkins,å®Œæˆç³»ç»Ÿé…ç½®ä¹‹å,ç„¶åé…ç½®å…¨å±€å·¥å…·ï¼Œé…ç½®JDKï¼ŒGitï¼ŒGradleï¼ŒAntï¼ŒMavenç­‰å·¥å…·ï¼Œå•å‡»Addï¼ˆæ–°å¢ï¼‰æŒ‰é’®ï¼Œæ·»åŠ å®ä¾‹çš„åç§°å’Œç³»ç»Ÿç»å¯¹åœ°å€ã€‚jdkã€antã€Maven","link":"/2018/01/16/Jenkins/jenkins%E5%85%A8%E5%B1%80%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE(%E4%B8%89)/"},{"title":"Jenkinså®‰è£…éƒ¨ç½²","text":"jenkinsæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·ï¼Œç”¨äºç›‘æ§æŒç»­é‡å¤çš„å·¥ä½œ,ä½¿è½¯ä»¶æŒç»­é›†æˆã€‚ åŠŸèƒ½ï¼š æŒç»­ã€è‡ªåŠ¨åœ°æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€‚ ç›‘æ§ä¸€äº›å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ã€‚ç‰¹æ€§ï¼š æ˜“äºå®‰è£…-åªè¦æŠŠjenkins.waréƒ¨ç½²åˆ°servletå®¹å™¨ï¼Œä¸éœ€è¦æ•°æ®åº“æ”¯æŒã€‚ æ˜“äºé…ç½®-æ‰€æœ‰é…ç½®éƒ½æ˜¯é€šè¿‡å…¶æä¾›çš„webç•Œé¢å®ç°ã€‚ é›†æˆRSS/E-mailé€šè¿‡RSSå‘å¸ƒæ„å»ºç»“æœæˆ–å½“æ„å»ºå®Œæˆæ—¶é€šè¿‡e-mailé€šçŸ¥ã€‚ ç”ŸæˆJUnit/TestNGæµ‹è¯•æŠ¥å‘Šã€‚ åˆ†å¸ƒå¼æ„å»ºæ”¯æŒJenkinsèƒ½å¤Ÿè®©å¤šå°è®¡ç®—æœºä¸€èµ·æ„å»º/æµ‹è¯•ã€‚ æ–‡ä»¶è¯†åˆ«:Jenkinsèƒ½å¤Ÿè·Ÿè¸ªå“ªæ¬¡æ„å»ºç”Ÿæˆå“ªäº›jarï¼Œå“ªæ¬¡æ„å»ºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„jarç­‰ã€‚ æ’ä»¶æ”¯æŒ:æ”¯æŒæ‰©å±•æ’ä»¶ã€‚ å®‰è£…ï¼šä»Jenkinså®˜æ–¹ç½‘ç«™https://jenkins.io/ä¸‹è½½æœ€æ–°çš„waråŒ…ã€‚è®¾ç½®jenkinså·¥ä½œç©ºé—´åŠæ—¶é—´vim /etc/profile 123#jenkinsexport JENKINS_HOME=/usr/local/jenkinsexport JENKINS_JAVA_OPTIONS=&quot;-Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai&quot; å¯åŠ¨ ç¬¬ä¸€ç§ 1$ java -jar jenkins.jar åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8080/åœ¨åå°ä»¥9999ç«¯å£å¯åŠ¨ 1$ nohup java -jar jenkins.war --httpPort=9999 &amp; ç¬¬äºŒç§æŠŠwaråŒ…æ”¾åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨tomcatå³å¯ã€‚åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8080/jenkins ç¬¬ä¸€æ¬¡å¯åŠ¨Jenkinsæ—¶ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒJenkinsä¼šåœ¨æ§åˆ¶å°è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„å®‰è£…å£ä»¤ã€‚Jenkinsé»˜è®¤å·¥ä½œç©ºé—´ä¸ºç³»ç»Ÿç”¨æˆ·çš„æ ¹ç›®å½•ä¸‹.jenkinsï¼Œå³ ~/.jenkinsã€‚ä¹Ÿå¯è®¾å®šJenkinsçš„å·¥ä½œç©ºé—´ï¼Œå³åœ¨ç¯å¢ƒå˜é‡ä¸­å®šä¹‰JENKINS_HOMEå˜é‡ã€‚","link":"/2018/01/16/Jenkins/jenkins%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"Jenkinsç³»ç»Ÿé…ç½®","text":"jenkinsç³»ç»Ÿç®¡ç†ã€‹ç³»ç»Ÿé…ç½® jenkins éƒ¨ç½²å®Œæˆåï¼Œéœ€è¦è¿›è¡Œç³»ç»Ÿè®¾ç½®ã€‚ ä¸»ç›®å½•ï¼šé»˜è®¤æ˜¯ç”¨æˆ·ç›®å½•ä¸‹çš„ .jenkinsï¼Œè¯¥ç›®å½•ä¸‹ä¸»è¦å­˜å‚¨Jenkinsæ‰€æœ‰çš„æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡JENKINS_HOMEæ¥ä¿®æ”¹è¯¥è·¯å¾„ã€‚ ç³»ç»Ÿæ¶ˆæ¯ï¼šè®¾ç½®äº†è¯¥ä¿¡æ¯ä¹‹åï¼Œä¼šæ˜¾ç¤ºåœ¨é¦–é¡µé¡¶éƒ¨ï¼Œä¸»è¦æ˜¯ç”¨æ¥å‘å¸ƒç³»ç»Ÿå…¬å‘Šã€‚ æ‰§è¡Œè€…æ•°é‡ï¼šè¡¨ç¤ºæœ¬æœºåŒæ—¶å¯ä»¥æ‰§è¡Œçš„æ„å»ºæ•°ç›®ï¼Œé»˜è®¤ä¸º2ï¼Œè¯´æ˜æœ€å¤šå¯åŒæ—¶è¿›è¡Œ2ä¸ªé¡¹ç›®æ„å»ºï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºç¦æ­¢æ„å»ºã€‚ æ ‡è®°ï¼šç”¨æ¥è®°å½•è¿™ä¸ªæœºå™¨çš„åç§°ï¼ˆä¸ºäº†åˆ†é…èŠ‚ç‚¹ä½¿ç”¨)ã€‚ ç”Ÿæˆå‰ç­‰å¾…æ—¶é—´ï¼šè¿™ä¸ªæ—¶é—´ä¸ºæ„å»ºå¼€å§‹å‰çš„ç­‰å¾…æ—¶é—´ã€‚ SCMç­¾å‡ºé‡è¯•æ¬¡æ•°ï¼šå¦‚æœä»gitã€svnä¸­ä¸‹è½½ä»£ç å¤±è´¥ï¼Œéœ€è¦é‡è¯•çš„æ¬¡æ•°ã€‚ Restrict project namingï¼šé™åˆ¶é¡¹ç›®å‘½åï¼Œå‹¾é€‰åå¯ä»¥çœ‹åˆ°å…·ä½“è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸ºé»˜è®¤æˆ–è€…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œé™åˆ¶ã€‚ å…¨å±€å±æ€§environment variables:è®¾ç½®å…¨å±€å˜é‡ï¼Œåœ¨è¿™é‡Œå®šä¹‰çš„å…¨å±€å˜é‡å¯ä»¥åœ¨æ„å»ºæˆ–è€…å‘é€é‚®ä»¶æ—¶å¼•ç”¨ã€‚tool locations:è®¾ç½®å…¨å±€å·¥å…·ï¼Œä¹Ÿå¯ä»¥æŠŠéœ€è¦çš„å·¥å…·éƒ½åœ¨è¿™é‡Œè¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚mavenï¼Œant,jdkç­‰ã€‚ è®¾ç½®æ—¶é—´æ ¼å¼ Jenkins locationjenkins url :è®¾ç½®jenkinsçš„url(å‘é€é‚®ä»¶å¼•ç”¨jenkinsçš„åœ°å€ä¼šå–è¿™ä¸ªå€¼ï¼Œå¦‚æœè®¾é”™äº†ï¼Œé‚®ä»¶çš„è¿æ¥å°±ä¼šæ‰“ä¸å¼€)ã€‚ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€ï¼šç®¡ç†å‘˜çš„é‚®ä»¶åœ°å€ï¼ˆåœ¨æ„å»ºéœ€è¦å‘é€é‚®ä»¶æ—¶ï¼Œä¼šç”¨åˆ°è¿™ä¸ªé‚®ä»¶åœ°å€ï¼‰ã€‚ ä»£ç æ‰˜ç®¡ä»“åº“è®¾ç½®ï¼šè¿™é‡Œæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè®¾ç½®ã€‚ Extended E-mail Notification(é‚®ä»¶æ’ä»¶)SMTP server :å‘é€é‚®ä»¶çš„æœåŠ¡å™¨Default user E-mail suffix:é»˜è®¤é‚®ç®±åç¼€ï¼ˆå¦‚æœé…ç½®äº†è¿™ä¸ªåé¢çš„é‚®ç®±å°±ä¸ç”¨å†™åç¼€äº†ï¼‰use smtp authentication:ä½¿ç”¨smtpç”¨æˆ·è®¤è¯ï¼Œè¿™ä¸ªé€‰é¡¹éœ€è¦é…åˆé‚®ç®±å¼€å¯smtpæœåŠ¡ï¼Œè¿™æ ·é‚®ç®±æ‰èƒ½é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·å‘é€é‚®ä»¶ã€‚ ç™¾åº¦å¼€å¯smtpæœåŠ¡ã€‚user name:è®¤è¯çš„é‚®ç®±password:è®¤è¯çš„å¯†ç ï¼ˆå¹¶éé‚®ç®±çš„å¯†ç ï¼Œæ˜¯å¼€å¯smtpæ—¶ç»™çš„ä¸€ä¸²å­—ç¬¦ï¼‰å¦‚æœé‚®ç®±æ˜¯sslé“¾æ¥ï¼Œå°±éœ€è¦å‹¾é€‰use sslsmtp port :å¦‚æœä½ çš„smtpæœåŠ¡ä¸æ˜¯465çš„ç«¯å£ï¼Œéœ€è¦é…ç½®å¯¹åº”çš„ç«¯å£charset:é‚®ä»¶ç¼–ç è®¾ç½®default content type:è®¾ç½®é‚®ä»¶å‘é€çš„æ ¼å¼ï¼šæ–‡æœ¬æ ¼å¼æˆ–è€…htmlæ ¼å¼Use List-ID Email Headerï¼šè®¾ç½®é‚®ä»¶çš„å‘é€çš„åç§°ï¼ˆä¾¿äºè¿‡æ»¤ï¼‰Default Recipientsï¼šè®¾ç½®é»˜è®¤çš„æ”¶ä»¶äººReply To Listï¼šè®¾ç½®é»˜è®¤å›å¤åˆ—è¡¨Emergency reroute:ç›¸å½“äºä¸€ä¸ªé‚®ä»¶çš„è½¬å‘ï¼ˆé‚®ä»¶å…ˆå‘é€åˆ°è¿™é‡Œï¼Œç„¶ååœ¨è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼‰Excluded Recipientsï¼šè®¾ç½®æ¥æ”¶çš„é»‘åå•ï¼ˆå°±æ˜¯ä¸å‘é€ç»™è¿™äº›äººï¼‰Default Subjectï¼šè®¾ç½®é»˜è®¤çš„é‚®ä»¶ä¸»é¢˜Maximum Attachment Sizeï¼šè¿™åªé‚®ä»¶é™„ä»¶çš„æœ€å¤§å€¼Default Contentï¼šè®¾ç½®é‚®ä»¶çš„é»˜è®¤å†…å®¹ï¼ˆé‡Œé¢å¯ä»¥å¼•ç”¨ä¸€äº›ç¯å¢ƒå˜é‡çš„å‚æ•°ï¼Œæˆ–è€…æ’ä»¶çš„ä¸€äº›å˜é‡ï¼‰Default Pre-send Scriptï¼šåœ¨å‘é€é‚®ä»¶å‰æ‰§è¡Œçš„è„šæœ¬default triggers:è®¾ç½®é»˜è®¤çš„å‘é€é‚®ä»¶ç­–ç•¥ï¼Œæ ¹æ®æƒ…å†µé€‰æ‹© é‚®ä»¶é€šçŸ¥ï¼šè¿™æ˜¯é»˜è®¤çš„é‚®ä»¶å‘é€å·¥å…·ï¼Œé…ç½®å’Œext emailæ’ä»¶è®¾ç½®å·®ä¸å¤šï¼Œåªæ˜¯ä¸èƒ½è®¾ç½®é‚®ä»¶çš„é»˜è®¤å‘é€ç­–ç•¥ï¼Œå’Œé‚®ä»¶å‘é€çš„å†…å®¹ç­‰ä¿¡æ¯ æ ¹æ®éœ€è¦è®¾ç½®ã€‚ä¸éœ€è¦å¯ä¸è®¾ç½®ã€‚å‚è€ƒï¼šhttps://www.jianshu.com/p/a154f2a1d0c3","link":"/2018/01/18/Jenkins/jenkins%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"Jenkinsæ— æ³•é‡å¯tomcatåŸå› ","text":"åœ¨ä½¿ç”¨Hudsonçš„æ‰§è¡Œshè„šæœ¬çš„æ—¶å€™ï¼Œå¦‚æœshè„šæœ¬æ˜¯ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå¦‚ Tomcat è¿™æ ·çš„æœåŠ¡ã€‚å¦‚æœä½¿ç”¨Hudsonçš„é»˜è®¤é…ç½®ï¼Œä¼šå‘ç°è¿™äº›sh è¿›ç¨‹æœ‰å¯åŠ¨çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ä¸ä¼šå¸¸é©»åå°ï¼Œçœ‹Hudson è¾“å‡ºçš„æ—¥å¿—ï¼Œå‘ç°Hudsonåœ¨Jobæ„å»ºç»“æŸä¹‹åï¼Œkillæ‰€æœ‰æœªç»ˆæ­¢çš„è¡ç”Ÿè¿›ç¨‹ã€‚ åœ¨Hudsonå¦ä¸€wikié¡µé¢ä¸Šè¿›ä¸€æ­¥æè¿°äº†Hudsonæ€æ‰è¡ç”Ÿè¿›ç¨‹çš„æƒ…å†µã€‚Hudsonåœ¨æ‰§è¡ŒJobæ—¶ä¼šè®¾ç½®ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡å°†è¢«Jobè¡ç”Ÿå‡ºçš„è¿›ç¨‹ç»§æ‰¿ã€‚Hudsonåœ¨killè¡ç”Ÿè¿›ç¨‹çš„æ—¶å€™ä¼šæŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœæ‰¾åˆ°å®ƒä¹‹å‰è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œåˆ™å°†å…¶æ€æ‰ã€‚Wikiä¸Šç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥é¿å…è¿›ç¨‹è¢«killæ‰ï¼šä¿®æ”¹Hudsonè®¾ç½®çš„ç¯å¢ƒå˜é‡BUILD_IDçš„å€¼ï¼Œä»è€Œè®©Hudsonè®¤ä¸ºæ­¤è¿›ç¨‹ä¸æ˜¯ç”±Jobçš„æ„å»ºè¿‡ç¨‹è¡ç”Ÿçš„ã€‚ è§£å†³ï¼šæ‰“å¼€ï¼šç³»ç»Ÿç®¡ç† &gt; ç³»ç»Ÿè®¾ç½®åœ¨ å…¨å±€å±æ€§ ä¸­çš„ ç¯å¢ƒå˜é‡ ä¸­è®¾ç½®BUILD_ID å€¼ä¸º allow_to_run_as_daemon å‚è€ƒï¼šhttps://blog.csdn.net/maotongbin/article/details/53079921","link":"/2018/04/04/Jenkins/jenkins%E6%97%A0%E6%B3%95%E9%87%8D%E5%90%AFtomcat%E5%8E%9F%E5%9B%A0/"},{"title":"Jenkinsç»¼åˆ","text":"1ã€è®¾ç½®jenkinså·¥ä½œç©ºé—´åŠæ—¶åŒºvim /etc/profile 123#jenkinsexport JENKINS_HOME=/usr/local/jenkinsexport JENKINS_JAVA_OPTIONS=&quot;-Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai&quot; 2ã€å¯åŠ¨jenkinsæœåŠ¡æŠŠwaråŒ…æ”¾åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨tomcatå³å¯ã€‚åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8080/jenkins 3ã€å®‰è£…æ’ä»¶ Publish over SSH Maven Integration plugin4ã€ç³»ç»Ÿè®¾ç½®åœ¨ å…¨å±€å±æ€§ ä¸­çš„ ç¯å¢ƒå˜é‡ ä¸­è®¾ç½®BUILD_ID å€¼ä¸º allow_to_run_as_daemonåŸå› è§ Jenkinsæ— æ³•é‡å¯tomcatåŸå› 5ã€å…¨å±€å·¥å…·é…ç½®å®‰è£…JDKã€Mavenã€Antç­‰å¦‚JDKå®‰è£… åˆ«åï¼šJDK1.8 JAVA_HOMEï¼š/usr/local/java/jdk1.8.0_1716ã€åˆ©ç”¨mavenè¿›è¡Œæ„å»ºé¡¹ç›® ä»SVNæ£€å‡ºä»£ç ï¼ˆä¸»é¡¹ç›®å’Œé…ç½®æ–‡ä»¶ï¼‰ æ„å»ºè§¦å‘å™¨ å¯æäº¤ä»£ç åï¼Œè‡ªåŠ¨æ£€æµ‹æ›´æ–°ï¼Œè¿›è¡Œæ„å»ºã€‚ ä¹Ÿå¯è¿›è¡Œå®šæ—¶æ„å»º Build periodically 5 23 * * * ï¼ˆæ¯å¤©æ™šä¸Š23ç‚¹05åˆ†æ„å»ºï¼‰ã€‚ ![](https://ww1.sinaimg.cn/large/007iUjdily1fyd268z0hsj31470cbt9b.jpg) è¿›è¡Œé…ç½®æ–‡ä»¶æ›¿æ¢ ä¸Šä¼ æœåŠ¡å™¨ï¼Œå¹¶è¿›è¡Œé‡å¯ é‡å¯æœåŠ¡è„šæœ¬123456789101112131415161718#!/bin/bashexport JAVAHOME=/usr/local/java/jdk1.8.0_151echo ${JAVAHOME}PROJECT_DIR=/usr/local/bootserver/boot8100/fourworker/APP_NAME=\"fourworker_test\"PORT=8100pid=`ps -ef | grep -v grep | grep $APP_NAME | grep $PORT | awk '{print $2}'`echo \"pid=$pid\"if [ -n \"$pid\" ]thenkill -9 $pidfisleep 2cd $PROJECT_DIRnohup ${JAVAHOME}/bin/java -jar $PROJECT_DIR/cpnsp-api-1.0.0-SNAPSHOT.jar --name=$APP_NAME --server.port=$PORT &gt;$PORT.log 2&gt;&amp;1 &amp;exit","link":"/2018/05/03/Jenkins/jenkins%E7%BB%BC%E5%90%88/"},{"title":"å‰ç«¯æ–‡ä»¶æ›´æ–°æ–¹æ¡ˆ","text":"å‰ç«¯æ–‡ä»¶(é™¤index.htmlåœ¨æœåŠ¡å™¨nginxä¸‹)å­˜å‚¨åœ¨ä¸ƒç‰›ä¸­ã€‚ é€šè¿‡sambaè¿›è¡Œå„é¡¹ç›®å‰ç«¯æ–‡ä»¶çš„æš‚å­˜ã€‚ä¹‹åç”±jenkinså„é¡¹ç›®åˆ†åˆ«è°ƒå–ï¼Œç„¶åä¸Šä¼ è‡³ä¸ƒç‰›åŠæœåŠ¡å™¨ã€‚ jenkinsç›¸å…³é…ç½® 1234567891011121314151617181920212223242526272829#!/bin/bashQINIUPREFIX=xaxy #ä¸ƒç‰›å‰ç¼€FILE_DIR=/ssdb2/share/front/qiniu/xaxyUNPACK_DIR=$FILE_DIR/unpack #è§£å‹è¾“å‡ºç›®å½•PROJECT_DIR=$WORKSPACE/$QINIUPREFIX #ä¸Šä¼ æ–‡ä»¶ç›®å½•cd $FILE_DIRzipCnt=`ls -l |grep \"^-\"|wc -l`echo \"zipCnt=$zipCnt\"if [ \"$zipCnt\" -eq \"1\" ];then cp $FILE_DIR/* /ssdb2/share/front/backup/ #å¤‡ä»½ zipName=`find *.zip` echo \"zipName=$zipName\" unzip $zipName -d $UNPACK_DIRelse echo \"å‹ç¼©æ–‡ä»¶å­˜åœ¨ $zipCnt ä¸ªï¼Œæ„å»ºé€€å‡º\" set -e #æ³¨æ„ï¼Œä¸€å®šè¦å…ˆè®¾ç½®è¿™ä¸ª exit 1 #ç„¶åå†é€€å‡ºï¼Œjenkinså°±ä¼šæŠ¥çº¢æ˜¾ç¤ºæ„å»ºå¤±è´¥fiecho $WORKSPACErm -r $PROJECT_DIR/mkdir $PROJECT_DIRcd $UNPACK_DIR/*/cp -r ./ $PROJECT_DIRrm -r $FILE_DIR/* #æ¸…ç©ºç›®å½•ï¼Œæ³¨æ„ï¼šåˆ é™¤é«˜å±æ“ä½œï¼ï¼ï¼ï¼ æ–‡ä»¶è·¯å¾„å¡«å†™ä¸ƒç‰›å‰ç¼€åã€‚ è¦ä¸Šä¼ åˆ°çš„ bucketå¡«å†™è¦ä¸Šä¼ è‡³ä¸ƒç‰›ç©ºé—´å ä¸‹é¢æ˜¯æŠŠindex.htmlä¸Šä¼ è‡³çš„æœåŠ¡å™¨ç›®å½•ã€‚ ç”±äºé¡¹ç›®æ˜¯åœ¨å¤ªå¤šï¼Œæ›´æ–°ä¸Šä¼ å‰ç«¯å¾ˆå¤šæ—¶éå¸¸è´¹æ—¶ï¼Œåˆå®¹æ˜“å‡ºå·®é”™ã€‚ æ‰€ä»¥è¿›è¡Œäº†æ”¹è‰¯ï¼Œå‰ç«¯æ–‡ä»¶åŒ…åéƒ½å¸¦æœ‰(xxä¸ƒç‰›å‰ç¼€å)ï¼Œæ‰€ä»¥æŠŠå‰ç«¯æ–‡ä»¶ä¸Šä¼ è‡³ç»Ÿä¸€ç›®å½•ï¼Œç„¶åæ ¹æ®åŒ…ä¸Šçš„å‰ç¼€åï¼Œè¿›è¡Œæå–ã€‚ 12345678910111213141516171819202122232425262728#!/bin/bashQINIUPREFIX=$qiniuPrefix FILE_DIR=/ssdb2/share/front/updateUNPACK_DIR=$FILE_DIR/unpack/$QINIUPREFIX #è§£å‹è¾“å‡ºç›®å½•PROJECT_DIR=$WORKSPACE/$QINIUPREFIX #ä¸Šä¼ æ–‡ä»¶ç›®å½•cd $FILE_DIRzipCnt=`find *$QINIUPREFIX*.zip |wc -l`if [ \"$zipCnt\" -eq \"1\" ];then zipName=`find *$QINIUPREFIX*.zip` echo \"zipName=$zipName\" mkdir -p $UNPACK_DIR unzip $zipName -d $UNPACK_DIR mv $FILE_DIR/$zipName /ssdb2/share/front/backup/ #å¤‡ä»½ else echo \"å‹ç¼©æ–‡ä»¶å­˜åœ¨ $zipCnt ä¸ªï¼Œæ„å»ºé€€å‡º\" set -e #æ³¨æ„ï¼Œä¸€å®šè¦å…ˆè®¾ç½®è¿™ä¸ª exit 1 #ç„¶åå†é€€å‡ºï¼Œjenkinså°±ä¼šæŠ¥çº¢æ˜¾ç¤ºæ„å»ºå¤±è´¥fiecho $WORKSPACErm -r $PROJECT_DIR/mkdir $PROJECT_DIRcd $UNPACK_DIR/*/cp -r ./ $PROJECT_DIRrm -r $UNPACK_DIR/* #æ¸…ç©ºç›®å½•ï¼Œæ³¨æ„ï¼šåˆ é™¤é«˜å±æ“ä½œï¼ï¼ï¼ï¼##rm -r $FILE_DIR/*","link":"/2020/05/23/Jenkins/%E5%89%8D%E7%AB%AF%E6%96%87%E4%BB%B6%E6%9B%B4%E6%96%B0%E6%96%B9%E6%A1%88/"},{"title":"é€šè¿‡URLè§¦å‘Jenkinsæ„å»º","text":"https://www.cnblogs.com/tyrionyang/p/8183819.html å‡ ä¸ªæ’ä»¶ï¼šhttps://www.jianshu.com/p/0457aba7efcf","link":"/2020/04/17/Jenkins/%E9%80%9A%E8%BF%87URL%E8%A7%A6%E5%8F%91Jenkins%E6%9E%84%E5%BB%BA/"},{"title":"å°†Jenkinså®‰è£…ä¸ºsystemdæœåŠ¡","text":"Jenkinsçš„éƒ¨ç½²æ–¹å¼æ˜¯å°†jaræ”¾åœ¨äº†tomcatä¸‹(å…·ä½“å‚è€ƒä¹‹å‰çš„éƒ¨ç½²æ–¹å¼)ï¼Œç„¶åé€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡(/etc/profile)ä¸­æŒ‡å®šJenkinså·¥ä½œç©ºé—´åŠæ—¶åŒºå˜é‡ã€‚ æ‰€ä»¥æ­¤æ–‡å°†Jenkinså®‰è£…ä¸ºsystemdæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯å°†tomcatå®‰è£…ä¸ºsystemdæœåŠ¡ã€‚ 1ã€æ–°å»ºé¡¹ç›®çš„systemdç®¡ç†æ–‡ä»¶jenkins.service vim /etc/systemd/system/jenkins.service 1234567891011121314151617[Unit]Description=jenkins-tomcat9900After=network.target[Service]Type=forkingWorkingDirectory=/ssdb1/tomcat/tomcat-jenkins/binEnvironment=JAVA_HOME==/usr/local/java/jdk1.8.0_231Environment=JENKINS_HOME=/ssdb1/jenkinsEnvironment=JENKINS_JAVA_OPTIONS=\"-Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai\"ExecStart=/ssdb1/tomcat/tomcat-jenkins/bin/catalina.sh startExecReload=/ssdb1/tomcat/tomcat-jenkins/bin/catalina.sh restartExecStop=/ssdb1/tomcat/tomcat-jenkins/bin/catalina.sh stopSuccessExitStatus=143[Install]WantedBy=multi-user.target ä¸»è¦æ³¨æ„ç‚¹ï¼Œé€šè¿‡systemdè¿›è¡Œç®¡ç†çš„æœåŠ¡ï¼Œåœ¨/etc/profileä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡Environment å®šä¹‰ç¯å¢ƒå˜é‡ã€‚ 2ã€ç®¡ç† 123$ systemctl daemon-reload$ systemctl enable jenkins.service$ systemctl start jenkins.service 3ã€æŸ¥çœ‹çŠ¶æ€ 1$ systemctl status jenkins.service 4ã€æŸ¥çœ‹æœåŠ¡æ—¥å¿— 1$ vim /var/log/syslog ä¹‹å‰çš„ç›¸å…³è®°å½•ï¼šhttps://myqzf.github.io/2018/08/29/java/Spring-Boot/Spring-boot%E9%83%A8%E7%BD%B2/","link":"/2019/12/28/Jenkins/%E5%B0%86jenkins%E5%AE%89%E8%A3%85%E4%B8%BAsystemd%E6%9C%8D%E5%8A%A1/"},{"title":"RabbitMQå®‰è£…","text":"erlangå®‰è£…RabbitMQæ˜¯ç”¨erlangè¯­è¨€å¼€å‘ï¼Œæ‰€ä»¥éœ€å®‰è£…erlangã€‚1ã€è·å–å®‰è£…æ–‡ä»¶ 1$ wget http://erlang.org/download/otp_src_20.2.tar.gz2ã€è§£å‹erlangå®‰è£…åŒ… 1$ tar -zxvf otp_src_20.2.tar.gz3ã€è¿›å…¥ç›®å½•ï¼Œç¼–è¯‘å®‰è£… 123$ cd otp_src_20.2$ ./configure --prefix=/usr/local/erlang --enable-smp-support --enable-threads --enable-sctp --enable-kernel-poll --enable-hipe --with-ssl --without-javac$ make &amp;&amp; make install erlangå®‰è£…ç¼–è¯‘é€‰é¡¹ï¼š â€“prefix æŒ‡å®šå®‰è£…ç›®å½• â€“enable-smp-supportå¯ç”¨å¯¹ç§°å¤šå¤„ç†æ”¯æŒï¼ˆSymmetric Multi-Processingå¯¹ç§°å¤šå¤„ç†ç»“æ„çš„ç®€ç§°ï¼‰ â€“enable-threadså¯ç”¨å¼‚æ­¥çº¿ç¨‹æ”¯æŒ â€“enable-sctpå¯ç”¨æµæ§åˆ¶åè®®æ”¯æŒï¼ˆStream Control Transmission Protocolï¼Œæµæ§åˆ¶ä¼ è¾“åè®®ï¼‰ â€“enable-kernel-pollå¯ç”¨Linuxå†…æ ¸poll â€“enable-hipeå¯ç”¨é«˜æ€§èƒ½Erlang â€“with-ssl å¯ç”¨sslåŒ… â€“without-javac ä¸ç”¨javaç¼–è¯‘4ã€åŠ å…¥ç³»ç»Ÿå˜é‡vim /etc/profile 12export ERLANG_HOME=/usr/local/erlangexport PATH=$ERLANG_HOME/bin:$PATH 5ã€éªŒè¯erlangæ˜¯å¦å®‰è£…æˆåŠŸ 1234$ erl Erlang/OTP 20 [erts-9.2] [source] [smp:4:4] [ds:4:4:10] [async-threads:10] [kernel-poll:false] Eshell V9.2 (abort with ^G) 1&gt; halt(). é€€å‡ºï¼šhalt(). rabbitMqçš„å®‰è£…1ã€è·å–å®‰è£…åŒ… 1$ wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.15/rabbitmq-server-generic-unix-3.6.15.tar.xz 2ã€è§£å‹rabbitMQå®‰è£…åŒ…(æ³¨æ„ï¼štar.xzè§£å‹æ–¹å¼) 1$ tar -xvJf rabbitmq-server-generic-unix-3.6.15.tar.xz 3ã€åŠ å…¥ç³»ç»Ÿå˜é‡vim /etc/profile 12export RABBITMQ_HOME=/usr/local/rabbitmq/rabbitmq_server-3.7.4export PATH=$RABBITMQ_HOME/sbin:$PATH 4ã€è¿è¡ŒRabbitMQ (å¦å¼€ä¸€ç»ˆç«¯) 1$ sbin/rabbitmq-server 5ã€ä½¿RabbitMQåå°è¿è¡Œ 1$ rabbitmq-server -detached 6ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ 1$ sbin/rabbitmqctl status 7ã€å…³é—­æœåŠ¡ 1$ ./rabbitmqctl stop å…¶å®ƒï¼šè®¿é—®ç«¯å£ï¼š 4369ï¼Œepmdï¼ˆErlang Port Mapper Daemonï¼‰ï¼Œæ˜¯Erlangçš„ç«¯å£/ç»“ç‚¹åç§°æ˜ å°„ç¨‹åºï¼Œç”¨æ¥è·Ÿè¸ªèŠ‚ç‚¹åç§°ç›‘å¬åœ°å€ï¼Œåœ¨é›†ç¾¤ä¸­èµ·åˆ°ä¸€ä¸ªç±»ä¼¼DNSçš„ä½œç”¨ã€‚ 5672, 5671ï¼Œ AMQP 0-9-1 å’Œ 1.0 å®¢æˆ·ç«¯ç«¯å£ï¼Œused by AMQP 0-9-1 and 1.0 clients without and with TLS(Transport Layer Security) 25672ï¼ŒErlang distributionï¼Œå’Œ4369é…åˆ 15672ï¼ŒHTTP_APIç«¯å£ï¼Œç®¡ç†å‘˜ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œç”¨äºç®¡ç†RbbitMQï¼Œéœ€è¦å¯ç”¨managementæ’ä»¶ï¼Œrabbitmq-plugins enable rabbitmq_managementï¼Œè®¿é—®http://server-name:15672/ 61613, 61614ï¼Œå½“STOMPæ’ä»¶å¯ç”¨çš„æ—¶å€™æ‰“å¼€ï¼Œä½œä¸ºSTOMPå®¢æˆ·ç«¯ç«¯å£ï¼ˆæ ¹æ®æ˜¯å¦ä½¿ç”¨TLSé€‰æ‹©ï¼‰ 1883, 8883ï¼Œå½“MQTTæ’ä»¶å¯ç”¨çš„æ—¶å€™æ‰“å¼€ï¼Œä½œä¸ºMQTTå®¢æˆ·ç«¯ç«¯å£ï¼ˆæ ¹æ®æ˜¯å¦ä½¿ç”¨TLSé€‰æ‹©ï¼‰ 15674ï¼ŒåŸºäºWebSocketçš„STOMPå®¢æˆ·ç«¯ç«¯å£ï¼ˆå½“æ’ä»¶Web STOMPå¯ç”¨çš„æ—¶å€™æ‰“å¼€ï¼‰ 15675ï¼ŒåŸºäºWebSocketçš„MQTTå®¢æˆ·ç«¯ç«¯å£ï¼ˆå½“æ’ä»¶Web MQTTå¯ç”¨çš„æ—¶å€™æ‰“å¼€ï¼‰ é»˜è®¤ç”¨æˆ·RabbitMQé»˜è®¤ç”¨æˆ·å¸å·åŠå¯†ç éƒ½æ˜¯guestï¼Œé»˜è®¤åªèƒ½ä»æœ¬æœºè®¿é—®ã€‚å› æ­¤å¦‚æœéœ€è¦ä»å…¶å®ƒæœºå™¨è®¿é—®RabbitMQï¼Œéœ€è¦åšäº›è®¾ç½®ã€‚å‚è€ƒï¼šRabbitMQçš„é…ç½® Access Control ç›¸å…³çš„å†…å®¹ï¼Œé‡Œé¢ä¼šè®²è§£å¦‚ä½•åˆ›å»ºç”¨æˆ·ï¼Œåˆ é™¤guestç”¨æˆ·, æˆ–è®¾ç½®å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®RabbitMQ. è°ƒæ•´Linuxç³»ç»Ÿçš„é™åˆ¶RabbitMQå¦‚æœæ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„è¯ï¼Œéœ€è¦è°ƒæ•´ç³»ç»Ÿé™åˆ¶å’Œå†…æ ¸é™åˆ¶ï¼Œä»¥åº”å¯¹å¤§é‡å¹¶å‘è¿æ¥å’Œé«˜å®¹é‡çš„é˜Ÿåˆ—ã€‚è¦è°ƒæ•´çš„ä¸»è¦æ˜¯å…è®¸æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼Œå³ulimit -nå‘½ä»¤æ˜¾ç¤ºçš„å€¼ã€‚è¯¥é»˜è®¤å€¼å¯¹æ¶ˆæ¯ä¸­é—´ä»¶æ¥è¯´å¤ªä½äº†ï¼ˆä¸€èˆ¬æ˜¯1024ï¼‰ã€‚æˆ‘ä»¬æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯¹ç³»ç»Ÿç”¨æˆ·rabbitmqï¼ˆé»˜è®¤è¿è¡ŒRabbitMQ serverçš„ç”¨æˆ·ï¼‰è‡³å°‘è¦è®¾ç½®æˆ65536ï¼Œå¦‚æœæ˜¯å¼€å‘ç¯å¢ƒåˆ™è®¾ç½®æˆ4096ã€‚æœ‰ä¸¤ä¸ªé™åˆ¶éœ€è¦ä¿®æ”¹ï¼š1ã€æ“ä½œç³»ç»Ÿå†…æ ¸å…è®¸æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡(fs.file-max) 123456789#æŸ¥çœ‹$ cat /proc/sys/fs/file-max184289$ cat /proc/sys/fs/file-nr1024 0 184289 #å·²åˆ†é…æ–‡ä»¶å¥æŸ„çš„æ•°ç›® åˆ†é…äº†ä½†æ²¡æœ‰ä½¿ç”¨çš„å¥æŸ„æ•° æ–‡ä»¶å¥æŸ„æœ€å¤§æ•°ç›®#è®¾ç½®$ echo 284289 &gt; /proc/sys/fs/file-max 2ã€æ¯ä¸ªç”¨æˆ·å…è®¸æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡(ulimit -n)ï¼Œå¯ä»¥é€šè¿‡ulimit -n sizeè®¾ç½®ã€‚ å‰è€…å¿…é¡»é«˜äºåè€…ã€‚ éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ 123456789$ rabbitmqctl status{file_descriptors, [{total_limit,65435}, {total_used,2}, {sockets_limit,58889}, {sockets_used,0}]}, # æŸ¥çœ‹è®¾ç½®çš„limitsï¼Œ$RABBITMQ_BEAM_PROCESS_PIDç”¨å®é™…çš„è¿›ç¨‹idä»£æ›¿$ cat /proc/$RABBITMQ_BEAM_PROCESS_PID/limits å¯å‚è€ƒï¼šhttps://segmentfault.com/a/1190000011444627 ####é—®é¢˜1ã€ç¼–è¯‘erlangé‡åˆ°çš„é—®é¢˜ 12configure: error: No curses library functions foundconfigure: error: /bin/sh '/opt/erlang/otp_src_20.2/erts/configure' failed for erts è§£å†³ï¼š 1$ apt-get install ncurses-dev 2ã€å¯åŠ¨æŠ¥é”™ 123456789101112131415161718192021222324252627$ sbin/rabbitmq-serverBOOT FAILED===========Error description: {error,{missing_dependencies,[crypto,ssl], [cowboy,cowlib,rabbitmq_management, rabbitmq_management_agent, rabbitmq_trust_store]}}Log files (may contain more information): /usr/local/rabbitmq/rabbitmq_server-3.6.15/var/log/rabbitmq/rabbit@ubuntu.log /usr/local/rabbitmq/rabbitmq_server-3.6.15/var/log/rabbitmq/rabbit@ubuntu-sasl.logStack trace: [{rabbit_plugins,ensure_dependencies,1, [{file,\"src/rabbit_plugins.erl\"},{line,185}]}, {rabbit_plugins,prepare_plugins,1, [{file,\"src/rabbit_plugins.erl\"},{line,203}]}, {rabbit,broker_start,0,[{file,\"src/rabbit.erl\"},{line,300}]}, {rabbit,start_it,1,[{file,\"src/rabbit.erl\"},{line,424}]}, {init,start_em,1,[]}, {init,do_boot,3,[]}]{\"init terminating in do_boot\",{error,{missing_dependencies,[crypto,ssl],[cowboy,cowlib,rabbitmq_management,rabbitmq_management_agent,rabbitmq_trust_store]}}}init terminating in do_boot ({error,{missing_dependencies,[crypto,ssl],[cowboy,cowlib,rabbitmq_management,rabbitmq_management_agent,rabbitmq_trust_store]}}) åŸå› ï¼šç¼ºå°‘openssl è§£å†³ï¼š 1$ apt-get install openssl libssl-dev å‚è€ƒï¼šhttp://www.rabbitmq.com/install-debian.html","link":"/2018/03/05/RabbitMQ/RabbitMQ%E5%AE%89%E8%A3%85(%E4%B8%80)/"},{"title":"RabbitMQçš„é…ç½®","text":"ä»RabbitMQ 3.7.0å¼€å§‹ å•ä¸ªè®¾ç½®çš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¸€è¡Œä¸Šã€‚ è¡Œæ˜¯ç»“æ„åŒ–çš„é”®=å€¼ã€‚ ä»»ä½•ä»¥ï¼ƒå¼€å¤´çš„è¡Œéƒ½æ˜¯æ³¨é‡Šã€‚ ç¤ºä¾‹æ–‡ä»¶ 12listeners.tcp.default = 5672 # RabbitMQä¾¦å¬å®¢æˆ·ç«¯è¿æ¥ç«¯å£ä¸º5672ã€‚loopback_users = none # å…è®¸guestç”¨æˆ·ä»è¿œç¨‹ä¸»æœºè¿›è¡Œè¿æ¥ å®Œæ•´æ–‡ä»¶ï¼šhttps://raw.githubusercontent.com/rabbitmq/rabbitmq-server/master/docs/rabbitmq.conf.example å‚è€ƒï¼šhttps://www.rabbitmq.com/configure.html","link":"/2018/03/05/RabbitMQ/RabbitMQ%E7%9A%84%E9%85%8D%E7%BD%AE(%E4%B8%89)/"},{"title":"RabbitMQæ’ä»¶ã€ç”¨æˆ·æƒé™ç®¡ç†","text":"RabbitMQæ’ä»¶1ã€æ’ä»¶åˆ—è¡¨ 1$ rabbitmq-plugins list 2ã€å¯ç”¨æ’ä»¶ 1$ rabbitmq-plugins enable plugin-name 3ã€ç¦ç”¨æ’ä»¶ 1$ rabbitmq-plugins disable plugin-name ç¤ºä¾‹ï¼š(1) å¼€å¯ç®¡ç†é¡µé¢æ’ä»¶ 1$ rabbitmq-plugins enable rabbitmq_management (2) å¯ç”¨ rabbitmq stomp æ’ä»¶ 1rabbitmq-plugins enable rabbitmq_stomp è¯¥æ’ä»¶é»˜è®¤ç›‘å¬çš„ç«¯å£æ˜¯61613 (3) RabbitMQ Web STOMPæ’ä»¶ 1$ rabbitmq-plugins enable rabbitmq_web_stomp è¯¥æ’ä»¶é»˜è®¤ä¾¦å¬ç«¯å£15674 (4) Web STOMP Examples æºç  1$ rabbitmq-plugins enable rabbitmq_web_stomp_examples localhost:15670 ç”¨æˆ·æƒé™ç®¡ç†rabbitmqé»˜è®¤ä¼šåˆ›å»ºguest/guestè´¦å·å¯†ç ï¼Œåªèƒ½ç”¨äºlocalhostç™»å½•é¡µé¢ç®¡ç†å‘˜ã€‚æ³¨ï¼šéœ€è¦å¼€å¯ç®¡ç†é¡µé¢æ’ä»¶ã€‚å¯ä»¥é€šè¿‡rabbitmqctlæ‰§è¡Œç›¸å…³å‘½ä»¤æ¥ç»´æŠ¤ç”¨æˆ·ã€æƒé™ã€‚ç”¨æˆ·ç®¡ç† list_usersï¼Œç”¨æˆ·åˆ—è¡¨ add_user {username} {password}ï¼Œæ·»åŠ ç”¨æˆ· delete_user {username}ï¼Œåˆ é™¤ç”¨æˆ· change_password {username} {newpassword}ï¼Œä¿®æ”¹å¯†ç  clear_password {username}ï¼Œåˆ é™¤å¯†ç ï¼Œå¯†ç åˆ é™¤åå°±ä¸èƒ½è®¿é—®äº† authenticate_user {username} {password}ï¼Œç”¨æˆ·è®¤è¯ set_user_tags {username} {tag â€¦}ï¼Œä¸ºç”¨æˆ·è®¾ç½®è§’è‰²ï¼Œtagå¯ä»¥æ˜¯0ä¸ªã€ä¸€ä¸ªã€æˆ–å¤šä¸ªæƒé™ç®¡ç†å½“ä¸€ä¸ªRabbitMQå®¢æˆ·ç«¯å»ºç«‹åˆ°æœåŠ¡å™¨çš„è¿æ¥æ—¶ï¼Œåœ¨å®ƒçš„æ“ä½œæŒ‡ä»¤ä¸­æŒ‡å®šäº†ä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚æ­¤æ—¶å®æ–½ç¬¬ä¸€çº§è®¿é—®æ§åˆ¶ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®è™šæ‹Ÿä¸»æœºï¼Œå¦åˆ™æ‹’ç»è¿æ¥å°è¯•ã€‚èµ„æºï¼ˆå³exchangeså’Œqueuesï¼‰åœ¨ç‰¹å®šè™šæ‹Ÿä¸»æœºå†…è¢«å‘½åä¸ºå®ä½“; ç›¸åŒçš„åç§°åœ¨æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸­è¡¨ç¤ºä¸åŒçš„èµ„æºã€‚å½“å¯¹èµ„æºæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œä¼šå¼ºåˆ¶æ‰§è¡Œç¬¬äºŒçº§è®¿é—®æ§åˆ¶ã€‚RabbitMQåœ¨æŸä¸ªèµ„æºä¸ŠåŒºåˆ†äº†é…ç½®ã€å†™å’Œè¯»æ“ä½œã€‚é…ç½®æ“ä½œåˆ›å»ºæˆ–è€…é”€æ¯èµ„æºï¼Œæˆ–è€…æ›´æ”¹èµ„æºçš„è¡Œä¸ºã€‚å†™æ“ä½œå°†æ¶ˆæ¯æ³¨å…¥è¿›èµ„æºä¹‹ä¸­ã€‚è¯»æ“ä½œä»èµ„æºä¸­è·å–æ¶ˆæ¯ã€‚ä¸ºäº†å¯¹èµ„æºæ‰§è¡Œæ“ä½œï¼Œç”¨æˆ·å¿…é¡»å·²è¢«æˆäºˆé€‚å½“çš„æƒé™ã€‚ list_vhosts [vhostinfoitem â€¦]ï¼Œè·å–vhostsåˆ—è¡¨ add_vhost {vhost}ï¼Œ egï¼šrabbitmqctl add_vhost test delete_vhost {vhost} set_permissions [-p vhost] {user} {conf} {write} {read}ï¼Œç»™ç”¨æˆ·åˆ†åœ¨å¯¹åº”çš„vhostä¸Šåˆ†é…ç›¸åº”çš„æƒé™ã€‚ egï¼šrabbitmqctl set_permissions -p /myvhost chris â€œ^chris-.*â€œ â€œ.*â€œ â€œ.*â€œï¼Œè¿™æ¡æŒ‡ä»¤ï¼Œç»™ç”¨æˆ·chrisåœ¨myvhoståˆ†é…äº†æƒé™ï¼Œæƒé™åŒ…æ‹¬ï¼šä»¥â€chris-â€œå¼€å¤´çš„å…¨éƒ¨èµ„æºçš„é…ç½®æƒé™ï¼Œå’Œæ‰€æœ‰èµ„æºçš„è¯»å†™æƒé™. clear_permissions [-p vhost] {username}ï¼Œæ¸…é™¤æƒé™ list_permissions [-p vhost]ï¼Œvhostæƒé™åˆ†é…åˆ—è¡¨ list_user_permissions {username}ï¼Œuseræƒé™åˆ—è¡¨ åˆ é™¤é»˜è®¤ç”¨æˆ· 1$ rabbitmqctl delete_user guest æ·»åŠ ç”¨æˆ· 1$ rabbitmqctl add_user bjcscn yunyi123 è®¾ç½®ç”¨æˆ·è§’è‰² 1$ rabbitmqctl set_user_tags bjcscn administrator è®¾ç½®ç”¨æˆ·æƒé™ 1$ rabbitmqctl set_permissions -p / bjcscn \".*\" \".*\" \".*\" å‚è€ƒï¼špluginsAccess Controlrabbitmqctl Access Control","link":"/2018/03/05/RabbitMQ/RabbitMQ%E6%8F%92%E4%BB%B6(%E4%BA%8C)/"},{"title":"RabbitMQé›†ç¾¤","text":"Rabbité›†ç¾¤æ¨¡å¼å¤§æ¦‚åˆ†ä¸ºï¼šæ™®é€šé›†ç¾¤æ¨¡å¼ã€é•œåƒæ¨¡å¼æ™®é€šé›†ç¾¤æ¨¡å¼ï¼š é»˜è®¤çš„é›†ç¾¤æ¨¡å¼ï¼Œä»¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆrabbit01ã€rabbit02ï¼‰ä¸ºä¾‹æ¥è¿›è¡Œè¯´æ˜ã€‚å¯¹äºQueueæ¥è¯´ï¼Œæ¶ˆæ¯å®ä½“åªå­˜åœ¨äºå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹rabbit01ï¼ˆæˆ–è€…rabbit02ï¼‰ï¼Œrabbit01å’Œrabbit02ä¸¤ä¸ªèŠ‚ç‚¹ä»…æœ‰ç›¸åŒçš„å…ƒæ•°æ®ï¼Œå³é˜Ÿåˆ—çš„ç»“æ„ã€‚å½“æ¶ˆæ¯è¿›å…¥rabbit01èŠ‚ç‚¹çš„Queueåï¼Œconsumerä»rabbit02èŠ‚ç‚¹æ¶ˆè´¹æ—¶ï¼ŒRabbitMQä¼šä¸´æ—¶åœ¨rabbit01ã€rabbit02é—´è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼ŒæŠŠAä¸­çš„æ¶ˆæ¯å®ä½“å–å‡ºå¹¶ç»è¿‡Bå‘é€ç»™consumerã€‚æ‰€ä»¥consumeråº”å°½é‡è¿æ¥æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»ä¸­å–æ¶ˆæ¯ã€‚å³å¯¹äºåŒä¸€ä¸ªé€»è¾‘é˜Ÿåˆ—ï¼Œè¦åœ¨å¤šä¸ªèŠ‚ç‚¹å»ºç«‹ç‰©ç†Queueã€‚å¦åˆ™æ— è®ºconsumerè¿rabbit01æˆ–rabbit02ï¼Œå‡ºå£æ€»åœ¨rabbit01ï¼Œä¼šäº§ç”Ÿç“¶é¢ˆã€‚å½“rabbit01èŠ‚ç‚¹æ•…éšœåï¼Œrabbit02èŠ‚ç‚¹æ— æ³•å–åˆ°rabbit01èŠ‚ç‚¹ä¸­è¿˜æœªæ¶ˆè´¹çš„æ¶ˆæ¯å®ä½“ã€‚å¦‚æœåšäº†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå¾—ç­‰rabbit01èŠ‚ç‚¹æ¢å¤ï¼Œç„¶åæ‰å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœæ²¡æœ‰æŒä¹…åŒ–çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¸¢å¤±çš„ç°è±¡ã€‚é•œåƒæ¨¡å¼ï¼š å°†éœ€è¦æ¶ˆè´¹çš„é˜Ÿåˆ—å˜ä¸ºé•œåƒé˜Ÿåˆ—ï¼Œå­˜åœ¨äºå¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°RabbitMQçš„HAé«˜å¯ç”¨æ€§ã€‚ä½œç”¨å°±æ˜¯æ¶ˆæ¯å®ä½“ä¼šä¸»åŠ¨åœ¨é•œåƒèŠ‚ç‚¹ä¹‹é—´å®ç°åŒæ­¥ï¼Œè€Œä¸æ˜¯åƒæ™®é€šæ¨¡å¼é‚£æ ·ï¼Œåœ¨consumeræ¶ˆè´¹æ•°æ®æ—¶ä¸´æ—¶è¯»å–ã€‚ç¼ºç‚¹å°±æ˜¯ï¼Œé›†ç¾¤å†…éƒ¨çš„åŒæ­¥é€šè®¯ä¼šå ç”¨å¤§é‡çš„ç½‘ç»œå¸¦å®½ã€‚ èŠ‚ç‚¹1ã€RabbitMQé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸åŒäºå…¶å®ƒåˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰é¢†å¯¼è€…å’Œè¿½éšè€…èŠ‚ç‚¹ã€‚RabbitMQä¸­æ²¡æœ‰ç‰¹æ®Šçš„èŠ‚ç‚¹ã€‚2ã€Erlang Cookie RabbitMQèŠ‚ç‚¹å’ŒCLIå·¥å…·ï¼ˆä¾‹å¦‚rabbitmqctlï¼‰ä½¿ç”¨cookieæ¥ç¡®å®šå®ƒä»¬æ˜¯å¦è¢«å…è®¸ç›¸äº’é€šä¿¡ã€‚è¦ä½¿ä¸¤ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿé€šä¿¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å…±äº«å¯†é’¥ã€‚ åœ¨UNIXç³»ç»Ÿä¸Šï¼Œcookieé€šå¸¸åœ¨ /var/lib/rabbitmq/.erlang.cookie æˆ–è€…$HOME/.erlang.cookie3ã€èŠ‚ç‚¹ç±»å‹ï¼šç£ç›˜èŠ‚ç‚¹å’ŒRAMèŠ‚ç‚¹ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¸Œæœ›æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ç£ç›˜èŠ‚ç‚¹; RAMèŠ‚ç‚¹æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¯ç”¨äºæ”¹å–„å…·æœ‰é«˜æ’é˜Ÿï¼Œäº¤æ¢æˆ–ç»‘å®šæµå¤±çš„æ€§èƒ½é›†ç¾¤ã€‚RAMèŠ‚ç‚¹ä¸æä¾›æ›´é«˜çš„æ¶ˆæ¯é€Ÿç‡ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·ä»…ä½¿ç”¨ç£ç›˜èŠ‚ç‚¹ã€‚ é›†ç¾¤æ¨¡å¼é…ç½®å‰æï¼šé¦–å…ˆRabbitMQåœ¨ä¸¤å°æœºå™¨ä¸Šå®‰è£…å¥½ï¼Œå¹¶ä¸”RabbitMQçš„sbinç›®å½•å·²åŠ å…¥åˆ°PATHä¸­. 1ã€ä¿®æ”¹/etc/hostsæ–‡ä»¶ 12172.16.0.3 bp11_106172.16.0.2 bp13_253 åœ¨ä¸¤å°æœºå™¨ä¸Šåˆ†åˆ«ä¿®æ”¹ã€‚æ ¼å¼ï¼š ip hostname2ã€è®¾ç½®Erlang Cookieå°†å…¶ä¸­ä¸€å°çš„cookieå¤åˆ¶åˆ°å¦ä¸€å°ä¸­,æ–‡ä»¶æƒé™æ˜¯400ã€‚ 1$ scp -P 10100 /root/.erlang.cookie root@172.16.0.2:/root 3ã€å¯åŠ¨ç‹¬ç«‹çš„èŠ‚ç‚¹ 12rabbit1 $ rabbitmq-server -detachedrabbit2 $ rabbitmq-server -detached 4ã€åˆ†åˆ«æŸ¥çœ‹çŠ¶æ€ 123456789101112131415rabbit1 $ rabbitmqctl cluster_statusCluster status of node rabbit@rabbit1 ...[{nodes,[{disc,[rabbit@rabbit1]}]},{running_nodes,[rabbit@rabbit1]},{cluster_name,&lt;&lt;&quot;rabbit@rabbit1&quot;&gt;&gt;},{partitions,[]},{alarms,[{rabbit@rabbit1,[]}]}]rabbit2 $ rabbitmqctl cluster_statusCluster status of node rabbit@rabbit2 ...[{nodes,[{disc,[rabbit@rabbit2]}]},{running_nodes,[rabbit@rabbit2]},{cluster_name,&lt;&lt;&quot;rabbit@rabbit2&quot;&gt;&gt;},{partitions,[]},{alarms,[{rabbit@rabbit2,[]}]}] 5ã€åˆ›å»ºé›†ç¾¤ å°†rabbit2ä¸rabbit1è¿æ¥èµ·æ¥ 123rabbit2 $ rabbitmqctl stop_apprabbit2 $ rabbitmqctl join_cluster rabbit@rabbit1rabbit2 $ rabbitmqctl start_app 6ã€åˆ†åˆ«æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 123456789101112131415rabbit1 $ rabbitmqctl cluster_statusCluster status of node rabbit@rabbit1 ...[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]}, {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}, {cluster_name,&lt;&lt;&quot;rabbit@rabbit1&quot;&gt;&gt;}, {partitions,[]}, {alarms,[{rabbit@rabbit1,[]},{rabbit@rabbit2,[]}]}]rabbit2 $ rabbitmqctl cluster_statusCluster status of node rabbit@rabbit2 ...[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},{running_nodes,[rabbit@rabbit1,rabbit@rabbit2]},{cluster_name,&lt;&lt;&quot;rabbit@rabbit1&quot;&gt;&gt;},{partitions,[]},{alarms,[{rabbit@rabbit1,[]},{rabbit@rabbit2,[]}]}] å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªèŠ‚ç‚¹å·²åŠ å…¥ç¾¤é›† ä»é›†ç¾¤ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹å•æœºå¤šèŠ‚ç‚¹åˆ›å»ºå†…å­˜èŠ‚ç‚¹ å‚è€ƒï¼šhttp://www.rabbitmq.com/clustering.htmlhttps://www.cnblogs.com/myf008/p/8545322.htmlhttps://blog.csdn.net/woogeyu/article/details/51119101","link":"/2018/04/20/RabbitMQ/RabbitMQ%E9%9B%86%E7%BE%A4(%E5%9B%9B)/"},{"title":"RabbitMQé«˜å¯ç”¨æ€§ï¼ˆé•œåƒï¼‰é˜Ÿåˆ—","text":"RabbitMQé»˜è®¤é›†ç¾¤æ¨¡å¼ï¼Œä½†å¹¶ä¸ä¿è¯é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§ï¼Œå°½ç®¡exchangesã€bindingsè¿™äº›å¯ä»¥å¤åˆ¶åˆ°é›†ç¾¤é‡Œçš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯é›†ç¾¤å†…çš„é˜Ÿåˆ—å†…å®¹ä½äºå•ä¸ªèŠ‚ç‚¹ï¼ˆå£°æ˜é˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼‰ä¸Šï¼Œé˜Ÿåˆ—å†…å®¹ä¸ä¼šå¤åˆ¶ï¼Œè™½ç„¶è¯¥æ¨¡å¼è§£å†³ä¸€éƒ¨åˆ†èŠ‚ç‚¹å‹åŠ›ï¼Œä½†é˜Ÿåˆ—èŠ‚ç‚¹å®•æœºç›´æ¥å¯¼è‡´è¯¥é˜Ÿåˆ—æ— æ³•ä½¿ç”¨ï¼Œåªèƒ½ç­‰å¾…é‡å¯ï¼Œæ‰€ä»¥è¦æƒ³åœ¨é˜Ÿåˆ—èŠ‚ç‚¹å®•æœºæˆ–æ•…éšœä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå°±è¦å¤åˆ¶é˜Ÿåˆ—å†…å®¹åˆ°é›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦åˆ›å»ºé•œåƒé˜Ÿåˆ—ã€‚é˜Ÿåˆ—é•œåƒä¼šæŠŠå‘å¸ƒåˆ°é˜Ÿåˆ—çš„æ¶ˆæ¯å°†è¢«å¤åˆ¶åˆ°æ‰€æœ‰é•œåƒã€‚æ¶ˆè´¹è€…æ— è®ºè¿æ¥åˆ°å“ªä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”é•œåƒä¼šä¸¢å¼ƒå·²åœ¨ä¸»èŠ‚ç‚¹ç¡®è®¤çš„æ¶ˆæ¯ã€‚é˜Ÿåˆ—é•œåƒå› æ­¤å¢å¼ºäº†å¯ç”¨æ€§ï¼Œä½†ä¸ä¼šè·¨èŠ‚ç‚¹åˆ†å‘è´Ÿè½½ã€‚ é…ç½®é•œåƒé•œåƒä½¿ç”¨ç­–ç•¥é…ç½®ï¼Œç­–ç•¥é€šè¿‡åç§°ï¼ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼‰åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ï¼Œå¹¶åŒ…å«æ·»åŠ åˆ°åŒ¹é…é˜Ÿåˆ—çš„å…¨éƒ¨å±æ€§é›†ä¸­çš„å®šä¹‰ï¼ˆå¯é€‰å‚æ•°çš„æ˜ å°„ï¼‰ ç­–ç•¥ç®¡ç†ä½¿ç”¨ï¼šrabbitmqctlè®¾ç½®ä¸€ä¸ªç­–ç•¥set_policy [-p vhost] [--priority priority] [--apply-to apply-to] name pattern definition -p Vhostï¼š å¯é€‰å‚æ•°ï¼Œé’ˆå¯¹æŒ‡å®švhostä¸‹çš„queueè¿›è¡Œè®¾ç½® priorityï¼šå¯é€‰å‚æ•°ï¼Œpolicyçš„ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¸º0ã€‚æ•°å­—è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚ apply-toï¼šå¯é€‰å‚æ•°ï¼Œé€‚ç”¨äºå“ªäº›ç±»å‹çš„å¯¹è±¡ï¼Œå€¼å¯é€‰ä¸ºqueuesã€exchangesã€allï¼Œé»˜è®¤ä¸ºall Name: policyçš„åç§° Pattern: queueçš„åŒ¹é…æ¨¡å¼(æ­£åˆ™è¡¨è¾¾å¼) Definitionï¼šé•œåƒå®šä¹‰ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ha-mode, ha-params, ha-sync-modeha-mode:æŒ‡æ˜é•œåƒé˜Ÿåˆ—çš„æ¨¡å¼ï¼Œæœ‰æ•ˆå€¼ä¸º all/exactly/nodes allï¼šè¡¨ç¤ºåœ¨é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒ exactlyï¼šè¡¨ç¤ºåœ¨æŒ‡å®šä¸ªæ•°çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹çš„ä¸ªæ•°ç”±ha-paramsæŒ‡å®š nodesï¼šè¡¨ç¤ºåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹åç§°é€šè¿‡ha-paramsæŒ‡å®š ha-paramsï¼šha-modeæ¨¡å¼éœ€è¦ç”¨åˆ°çš„å‚æ•° ha-sync-modeï¼šè¿›è¡Œé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„åŒæ­¥æ–¹å¼ï¼Œæœ‰æ•ˆå€¼ä¸ºautomaticå’Œmanualç¤ºä¾‹ï¼š12$ rabbitmqctl set_policy ha-policy1 \"^\" '{\"ha-mode\":\"all\"}'$ rabbitmqctl set_policy ha-two \"^two\\.\" '{\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"}' clear_policy [-p vhost] name åˆ é™¤ä¸€ä¸ªç­–ç•¥list_policies [-p vhost] ç­–ç•¥åˆ—è¡¨ RabbitMQè´Ÿè½½å‡è¡¡ http://www.rabbitmq.com/ha.htmlhttp://www.rabbitmq.com/parameters.html#policies","link":"/2018/04/20/RabbitMQ/RabbitMQ%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7%EF%BC%88%E9%95%9C%E5%83%8F%EF%BC%89%E9%98%9F%E5%88%97(%E4%BA%94)/"},{"title":"RabbitMq-rabbitmqctl","text":"rabbitmqctl åˆ—å‡ºRabbitMQä¸­æ‰€æœ‰é˜Ÿåˆ—åŠå¯¹åº”çš„æ¶ˆæ¯æ•°ã€‚ 12345$ sudo rabbitmqctl list_queuesTimeout: 60.0 seconds ...Listing queues for vhost / ...task_queue 0hello 0 åˆ—å‡ºæœåŠ¡ä¸­æ‰€æœ‰çš„äº¤æ¢(exchange) 123456789$ sudo rabbitmqctl list_exchangesListing exchanges for vhost / ...amq.topic topicamq.match headers directamq.headers headersamq.direct directamq.fanout fanoutamq.rabbitmq.trace topic åˆ—å‡ºç»‘å®š 1234$ rabbitmqctl list_bindingsListing bindings for vhost /... exchange hello queue hello [] exchange task_queue queue task_queue [] http://www.rabbitmq.com/rabbitmqctl.8.html","link":"/2018/07/26/RabbitMQ/RabbitMq-rabbitmqctl/"},{"title":"RabbitMq-rabbitmqctl","text":"RabbitMQ Web STOMPæ’ä»¶ http://www.rabbitmq.com/rabbitmqctl.8.html","link":"/2018/07/28/RabbitMQ/RabbitMq-web-stomp/"},{"title":"Compose.yamæ–‡ä»¶","text":"Compose.yamæ–‡ä»¶æ˜¯å®šä¹‰servicesã€networksã€volumesï¼Œé»˜è®¤æ–‡ä»¶ä¸è·¯å¾„./docker-compose.yml.æœåŠ¡å®šä¹‰åŒ…å«å°†è¢«åº”ç”¨åˆ°ä¸ºè¯¥æœåŠ¡å¯åŠ¨çš„æ¯ä¸ªå®¹å™¨çš„é…ç½®ï¼Œå°±åƒ docker runä¼ é€’å‘½ä»¤è¡Œå‚æ•°ä¸€æ ·ã€‚ç½‘ç»œå’Œå·çš„å®šä¹‰ä¹Ÿç±»ä¼¼äºdocker network createå’Œdocker volume createã€‚ å®‰è£…Docker Compose 123$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose$ sudo chmod +x /usr/local/bin/docker-compose$ docker-compose --version å…·ä½“å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.docker.com/compose/install/#install-compose buildæŒ‡å®š Dockerfile æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚ 12345678version: '2'services: webapp: build: ./dir``` #### context è¦ä¹ˆæ˜¯ä¸€ä¸ªåŒ…å«Dockerfileçš„ç›®å½•çš„è·¯å¾„ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªåˆ°gitä»“åº“çš„urlã€‚ build: context: ./dir 12#### dockerfile æŒ‡å®šDockerfile build: context: . dockerfile: Dockerfile-alternate 1234#### args æ„å»ºå‚æ•°ï¼Œå®ƒä»¬æ˜¯ä»…åœ¨æ„å»ºè¿‡ç¨‹ä¸­å¯è®¿é—®çš„ç¯å¢ƒå˜é‡ã€‚ å°±åƒ Dockerfile ä¸­çš„ ARG æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯åœ¨æ„å»ºæˆåŠŸåå–æ¶ˆ.Dockerfileä¸­ARG ARG buildnoARG password RUN echo â€œBuild number: $buildnoâ€RUN script-requiring-password.sh â€œ$passwordâ€ 12 build: context: . args: buildno: 1 password: secret build: context: . args: - buildno=1 - password=secret 1234æ³¨æ„ï¼šå¸ƒå°”å€¼ï¼ˆtrueï¼Œfalseï¼Œyesï¼Œnoï¼Œonï¼Œoffï¼‰å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚ #### command å¯ä»¥è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚ command: bundle exec thin -p 3000 1ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ä¼¼äº dockerfileæ–‡ä»¶ä¸­çš„æ ¼å¼ command: [â€œbundleâ€, â€œexecâ€, â€œthinâ€, â€œ-pâ€, â€œ3000â€] 12345678910111213#### deployæŒ‡å®šä¸éƒ¨ç½²å’Œè¿è¡ŒæœåŠ¡ç›¸å…³çš„é…ç½®ã€‚ version: â€˜3â€™services: redis: image: redis:alpine deploy: replicas: 6 update_config: parallelism: 2 delay: 10s restart_policy: condition: on-failure 12345æœ‰å‡ ä¸ªå­é€‰é¡¹å¯ç”¨ï¼š##### endpoint_modeä¸ºè¿æ¥åˆ°é›†ç¾¤çš„å¤–éƒ¨å®¢æˆ·ç«¯æŒ‡å®šæœåŠ¡å‘ç°æ–¹æ³•ã€‚ * endpoint_mode: vipï¼Œ Dockerä¸ºæœåŠ¡åˆ†é…ä¸€ä¸ªè™šæ‹ŸIPï¼Œä½œä¸ºå®¢æˆ·ç«¯åˆ°è¾¾ç½‘ç»œæœåŠ¡çš„â€œå‰ç«¯â€ã€‚* endpoint_mode: dnsrr - DNSè½®è¯¢ï¼ŒDockerä¸ºæœåŠ¡è®¾ç½®DNSæ¡ç›®ï¼Œä½¿å¾—æœåŠ¡åç§°çš„DNSæŸ¥è¯¢è¿”å›ä¸€ä¸ªIPåœ°å€åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯ç›´æ¥è¿æ¥åˆ°å…¶ä¸­çš„ä¸€ä¸ªã€‚è´Ÿè½½å¹³è¡¡å™¨ã€‚ version: â€œ3.3â€ services: wordpress: image: wordpress ports: - 8080:80 networks: - overlay deploy: mode: replicated replicas: 2 endpoint_mode: vip mysql: image: mysql volumes: - db-data:/var/lib/mysql/data networks: - overlay deploy: mode: replicated replicas: 2 endpoint_mode: dnsrr volumes: db-data: networks: overlay: 123##### labelsæŒ‡å®šæœåŠ¡çš„æ ‡ç­¾ã€‚ version: â€œ3â€services: web: image: web deploy: labels: com.example.description: â€œThis label will appear on the web serviceâ€ 12##### modeä¸¤ç§æ¨¡å¼ï¼šglobalï¼ˆæ¯ä¸ªç¾¤é›†èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼‰æˆ–replicatedï¼ˆæŒ‡å®šæ•°é‡çš„å®¹å™¨ï¼‰ã€‚é»˜è®¤æ˜¯replicatedã€‚ version: â€˜3â€™services: worker: image: dockersamples/examplevotingapp_worker deploy: mode: global 123##### replicaså¦‚æœæœåŠ¡æ˜¯replicatedï¼ˆè¿™æ˜¯é»˜è®¤çš„ï¼‰ï¼ŒæŒ‡å®šåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´åº”è¯¥è¿è¡Œçš„å®¹å™¨çš„æ•°é‡ã€‚ version: â€˜3â€™services: worker: image: dockersamples/examplevotingapp_worker networks: - frontend - backend deploy: mode: replicated replicas: 6 12##### resourcesé…ç½®èµ„æºé™åˆ¶ã€‚ version: â€˜3â€™services: redis: image: redis:alpine deploy: resources: limits: cpus: â€˜0.50â€™ memory: 50M reservations: cpus: â€˜0.25â€™ memory: 20M 1234567åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒredisæœåŠ¡è¢«é™åˆ¶ä½¿ç”¨ä¸è¶…è¿‡50Mçš„å†…å­˜å’Œ0.50ï¼ˆ50ï¼…ï¼‰å¯ç”¨å¤„ç†æ—¶é—´ï¼ˆCPUï¼‰ï¼Œå¹¶ä¸” ä¿ç•™20Mäº†å†…å­˜å’Œ0.25CPUæ—¶é—´ï¼ˆæ€»æ˜¯å¯ç”¨ï¼‰ã€‚##### restart_policyé…ç½®æ˜¯å¦ä»¥åŠå¦‚ä½•åœ¨é€€å‡ºæ—¶é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ * conditionï¼šå…¶ä¸­ä¹‹ä¸€noneï¼Œon-failureæˆ–anyï¼ˆé»˜è®¤ï¼šï¼‰anyã€‚ * delayï¼šåœ¨é‡å¯å°è¯•ä¹‹é—´ç­‰å¾…å¤šé•¿æ—¶é—´ï¼ˆæŒ‡å®šä¸º æŒç»­æ—¶é—´ï¼‰ï¼ˆé»˜è®¤å€¼ï¼š0ï¼‰ã€‚ * max_attemptsï¼šåœ¨æ”¾å¼ƒä¹‹å‰å°è¯•é‡å¯å®¹å™¨å¤šå°‘æ¬¡ï¼ˆé»˜è®¤ï¼šæ°¸ä¸æ”¾å¼ƒï¼‰ã€‚ * windowï¼šå†³å®šé‡æ–°å¯åŠ¨æˆåŠŸä¹‹å‰ç­‰å¾…å¤šé•¿æ—¶é—´ï¼ˆæŒ‡å®šä¸ºæŒç»­æ—¶é—´ï¼‰ï¼ˆé»˜è®¤å€¼ï¼šç«‹å³å†³å®šï¼‰ã€‚ version: â€œ3â€services: redis: image: redis:alpine deploy: restart_policy: condition: on-failure delay: 5s max_attempts: 3 window: 120s 12345678##### update_configé…ç½®å¦‚ä½•æ›´æ–°æœåŠ¡ã€‚ç”¨äºé…ç½®æ»šåŠ¨æ›´æ–°ã€‚ * parallelismï¼šä¸€æ¬¡æ›´æ–°çš„å®¹å™¨æ•°é‡ã€‚ * delayï¼šæ›´æ–°ä¸€ç»„å®¹å™¨ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ã€‚ * failure_actionï¼šå¦‚æœæ›´æ–°å¤±è´¥ï¼Œè¯¥æ€ä¹ˆåŠã€‚å…¶ä¸­ä¹‹ä¸€continueï¼Œrollbackæˆ–pause ï¼ˆé»˜è®¤ï¼šï¼‰pauseã€‚ * monitorï¼šæ¯ä¸ªä»»åŠ¡æ›´æ–°åç›‘è§†å¤±è´¥çš„æ—¶é—´(ns|us|ms|s|m|h)ï¼ˆé»˜è®¤ä¸º0ï¼‰ã€‚ * max_failure_ratioï¼šåœ¨æ›´æ–°æœŸé—´å®¹å¿çš„å¤±è´¥ç‡ã€‚ * orderï¼šæ›´æ–°æœŸé—´çš„æ“ä½œé¡ºåºã€‚å…¶ä¸­ä¸€ä¸ªstop-firstï¼ˆæ—§çš„ä»»åŠ¡åœ¨å¼€å§‹æ–°çš„ä»»åŠ¡ä¹‹å‰åœæ­¢ï¼‰æˆ–start-firstï¼ˆæ–°çš„ä»»åŠ¡é¦–å…ˆå¯åŠ¨ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡å°†çŸ­æš‚åœ°é‡å ï¼‰ï¼ˆé»˜è®¤stop-firstï¼‰ã€‚ version: â€˜3.4â€™services: vote: image: dockersamples/examplevotingapp_vote:before depends_on: - redis deploy: replicas: 2 update_config: parallelism: 2 delay: 10s order: stop-first 1234#### depends_onè¡¨ç¤ºæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿™æœ‰ä¸¤ä¸ªä½œç”¨ï¼š * docker-compose upå°†ä»¥ä¾èµ–æ€§é¡ºåºå¯åŠ¨æœåŠ¡ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œdbå’Œredisä¼šwebä¹‹å‰å¯åŠ¨ã€‚* docker-compose up SERVICEä¼šè‡ªåŠ¨åŒ…å«SERVICEä¾èµ–é¡¹ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œdocker-compose up webä¹Ÿå°†åˆ›å»ºå’Œå¯åŠ¨dbå’Œredisã€‚ version: â€˜3â€™services: web: build: . depends_on: - db - redis redis: image: redis db: image: postgres 12#### dnsè‡ªå®šä¹‰DNSæœåŠ¡å™¨ã€‚å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚ dns: 8.8.8.8dns: 8.8.8.8 9.9.9.912#### dns_searchè‡ªå®šä¹‰DNSæœç´¢åŸŸã€‚å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚ dns_search: example.comdns_search: dc1.example.com dc2.example.com12#### tmpfsåœ¨å®¹å™¨ä¸­æŒ‚è½½ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿã€‚å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚ tmpfs: /runtmpfs: /run /tmp12#### entrypointè¦†ç›–é»˜è®¤å…¥å£ç‚¹ã€‚ entrypoint: /code/entrypoint.sh1234#### env_fileä»æ–‡ä»¶æ·»åŠ ç¯å¢ƒå˜é‡ã€‚å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚ å¦‚æœæ‚¨å·²ç»æŒ‡å®šäº†ä¸€ä¸ªComposeæ–‡ä»¶docker-compose -f FILEï¼Œåˆ™è·¯å¾„ env_fileç›¸å¯¹äºè¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚åœ¨environmentéƒ¨åˆ†ä¸­ å£°æ˜çš„ç¯å¢ƒå˜é‡å°†è¦†ç›–è¿™äº›å€¼ - å³ä½¿è¿™äº›å€¼ä¸ºç©ºæˆ–æœªå®šä¹‰ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ env_file: .env env_file: ./common.env ./apps/web.env /opt/secrets.env1envæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½æ˜¯VAR=VALæ ¼å¼ã€‚#ä»¥ç©ºç™½è¡Œå¼€å¤´çš„è¡Œï¼ˆå³æ³¨é‡Šï¼‰è¢«å¿½ç•¥ã€‚ Set Rails/Rack environmentRACK_ENV=development12#### environmentæ·»åŠ ç¯å¢ƒå˜é‡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚ä»»ä½•å¸ƒå°”å€¼; trueï¼Œfalseï¼Œyesï¼Œnoéœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸è¢«YMLè§£æå™¨è½¬æ¢ä¸ºTrueæˆ–Falseã€‚ environment:RACK_ENV: developmentSHOW: â€˜trueâ€™SESSION_SECRET: environment: RACK_ENV=development SHOW=true SESSION_SECRET123æ³¨æ„ï¼šå¦‚æœä½ çš„æœåŠ¡æŒ‡å®šäº†ä¸€ä¸ªbuildé€‰é¡¹ï¼Œåœ¨buildè¿‡ç¨‹ä¸­å®šä¹‰çš„å˜é‡environmentå°†ä¸ä¼šè‡ªåŠ¨å¯è§ã€‚ä½¿ç”¨argså­é€‰é¡¹buildæ¥å®šä¹‰æ„å»ºæ—¶ç¯å¢ƒå˜é‡ã€‚ #### exposeå…¬å¼€ç«¯å£è€Œä¸å°†å®ƒä»¬å‘å¸ƒåˆ°ä¸»æœº - å®ƒä»¬åªèƒ½è¢«é“¾æ¥çš„æœåŠ¡è®¿é—®ã€‚åªèƒ½æŒ‡å®šå†…éƒ¨ç«¯å£ã€‚ expose: â€œ3000â€ â€œ800012#### external_linksè®©Composeé¡¹ç›®é‡Œé¢çš„å®¹å™¨è¿æ¥åˆ°é‚£äº›é¡¹ç›®é…ç½®å¤–éƒ¨çš„å®¹å™¨,å¤–éƒ¨åˆ›å»ºçš„å®¹å™¨å¿…é¡»è¿æ¥åˆ°å®ƒä»¬çš„æœåŠ¡ç›¸åŒçš„ç½‘ç»œã€‚ external_links: redis_1 project_db_1:mysql project_db_1:postgresql12#### extra_hostsæ·»åŠ ä¸»æœºåæ˜ å°„ã€‚ä½¿ç”¨ä¸dockerå®¢æˆ·ç«¯--add-hostå‚æ•°ç›¸åŒçš„å€¼ã€‚ extra_hosts: â€œsomehost:162.242.195.82â€ â€œotherhost:50.31.209.229â€1å…·æœ‰IPåœ°å€å’Œä¸»æœºåçš„æ¡ç›®å°†åœ¨/etc/hostsè¯¥æœåŠ¡çš„å†…éƒ¨å®¹å™¨ä¸­åˆ›å»ºï¼Œä¾‹å¦‚ï¼š 162.242.195.82 somehost50.31.209.229 otherhost12#### healthchecké…ç½®è¿è¡Œçš„æ£€æŸ¥ä»¥ç¡®å®šæ­¤æœåŠ¡çš„å®¹å™¨æ˜¯å¦â€œå¥åº·â€ã€‚ healthcheck:test: [â€œCMDâ€, â€œcurlâ€, â€œ-fâ€, â€œhttp://localhost&quot;]interval: 1m30stimeout: 10sretries: 312intervalå’ŒtimeoutæŒ‡å®šæŒç»­æ—¶é—´ã€‚ testå¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–ä¸€ä¸ªåˆ—è¡¨ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç¬¬ä¸€é¡¹å¿…é¡»æ˜¯NONEï¼ŒCMDæˆ–CMD-SHELLã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™ç›¸å½“äºæŒ‡å®šCMD-SHELLåè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚ Hit the local web apptest: [â€œCMDâ€, â€œcurlâ€, â€œ-fâ€, â€œhttp://localhost&quot;] As above, but wrapped in /bin/sh. Both forms below are equivalent.test: [â€œCMD-SHELLâ€, â€œcurl -f http://localhost || exit 1â€]test: curl -f https://localhost || exit 1 12#### imageæŒ‡å®šå›¾åƒä»¥ä»ä¸­å¯åŠ¨å®¹å™¨ã€‚å¯ä»¥æ˜¯å­˜å‚¨åº“/æ ‡ç­¾æˆ–éƒ¨åˆ†å›¾åƒIDã€‚ image: redisimage: ubuntu:14.04image: tutum/influxdbimage: example-registry.com:4000/postgresqlimage: a4bc65fd 123#### labelsä½¿ç”¨Docker labelså°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚(å…ƒæ•°æ®ï¼šä¸ºæè¿°æ•°æ®çš„æ•°æ®ã€‚)å»ºè®®ä½¿ç”¨åå‘DNSæ ‡è®°æ¥é˜²æ­¢æ‚¨çš„æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çªã€‚ labels: com.example.description: â€œAccounting webappâ€ com.example.department: â€œFinanceâ€ com.example.label-with-empty-value: â€œâ€ labels: â€œcom.example.description=Accounting webappâ€ â€œcom.example.department=Financeâ€ â€œcom.example.label-with-empty-valueâ€12#### linksé“¾æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡ä¸­çš„å®¹å™¨ã€‚æ—¢å¯ä»¥æŒ‡å®šæœåŠ¡åç§°ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé“¾æ¥åˆ«åï¼ˆSERVICE:ALIASï¼‰ï¼Œæˆ–è€…ä»…æŒ‡å®šæœåŠ¡åç§°ã€‚ web:links: db db:database redis12#### loggingé…ç½®æœåŠ¡çš„æ—¥å¿— logging:driver: syslogoptions:syslog-address: â€œtcp://192.168.0.42:123â€12driver åç§°ä¸ºæœåŠ¡çš„å®¹å™¨æŒ‡å®šäº†ä¸€ä¸ªæ—¥å¿—é©±åŠ¨ç¨‹åºã€‚é»˜è®¤å€¼æ˜¯json-fileã€‚ driver: â€œjson-fileâ€driver: â€œsyslogâ€driver: â€œnoneâ€1234å‚è€ƒï¼šhttps://docs.docker.com/engine/admin/logging/overview/#configure-the-default-logging-driver#### network_modeç½‘ç»œæ¨¡å¼ã€‚ä½¿ç”¨ä¸dockerå®¢æˆ·ç«¯--netå‚æ•°ç›¸åŒçš„å€¼ï¼ŒåŠ ä¸Šç‰¹æ®Šçš„å½¢å¼service:[service name]ã€‚ network_mode: â€œbridgeâ€network_mode: â€œhostâ€network_mode: â€œnoneâ€network_mode: â€œservice:[service name]â€network_mode: â€œcontainer:[container name/id]â€12#### networksç½‘ç»œ services:some-service:networks: some-network other-network1234##### aliasesåˆ«å,ç½‘ç»œä¸Šæ­¤æœåŠ¡çš„åˆ«åï¼ˆå¤‡ç”¨ä¸»æœºåï¼‰ã€‚åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æˆ–åˆ«åæ¥è¿æ¥åˆ°æœåŠ¡çš„ä¸€ä¸ªå®¹å™¨ã€‚ ç”±äºaliasesæ˜¯ç½‘ç»œèŒƒå›´çš„ï¼Œç›¸åŒçš„æœåŠ¡å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œä¸Šå…·æœ‰ä¸åŒçš„åˆ«åã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæä¾›äº†ä¸‰ç§æœåŠ¡ï¼ˆwebï¼Œworkerï¼Œå’Œdbï¼‰ï¼Œå…¶ä¸­ä¸¤ä¸ªç½‘ç»œï¼ˆæ²¿newå’Œlegacyï¼‰ã€‚è¯¥dbæœåŠ¡æ˜¯åœ¨ä¸»æœºådbæˆ–databaseä¸Šnewç½‘ç»œï¼Œå’Œdbæˆ–mysqlä¸Šçš„legacyç½‘ç»œã€‚ version: â€˜2â€™ services: web: build: ./web networks: - new worker: build: ./worker networks: - legacy db: image: mysql networks: new: aliases: - database legacy: aliases: - mysql networks: new: legacy: 12#### ipv4_address,ipv6_addressåŠ å…¥ç½‘ç»œæ—¶ï¼Œä¸ºæ­¤æœåŠ¡çš„å®¹å™¨æŒ‡å®šé™æ€IPåœ°å€ã€‚ version: â€˜2.1â€™ services: app: image: busybox command: ifconfig networks: app_net: ipv4_address: 172.16.238.10 ipv6_address: 2001:3984:3989::10 networks: app_net: driver: bridge enable_ipv6: true ipam: driver: default config: - subnet: 172.16.238.0/24 - subnet: 2001:3984:3989::/64 1234#### portså…¬å¼€ç«¯å£ ç®€æ´è¯­æ³•ï¼š æ—¢å¯ä»¥æŒ‡å®športï¼ˆHOST:CONTAINERï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®¹å™¨ç«¯å£ï¼ˆå°†é€‰æ‹©ä¸€ä¸ªéšæœºçš„ä¸»æœºç«¯å£ï¼‰ã€‚ ports: â€œ3000â€ â€œ3000-3005â€ â€œ8000:8000â€ â€œ9090-9091:8080-8081â€ â€œ49100:22â€ â€œ127.0.0.1:8001:8001â€ â€œ127.0.0.1:5000-5010:5000-5010â€ â€œ6060:6060/udpâ€ 12345é•¿æ ¼å¼çš„è¯­æ³•ï¼š * targetï¼šå®¹å™¨å†…çš„ç«¯å£ã€‚* publishedï¼šå…¬å¼€æ›å…‰çš„ç«¯å£ã€‚* protocolï¼šç«¯å£åè®®ï¼ˆtcpæˆ–udpï¼‰ã€‚ * modeï¼šhostç”¨äºå‘å¸ƒæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ä¸»æœºç«¯å£ï¼Œæˆ–è€…ingressç”¨äºç¾¤é›†æ¨¡å¼çš„ç«¯å£ï¼Œè¯¥ç«¯å£å°†è¢«è´Ÿè½½å‡è¡¡ã€‚ ports: target: 80published: 8080protocol: tcpmode: host12#### secretsä½¿ç”¨æ¯é¡¹æœåŠ¡secrets é…ç½®æˆäºˆå¯¹æ¯é¡¹æœåŠ¡çš„ç§˜å¯†è®¿é—®æƒé™ã€‚ version: â€œ3.1â€services:redis:image: redis:latestdeploy: replicas: 1secrets: my_secret my_other_secretsecrets:my_secret:file: ./my_secret.txtmy_other_secret:external: true123æˆäºˆå¯¹redisæœåŠ¡my_secretå’Œmy_other_secretç§˜å¯†çš„è®¿é—®æƒé™ã€‚å…¶å€¼ my_secretè¢«è®¾ç½®ä¸ºæ–‡ä»¶çš„å†…å®¹./my_secret.txtï¼Œå¹¶è¢« my_other_secretå®šä¹‰ä¸ºå¤–éƒ¨èµ„æº. #### stop_signalè®¾ç½®ä¸€ä¸ªæ›¿ä»£ä¿¡å·æ¥åœæ­¢å®¹å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹stopä½¿ç”¨SIGTERMã€‚ä½¿ç”¨æ›¿ä»£ä¿¡å·stop_signalå°†ä¼šå¯¼è‡´ stopå‘é€è¯¥ä¿¡å·ã€‚ stop_signal: SIGUSR112#### stop_grace_periodæŒ‡å®šstop_signalåœ¨å‘é€SIGKILLä¹‹å‰å¦‚æœä¸å¤„ç†SIGTERMï¼ˆæˆ–æŒ‡å®šçš„ä»»ä½•åœæ­¢ä¿¡å·ï¼‰ï¼Œåˆ™è¯•å›¾åœæ­¢å®¹å™¨æ—¶è¦ç­‰å¾…å¤šé•¿æ—¶é—´ ã€‚æŒ‡å®šä¸ºæŒç»­æ—¶é—´ã€‚ stop_grace_period: 1sstop_grace_period: 1m30s12#### volumesè½½ä¸»æœºè·¯å¾„æˆ–å‘½åå·ï¼Œå°†å…¶æŒ‡å®šä¸ºæœåŠ¡çš„å­é€‰é¡¹ã€‚ version: â€œ3.2â€services:web:image: nginx:alpinevolumes: type: volumesource: mydatatarget: /datavolume: nocopy: true type: bindsource: ./statictarget: /opt/app/static db: image: postgres:latest volumes: â€œ/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sockâ€ â€œdbdata:/var/lib/postgresql/dataâ€ volumes: mydata: dbdata: 1234æ­¤ç¤ºä¾‹æ˜¾ç¤ºæœåŠ¡mydataæ­£åœ¨ä½¿ç”¨çš„å‘½åå·ï¼ˆï¼‰webï¼Œä»¥åŠä¸ºå•ä¸ªæœåŠ¡ï¼ˆdbæœåŠ¡ ä¸‹çš„ç¬¬ä¸€ä¸ªè·¯å¾„volumesï¼‰å®šä¹‰çš„ç»‘å®šæŒ‚è½½ã€‚è¯¥dbæœåŠ¡è¿˜ä½¿ç”¨åä¸ºdbdataï¼ˆåœ¨dbæœåŠ¡ä¸‹çš„ç¬¬äºŒä¸ªè·¯å¾„volumesï¼‰çš„å‘½åå·ï¼Œä½†ä½¿ç”¨æ—§çš„å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰å®ƒä»¥è£…è½½å‘½åå·ã€‚volumeså¦‚å›¾æ‰€ç¤ºï¼Œå‘½åå·å¿…é¡»åˆ—åœ¨é¡¶çº§å¯†é’¥ä¸‹ ã€‚#### restartnoæ˜¯é»˜è®¤çš„é‡å¯ç­–ç•¥ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡å¯å®¹å™¨ã€‚å½“alwaysæŒ‡å®šæ—¶ï¼Œå®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚è¯¥ on-failureå¦‚æœé€€å‡ºä»£ç æŒ‡ç¤ºçš„æ•…éšœé”™è¯¯æ”¿ç­–é‡å¯çš„å®¹å™¨ã€‚ restart: â€œnoâ€restart: alwaysrestart: on-failurerestart: unless-stopped 12345----------------------------------------------------------### volumeä½¿ç”¨volumeï¼šhttps://docs.docker.com/engine/admin/volumes/volumes/ ä¸‹é¢æ˜¯ä¸€ä¸ªåŒæœåŠ¡è®¾ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ•°æ®åº“çš„æ•°æ®ç›®å½•ä¸å¦ä¸€ä¸ªæœåŠ¡å…±äº«ä¸ºä¸€ä¸ªå·ï¼Œä»¥ä¾¿å¯ä»¥å®šæœŸå¤‡ä»½ï¼š version: â€œ3â€ services: db: image: db volumes: - data-volume:/var/lib/db backup: image: backup-service volumes: - data-volume:/var/lib/backup/data volumes: data-volume: 123#### externalå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æŒ‡å®šè¯¥å·å·²åœ¨docker composeä¹‹å¤–åˆ›å»ºã€‚docker-compose upä¸ä¼šå°è¯•å»åˆ›å»ºå®ƒï¼Œå¦‚æœå®ƒä¸å­˜åœ¨å°±ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ[projectname]dataCompose ä¸æ˜¯è¯•å›¾åˆ›å»ºä¸€ä¸ªè¢«è°ƒç”¨çš„å·ï¼Œè€Œæ˜¯ æŸ¥æ‰¾ä¸€ä¸ªç®€å•è°ƒç”¨çš„ç°æœ‰å·ï¼Œdataå¹¶å°†å…¶æŒ‚è½½åˆ°dbæœåŠ¡çš„å®¹å™¨ä¸­. version: â€˜2â€™ services: db: image: postgres volumes: - data:/var/lib/postgresql/data volumes: data: external: true","link":"/2017/11/15/docker/compose.yam/"},{"title":"Dockerfileåˆ›å»ºé•œåƒ","text":"Dockerfile ä¸€èˆ¬åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ã€‚ æŒ‡ä»¤ 1ã€FROM æ ¼å¼ä¸ºFROM æˆ–: ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸ºFROMï¼ŒåŒä¸€ä¸ªDockerfileå¯ä»¥åˆ›å»ºå¤šä¸ªé•œåƒï¼Œä½¿ç”¨å¤šä¸ªFROMæŒ‡ä»¤ã€‚ 2ã€MAINTAINER æ ¼å¼ä¸ºMINTAINER ,æŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ã€‚ 3ã€RUN æ ¼å¼ä¸ºRUNæˆ–RUN [â€œexecutableâ€,â€paramlâ€,â€param2â€] å‰è€…åœ¨shellç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤ï¼Œå³/bin/sh -c;åè€…ç”¨execæ‰§è¡Œã€‚ 4ã€CMD æ”¯æŒä¸‰ç§æ ¼å¼ï¼š CMD [â€œexecutableâ€,â€paramlâ€,â€param2â€] ä½¿ç”¨execæ‰§è¡Œï¼Œæ¨èæ–¹å¼ã€‚ CMD command param1 param2ï¼Œåœ¨/bin/shä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ã€‚ CMD [â€œparamlâ€,â€param2â€],æä¾›ç»™ENTRYPOINTçš„é»˜è®¤å‚æ•°ã€‚ æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ªDockerfile åªèƒ½æœ‰ä¸€æ¡CMDå‘½ä»¤ã€‚ å¦‚æœæŒ‡å®šå¤šä¸ªï¼Œåˆ™åªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰CMDæŒ‡å®šçš„å‘½ä»¤ã€‚ 5ã€EXPOSE æ ¼å¼ä¸ºEXPOSE [â€¦] å‘Šè¯‰DockeræœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ã€‚ 6ã€ENV æ ¼å¼ä¸ºENV ã€‚æŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­RUNæŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒã€‚ 7ã€ADD æ ¼å¼ä¸ºADD è¯¥æŒ‡ä»¤å°†å¤åˆ¶æŒ‡å®šçš„åˆ°å®¹å™¨ä¸­çš„ã€‚å…¶ä¸­å¯ä»¥æ˜¯Dockerfileæ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªURLï¼›è¿˜å¯ä»¥æ˜¯taræ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å‹ä¸ºç›®å½•ï¼‰ã€‚ 8ã€COPY æ ¼å¼ä¸ºCOPY å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ ï¼ˆä¸ºDockerfileæ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰åˆ°å®¹å™¨ä¸­çš„ã€‚ç›®æ ‡è·¯å¾„ä¸å­˜åœ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚ å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èç”¨COPYã€‚ 9ã€ENTRYPOINT ä¸¤ç§æ ¼å¼ï¼š ENTRYPOINT [â€œexecutableâ€,â€paramlâ€,â€param2â€] ENTRYPOINT command param1 param2ï¼ˆshellä¸­æ‰§è¡Œï¼‰ã€‚ å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢«docker run æä¾›çš„å‚æ•°è¦†ç›–ã€‚ æ¯ä¸ªDockefileä¸­åªèƒ½ç”¨ä¸€ä¸ªENTRYPOINTï¼Œå½“æŒ‡å®šäº†å¤šä¸ªENTRYPOINTï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚ 10ã€VOLUME æ ¼å¼ä¸ºVOLUME [â€œ/dataâ€]ã€‚ åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶å®ƒå®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿å­˜çš„æ•°æ®ã€‚ 11ã€USER æ ¼å¼ä¸ºUSER daemonã€‚ æŒ‡å®šè¿è¡Œå®¹å™¨æ˜¯çš„ç”¨æˆ·åæˆ–UID,åç»­çš„RUNä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·ã€‚ å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡æ”¹åäº†æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ·ã€‚è¦ä¸´æ—¶è·å–ç®¡ç†äº‘æƒé™å¯ä»¥ç”¨gosuï¼Œä¸æ¨èsudoã€‚ 12ã€WORKDIR æ ¼å¼ä¸ºWORKDIR /path/to/workdirã€‚ ä¸ºåç»­çš„RUNã€CMDã€ENTRYPOINTæŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•ã€‚ å¯ä»¥ä½¿ç”¨å¤šä¸ªWORKDIRæŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°ä¸ºç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„ã€‚ 13ã€ONBUILD æ ¼å¼ä¸ºONBUILD [INSTRCTION] é…ç½®å½“æ‰€å»ºé•œåƒä½œä¸ºå…¶ä»–æ–°å»ºé•œåƒçš„åŸºç¡€é•œåƒæ—¶ï¼Œæ‰€æ‰§è¡Œçš„æ“ä½œæŒ‡ä»¤ åˆ›å»ºé•œåƒ ç¼–å†™å®ŒDockefileåï¼Œå¯é€šè¿‡docker buildå‘½ä»¤åˆ›å»ºé•œåƒã€‚ æ ¼å¼ä¸ºdocker build [OPTIONS] PATH | URL | -","link":"/2017/10/25/docker/Dockerfile%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F/"},{"title":"docker-machine","text":"ä¹‹å‰ï¼ŒDockerçš„å®‰è£…æµç¨‹éå¸¸å¤æ‚ï¼Œç”¨æˆ·éœ€è¦ç™»å½•åˆ°ç›¸åº”çš„ä¸»æœºä¸Šï¼Œæ ¹æ®å®˜æ–¹çš„å®‰è£…å’Œé…ç½®æŒ‡å—æ¥å®‰è£…Dockerï¼Œå¹¶ä¸”ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„å®‰è£…æ­¥éª¤ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚è€Œæœ‰äº†Machineåï¼Œä¸ç®¡æ˜¯åœ¨ç¬”è®°æœ¬ã€è™šæ‹Ÿæœºè¿˜æ˜¯å…¬æœ‰äº‘å®ä¾‹ä¸Šï¼Œç”¨æˆ·ä»…ä»…éœ€è¦ä¸€ä¸ªå‘½ä»¤å°±è½»æ¾æå®šå®‰è£…ã€‚å½“ç„¶é‚£ä½ éœ€è¦å…ˆå®‰è£…Docker Machineã€‚Docker Machineæ˜¯ä¸€ä¸ªç®€åŒ–Dockerå®‰è£…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå³å¯åœ¨ç›¸åº”çš„å¹³å°ä¸Šå®‰è£…Dockerï¼Œæ¯”å¦‚VirtualBoxã€ Digital Oceanã€Microsoft Azureã€‚ å®‰è£…docker-machine linux: 123$ curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;chmod +x /tmp/docker-machine &amp;&amp;sudo cp /tmp/docker-machine /usr/local/bin/docker-machine æŸ¥çœ‹ç‰ˆæœ¬ï¼š 12$ docker-machine version docker-machine version 0.13.0, build 9371605 åˆ›å»ºè™šæ‹Ÿä¸»æœºé¦–å…ˆç¡®ä¿æœåŠ¡å™¨å«æœ‰ VirtualBox è½¯ä»¶åï¼ˆå¦‚æœæ²¡æœ‰è£…virtualboxæˆ‘ä»¬ä½¿ç”¨#apt install virtualboxï¼‰ï¼Œ æˆ‘ä»¬å¯ä»¥ç›´æ¥å®‰è£…dockeræä¾›çš„ä¸€ä¸ª Boot2Dockerï¼ŒBoot2Dockeræ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºè¿è¡ŒDockerå®¹å™¨çš„è½»é‡çº§Linuxå‘è¡Œç‰ˆã€‚ 123456$ docker-machine create --driver virtualbox default #åˆ›å»ºåä¸ºdefaultçš„machine Running pre-create checks... (default) Image cache directory does not exist, creating it at /root/.docker/machine/cache... (default) No default Boot2Docker ISO found locally, downloading the latest release... (default) Latest release for github.com/boot2docker/boot2docker is v17.11.0-ce (default) Downloading /root/.docker/machine/cache/boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v17.11.0-ce/boot2docker.iso... è¯´æ˜ï¼šä¸‹è½½å¯èƒ½éå¸¸æ…¢å¯ä»¥å…ˆä¸‹è½½å¥½ï¼Œç„¶åç§»åŠ¨åˆ°/root/.docker/machine/cache/æ–‡ä»¶å¤¹ä¸‹ã€‚ ç”¨è™šæ‹Ÿæœºå¯èƒ½é‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š 12Running pre-create checks...Error with pre-create check: &quot;This computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory&quot; è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨vmwareå½“ä¸­å¼€å¯è™šæ‹ŸåŒ–å¼•æ“å°±å¯ä»¥äº†ã€‚ æŸ¥çœ‹åˆ›å»ºçš„machine 123$ docker-machine lsNAME ACTIVE DRIVER STATE URL SWARM DOCKER ERRORSdefault - virtualbox Running tcp://192.168.99.100:2376 v17.11.0-ce æŸ¥çœ‹machineçš„ç¯å¢ƒ 1234567$ docker-machine env defaultexport DOCKER_TLS_VERIFY=&quot;1&quot;export DOCKER_HOST=&quot;tcp://192.168.99.100:2376&quot;export DOCKER_CERT_PATH=&quot;/root/.docker/machine/machines/default&quot;export DOCKER_MACHINE_NAME=&quot;default&quot;# Run this command to configure your shell:# eval $(docker-machine env default) è¿æ¥åˆ°æ–°æœºå™¨machine 1$ eval &quot;$(docker-machine env default)&quot; è·å–machineä¸»æœºip 12$ docker-machine ip default192.168.99.100 åœ¨å®¹å™¨ä¸­è¿è¡ŒNginx WebæœåŠ¡å™¨ï¼š 1$ docker run -d -p 8000:80 nginx å¯åŠ¨å’Œåœæ­¢æœºå™¨ 12$ docker-machine stop default$ docker-machine start default","link":"/2017/11/30/docker/docker-machine/"},{"title":"dockerä»“åº“","text":"å®˜æ–¹é•œåƒä»“åº“ï¼šhttps://hub.docker.com å¯é€šè¿‡docker loginå‘½ä»¤è¾“å…¥ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±å®Œæˆæ³¨å†Œå’Œç™»å½•ï¼Œä¼šåœ¨æœ¬åœ°ç”¨æˆ·ç›®å½•.dockercfgä¸­ä¿å­˜ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚ é˜¿é‡Œäº‘ä»“åº“ï¼šhttps://dev.aliyun.com/search.html registry.cn-hangzhou.aliyuncs.com åˆ›å»ºç§æœ‰ä»“åº“ å®‰è£…dockeråï¼Œå¯ä»¥é€šè¿‡å®˜æ–¹æä¾›çš„registryé•œåƒæ­å»ºæœ¬åœ°ç§æœ‰ä»“åº“ç¯å¢ƒ 1ã€ä¸‹è½½å¯åŠ¨ç§æœ‰ä»“åº“ 1$ docker run -d -p 5000:5000 registry ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªç§æœ‰ä»“åº“æœåŠ¡ï¼Œç›‘å¬ç«¯å£ä¸º5000. 2ã€æ ‡è®°ä¸€ä¸ªimageï¼ŒæŒ‡å‘ç§æœ‰ä»“åº“ 1$ docker tag ubuntu localhost:5000/my_ubuntu 3ã€æ¨å‘ç§æœ‰ä»“åº“ 1$ docker push localhost:5000/my_ubuntu 4ã€ä»ç§æœ‰ä»“åº“æ‹‰ä¸‹æ¥ 1$ docker pull localhost:5000/my_ubuntu è¯´æ˜ï¼š 1$ docker exec -ti 2248c81af285 /bin/sh #è¿›å…¥ç§æœ‰ä»“åº“å®¹å™¨ ç§æœ‰ä»“åº“é…ç½®æ–‡ä»¶åœ¨å®¹å™¨/etc/docker/registryä¸‹ã€‚ pushåˆ°ä»“åº“çš„imagesåœ¨/var/lib/registry/dockerä¸‹ã€‚","link":"/2017/10/24/docker/docker%E4%BB%93%E5%BA%93/"},{"title":"dockerå®¹å™¨","text":"åˆ›å»ºå®¹å™¨ 12345$ docker create -it ubuntu:latest782d307c281f26b47f10b53216ab34e69c7658f6112c5aadf5f52e74d5fab943$ docker ps -aCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES782d307c281f ubuntu \"/bin/bash\" 12 seconds ago Created boring_benz è¯´æ˜ï¼šä½¿ç”¨docker create åˆ›å»ºçš„å®¹å™¨å¤„äºåœæ­¢çŠ¶æ€ã€‚å¯ä½¿ç”¨docker startå‘½ä»¤å¯åŠ¨ã€‚ æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨å¯åŠ¨å®¹å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºé•œåƒæ–°å»ºä¸€ä¸ªå®¹å™¨å¹¶å¯åŠ¨ï¼Œå¦ä¸€ä¸ªæ˜¯å°†ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨é‡æ–°å¯åŠ¨ã€‚å‘½ä»¤ä¸ºï¼šdocker run ç­‰ä»·äº docker create å‘½ä»¤ï¼Œå†æ‰§è¡Œdocker startå‘½ä»¤ã€‚ä½¿ç”¨docker run æ¥åˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨æ—¶ï¼Œdockeråœ¨åå°è¿è¡Œçš„æ“ä½œæ˜¯1ã€æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬å…±ä»“åº“ä¸‹è½½ã€‚2ã€åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚3ã€åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚ã€‚4ã€ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­ã€‚5ã€ä»åœ°å€æ± é…ç½®ä¸€ä¸ªIPåœ°å€ç»™å®¹å™¨ã€‚6ã€æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åºã€‚7ã€æ‰§è¡Œå®Œæ¯•åå®¹å™¨ç»ˆæ­¢ã€‚ 12$ docker run -i -t ubuntu:16.04 /bin/bash$ docker start ubuntu -t:è®©dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å‡ºä¸Šã€‚-iï¼šè®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚ å®ˆæŠ¤æ€è¿è¡Œ 1$ docker run -d ubuntu /bin/sh -c \"while true; do echo hello world; sleep 1; done\" -d:è®©dockerå®¹å™¨åœ¨åå°ä»¥å®ˆæŠ¤æ€å½¢å¼è¿è¡Œã€‚ ç»ˆæ­¢å®¹å™¨ 12$ docker stop [OPTIONS] CONTAINER [CONTAINER...]$ docker stop ubuntu è¿›å…¥å®¹å™¨å¯åŠ¨ä½¿ç”¨-då‚æ•°ï¼Œå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥åå°ï¼Œæ— æ³•çœ‹è§å®¹å™¨ä¸­çš„ä¿¡æ¯ã€‚å¯ä½¿ç”¨docker attachå‘½ä»¤ã€docker exec å‘½ä»¤ã€‚ä»¥åŠnaenterå·¥å…·ã€‚docker attac 1$ docker attach ubuntu è¯´æ˜ï¼š å½“å¤šä¸ªçª—å£åŒæ—¶attachåˆ°åŒä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæ‰€æœ‰çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºã€‚å½“æŸä¸ªçª—å£å› å‘½ä»¤å µå¡æ—¶ï¼Œå…¶å®ƒçª—å£ä¹Ÿæ— æ³•æ‰§è¡Œæ“ä½œäº†ã€‚docker exec 12345$ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES f1bdd171e79d ubuntu \"/bin/bash\" 16 hours ago Exited (0) 16 hours ago trusting_noyce$ docker start f1bdd171e79d$ docker exec -ti f1bdd171e79d /bin/bash è·å–å®¹å™¨è¿›ç¨‹çš„pid 1$ docker inspect --format \"{{.State.Pid}}\" f1bdd171e79d åˆ é™¤å®¹å™¨ä½¿ç”¨docker rmå‘½ä»¤ 1$ docker rm f1bdd171e79d -f,â€“force=false å¼ºè¡Œç»ˆæ­¢å¹¶åˆ é™¤ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ã€‚-l,â€“link=falseåˆ é™¤å®¹å™¨çš„è¿æ¥ï¼Œä½†ä¿ç•™å®¹å™¨ã€‚-v,â€“volumes=falseåˆ é™¤å®¹å™¨æŒ‚è½½çš„æ•°æ®å·ã€‚ å¯¼å‡ºå®¹å™¨ 1$ docker export f1bdd171e79d &gt; ubuntu.tar å¯¼å…¥å®¹å™¨å¯¼å‡ºçš„å®¹å™¨æ–‡ä»¶å¯ä»¥ä½¿ç”¨docker importå¯¼å…¥ï¼Œæˆä¸ºé•œåƒã€‚ 1cat ubuntu.tar | docker import - ubuntu:v1.0 å®é™…ä¸Šï¼Œå¯ä»¥ä½¿ç”¨docker loadå‘½ä»¤å¯¼å…¥é•œåƒçš„å‚¨å­˜æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ï¼Œç”¨docker importå‘½ä»¤å¯¼å…¥ä¸€ä¸ªå®¹å™¨åˆ°æœ¬åœ°é•œåƒåº“ã€‚","link":"/2017/10/22/docker/docker%E5%AE%B9%E5%99%A8/"},{"title":"dockerçš„å®‰è£…","text":"ç³»ç»Ÿç¯å¢ƒï¼šUbuntu 16.04 å®˜æ–¹æ–‡æ¡£ç»™å‡ºä¸‰ç§å®‰è£…æ–¹å¼ 1ã€è®¾ç½®dockerçš„å­˜å‚¨åº“ï¼Œå¹¶ä»ä¸­è¿›è¡Œå®‰è£…ï¼Œæ–¹ä¾¿å®‰è£…å’Œå‡çº§ï¼Œæ¨èã€‚ 2ã€ä¸‹è½½debè½¯ä»¶åŒ…ï¼Œæ‰‹åŠ¨å®‰è£…ã€å‡çº§ã€‚ä¸èƒ½è®¿é—®äº’è”ç½‘æ—¶çš„æƒ…å†µã€‚ 3ã€ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬å®‰è£…ï¼Œæµ‹è¯•å’Œå¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚ ä½¿ç”¨è„šæœ¬è¿›è¡Œå®‰è£…12$ curl -fsSL get.docker.com -o get-docker.sh$ sudo sh get-docker.sh dockeré•œåƒè·å–é•œåƒ123$ sudo docker pull ubuntu # ä»hub.docker.comè·å–ubuntu:latesté•œåƒ$ sudo docker pull ubuntu:16.04 #ä¸‹è½½æŒ‡å®šçš„ç‰ˆæœ¬$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/ubuntu/ubuntu #ä»é˜¿é‡Œäº‘ä»“åº“ä¸‹è½½ æŸ¥çœ‹æ‰€æœ‰é•œåƒä¿¡æ¯1234$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 16.04 747cb2d60bbe 11 days ago 122MB hello-world latest 05a3bd381fc2 5 weeks ago 1.84kB REPOSITORY:ä»“åº“å TAGï¼šç‰ˆæœ¬ï¼Œæ ‡ç­¾ä¿¡æ¯ IMAGE ID:é•œåƒID CREATEDï¼šåˆ›å»ºæ—¶é—´ SIZEï¼šé•œåƒå¤§å° æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯1$ docker inspect ubuntu ä»è¿œç«¯ä»“åº“æœç´¢é•œåƒ1$ docker search ubuntu æ›´æ”¹é•œåƒTAG1$ docker tag registry.cn-hangzhou.aliyuncs.com/ubuntu/ubuntu:latest ali-ubuntu:16.04 åˆ é™¤é•œåƒ1$ docker rmi ubuntu æ³¨æ„ï¼šå½“æœ‰è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶ï¼Œåˆ™é•œåƒæ–‡ä»¶é»˜è®¤æ— æ³•åˆ é™¤ï¼Œåº”å…ˆåˆ é™¤é•œåƒåˆ›å»ºçš„å®¹å™¨ã€‚ æŸ¥çœ‹æœ¬æœºæ‰€æœ‰å®¹å™¨123$ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 75f6116e66fa hello-world \"/hello\" 2 hours ago Exited (0) 2 hours ago compassionate_dubinsky åˆ é™¤å®¹å™¨1$ docker rm 75f6116e66fa åˆ›å»ºé•œåƒä¸‰ç§æ–¹å¼ï¼š 1ã€åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºã€‚ 2ã€åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥ã€‚ 3ã€åŸºäºDockerfileåˆ›å»ºã€‚ åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºã€‚ 1$ docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] -a,â€“author:ä½œè€…ä¿¡æ¯ -m,â€“message:æäº¤ä¿¡æ¯ -p,â€“pauseï¼šæäº¤æ—¶æš‚åœå®¹å™¨è¿è¡Œ å¾…è¡¥å……ã€‚ã€‚ã€‚ å­˜å‡ºé•œåƒ1$ docker save -o ubuntu16.04.tar ubuntu:16.04 è½½å…¥é•œåƒ1$ docker load --input ubuntu16.04.tar ä¸Šä¼ é•œåƒåˆ°ä»“åº“é»˜è®¤ä¸Šä¼ åˆ°DockerHubä»“åº“ï¼Œéœ€è¦ç™»å½•ã€‚ 1$ docker push [OPTIONS] NAME[:TAG]","link":"/2017/10/22/docker/docker%E7%9A%84%E5%AE%89%E8%A3%85/"},{"title":"dockeræ•°æ®ç®¡ç†","text":"æ•°æ®å· åˆ›å»ºä¸€ä¸ªæ•°æ®å· 1$ docker volume create my-vol æŸ¥çœ‹å·åˆ—è¡¨ 12$ docker volume ls local my-vol å·è¯¦æƒ… 123456789101112$ docker volume inspect my-vol [ { \"CreatedAt\": \"2017-10-25T10:37:54+08:00\", \"Driver\": \"local\", \"Labels\": {}, \"Mountpoint\": \"/var/lib/docker/volumes/my-vol/_data\", \"Name\": \"my-vol\", \"Options\": {}, \"Scope\": \"local\" } ] åˆ é™¤å· 1$ docker volume rm my-vol ä½¿ç”¨ docker run -v å¯åŠ¨çš„å®¹å™¨è¢«åˆ é™¤ä»¥åï¼Œåœ¨ä¸»æœºä¸Šä¼šé—ç•™ä¸‹æ¥å­¤å•çš„å·ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç®€å•æ–¹æ³•æ¥åšæ¸…ç†ï¼š 123$ docker volume ls -qf dangling=true$ docker volume rm $(docker volume ls -qf dangling=true)$ docker volume ls å¯åŠ¨å…·æœ‰æ•°æ®å·çš„å®¹å™¨ -vï¼Œâ€“volumeå’Œâ€“mountï¼Œéƒ½å¯å®ç°ç›¸åŒç›®æ ‡ï¼Œâ€“mountæ›´ä¸ºæ˜ç¡®å’Œå†—é•¿ã€‚æœ€å¤§çš„åŒºåˆ«æ˜¯-v è¯­æ³•å°†æ‰€æœ‰é€‰é¡¹åˆå¹¶åœ¨ä¸€ä¸ªå­—æ®µä¸­ï¼Œè€Œâ€“mount è¯­æ³•å°†å®ƒä»¬åˆ†å¼€ã€‚ â€“mount ç”±å¤šä¸ªé”®å€¼å¯¹ç»„æˆï¼Œç”±é€—å·åˆ†éš”ï¼Œæ¯ä¸ªç”±=å…ƒç»„ç»„æˆã€‚ type å€¼å¯ä»¥æ˜¯volumeï¼Œbindæˆ–tmpfsã€‚å¦‚æœæœªæŒ‡å®šç±»å‹ï¼Œåˆ™é»˜è®¤ä¸ºvolume 123456789101112* volumeå°†æ•°æ®å·å£®å“‰åˆ°å®¹å™¨ã€‚ * bindï¼šå°†ç›®å½•æˆ–æ–‡ä»¶ä»ä¸»æœºç»‘å®šåˆ°å®¹å™¨ä¸­ã€‚ * tmpfsï¼šåœ¨å®¹å™¨ä¸­å®‰è£…ä¸€ä¸ªtmpfsã€‚ srcæˆ–source* type = volumeï¼Œsrcæ˜¯å¯é€‰çš„ï¼Œç”¨æ¥æŒ‡å®šå·çš„åç§°ï¼Œå·ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºï¼ŒæœªæŒ‡å®šsrcï¼Œåˆ™ä¼šä¸ºè¯¥å·åˆ†é…ä¸€ä¸ªéšæœºåç§°ã€‚ * type = bindï¼šsrcæ˜¯å¿…éœ€çš„ã€‚æŒ‡å®šè¦ç»‘å®šçš„æ–‡ä»¶æˆ–ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œæ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šäº§ç”Ÿé”™è¯¯ã€‚ * type = tmpfsï¼šsrcä¸å—æ”¯æŒã€‚ dstæˆ– destination æˆ– targetï¼ŒæŒ‡å®šçš„æ•°æ®å·æ–‡ä»¶æˆ–ç›®å½•å°†è¢«å®‰è£…åœ¨å®¹å™¨çš„è·¯å¾„ã€‚ * å®¹å™¨å†…çš„å®‰è£…è·¯å¾„ï¼Œå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºã€‚ readonlyæˆ–ro ç»‘å®šä»¥åªè¯»çš„æ–¹å¼è£…è½½åˆ°å®¹å™¨ã€‚ * trueæˆ–1æˆ–æ— å€¼ï¼šæŒ‚è½½ç»‘å®šæˆ–å·ä¸ºåªè¯»ã€‚* falseæˆ–0ï¼šæŒ‚è½½ç»‘å®šæˆ–å·è¯»å†™ã€‚ ä½¿ç”¨ -v æ¥æŒ‚è½½ä¸€ä¸ªä¸»æœºä¸Šçš„ç›®å½•åˆ°å®¹å™¨çš„ç›®å½•,-vå‚æ•°å‚æ•°å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œä»¥æ·»åŠ å¤šä¸ªæ•°æ®å· 1$ docker run -d -p 80:80 -v /root:/usr/share/nginx/html nginx /bin/bash å¦‚æœå¯åŠ¨ä¸€ä¸ªä¸å­˜åœ¨çš„å·çš„å®¹å™¨ï¼Œdockerä¼šè‡ªåŠ¨åˆ›å»ºå·ã€‚ ä¸‹è¿°ï¼Œ-vå’Œâ€“mount äº§ç”ŸåŒæ ·çš„æ•ˆæœã€‚ -v â€“mount docker run -d -it â€“name test_nginx -v my-vol2:/app nginx:latest docker run -d -it â€“name test_nginx â€“mount source=my-vol2,target=/app nginx:latest ä½¿ç”¨docker inspect test_nginx éªŒè¯åˆ›å»ºå¹¶æ­£ç¡®å®‰è£…ï¼Œå¯»æ‰¾Mountéƒ¨åˆ†ã€‚ 123456789101112\"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"my-vol2\", \"Source\": \"/var/lib/docker/volumes/my-vol2/_data\", \"Destination\": \"/app\", \"Driver\": \"local\", \"Mode\": \"z\", \"RW\": true, \"Propagation\": \"\" } ], è¿™è¡¨æ˜mountæ˜¯ä¸€ä¸ªå·ï¼Œå®ƒæ˜¾ç¤ºæ­£ç¡®çš„æºå’Œç›®çš„åœ°ï¼Œå¹¶ä¸”mountæ˜¯è¯»å†™çš„ã€‚ åœæ­¢å®¹å™¨å¹¶åˆ é™¤å· 123$ docker container stop test_nginx$ docker container rm test_nginx$ docker volume rm my-vol2 å‚è€ƒï¼šhttps://docs.docker.com/engine/admin/volumes/volumes/#choose-the--v-or-mount-flaghttps://docs.docker.com/engine/reference/commandline/service_create/#set-metadata-on-a-service--l-labelhttps://docs.docker.com/engine/admin/volumes/tmpfs/#specify-tmpfs-options","link":"/2017/10/24/docker/docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/"},{"title":"Elasticsearch-analyze","text":"_analyze åˆ†æè¢«å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ 12345GET /_analyze{ &quot;analyzer&quot;: &quot;index_ansj&quot;, &quot;text&quot;: &quot;å…­å‘³åœ°é»„ä¸¸è½¯èƒ¶å›Š.&quot;} analyzer: æŒ‡å®šåˆ†æå™¨ã€‚ text: è¦è¢«åˆ†æçš„å†…å®¹ã€‚ ç»“æœä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„è¯æ¡ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546{ &quot;tokens&quot;: [ { &quot;token&quot;: &quot;å…­å‘³&quot;, &quot;start_offset&quot;: 0, &quot;end_offset&quot;: 2, &quot;type&quot;: &quot;mq&quot;, &quot;position&quot;: 0 }, { &quot;token&quot;: &quot;åœ°é»„&quot;, &quot;start_offset&quot;: 2, &quot;end_offset&quot;: 4, &quot;type&quot;: &quot;n&quot;, &quot;position&quot;: 1 }, { &quot;token&quot;: &quot;ä¸¸&quot;, &quot;start_offset&quot;: 4, &quot;end_offset&quot;: 5, &quot;type&quot;: &quot;q&quot;, &quot;position&quot;: 2 }, { &quot;token&quot;: &quot;è½¯&quot;, &quot;start_offset&quot;: 5, &quot;end_offset&quot;: 6, &quot;type&quot;: &quot;a&quot;, &quot;position&quot;: 3 }, { &quot;token&quot;: &quot;èƒ¶å›Š&quot;, &quot;start_offset&quot;: 6, &quot;end_offset&quot;: 8, &quot;type&quot;: &quot;n&quot;, &quot;position&quot;: 4 }, { &quot;token&quot;: &quot;.&quot;, &quot;start_offset&quot;: 8, &quot;end_offset&quot;: 9, &quot;type&quot;: &quot;w&quot;, &quot;position&quot;: 5 } ]}","link":"/2018/06/08/elasticsearch/Elasticsearch-analyze/"},{"title":"Elasticsearch-æ˜ å°„","text":"æ˜ å°„æ˜¯ç”¨äºå®šä¹‰æ–‡æ¡£æ‰€åŒ…å«çš„å­—æ®µçš„æ•°æ®ç±»å‹è¿›è¡Œå­˜å‚¨å’Œç´¢å¼•æ–¹å¼çš„è¿‡ç¨‹ ã€‚ å­—æ®µæ•°æ®ç±»å‹ Field datatypes æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªæ•°æ®ç±»å‹ã€‚å¯ä»¥æ˜¯ åŸºæœ¬æ•°æ®ç±»å‹ï¼štextï¼Œkeywordï¼Œdateï¼Œlongï¼Œ doubleï¼Œbooleanæˆ–ipã€‚ ä¸€ç§æ”¯æŒJSONçš„åˆ†å±‚ç‰¹æ€§çš„ç±»å‹ï¼Œå¦‚ objectæˆ–nestedã€‚ ä¸€ç§ç‰¹æ®Šç±»å‹ geo_pointï¼Œ geo_shapeæˆ–completionã€‚ ä»¥ä¸åŒçš„ç›®çš„å¯¹å­—æ®µæ˜ å°„åˆé€‚çš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²å­—æ®µå¯ä»¥æ˜ å°„ä¸ºtextç”¨äºå…¨æ–‡æœç´¢ï¼Œä¹Ÿå¯ä»¥æ˜ å°„keywordè¿›è¡Œæ’åºæˆ–èšåˆ ã€‚å¤šæ•°æ•°æ®ç±»å‹ éƒ½å¯ä»¥é€šè¿‡fieldså‚æ•°å°† åŒä¸€å­—æ®µè¿›è¡Œå¤šä¸ªæ•°æ®ç±»å‹çš„ç´¢å¼•æ–¹å¼ã€‚ æ˜ å°„çˆ†ç‚¸åœ¨ç´¢å¼•ä¸­å®šä¹‰å¤ªå¤šå­—æ®µæ˜¯ä¸€ç§å¯èƒ½å¯¼è‡´æ˜ å°„çˆ†ç‚¸çš„æƒ…å†µï¼Œè¿™å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³é”™è¯¯å’Œéš¾ä»¥æ¢å¤çš„æƒ…å†µ ï¼Œä¾‹å¦‚ï¼Œæ’å…¥çš„æ¯ä¸ªæ–°æ–‡æ¡£æ—¶å¼•å…¥æ–°å­—æ®µçš„æƒ…å†µã€‚è¿™åœ¨åŠ¨æ€æ˜ å°„ä¸­éå¸¸å¸¸è§ã€‚æ¯æ¬¡æ–‡æ¡£åŒ…å«æ–°å­—æ®µæ—¶ï¼Œè¿™äº›å­—æ®µæœ€ç»ˆéƒ½ä¼šå‡ºç°åœ¨ç´¢å¼•çš„æ˜ å°„ä¸­ã€‚ å¦‚æœåªæ˜¯å°‘é‡æ•°æ®ï¼Œè¿™å¹¶ä¸éœ€è¦æ‹…å¿ƒï¼Œä½†éšç€æ˜ å°„çš„å¢é•¿ï¼Œå®ƒå¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚ å¦‚éœ€å­—æ®µæ˜ å°„çš„æ•°é‡ ï¼Œæ¥é˜²æ­¢æ˜ å°„çˆ†ç‚¸ã€‚å‚è€ƒ mapping-limit-settings åŠ¨æ€æ˜ å°„åœ¨æ·»åŠ æ–‡æ¡£æ—¶ä¸éœ€è¦å®šä¹‰å­—æ®µå’Œæ˜ å°„ç±»å‹ ï¼Œæ˜¯å› ä¸ºElasticsearchçš„åŠ¨æ€æ˜ å°„ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æ–°çš„å­—æ®µåç§°ã€‚æ–°å­—æ®µæ—¢å¯ä»¥æ·»åŠ åˆ°æ˜ å°„ç±»å‹ã€‚ æ˜¾ç¤ºæ˜ å°„ åŠ¨æ€æ˜ å°„çš„å­—æ®µç±»å‹å¯èƒ½ä¸æ˜¯ç†æƒ³çš„ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šæ˜ å°„ã€‚ å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶åˆ›å»ºå­—æ®µæ˜ å°„ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨PUTæ˜ å°„APIå°†å­—æ®µæ·»åŠ åˆ°ç°æœ‰ç´¢å¼• ã€‚ æ›´æ–°ç°æœ‰å­—æ®µæ˜ å°„ç°æœ‰çš„å­—æ®µæ˜ å°„æ— æ³•æ›´æ–°ã€‚æ›´æ”¹æ˜ å°„æ„å‘³ç€ä½¿å·²ç¼–åˆ¶ç´¢å¼•çš„æ–‡æ¡£æ— æ•ˆã€‚ åº”è¯¥åˆ›å»ºä¸€ä¸ªæ­£ç¡®æ˜ å°„æ–°çš„ç´¢å¼•å¹¶é‡æ–°ç´¢å¼•çš„æ•°æ®è½¬æ¢åˆ°indexã€‚ æ˜ å°„ç¤ºä¾‹12345678910111213141516PUT my_index { \"mappings\": { \"doc\": { \"properties\": { \"title\": { \"type\": \"text\" }, \"name\": { \"type\": \"text\" }, \"age\": { \"type\": \"integer\" }, \"created\": { \"type\": \"date\", \"format\": \"strict_date_optional_time||epoch_millis\" } } } }} å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html","link":"/2018/07/11/elasticsearch/Elasticsearch-%E6%98%A0%E5%B0%84/"},{"title":"elastic-stack","text":"elastic-stack Elastic Stackèƒ½å¤Ÿä»¥ä»»ä½•æ ¼å¼å¯é çš„ï¼Œå®‰å…¨åœ°ä»ä»»ä½•æ¥æºè·å–æ•°æ®ï¼Œå¹¶å®æ—¶æœç´¢ï¼Œåˆ†æå’Œå¯è§†åŒ–ã€‚ ç”±ELK (Elasticsearchã€Logstashä»¥åŠKibana) +Beats ç»„æˆã€‚ ç›®å‰BeatsåŒ…å«å…­ç§å·¥å…·ï¼š Packetbeatï¼š ç½‘ç»œæ•°æ®ï¼ˆæ”¶é›†ç½‘ç»œæµé‡æ•°æ®ï¼‰ Metricbeatï¼š æŒ‡æ ‡ ï¼ˆæ”¶é›†ç³»ç»Ÿã€è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿçº§åˆ«çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µç­‰æ•°æ®ï¼‰ Filebeatï¼š æ—¥å¿—æ–‡ä»¶ï¼ˆæ”¶é›†æ–‡ä»¶æ•°æ®ï¼‰ Winlogbeatï¼š windowsäº‹ä»¶æ—¥å¿—ï¼ˆæ”¶é›† Windows äº‹ä»¶æ—¥å¿—æ•°æ®ï¼‰ Auditbeatï¼šå®¡è®¡æ•°æ® ï¼ˆæ”¶é›†å®¡è®¡æ—¥å¿—ï¼‰ Heartbeatï¼šè¿è¡Œæ—¶é—´ç›‘æ§ ï¼ˆæ”¶é›†ç³»ç»Ÿè¿è¡Œæ—¶çš„æ•°æ®ï¼‰","link":"/2018/08/20/elasticsearch/elastic-stack/"},{"title":"SpringBootä¸ElasticSearché›†æˆ","text":"springbootç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º2.0.3.RELEASEï¼Œè™½ç„¶spring-data-elasticsearchæœ€æ–°ç‰ˆæœ¬(æµ‹è¯•ç‰ˆ)ä¸º3.1.0å·²é›†æˆäº†ElasticSearch6.2.2ç‰ˆæœ¬ï¼Œä½†æ˜¯SpringBooté›†æˆçš„spring-data-elasticsearchä¸º3.0.7ç‰ˆæœ¬ï¼Œä¸æ”¯æŒElasticSearch 6 ç‰ˆæœ¬ã€‚æ‰€ä»¥åªå¾—è‡ªå·±é›†æˆã€‚ ElasticSearchè®¡åˆ’åœ¨7.0ä¸­å°†ä¼šå¼ƒç”¨TransportClientï¼Œå¹¶åœ¨8.0ä¸­å®Œå…¨åˆ é™¤å®ƒã€‚æ‰€ä»¥é€‰æ‹©å¯¹ Java High Level REST Client é›†æˆã€‚ElasticSearch æä¾›äº†ä¸€å¥—åŸºäºrestfulé£æ ¼çš„å…¨æ–‡æ£€ç´¢æœåŠ¡ç»„ä»¶ã€‚ 1ã€pom.xml 12345678910&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt; &lt;version&gt;6.3.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt; &lt;version&gt;6.3.0&lt;/version&gt;&lt;/dependency&gt; 2ã€ElasticsearchConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293import org.apache.http.HttpHost;import org.apache.http.auth.AuthScope;import org.apache.http.auth.UsernamePasswordCredentials;import org.apache.http.client.CredentialsProvider;import org.apache.http.impl.client.BasicCredentialsProvider;import org.apache.http.impl.nio.client.HttpAsyncClientBuilder;import org.elasticsearch.action.admin.indices.create.CreateIndexRequest;import org.elasticsearch.action.admin.indices.create.CreateIndexResponse;import org.elasticsearch.client.RestClient;import org.elasticsearch.client.RestClientBuilder;import org.elasticsearch.client.RestHighLevelClient;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.DisposableBean;import org.springframework.beans.factory.FactoryBean;import org.springframework.beans.factory.InitializingBean;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class ElasticsearchConfig implements FactoryBean&lt;RestHighLevelClient&gt;, InitializingBean, DisposableBean { private static final Logger LOGGER = LoggerFactory.getLogger(ElasticsearchConfig.class); @Value(\"${spring.data.elasticsearch.cluster-nodes}\") private String clusterNodes; private RestHighLevelClient restHighLevelClient; @Override public void afterPropertiesSet() throws Exception { restHighLevelClient = buildClient(); } private RestHighLevelClient buildClient() { try { final CredentialsProvider credentialsProvider = new BasicCredentialsProvider(); credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(\"username\", \"passwd\")); RestClientBuilder builder = RestClient.builder(new HttpHost(clusterNodes.split(\":\")[0], Integer.parseInt(clusterNodes.split(\":\")[1]),\"http\")) .setHttpClientConfigCallback(new RestClientBuilder.HttpClientConfigCallback() { @Override public HttpAsyncClientBuilder customizeHttpClient(HttpAsyncClientBuilder httpClientBuilder) { httpClientBuilder.disableAuthCaching(); return httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider); } }); restHighLevelClient = new RestHighLevelClient(builder); } catch (Exception e) { LOGGER.error(e.getMessage()); } return restHighLevelClient; } @Override public RestHighLevelClient getObject() throws Exception { return restHighLevelClient; } @Override public Class&lt;?&gt; getObjectType() { return RestHighLevelClient.class; } @Override public void destroy() throws Exception { try { if (restHighLevelClient != null) { restHighLevelClient.close(); } } catch (final Exception e) { LOGGER.error(\"Error closing ElasticSearch client: \", e); } } @Bean(name = \"cmsElasticSearchIndex\") public String cmsElasticSearchIndex() throws Exception { String cmsIndex= \"cms\"; GetIndexRequest getRequest = new GetIndexRequest(); getRequest.indices(cmsIndex); boolean exists = restHighLevelClient.indices().exists(getRequest); if(!exists) { CreateIndexRequest request = new CreateIndexRequest(cmsIndex); CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(request); boolean acknowledged = createIndexResponse.isAcknowledged(); // æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç¡®è®¤è¯·æ±‚ LOGGER.info(\"æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç¡®è®¤è¯·æ±‚?\" + acknowledged); } return cmsIndex; }} 3ã€application.properties 12spring.data.elasticsearch.cluster-name=my-es-clusterspring.data.elasticsearch.cluster-nodes=localhost:9200 4ã€æµ‹è¯• 123456789101112131415161718192021@Autowiredprivate BookServiceImpl bookService;@Autowiredprivate RestHighLevelClient client;@Testpublic void getIndexTest() { GetRequest request = new GetRequest(\"cms\", \"Book\", \"1\"); try { GetResponse response = client.get(request); System.out.println(response); } catch (IOException e) { e.printStackTrace(); }}@Testpublic void getIndexServiceTest() { Book book = bookService.findById(1L); System.out.println(book.toString());} é¡¹ç›®åœ°å€ï¼šspringboot-elasticsearch-high ElasticSearch6.3.0å·²å†…ç½®æ”¯æŒ SQL æ¨¡å— å‚è€ƒï¼šSQL æ¨¡å—","link":"/2018/06/15/elasticsearch/SpringBoot%E4%B8%8EElasticSearch%E9%9B%86%E6%88%90/"},{"title":"Elasticsearchï¼ˆä¸€ï¼‰å®‰è£…","text":"Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºApache Lucene(TM)çš„å¼€æº çš„å®æ—¶åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒå¯ç”¨äºå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æ ã€‚ å…³äºLucene ï¼ŒLuceneæ˜¯è¿„ä»Šä¸ºæ­¢æœ€å…ˆè¿›ã€æ€§èƒ½æœ€å¥½çš„ã€åŠŸèƒ½æœ€å…¨çš„æœç´¢å¼•æ“åº“ã€‚ ä½†æ˜¯ï¼ŒLuceneåªæ˜¯ä¸€ä¸ªåº“ã€‚æƒ³è¦ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨Javaæ¥ä½œä¸ºå¼€å‘è¯­è¨€å¹¶å°†å…¶ç›´æ¥é›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­ ã€‚ Elasticsearchä¹Ÿæ˜¯ä½¿ç”¨Javaå¼€å‘å¹¶ä½¿ç”¨Luceneä½œä¸ºå…¶æ ¸å¿ƒæ¥å®ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œå®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•çš„RESTful APIæ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å•ã€‚ å®‰è£…1ã€æ–°å¢elasticç³»ç»Ÿç”¨æˆ· 123$ adduser elastic$ su elastic$ cd /home/elastic/ 2ã€ä¸‹è½½å¹¶å®‰è£… 12345$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.tar.gz$ tar -xzf elasticsearch-6.2.4.tar.gz$ cd elasticsearch-6.2.4/$ lsbin config lib LICENSE.txt logs modules NOTICE.txt plugins README.textile ç±»å‹ æè¿° é»˜è®¤ä½ç½® è®¾ç½® homeç›®å½• Elasticsearchä¸»ç›®å½•æˆ– $ES_HOME è§£å‹åæ‰€åˆ›å»ºçš„ç›®å½• ï¼ˆelasticsearch-6.2.4ï¼‰ bin äºŒè¿›åˆ¶è„šæœ¬ï¼ŒåŒ…æ‹¬elasticsearchå¯åŠ¨èŠ‚ç‚¹å’Œelasticsearch-pluginå®‰è£…æ’ä»¶ $ES_HOME/bin config é…ç½®æ–‡ä»¶ $ES_HOME/config ES_PATH_CONF data åœ¨èŠ‚ç‚¹ä¸Šåˆ†é…çš„æ¯ä¸ªç´¢å¼•/åˆ†ç‰‡çš„æ•°æ®æ–‡ä»¶çš„ä½ç½®ã€‚å¯ä»¥å®¹çº³å¤šä¸ªåœ°ç‚¹ã€‚ $ES_HOME/data path.data logs æ—¥å¿—æ–‡ä»¶ $ES_HOME/logs path.logs plugins æ’ä»¶æ–‡ä»¶çš„ä½ç½®ã€‚æ¯ä¸ªæ’ä»¶éƒ½å°†åŒ…å«åœ¨ä¸€ä¸ªå­ç›®å½•ä¸­ã€‚ $ES_HOME/plugins scripts è„šæœ¬æ–‡ä»¶ $ES_HOME/scripts path.scripts 3ã€å¯åŠ¨Elasticsearch 12$ ./bin/elasticsearch // å‰å°è¿è¡Œ,æ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdout)$ ./bin/elasticsearch -d -p pid //åå°è¿è¡Œï¼Œä½œä¸ºå®ˆæŠ¤ç¨‹åºè¿è¡Œã€‚ 4ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ 12345678910111213141516$ curl localhost:9200 { \"name\" : \"Guwcwiz\", \"cluster_name\" : \"elasticsearch\", \"cluster_uuid\" : \"nlJI4RBQT56y2AViWjNm4A\", \"version\" : { \"number\" : \"6.2.4\", \"build_hash\" : \"ccec39f\", \"build_date\" : \"2018-04-12T20:37:28.497551Z\", \"build_snapshot\" : false, \"lucene_version\" : \"7.2.1\", \"minimum_wire_compatibility_version\" : \"5.6.0\", \"minimum_index_compatibility_version\" : \"5.0.0\" }, \"tagline\" : \"You Know, for Search\" } é—®é¢˜å¯åŠ¨è¿‡ç¨‹å¯èƒ½é‡åˆ°çš„é—®é¢˜ 1ã€ç«¯å£è¢«å ç”¨ èŠ‚ç‚¹é—´äº¤äº’çš„TCpç«¯å£ï¼Œé»˜è®¤æ˜¯9300ã€‚ å¯¹å¤–æœåŠ¡HTTPç«¯å£ï¼Œé»˜è®¤æ˜¯9200ã€‚ 12[2018-06-05T11:40:36,756][WARN ][o.e.t.n.Netty4Transport ] [Guwcwiz] exception caught on transport layer [NettyTcpChannel{localAddress=/127.0.0.1:58590, remoteAddress=/127.0.0.1:9300}], closing connectionio.netty.handler.codec.DecoderException: java.io.StreamCorruptedException: invalid internal transport message format, got (48,54,54,50) è§£å†³ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ $ vim ./config/elasticsearch.yml 12http.port: 9200transport.tcp.port: 19300 2ã€é”å®šå†…å­˜å¤±è´¥ 12ERROR: bootstrap checks failedmemory locking requested for elasticsearch process but memory is not locked memory_lock_check Elasticsearch é…ç½®æ–‡ä»¶ä¸­elasticsearch.ymlå¯ç”¨äº†bootstrap.memory_lockè®¾ç½® ï¼Œä½†Elasticsearchæ— æ³•é”å®šå †ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœelasticsearch ç”¨æˆ·æ²¡æœ‰memlock unlimitedï¼‰ è§£å†³ï¼š æ–¹æ³•ä¸€ï¼šæ³¨é‡Šæ‰é…ç½®æ–‡ä»¶ä¸­ #bootstrap.memory_lock: true å¹¶ä½¿ç”¨å…¶å®ƒå‡ ç§æ–¹æ³•é…ç½®ç³»ç»Ÿç¦æ­¢äº¤æ¢ Disable swapping æ–¹æ³•äºŒï¼šç¼–è¾‘ /etc/security/limits.conf æ–‡ä»¶ä¸ºç‰¹å®šç”¨æˆ·æ°¸ä¹…è®¾ç½®ã€‚åœ¨limits.confæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1elasticsearch - memlock unlimited æ­¤æ›´æ”¹ä»…åœ¨elasticsearchç”¨æˆ·ä¸‹æ¬¡æ‰“å¼€æ–°ä¼šè¯æ—¶ç”Ÿæ•ˆã€‚ 3ã€ç”¨æˆ·æ‹¥æœ‰çš„å†…å­˜æƒé™å¤ªå° 12ERROR: [1] bootstrap checks failed[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] è§£å†³ï¼š ç¼–è¾‘ /etc/sysctl.confæ–‡ä»¶ åœ¨æ–‡ä»¶æœ«è¡Œæ·»åŠ  1vm.max_map_count = 262144 ç„¶ååœ¨shellä¸­æ‰§è¡Œ 1$ sysctl -p å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/zip-targz.html","link":"/2018/06/05/elasticsearch/elasticsearch(%E4%B8%80)%E5%AE%89%E8%A3%85/"},{"title":"Elasticsearchï¼ˆä¸‰ï¼‰èŠ‚ç‚¹","text":"Elasticsearch èŠ‚ç‚¹æ¯å¯åŠ¨ä¸€ä¸ªElasticsearchçš„å®ä¾‹ï¼Œå°±ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªnodeèŠ‚ç‚¹ï¼Œå¤šä¸ªèŠ‚ç‚¹çš„é›†åˆå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹é»˜è®¤éƒ½å¯ä»¥å¤„ç†HTTPå’ŒTransportä¸¤ç§é€šä¿¡ï¼Œtransporté€šä¿¡ç”¨äºèŠ‚ç‚¹é—´JavaTransportClientçš„é€šä¿¡ ; HTTPå±‚ä»…ç”±å¤–éƒ¨RESTå®¢æˆ·ç«¯ä½¿ç”¨ã€‚ é›†ç¾¤ä¸­çš„Nodeéƒ½èƒ½ç›¸äº’å‘ç°ï¼Œå¹¶ä¸”å¯ä»¥å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°é€‚å½“çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªNodeä¼šæœ‰ä»¥ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªä½œç”¨ï¼š æœ‰èµ„æ ¼è¢«é€‰ä¸¾çš„ä¸»èŠ‚ç‚¹ã€‚node.masterè®¾ç½®ä¸ºtrueï¼ˆé»˜è®¤ï¼‰çš„èŠ‚ç‚¹ï¼Œä½¿å…¶æœ‰èµ„æ ¼è¢«é€‰ä¸ºæ§åˆ¶é›†ç¾¤çš„ä¸»èŠ‚ç‚¹ã€‚ æ•°æ®èŠ‚ç‚¹ node.dataè®¾ç½®ä¸ºtrueï¼ˆé»˜è®¤ï¼‰çš„èŠ‚ç‚¹ã€‚æ•°æ®èŠ‚ç‚¹ä¿å­˜æ•°æ®å¹¶æ‰§è¡Œæ•°æ®ç›¸å…³çš„æ“ä½œï¼Œå¦‚CRUDï¼Œæœç´¢å’Œèšåˆã€‚ ingestèŠ‚ç‚¹ node.ingestè®¾ç½®ä¸ºtrueï¼ˆé»˜è®¤ï¼‰çš„èŠ‚ç‚¹ã€‚æ‘„å–èŠ‚ç‚¹èƒ½å¤Ÿå°†æ‘„å–ç®¡é“åº”ç”¨äºæ–‡æ¡£ï¼Œä»¥ä¾¿åœ¨ç¼–åˆ¶ç´¢å¼•ä¹‹å‰è½¬æ¢å’Œä¸°å¯Œæ–‡æ¡£ã€‚ç”±äºè´Ÿè½½è¾ƒé‡ï¼Œå› æ­¤ä½¿ç”¨ä¸“ç”¨æ‘„å–èŠ‚ç‚¹å¹¶å°†ä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹æ ‡è®°ä¸ºâ€œæ˜¯æœ‰æ„ä¹‰çš„â€ tribeèŠ‚ç‚¹ é€šè¿‡tribe.*è®¾ç½®é…ç½®çš„tribeèŠ‚ç‚¹ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åè°ƒèŠ‚ç‚¹ï¼Œå¯ä»¥è¿æ¥åˆ°å¤šä¸ªç¾¤é›†å¹¶åœ¨æ‰€æœ‰è¿æ¥çš„ç¾¤é›†ä¸­æ‰§è¡Œæœç´¢å’Œå…¶ä»–æ“ä½œã€‚ ä¸»èŠ‚ç‚¹ä¸»èŠ‚ç‚¹è´Ÿè´£è½»é‡çº§ç¾¤é›†èŒƒå›´çš„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œè·Ÿè¸ªå“ªäº›èŠ‚ç‚¹æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åŠå†³å®šå°†å“ªäº›ç¢ç‰‡åˆ†é…ç»™å“ªäº›èŠ‚ç‚¹ã€‚é›†ç¾¤æœ‰ä¸€ä¸ªç¨³å®šçš„ä¸»èŠ‚ç‚¹æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸€èˆ¬åœ¨è¾ƒå¤§çš„ç¾¤é›†ä¸­åˆ†é…ä¸“ç”¨ä¸»èŠ‚ç‚¹å’Œä¸“ç”¨æ•°æ®èŠ‚ç‚¹ã€‚ 1234node.masterï¼štrue node.dataï¼šfalse node.ingestï¼šfalse search.remote.connectï¼šfalse //ç¦ç”¨è·¨ç¾¤é›†æœç´¢ æ•°æ®èŠ‚ç‚¹æ•°æ®èŠ‚ç‚¹ä¿å­˜åŒ…å«æ‚¨ç¼–å…¥ç´¢å¼•çš„æ–‡æ¡£çš„åˆ†ç‰‡ã€‚æ•°æ®èŠ‚ç‚¹å¤„ç†ä¸æ•°æ®ç›¸å…³çš„æ“ä½œï¼Œå¦‚CRUDï¼Œæœç´¢å’Œèšåˆã€‚è¿™äº›æ“ä½œæ˜¯I / O-ï¼Œå†…å­˜å’ŒCPUå¯†é›†å‹çš„ã€‚ç›‘è§†è¿™äº›èµ„æºå¹¶åœ¨è¿‡è½½æ—¶æ·»åŠ æ›´å¤šæ•°æ®èŠ‚ç‚¹éå¸¸é‡è¦ã€‚ æ‹¥æœ‰ä¸“ç”¨æ•°æ®èŠ‚ç‚¹çš„ä¸»è¦å¥½å¤„æ˜¯åˆ†ç¦»ä¸»æ•°æ®è§’è‰²å’Œæ•°æ®è§’è‰² 1234node.masterï¼šfalse node.dataï¼štrue node.ingestï¼šfalse search.remote.connectï¼šfalse ingestèŠ‚ç‚¹ æ‘„å–èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ‘„å–å¤„ç†å™¨ç»„æˆçš„é¢„å¤„ç†æµæ°´çº¿ã€‚æ ¹æ®æ‘„å–å¤„ç†å™¨æ‰§è¡Œçš„æ“ä½œç±»å‹å’Œæ‰€éœ€èµ„æºï¼Œå…·æœ‰ä¸“ç”¨æ‘„å…¥èŠ‚ç‚¹å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå®ƒåªä¼šæ‰§è¡Œæ­¤ç‰¹å®šä»»åŠ¡ã€‚ 1234node.masterï¼šfalse node.dataï¼šfalse node.ingestï¼štrue search.remote.connectï¼šfalse åªåè°ƒèŠ‚ç‚¹ ä¸å…·å¤‡å¤„ç†ä¸»ä»»åŠ¡ï¼Œä¿å­˜æ•°æ®å’Œé¢„å¤„ç†æ–‡æ¡£çš„èƒ½åŠ›ï¼Œåªèƒ½å¤„ç†è¯·æ±‚ï¼Œå¤„ç†æœç´¢ç¼©å‡é˜¶æ®µä»¥åŠåˆ†å‘æ‰¹é‡ç´¢å¼•ã€‚æœ¬è´¨ä¸Šï¼Œåªåè°ƒèŠ‚ç‚¹å°±åƒæ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨ä¸€æ ·ã€‚ 1234node.masterï¼šfalse node.dataï¼šfalse node.ingestï¼šfalse search.remote.connectï¼šfalse æ³¨æ„ï¼šä»¥ä¸Šè®¾ç½®ä»…é€‚ç”¨äºæœªå®‰è£…X-Packçš„æƒ…å†µ å¦‚æœå®‰è£…äº†X-Packï¼Œåˆ™è¿˜æœ‰ä¸€ä¸ªé™„åŠ çš„èŠ‚ç‚¹ç±»å‹ï¼š æœºå™¨å­¦ä¹ èŠ‚ç‚¹ X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½æä¾›äº†æœºå™¨å­¦ä¹ èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥è¿è¡Œä½œä¸šå¹¶å¤„ç†æœºå™¨å­¦ä¹ APIè¯·æ±‚ã€‚å¦‚æœxpack.ml.enabledè®¾ç½®ä¸ºtrueå¹¶ä¸”node.mlè®¾ç½®ä¸ºfalseï¼Œåˆ™èŠ‚ç‚¹å¯ä»¥ä¸ºAPIè¯·æ±‚æä¾›æœåŠ¡ï¼Œä½†ä¸èƒ½è¿è¡Œä½œä¸šã€‚ æœºå™¨å­¦ä¹ èŠ‚ç‚¹xpack.ml.enabledå’Œnode.mlè®¾ç½®trueçš„èŠ‚ç‚¹ï¼Œè¿™æ˜¯X-Packæ—¶çš„é»˜è®¤é…ç½®ã€‚å¦‚æœæƒ³ä½¿ç”¨X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½ï¼Œåˆ™ç¾¤é›†ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæœºå™¨å­¦ä¹ èŠ‚ç‚¹ã€‚æœ‰å…³X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è€ƒå¼¹æ€§å †æ ˆä¸­çš„æœºå™¨å­¦ä¹ ã€‚ å¦‚æœå®‰è£…äº†X-Packï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹å…·æœ‰ä¸»èŠ‚ç‚¹èµ„æ ¼ï¼Œæ•°æ®ï¼Œæ‘„å–å’Œæœºå™¨å­¦ä¹ èŠ‚ç‚¹ã€‚ å®‰è£…äº†X-Packå„èŠ‚ç‚¹çš„é…ç½®åœ¨å®‰è£…X-Packæ—¶åˆ›å»ºä¸“ç”¨çš„ä¸»èŠ‚ç‚¹èŠ‚ç‚¹ï¼Œé…ç½®ï¼š12345node.masterï¼štrue node.dataï¼šfalse node.ingestï¼šfalse node.mlï¼šfalse xpack.ml.enabledï¼štrue åœ¨å®‰è£…X-Packæ—¶åˆ›å»ºä¸“ç”¨æ•°æ®èŠ‚ç‚¹ï¼Œé…ç½®ï¼š1234node.masterï¼šfalse node.dataï¼štrue node.ingestï¼šfalse node.mlï¼šfalse //ç¦ç”¨node.mlè§’è‰² å®‰è£…X-Packæ—¶åˆ›å»ºä¸“ç”¨ingestèŠ‚ç‚¹ï¼Œé…ç½®ï¼š12345node.masterï¼šfalse node.dataï¼šfalse node.ingestï¼štrue search.remote.connectï¼šfalse node.mlï¼šfalse å®‰è£…X-Packæ—¶åˆ›å»ºä¸“ç”¨åè°ƒèŠ‚ç‚¹ï¼Œé…ç½®ï¼š12345node.masterï¼šfalse node.dataï¼šfalse node.ingestï¼šfalse search.remote.connectï¼šfalse node.mlï¼šfalse å¦‚æœè¦åœ¨ç¾¤é›†ä¸­ä½¿ç”¨X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸Šå¯ç”¨æœºå™¨å­¦ä¹ ï¼ˆè®¾ç½®xpack.ml.enabledä¸ºtrueï¼‰ åˆ›å»ºä¸“ç”¨æœºå™¨å­¦ä¹ èŠ‚ç‚¹ï¼Œè®¾ç½®ï¼š123456node.masterï¼šfalse node.dataï¼šfalse node.ingestï¼šfalse search.remote.connectï¼šfalse node.mlï¼štrue xpack.ml.enabledï¼štrue å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html","link":"/2018/06/08/elasticsearch/elasticsearch(%E4%B8%89)%E8%8A%82%E7%82%B9/"},{"title":"Elasticsearchï¼ˆäºŒï¼‰é…ç½®","text":"Elasticsearchè®¾ç½®Elasticsearchæä¾›äº†å¾ˆå¥½çš„é»˜è®¤è®¾ç½®ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆå°‘çš„é…ç½®ã€‚ è™½ç„¶Elasticsearchåªéœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œä½†åœ¨æŠ•å…¥ç”Ÿäº§ä¹‹å‰éœ€è¦è€ƒè™‘ä»¥ä¸‹è®¾ç½®ã€‚ elasticsearch.yml é…ç½®1ã€path.data and path.logs å¦‚æœæ­£åœ¨ä½¿ç”¨.zipæˆ–.tar.gzå­˜æ¡£ï¼Œåˆ™dataå’Œlogs ç›®å½•åœ¨$ES_HOMEä¸‹ã€‚å¦‚æœè¿™äº›é‡è¦æ–‡ä»¶å¤¹ä¿ç•™åœ¨é»˜è®¤ä½ç½®ï¼Œé‚£ä¹ˆåœ¨å°†Elasticsearchå‡çº§åˆ°æ–°ç‰ˆæœ¬æ—¶ï¼Œè¿™äº›æ–‡ä»¶å¤¹æœ‰å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚ åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œå¦‚æœæƒ³è¦æ›´æ”¹æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š 12path.data: /var/data/elasticsearchpath.logs: /var/log/elasticsearch 2ã€ cluster.name æŸä¸ªèŠ‚ç‚¹åªæœ‰å’Œé›†ç¾¤ä¸‹çš„å…¶ä»–èŠ‚ç‚¹å…±äº«å®ƒçš„ cluster.name æ‰èƒ½åŠ å…¥ä¸€ä¸ªé›†ç¾¤ã€‚é»˜è®¤æ˜¯elasticsearch ï¼Œåº”å°†å…¶æ›´æ”¹ä¸ºæè¿°é›†ç¾¤ç”¨é€”çš„é€‚å½“åç§°ã€‚ 1cluster.name: logging-prod 3ã€ node.name é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå°†ä½¿ç”¨éšæœºç”Ÿæˆçš„UUIDçš„å‰ä¸ƒä¸ªå­—ç¬¦ä½œä¸ºèŠ‚ç‚¹IDã€‚è¯·æ³¨æ„ï¼ŒèŠ‚ç‚¹IDæ˜¯æŒä¹…çš„ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹é‡æ–°å¯åŠ¨æ—¶ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤é»˜è®¤èŠ‚ç‚¹åç§°ä¹Ÿä¸ä¼šæ›´æ”¹ã€‚ 1node.nameï¼šprod-data-2 4ã€network.host é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä»…ç»‘å®šåˆ°å›ç¯åœ°å€ - ä¾‹å¦‚127.0.0.1 å’Œ[::1]ã€‚è¿™è¶³ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå•ä¸ªå¼€å‘èŠ‚ç‚¹ã€‚ å®é™…ä¸Šï¼Œå¯ä»¥ä»$ES_HOME å•ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›¸åŒä½ç½®å¯åŠ¨å¤šä¸ªèŠ‚ç‚¹ã€‚è¿™å¯ä»¥ç”¨äºæµ‹è¯•Elasticsearchå½¢æˆç¾¤é›†çš„èƒ½åŠ›ï¼Œä½†å®ƒä¸æ˜¯æ¨èç”¨äºç”Ÿäº§çš„é…ç½®ã€‚ ä¸ºäº†ä¸å…¶ä»–æœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹è¿›è¡Œé€šä¿¡å¹¶å½¢æˆç¾¤é›†ï¼Œæ‚¨çš„èŠ‚ç‚¹å°†éœ€è¦ç»‘å®šåˆ°éå›é€åœ°å€ã€‚è™½ç„¶ç½‘ç»œè®¾ç½®å¾ˆå¤šï¼Œä½†é€šå¸¸æ‚¨éœ€è¦é…ç½®çš„æ˜¯ network.hostï¼š 1network.hostï¼š192.168.1.10 åªè¦å¯¹network.hostæä¾›è‡ªå®šä¹‰è®¾ç½®ï¼ŒElasticsearchå°±ä¼šå‡å®šæ‚¨æ­£åœ¨ä»å¼€å‘æ¨¡å¼è½¬ç§»åˆ°ç”Ÿäº§æ¨¡å¼ï¼Œå¹¶å°†å¤šä¸ªç³»ç»Ÿå¯åŠ¨æ£€æŸ¥ä»è­¦å‘Šå‡çº§åˆ°å¼‚å¸¸ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å¼€å‘æ¨¡å¼ä¸ç”Ÿäº§æ¨¡å¼ç¼–è¾‘ã€‚ 5ã€Discovery settings Elasticsearchä½¿ç”¨åä¸ºâ€œZen Discoveryâ€çš„è‡ªå®šä¹‰å‘ç°å®ç°è¿›è¡ŒèŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„ç¾¤é›†å’Œä¸»é€‰ä¸¾ã€‚åœ¨æŠ•å…¥ç”Ÿäº§ä¹‹å‰ï¼Œåº”è¯¥é…ç½®ä¸¤ä¸ªé‡è¦çš„å‘ç°è®¾ç½®ã€‚ discovery.zen.ping.unicast.hosts å¼€ç®±å³ç”¨ï¼Œæ²¡æœ‰ä»»ä½•ç½‘ç»œé…ç½®ï¼ŒElasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„ç¯å›åœ°å€ï¼Œå¹¶å°†æ‰«æç«¯å£9300åˆ°9305ä»¥å°è¯•è¿æ¥åˆ°è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ã€‚è¿™æä¾›äº†è‡ªåŠ¨é›†ç¾¤ä½“éªŒï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•é…ç½®ã€‚ å½“éœ€è¦ä¸å…¶ä»–æœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹ç»„æˆç¾¤é›†æ—¶ï¼Œæ‚¨å¿…é¡»æä¾›ç¾¤é›†ä¸­å…¶ä»–èŠ‚ç‚¹çš„ç§å­åˆ—è¡¨ï¼Œè¿™äº›èŠ‚ç‚¹å¯èƒ½æ˜¯æ´»çš„å¹¶ä¸”å¯è”ç³»çš„ã€‚è¿™å¯ä»¥æŒ‡å®šå¦‚ä¸‹ï¼š 1234discovery.zen.ping.unicast.hostsï¼š - 192.168.1.10:9300 - 192.168.1.11 - seeds.mydomain.com å¦‚æœæœªæŒ‡å®šç«¯å£ï¼Œå°†é»˜è®¤ä¸ºtransport.profiles.default.portå¹¶å›é€€åˆ° transport.tcp.portã€‚ å¦‚æœè¾“å…¥çš„æ˜¯ä¸»æœºåï¼Œè¢«è§£ææˆå¤šä¸ªåœ°å€ï¼Œå°†ä¼šå°è¯•è¿æ¥æ‰€æœ‰åœ°å€ã€‚ discovery.zen.ping.unicast.hosts ä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé…ç½®è¯¥discovery.zen.minimum_master_nodesè®¾ç½®è‡³å…³é‡è¦ï¼Œ ä»¥ä¾¿æ¯ä¸ªç¬¦åˆä¸»èŠ‚ç‚¹çš„èŠ‚ç‚¹éƒ½çŸ¥é“ä¸ºäº†å½¢æˆç¾¤é›†è€Œå¿…é¡»å¯è§çš„ä¸»èŠ‚ç‚¹çš„æœ€å°æ•°é‡ã€‚ å¦‚æœæ²¡æœ‰è¿™ç§è®¾ç½®ï¼Œé­å—ç½‘ç»œæ•…éšœçš„é›†ç¾¤å°±æœ‰å¯èƒ½å°†é›†ç¾¤åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„é›†ç¾¤ - è„‘è£‚ - è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚åœ¨ Avoiding split brain with minimum_master_nodesedit æä¾›äº†æ›´è¯¦ç»†çš„è§£é‡Š ã€‚ ä¸ºé¿å…åˆ†è£‚å¤§è„‘ï¼Œåº”å°†å€™é€‰èŠ‚ç‚¹çš„æ•°é‡è®¾ç½®ä¸ºï¼š 1ï¼ˆmaster_eligible_nodes / 2ï¼‰+ 1 å‡å¦‚æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œæœ€å°å€™é€‰ä¸»èŠ‚ç‚¹æ•°åº”è¯¥æ˜¯ï¼ˆ3/2)+1=2: 1discovery.zen.minimum_master_nodesï¼š2 jvm.options1ã€Heap size é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchè®¾ç½®JVMä½¿ç”¨çš„æœ€å°å’Œæœ€å¤§å †å†…å­˜ä¸º1 GBã€‚åœ¨è½¬ç§»åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œé…ç½®å †å¤§å°ä»¥ç¡®ä¿Elasticsearchæœ‰è¶³å¤Ÿçš„å¯ç”¨å †æ˜¯éå¸¸é‡è¦çš„ã€‚ Elasticsearchå°†é€šè¿‡ï¼ˆæœ€å°å †å¤§å°ï¼‰å’Œï¼ˆæœ€å¤§å †å¤§å°ï¼‰è®¾ç½®æ¥åˆ†é…jvm.optionsä¸­æŒ‡å®šçš„æ•´ä¸ªå † ã€‚Xms Xmx è¿™äº›è®¾ç½®çš„å€¼å–å†³äºæœåŠ¡å™¨ä¸Šå¯ç”¨çš„RAMæ•°é‡ã€‚å¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼š å°†æœ€å°å †å¤§å°ï¼ˆXmsï¼‰å’Œæœ€å¤§å †å¤§å°ï¼ˆXmxï¼‰è®¾ç½®ä¸ºç›¸ç­‰ . è®¾ç½®Xmxä¸ºä¸è¶…è¿‡ç‰©ç†RAMçš„50ï¼…ï¼Œä»¥ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç‰©ç†å†…å­˜ç•™ç»™å†…æ ¸æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚ Elasticsearchå¯ç”¨çš„å †è¶Šå¤šï¼Œå¯ç”¨äºç¼“å­˜çš„å†…å­˜å°±è¶Šå¤šã€‚ä½†è¯·æ³¨æ„ï¼Œå¤ªå¤šçš„å †å¯èƒ½ä¼šä½¿æ‚¨é•¿æ—¶é—´åƒåœ¾æ”¶é›†æš‚åœã€‚ ä¸è¦è®¾ç½®Xmxä¸ºJVMç”¨äºå‹ç¼©å¯¹è±¡æŒ‡é’ˆï¼ˆå‹ç¼©oopsï¼‰çš„ä¸´ç•Œå€¼ä»¥ä¸Š; ç¡®åˆ‡çš„ä¸´ç•Œå€¼æœ‰æ‰€ä¸åŒï¼Œä½†æ¥è¿‘32 GBã€‚å¯ä»¥é€šè¿‡åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ä¸€è¡Œæ¥éªŒè¯æ‚¨æ˜¯å¦å¤„äºé™åˆ¶ä¹‹ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1heap size [1.9gb], compressed ordinary object pointers [true] å°½é‡ä¿æŒä½äºåŸºäºé›¶çš„å‹ç¼©oopsçš„é˜ˆå€¼; å‡†ç¡®çš„æˆªæ­¢å€¼ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†å¤§å¤šæ•°ç³»ç»Ÿä¸Šçš„26 GBæ˜¯å®‰å…¨çš„ï¼Œä½†åœ¨æŸäº›ç³»ç»Ÿä¸Šå¯èƒ½é«˜è¾¾30 GBã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨JVMé€‰é¡¹å¯åŠ¨Elasticsearch -XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsModeå¹¶æŸ¥æ‰¾ä»¥ä¸‹è¡Œæ¥éªŒè¯æ‚¨æ˜¯å¦å¤„äºé™åˆ¶ä¹‹ä¸‹ï¼š 1heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops è€Œä¸æ˜¯ 1heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000 ç¤ºä¾‹ï¼šé€šè¿‡jvm.optionsæ–‡ä»¶è®¾ç½®å †å¤§å° 12-Xms2g -Xmx2g å°†æœ€å°å †å¤§å°è®¾ç½®ä¸º2gã€‚ å°†æœ€å¤§å †å¤§å°è®¾ç½®ä¸º2g ã€‚ 2ã€Heap dump path å½’æ¡£tarè§£å‹åŒ…é»˜è®¤æƒ…å†µä¸‹ä¸é…ç½®å †è½¬å‚¨è·¯å¾„ã€‚ JVMå°†é»˜è®¤è½¬å‚¨åˆ°Elasticsearchè¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚ å¦‚æœæƒ³é…ç½®ä¸€ä¸ªå †è½¬å‚¨è·¯å¾„ï¼Œåº”è¯¥ä¿®æ”¹ jvm.optionsä¸­æ¡ç›®#-XX:HeapDumpPath=/heap/dump/path åˆ é™¤æ³¨é‡Šæ ‡è®°#ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå®é™…çš„è·¯å¾„ã€‚ 3ã€GC logging é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå¯ç”¨GCæ—¥å¿—ã€‚jvm.optionsåœ¨Elasticsearchæ—¥å¿—ä¸­é»˜è®¤é…ç½® ä¸ºé»˜è®¤ä½ç½®ã€‚é»˜è®¤é…ç½®æ¯64 MBè½®æ¢ä¸€æ¬¡æ—¥å¿—ï¼Œæœ€å¤šå¯æ¶ˆè€—2 GBç£ç›˜ç©ºé—´ã€‚ ç³»ç»Ÿè®¾ç½®ç†æƒ³æƒ…å†µä¸‹ï¼ŒElasticsearchåº”è¯¥åœ¨æœåŠ¡å™¨ä¸Šç‹¬ç«‹è¿è¡Œå¹¶ä½¿ç”¨å¯ç”¨çš„æ‰€æœ‰èµ„æºã€‚ä¸ºæ­¤ï¼Œéœ€è¦é…ç½®æ“ä½œç³»ç»Ÿä»¥å…è®¸è¿è¡ŒElasticsearchçš„ç”¨æˆ·è®¿é—®æ¯”é»˜è®¤å…è®¸çš„èµ„æºæ›´å¤šçš„èµ„æºã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå‡å®šæ‚¨æ­£åœ¨å¼€å‘æ¨¡å¼ä¸‹å·¥ä½œã€‚å¦‚æœä»¥ä¸‹ä»»ä½•è®¾ç½®é…ç½®ä¸æ­£ç¡®ï¼Œä»å¯ä»¥å¯åŠ¨å¹¶è¿è¡ŒElasticsearchèŠ‚ç‚¹ã€‚ ä½†ä¼šå‘æ—¥å¿—æ–‡ä»¶å†™å…¥è­¦å‘Šã€‚ ä½†æ˜¯åªè¦é…ç½®å¥½ç½‘ç»œè®¾ç½®network.hostï¼ŒElasticsearchå°±ä¼šå‡å®šæ‚¨æ­£åœ¨è½¬å‘ç”Ÿäº§å¹¶å°†ä¸Šè¿°è­¦å‘Šå‡çº§ä¸ºå¼‚å¸¸ã€‚è¿™äº›å¼‚å¸¸å°†é˜»æ­¢ElasticsearchèŠ‚ç‚¹å¯åŠ¨ã€‚å¯ç¡®ä¿æ‚¨ä¸ä¼šç”±äºé…ç½®é”™è¯¯çš„æœåŠ¡å™¨è€Œä¸¢å¤±æ•°æ®ã€‚ 1ã€ç¦ç”¨äº¤æ¢åˆ†åŒº æœ‰ä¸‰ç§æ–¹æ³•ç¦ç”¨äº¤æ¢ã€‚é¦–é€‰é€‰é¡¹æ˜¯å®Œå…¨ç¦ç”¨äº¤æ¢ã€‚ å…¶å®ƒå¦‚æœ€å°åŒ–swappinessä¸å†…å­˜é”å®š ã€‚ å…·ä½“å‚è€ƒ ç¦ç”¨æ‰€æœ‰äº¤æ¢æ–‡ä»¶ åœ¨Linuxç³»ç»Ÿä¸Šï¼Œä¸´æ—¶ç¦ç”¨äº¤æ¢ï¼š 1sudo swapoff -a è¦æ°¸ä¹…ç¦ç”¨å®ƒï¼Œéœ€è¦ç¼–è¾‘è¯¥/etc/fstabæ–‡ä»¶å¹¶æ³¨é‡Šæ‰åŒ…å«swapçš„æ‰€æœ‰è¡Œã€‚ é…ç½®swappiness Linuxç³»ç»Ÿä¸Šå¯ç”¨çš„å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ç¡®ä¿sysctlå€¼ vm.swappinessè®¾ç½®ä¸º1ã€‚è¿™å‡å°‘äº†å†…æ ¸çš„äº¤æ¢è¶‹åŠ¿ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸åº”è¯¥å¯¼è‡´äº¤æ¢ï¼ŒåŒæ—¶ä»ç„¶å…è®¸æ•´ä¸ªç³»ç»Ÿåœ¨ç´§æ€¥æƒ…å†µä¸‹è¿›è¡Œäº¤æ¢ã€‚ å¯ç”¨bootstrap.memory_lock å¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨Linux / Unixç³»ç»Ÿä¸Šä½¿ç”¨mlockallæˆ– åœ¨Windows ä¸Š ä½¿ç”¨ VirtualLockï¼Œä»¥å°è¯•å°†è¿›ç¨‹åœ°å€ç©ºé—´é”å®šåˆ°RAMä¸­ï¼Œé˜²æ­¢ä»»ä½•Elasticsearchå†…å­˜è¢«æ¢å‡ºã€‚åœ¨config/elasticsearch.ymlæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1bootstrap.memory_lockï¼štrue 2ã€å¢åŠ æ–‡ä»¶æè¿°ç¬¦ Elasticsearchä½¿ç”¨äº†å¤§é‡çš„æ–‡ä»¶æè¿°ç¬¦æˆ–æ–‡ä»¶å¥æŸ„ã€‚å¦‚æœç”¨å®Œæ–‡ä»¶æè¿°ç¬¦å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ç¡®ä¿å°†è¿è¡ŒElasticsearchçš„ç”¨æˆ·çš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦æ•°é™åˆ¶å¢åŠ åˆ°65,536æˆ–æ›´é«˜ã€‚ åœ¨Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘ /etc/security/limits.conf æ–‡ä»¶ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®æ°¸ä¹…é™åˆ¶ã€‚è¦å°†elasticsearchç”¨æˆ·çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°è®¾ç½®ä¸º65,536ï¼Œåœ¨limits.confæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1elasticsearch - nofile 65536 æ­¤æ›´æ”¹ä»…åœ¨elasticsearchç”¨æˆ·ä¸‹æ¬¡æ‰“å¼€æ–°ä¼šè¯æ—¶ç”Ÿæ•ˆã€‚ è¯´æ˜ï¼šåœ¨Ubuntuä¸­å¯åŠ¨è¿›ç¨‹çš„æ–‡ä»¶init.d å¯èƒ½ä¼šå¿½ç•¥limits.conf ï¼Œè¦å¯ç”¨è¯¥limits.confæ–‡ä»¶ï¼Œå–æ¶ˆ/etc/pam.d/suä»¥ä¸‹æ³¨é‡Šè¡Œï¼š 1# session required pam_limits.so 3ã€å¢åŠ è™šæ‹Ÿå†…å­˜ Elasticsearch mmapfsé»˜è®¤ä½¿ç”¨ä¸€ä¸ªç›®å½•æ¥å­˜å‚¨å®ƒçš„ç´¢å¼•ã€‚mmapè®¡æ•°çš„é»˜è®¤æ“ä½œç³»ç»Ÿé™åˆ¶å¯èƒ½å¤ªä½ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ä¸è¶³å¼‚å¸¸ã€‚ åœ¨Linuxä¸Šï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä¸´æ—¶å¢åŠ é™åˆ¶ ï¼š 1sysctl -w vm.max_map_count = 262144 è¦æ°¸ä¹…è®¾ç½®ï¼Œç¼–è¾‘ /etc/sysctl.conf æ–‡ä»¶ã€‚æ·»åŠ ï¼š 1vm.max_map_count=262144 å¹¶æ‰§è¡Œå‘½ä»¤ï¼š sysctl -p 4ã€å¢åŠ å¯åˆ›å»ºçº¿ç¨‹æ•°é‡ Elasticsearché’ˆå¯¹ä¸åŒç±»å‹çš„æ“ä½œä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ± ã€‚èƒ½å¤Ÿåœ¨éœ€è¦æ—¶åˆ›å»ºæ–°çº¿ç¨‹å¾ˆé‡è¦ã€‚ç¡®ä¿Elasticsearchç”¨æˆ·å¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°è‡³å°‘ä¸º4096ã€‚ å¯ä»¥é€šè¿‡ç¼–è¾‘ /etc/security/limits.conf æ–‡ä»¶ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®æ°¸ä¹…é™åˆ¶ã€‚è¦å°†elasticsearchç”¨æˆ·çš„æœ€å¤§åˆ›å»ºçº¿ç¨‹æ•°é‡è®¾ç½®ä¸º4096ï¼Œåœ¨limits.confæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1elastic - nproc 4096 5ã€JVM DNSç¼“å­˜è®¾ç½® DNS cache settings å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/zip-targz.html https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html","link":"/2018/06/06/elasticsearch/elasticsearch(%E4%BA%8C)%E9%85%8D%E7%BD%AE/"},{"title":"Elasticsearchï¼ˆäº”ï¼‰API","text":"Elasticsearch APIElasticsearchæ˜¯åŸºäºHTTPåè®®ï¼Œä»¥JSONä¸ºæ•°æ®äº¤äº’æ ¼å¼çš„RESTful APIå¯ä»¥é€šè¿‡WEBå®¢æˆ·ç«¯æˆ–curlå‘½ä»¤ä¸Elasticsearché€šä¿¡ã€‚ å‘Elasticsearchå‘å‡ºçš„è¯·æ±‚çš„ç»„æˆéƒ¨åˆ† 1curl -X&lt;VERB&gt; '&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;' -d '&lt;BODY&gt;' VERB HTTPæ–¹æ³•ï¼šGET, POST, PUT, HEAD, DELETEPROTOCOL httpæˆ–è€…httpsåè®®ï¼ˆåªæœ‰åœ¨Elasticsearchå‰é¢æœ‰httpsä»£ç†çš„æ—¶å€™å¯ç”¨ï¼‰HOST Elasticsearché›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸»æœºåï¼Œå¦‚æœæ˜¯åœ¨æœ¬åœ°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±å«localhostPORT Elasticsearch HTTPæœåŠ¡æ‰€åœ¨çš„ç«¯å£ï¼Œé»˜è®¤ä¸º9200PATH APIè·¯å¾„ï¼ˆä¾‹å¦‚_countå°†è¿”å›é›†ç¾¤ä¸­æ–‡æ¡£çš„æ•°é‡ï¼‰ï¼ŒPATHå¯ä»¥åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä¾‹å¦‚_cluster/statsæˆ–è€…_nodes/stats/jvmQUERY_STRING ä¸€äº›å¯é€‰çš„æŸ¥è¯¢è¯·æ±‚å‚æ•°ï¼Œä¾‹å¦‚?prettyå‚æ•°å°†ä½¿è¯·æ±‚è¿”å›æ›´åŠ ç¾è§‚æ˜“è¯»çš„JSONæ•°æ®BODY ä¸€ä¸ªJSONæ ¼å¼çš„è¯·æ±‚ä¸»ä½“ï¼ˆå¦‚æœè¯·æ±‚éœ€è¦çš„è¯ï¼‰ æŸ¥è¯¢é›†ç¾¤ä¸­çš„æ–‡æ¡£æ•°é‡ 12345678910111213141516171819$ curl -i -H \"Content-Type: application/json\" -XGET '47.98.128.106:19200/_count?pretty' -d '{ \"query\": { \"match_all\": {} }}'HTTP/1.1 200 OKcontent-type: application/json; charset=UTF-8content-length: 114{ \"count\" : 0, \"_shards\" : { \"total\" : 0, \"successful\" : 0, \"skipped\" : 0, \"failed\" : 0 }} Elasticsearchä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ çš„ç±»æ¯” 12Relational DB -&gt; Databases -&gt; Tables -&gt; Rows -&gt; ColumnsElasticsearch -&gt; Indices -&gt; Types -&gt; Documents -&gt; Fields Elasticsearché›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼•(indices)ï¼ˆæ•°æ®åº“ï¼‰ï¼Œæ¯ä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹(types)ï¼ˆè¡¨ï¼‰ï¼Œæ¯ä¸€ä¸ªç±»å‹åŒ…å«å¤šä¸ªæ–‡æ¡£(documents)ï¼ˆè¡Œï¼‰ï¼Œç„¶åæ¯ä¸ªæ–‡æ¡£åŒ…å«å¤šä¸ªå­—æ®µ(Fields)ï¼ˆåˆ—ï¼‰ã€‚ ç®€å•æœç´¢ 123GET /megacorp/employee/1GET /megacorp/employee/_searchGET /megacorp/employee/_search?q=last_name:Smith DSLè¯­å¥æŸ¥è¯¢ æœç´¢last_nameåŒ…å«Smithçš„ 12345678GET /megacorp/employee/_search { &quot;query&quot; : { &quot;match&quot; : { &quot;last_name&quot; : &quot;Smith&quot; } } } filter: æœç´¢å¹´é¾„å¤§äº30å²å¹¶ä¸”last_nameåŒ…å«Smithçš„ 1234567891011121314151617GET /megacorp/employee/_search { &quot;query&quot; : { &quot;filtered&quot; : { &quot;filter&quot; : { &quot;range&quot; : { &quot;age&quot; : { &quot;gt&quot; : 30 } &lt;1&gt; } }, &quot;query&quot; : { &quot;match&quot; : { &quot;last_name&quot; : &quot;smith&quot; &lt;2&gt; } } } } } å…¨æ–‡æœç´¢(match)ï¼šæœç´¢aboutåŒ…å«rock climbingçš„ï¼Œç»“æœä¼šæŠŠåŒ…å«rock æˆ–climbingçš„æŸ¥å‡ºæ¥ 12345678 GET /megacorp/employee/_search{ &quot;query&quot; : { &quot;match&quot; : { &quot;about&quot; : &quot;rock climbing&quot; } }} çŸ­è¯­æœç´¢(match_phrase)ï¼šæŸ¥è¯¢åŒæ—¶åŒ…å«â€rockâ€å’Œâ€climbingâ€ï¼ˆå¹¶ä¸”æ˜¯ç›¸é‚»çš„ï¼‰çš„è®°å½• 12345678 GET /megacorp/employee/_search{ &quot;query&quot; : { &quot;match_phrase&quot; : { &quot;about&quot; : &quot;rock climbing&quot; } }} é«˜äº®æˆ‘ä»¬çš„æœç´¢(highlight): 12345678910111213 GET /megacorp/employee/_search{ &quot;query&quot; : { &quot;match_phrase&quot; : { &quot;about&quot; : &quot;rock climbing&quot; } }, &quot;highlight&quot;: { &quot;fields&quot; : { &quot;about&quot; : {} } }}å­—æ®µå­˜åœ¨æŸ¥è¯¢ 123456GET /_search{ \"query\": { \"exists\" : { \"field\" : \"user\" } }} å­—æ®µä¸å­˜åœ¨æŸ¥è¯¢ 123456789101112GET /_search{ \"query\": { \"bool\": { \"must_not\": { \"exists\": { \"field\": \"user\" } } } }} å­¦ä¹ å¯å‚è€ƒï¼šhttps://es.xiaoleilu.com/index.html","link":"/2018/06/08/elasticsearch/elasticsearch(%E4%BA%94)API/"},{"title":"Elasticsearchï¼ˆå››ï¼‰æ’ä»¶","text":"Elasticsearch HeadElasticsearch Head æ˜¯é›†ç¾¤ç®¡ç†ã€æ•°æ®å¯è§†åŒ–ã€å¢åˆ æ”¹æŸ¥ã€æŸ¥è¯¢è¯­å¥å¯è§†åŒ–å·¥å…· ã€‚ è‡ª5.0ä»¥åï¼Œheadæ’ä»¶å®‰è£…å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå¯ä»¥å®‰è£…è°·æ­Œæ’ä»¶çš„elasticsearch-head-chrome å‚è€ƒ æœ‰dockerç¯å¢ƒçš„å¯ä½¿ç”¨dockerå¯åŠ¨ï¼š docker run -p 9100:9100 mobz/elasticsearch-head:5 å…¶å®elasticsearch6.*çš„ç‰ˆæœ¬æ˜¯ä¸éœ€è¦å®‰è£…headæ’ä»¶çš„ï¼Œkibana+x-packå°±å¯ä»¥äº†ã€‚ elasticsearch-analysis-ansj elasticsearch-analysis-ansjæ˜¯ä¸€ä¸ªelasticsearchçš„ä¸­æ–‡åˆ†è¯æ’ä»¶ã€‚ ansj_segè‡ªå®šä¹‰è¯åº“ï¼šhttp://yucang52555.iteye.com/blog/2164829 å®‰è£… è¿›å…¥Elasticsearchç›®å½•æ‰§è¡Œå‘½ä»¤ 1$ ./bin/elasticsearch-plugin install https://github.com/NLPchina/elasticsearch-analysis-ansj/releases/download/v6.2.4/elasticsearch-analysis-ansj-6.2.4.0-release.zip Elasticsearchè®¾ç½®ansjé»˜è®¤åˆ†è¯ å»ºè®®ä¸è¦å…¨å±€è®¾ç½®ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶å»è®¾ç½®ã€‚ Elasticsearch6.Xä¸èƒ½ç›´æ¥ä¿®æ”¹elasticsearch.yml issues Elasticsearch6ä¸æ”¯æŒåŠ¨æ€è®¾ç½®ï¼Œindeciså¤„äºå¼€å¯çŠ¶æ€ï¼Œéœ€è¦å…ˆå…³é—­ï¼Œåœ¨è¿›è¡Œè®¾ç½®ï¼Œè®¾ç½®å®Œæˆååœ¨æ‰“å¼€ã€‚å‚è€ƒ 1$ curl -u user:passwd -XPOST 'localhost:9200/_all/_close' 1234$ curl -u user:passwd -H \"Content-Type: application/json\" -XPUT 'localhost:9200/_all/_settings?preserve_existing=true' -d '{ \"index.analysis.analyzer.default.type\" : \"index_ansj\", \"index.analysis.analyzer.default_search.type\" : \"query_ansj\"}' 1$ curl -u user:passwd -XPOST 'localhost:9200/_all/_open' æŸ¥çœ‹ 123456789101112131415161718192021222324$ GET /test ... &quot;settings&quot;: { &quot;index&quot;: { &quot;number_of_shards&quot;: &quot;5&quot;, &quot;provided_name&quot;: &quot;test&quot;, &quot;creation_date&quot;: &quot;1529580829374&quot;, &quot;analysis&quot;: { &quot;analyzer&quot;: { &quot;default_search&quot;: { &quot;type&quot;: &quot;query_ansj&quot; }, &quot;default&quot;: { &quot;type&quot;: &quot;index_ansj&quot; } } }, &quot;number_of_replicas&quot;: &quot;1&quot;, &quot;uuid&quot;: &quot;EZPQ7kWjSee13sqR0P84BA&quot;, &quot;version&quot;: { &quot;created&quot;: &quot;6020499&quot; } } }","link":"/2018/06/06/elasticsearch/elasticsearch(%E5%9B%9B)%E6%8F%92%E4%BB%B6/"},{"title":"elasticsearchåˆ†é¡µ","text":"elasticsearchåˆ†é¡µ æ·±åº¦åˆ†é¡µï¼ˆfrom/sizeï¼‰ å¦‚æœè¦æŸ¥è¯¢ç¬¬5000-5100æ•°æ®ï¼Œæ ¹æ®å®˜æ–¹API å¾ˆå®¹æ˜“åšåˆ° 1234567GET /_search{ &quot;from&quot; : 5000, &quot;size&quot; : 5100, &quot;query&quot; : { &quot;term&quot; : { &quot;user&quot; : &quot;kimchy&quot; } }} æŸ¥è¯¢çš„æµç¨‹å¦‚ä¸‹ï¼š 1ã€å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æŸä¸ªnodeèŠ‚ç‚¹ã€‚ 2ã€æ­¤nodeå°†è¯·æ±‚å¹¿æ’­åˆ°å„åˆ†ç‰‡ï¼Œå„åˆ†ç‰‡å„è‡ªæŸ¥è¯¢å‰5100æ¡æ•°æ®ã€‚ 3ã€æŸ¥è¯¢ç»“æœè¿”å›ç»™nodeèŠ‚ç‚¹ï¼Œnodeå¯¹ç»“æœè¿›è¡Œåˆå¹¶æ•´åˆï¼Œå–å‡ºå‰5100æ¡æ•°æ®ã€‚ 4ã€è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ æ·±åº¦åˆ†é¡µæŸ¥è¯¢çš„é—®é¢˜ ï¼Œå¦‚æœä½ è¦æ·±åº¦è·å–1000000åˆ°1000100é¡µçš„æ•°æ®ï¼Œæ€§èƒ½é—®é¢˜ä¼šéå¸¸æ˜æ˜¾çš„æš´éœ²å‡ºæ¥ï¼šCPUã€å†…å­˜ã€IOã€ç½‘ç»œå¸¦å®½ç­‰ç­‰ï¼Œè€Œä¸”Elasticsearchæœ¬èº«å°±æ˜¯ä¸ªJavaåº”ç”¨ï¼Œè‹¥å¹¶å‘ä¸Šå»ï¼ŒElasticsearchä¼šå¿«å°±ä¼šOOMã€‚ å®˜æ–¹ä¹Ÿå¯¹æ­¤è¿›è¡Œäº†é™åˆ¶ Note that from + size can not be more than the index.max_result_window index setting which defaults to 10,000. See the Scroll or Search After API for more efficient ways to do deep scrolling. å¤§æ„ä¸ºï¼Œfrom+sizeä¸å†é€‚ç”¨äºæŸ¥è¯¢æ•°æ®è¶…è¿‡index.max_result_windowè®¾ç½®å€¼ï¼Œæ­¤é»˜è®¤å€¼ä¸º10000 ã€‚æŸ¥çœ‹ Scroll æˆ– Search Afteræ¥è·å–æ›´é«˜æ•ˆçš„æ·±å±‚åˆ†é¡µï¼ˆæ»šåŠ¨ï¼‰ã€‚ scroll API å®ƒå¯ç”¨äºä»å•ä¸ªæœç´¢è¯·æ±‚ä¸­æ£€ç´¢å¤§é‡æ•°æ®ï¼ˆç”šè‡³æ‰€æœ‰æ•°æ®ï¼‰ï¼Œè¿™ä¸åœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸Šcursors (æ¸¸æ ‡)çš„æ–¹å¼éå¸¸ç›¸ä¼¼ã€‚ scrollä¸æ˜¯é’ˆå¯¹å®æ—¶ç”¨æˆ·è¯·æ±‚ï¼Œè€Œæ˜¯é’ˆå¯¹å¤„ç†å¤§é‡æ•°æ® ã€‚ Scrollæ•´ä¸ªéå†è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š 1ã€åˆå§‹åŒ– 123456789POST /index/type/_search?scroll=1m{ &quot;size&quot;: 100, &quot;query&quot;: { &quot;match&quot; : { &quot;title&quot; : &quot;elasticsearch&quot; } }} è¯´æ˜ï¼š(1) ä¸æ™®é€šæŸ¥è¯¢ä¸€æ ·ï¼Œå¯ä»¥æŒ‡å®šindexã€typeã€æŸ¥è¯¢æ¡ä»¶ç­‰ã€‚ â€‹ (2) scrollå‚æ•°ï¼šåˆå§‹åŒ–è¯·æ±‚å¿…é¡»æŒ‡å®šScrollå‚æ•°ï¼Œæ­¤å‚æ•°å‘Šè¯‰Elasticsearch ä»–è¦ä¿å­˜æ­¤æ¬¡æœç´¢çš„ä¸Šä¸‹æ–‡å¤šé•¿æ—¶é—´ã€‚ 2ã€éå† 12345POST /_search/scroll { &quot;scroll&quot; : &quot;1m&quot;, &quot;scroll_id&quot; : &quot;DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ==&quot; } è¯´æ˜ï¼š(1) scroll: æŒ‡å®šä¸Šä¸‹æ–‡æœç´¢çš„ä¿æŒæ—¶é—´ï¼Œè¶…æ—¶scroll_idå°±è¿‡æœŸä¸èƒ½å†ä½¿ç”¨ã€‚ä½†æ˜¯è®¾ç½®æ—¶é—´ä¸å¯è¿‡é•¿ï¼Œåªè¦èƒ½è®©å…¶ä¿æŒåˆ°ä¸‹ä¸€æ¬¡éå†ï¼ˆä¸¤æ¬¡éå†æ—¶é—´ï¼‰å®Œæˆå³å¯ã€‚ (2) scroll_id: åˆå§‹åŒ–æˆ–ä¸Šæ¬¡éå†çš„è¿”å›çš„scroll_idã€‚ (3) indexã€typeã€æœç´¢æ¡ä»¶ä¸ç”¨æŒ‡å®šã€‚ è¿™äº›æ˜¯åœ¨åŸå§‹searchè¯·æ±‚ä¸­æŒ‡å®šçš„ã€‚ (4) é»˜è®¤æ¯æ¬¡å–10æ¡ã€‚è‹¥éœ€è¦ä¿®æ”¹ï¼Œæ·»åŠ sizeå‚æ•°ï¼Œsizeçš„è®¾ç½®ä¹Ÿè¦è€ƒè™‘æ€§èƒ½é—®é¢˜ï¼Œè¿‡å¤§ä¸€æ¬¡å–æ•°æ®è¿‡å¤šä¸æ˜¯è‡ªå·±åº”ç”¨OOMå°±æ˜¯esæœåŠ¡OOMã€‚ (5) é‡å¤æ­¤è¯·æ±‚ç›´åˆ°è¿”å›æ•°æ®ä¸ºç©ºï¼Œéå†ç»“æŸã€‚ java-rest-high-search-scroll Search After API scroll api ä¸å»ºè®®ç”¨äºå®æ—¶ç”¨æˆ·è¯·æ±‚ ï¼Œå®¹å¿æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ search_afterå‚æ•°é€šè¿‡æä¾›å®æ—¶æ¸¸æ ‡æ¥è§£å†³æ­¤é—®é¢˜ã€‚åŸç†æ˜¯ä½¿ç”¨ä¸Šä¸€é¡µçš„ç»“æœæ¥å¸®åŠ©æ£€ç´¢ä¸‹ä¸€é¡µ ã€‚ search_afterä¸æ˜¯è‡ªç”±è·³è½¬åˆ°éšæœºé¡µé¢è€Œæ˜¯å¹¶è¡Œæ»šåŠ¨è®¸å¤šæŸ¥è¯¢çš„è§£å†³æ–¹æ¡ˆ ã€‚ ä¾‹å¦‚æ£€ç´¢ç¬¬ä¸€é¡µå¦‚ä¸‹ 12345678910111213GET twitter/_search{ &quot;size&quot;: 10, &quot;query&quot;: { &quot;match&quot; : { &quot;title&quot; : &quot;elasticsearch&quot; } }, &quot;sort&quot;: [ {&quot;date&quot;: &quot;asc&quot;}, {&quot;_id&quot;: &quot;desc&quot;} ]} ä¸Šè¿°è¯·æ±‚çš„ç»“æœæ•°ç»„ä¸­æ¯ä¸ªæ–‡æ¡£ä¼šåŒ…æ‹¬sort valuesã€‚è¿™äº›sort valueså¯ä»¥ä¸ä¸‹é¢è¯·æ±‚çš„search_afterå‚æ•°ä¸€èµ·ä½¿ç”¨ ï¼Œå¯ä»¥åœ¨ç»“æœåˆ—è¡¨ä¸­çš„ä»»ä½•æ–‡æ¡£â€œä¹‹åâ€å¼€å§‹è¿”å›ç»“æœ ã€‚ è¯·æ±‚ä¸‹ä¸€é¡µ 1234567891011121314GET twitter/_search{ &quot;size&quot;: 10, &quot;query&quot;: { &quot;match&quot; : { &quot;title&quot; : &quot;elasticsearch&quot; } }, &quot;search_after&quot;: [1463538857, &quot;654323&quot;], &quot;sort&quot;: [ {&quot;date&quot;: &quot;asc&quot;}, {&quot;_id&quot;: &quot;desc&quot;} ]} è¯´æ˜ï¼šä½¿ç”¨æ—¶ï¼Œfromå‚æ•°å¿…é¡»è®¾ç½®ä¸º0ï¼ˆæˆ–-1ï¼‰ ã€‚ å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-from-size.html https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-search-after.html https://www.sohu.com/a/165387407_465944","link":"/2018/07/16/elasticsearch/elasticsearch%E5%88%86%E9%A1%B5/"},{"title":"Elasticsearchä¸mongodbåŒæ­¥","text":"Elasticsearchä¸mongodbåŒæ­¥ åˆ©ç”¨mongo-connectormongodbå®˜æ–¹ä»‹ç» github å®‰è£…æ ¹æ®å…·ä½“Elasticsearchç‰ˆæœ¬ï¼Œåˆ©ç”¨pipå®‰è£…æœ€æ–°ç‰ˆæœ¬mongo-connector 123$ pip install 'mongo-connector[elastic5]'$ mongo-connector --version mongo-connector version: 2.5.1 å¦‚æœæç¤ºpipæ²¡è£…ï¼Œåˆ™å…ˆå®‰è£…pip 1$ sudo apt-get install python-pip mongodbå¼€å¯å‰¯æœ¬é›†ï¼ˆå¿…é¡»å¼€å¯ï¼‰ï¼Œå·²å¼€å¯åˆ™å¿½ç•¥æ­¤æ­¥ã€‚deploy-replica-set (1) åœæ­¢mongodbæœåŠ¡ 1$ service mongodb stop (2) é€šè¿‡ --replSet è®¾å®šå‰¯æœ¬é›†åç§° 1$ mongod --replSet myDevReplSet æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ mongodb.conf ä¸­æ·»åŠ  12#å‰¯æœ¬é›†åç§°replSet=myDevReplSet è¯´æ˜ï¼š myDevReplSetæ˜¯å‰¯æœ¬é›†çš„åç§° (3) åˆå§‹åŒ–å‰¯æœ¬é›† 123456&gt; rs.initiate(){ \"info2\" : \"no configuration specified. Using a default configuration for the set\", \"me\" : \"ubuntu:27017\", \"ok\" : 1} (4) ã€éªŒè¯ã€‘åˆå§‹åŒ–å‰¯æœ¬é›†çš„é…ç½® 123456789101112131415161718192021222324252627282930313233343536myDevReplSet:OTHER&gt; rs.conf(){ &quot;_id&quot; : &quot;myDevReplSet&quot;, &quot;version&quot; : 1, &quot;protocolVersion&quot; : NumberLong(1), &quot;members&quot; : [ { &quot;_id&quot; : 0, &quot;host&quot; : &quot;ubuntu:27017&quot;, &quot;arbiterOnly&quot; : false, &quot;buildIndexes&quot; : true, &quot;hidden&quot; : false, &quot;priority&quot; : 1, &quot;tags&quot; : { }, &quot;slaveDelay&quot; : NumberLong(0), &quot;votes&quot; : 1 } ], &quot;settings&quot; : { &quot;chainingAllowed&quot; : true, &quot;heartbeatIntervalMillis&quot; : 2000, &quot;heartbeatTimeoutSecs&quot; : 10, &quot;electionTimeoutMillis&quot; : 10000, &quot;catchUpTimeoutMillis&quot; : 2000, &quot;getLastErrorModes&quot; : { }, &quot;getLastErrorDefaults&quot; : { &quot;w&quot; : 1, &quot;wtimeout&quot; : 0 }, &quot;replicaSetId&quot; : ObjectId(&quot;5b35a8568dccf16c7734a30b&quot;) }} (5)ã€éªŒè¯ã€‘å‰¯æœ¬é›†çš„çŠ¶æ€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142myDevReplSet:PRIMARY&gt; rs.status(){ \"set\" : \"myDevReplSet\", \"date\" : ISODate(\"2018-06-29T03:34:53.131Z\"), \"myState\" : 1, \"term\" : NumberLong(1), \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"durableOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) } }, \"members\" : [ { \"_id\" : 0, \"name\" : \"ubuntu:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 282, \"optime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2018-06-29T03:34:49Z\"), \"electionTime\" : Timestamp(1530243158, 2), \"electionDate\" : ISODate(\"2018-06-29T03:32:38Z\"), \"configVersion\" : 1, \"self\" : true } ], \"ok\" : 1} æ•°æ®åŒæ­¥ å®˜æ–¹æ–‡æ¡£å‘½ä»¤æ ¼å¼ 123mongo-connector -m &lt;mongodb server hostname&gt;:&lt;replica set port&gt; \\ -t &lt;replication endpoint URL, e.g. http://localhost:8983/solr&gt; \\ -d &lt;name of doc manager, e.g., solr_doc_manager&gt; æ‰§è¡Œå‘½ä»¤ 1$ mongo-connector -m username:passwd@localhost:27017 -t username:passwd@localhost:9200 -d elastic2_doc_manager -n testDB.testCol è¯´æ˜ï¼š -m æŒ‡å®šmongodbçš„åœ°å€ä¸ç«¯å£ ã€‚ â€‹ -t ESçš„åœ°å€ä¸ç«¯å£ ã€‚ â€‹ -d doc managerçš„åç§°ï¼Œ2.xç‰ˆæœ¬ä¸ºï¼š elastic2-doc-managerã€‚ â€‹ -n æŒ‡å®šè¦åŒæ­¥çš„æ•°æ®åº“å’Œé›†åˆåã€‚ æ•°æ®åŒæ­¥å‰åº”å…ˆå»ºç«‹ç´¢å¼•ï¼Œå†è¿›è¡Œæ•°æ®åŒæ­¥ éªŒè¯æµ‹è¯• mongodbä¸­æ‰§è¡Œæ•°æ®æ’å…¥ 12345$ myDevReplSet:PRIMARY&gt; use test; # testå¯¹åº”ESçš„Indexswitched to db test# æ’å…¥æ•°æ® blogå¯¹åº”ESçš„type$ myDevReplSet:PRIMARY&gt; db.blog.insert({\"title\":\"æ ‡é¢˜ä¸€\",\"time\":\"2018-06-29\",\"content\":\"æµ‹è¯•MongoDBä¸ElasticSearchæ•°æ®åŒæ­¥\"});WriteResult({ \"nInserted\" : 1 }) ElasticSearchä¸­æ£€ç´¢æ•°æ® 12345678910111213141516171819202122232425262728&gt; GET /test/blog/_search{ \"took\": 0, \"timed_out\": false, \"_shards\": { \"total\": 5, \"successful\": 5, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": 1, \"max_score\": 1, \"hits\": [ { \"_index\": \"test\", \"_type\": \"blog\", \"_id\": \"5b35dafcad35569566d32bc7\", \"_score\": 1, \"_source\": { \"content\": \"æµ‹è¯•MongoDBä¸ElasticSearchæ•°æ®åŒæ­¥\", \"title\": \"æ ‡é¢˜ä¸€\", \"time\": \"2018-06-29\" } } ] }} mongo-connectorå·¥å…·æ”¯æŒMongoDBä¸ESä¹‹é—´çš„å®æ—¶å¢insertã€åˆ deleteã€æ”¹updateæ“ä½œã€‚ ä½†å¯¹äºå†å²æ•°æ® ä¸èƒ½ä¿å­˜åˆ°ESä¸­ MongoDB Riverçš„æ’ä»¶MongoDB River ç‰ˆæœ¬è¾ƒæ—§ä¸å»ºè®®ä½¿ç”¨ã€‚ å…¶å®ƒæ–¹æ¡ˆï¼šæš‚æœªæ·±ç©¶ https://elasticsearch.cn/question/1167 é€šè¿‡Bulk API å‚è€ƒï¼šhttps://blog.csdn.net/u011801161/article/details/71726495","link":"/2018/06/29/elasticsearch/Elasticsearch%E4%B8%8Emongodb%E5%90%8C%E6%AD%A5/"},{"title":"Kibanaå®‰è£…","text":"Kibanaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œæ—¨åœ¨ä¸Elasticsearchåˆä½œã€‚å¯ä»¥ä½¿ç”¨Kibanaæ¥æœç´¢ï¼ŒæŸ¥çœ‹å­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®å¹¶ä¸å…¶è¿›è¡Œäº¤äº’ã€‚å¯ä»¥æ‰§è¡Œé«˜çº§æ•°æ®åˆ†æï¼Œå¹¶åœ¨å„ç§å›¾è¡¨ï¼Œè¡¨æ ¼å’Œå›¾è¡¨ä¸­å¯è§†åŒ–æ•°æ®ã€‚ å®‰è£…1ã€ä¸‹è½½å¹¶å®‰è£… 123456$ wget https://artifacts.elastic.co/downloads/kibana/kibana-6.2.4-linux-x86_64.tar.gz$ tar -xzf kibana-6.2.4-linux-x86_64.tar.gz$ cd kibana-6.2.4-linux-x86_64/$ lsbin data node NOTICE.txt package.json README.txt ui_frameworkconfig LICENSE.txt node_modules optimize plugins src webpackShims ç±»å‹ æè¿° é»˜è®¤ä½ç½® homeç›®å½• Kibana ä¸»ç›®å½•æˆ– $KIBANA_HOME è§£å‹åæ‰€åˆ›å»ºçš„ç›®å½• ï¼ˆkibana-6.2.4-linux-x86_64ï¼‰ bin äºŒè¿›åˆ¶è„šæœ¬åŒ…æ‹¬kibanaå¯åŠ¨KibanaæœåŠ¡å™¨å’Œkibana-pluginå®‰è£…æ’ä»¶ $KIBANA_HOME\\bin config é…ç½®æ–‡ä»¶ $KIBANA_HOME\\config data ç”±KibanaåŠå…¶æ’ä»¶å†™å…¥ç£ç›˜çš„æ•°æ®æ–‡ä»¶çš„ä½ç½® $KIBANA_HOME\\data optimize è¿è¡Œçš„æºä»£ç ã€‚æŸäº›ç®¡ç†æ“ä½œï¼ˆä¾‹å¦‚æ’ä»¶å®‰è£…ï¼‰ä¼šå¯¼è‡´æºä»£ç è¢«å³æ—¶é‡æ–°ç¼–è¯‘ã€‚ $KIBANA_HOME\\optimize plugins æ’ä»¶æ–‡ä»¶çš„ä½ç½®ã€‚æ¯ä¸ªæ’ä»¶éƒ½å°†åŒ…å«åœ¨ä¸€ä¸ªå­ç›®å½•ä¸­ã€‚ $KIBANA_HOME\\plugins 2ã€é…ç½®æ–‡ä»¶ å‚è€ƒvim ./config/kibana.yml 123server.port: 5601server.host: \"172.16.0.3\"elasticsearch.url: \"http://172.16.0.3:19200\" 3ã€å¯åŠ¨ Kibana 12$ ./bin/kibana # å‰å°è¿è¡Œ,æ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdout)$ nohup ./bin/kibana &gt;&gt; kibana.log 2&gt;&amp;1 &amp; #åå°å¯åŠ¨ 4ã€è®¿é—®ï¼šlocalhost:5601 å…¶å®ƒï¼š è·å–kibanaçš„PID 123$ lsof -i:5601COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEnode 18325 elastic 12u IPv4 2090814531 0t0 TCP bp11_106:5601 (LISTEN) æˆ–è€… ps -ef |grep node ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨Kibanahttps://www.elastic.co/guide/en/kibana/6.2/production.html å‚è€ƒï¼šhttps://www.elastic.co/guide/en/kibana/6.2/targz.html","link":"/2018/06/07/elasticsearch/kibana%E7%9A%84%E5%AE%89%E8%A3%85/"},{"title":"Elasticsearch-analyze","text":"_analyze åˆ†æè¢«å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ 12345GET /_analyze{ &quot;analyzer&quot;: &quot;index_ansj&quot;, &quot;text&quot;: &quot;å…­å‘³åœ°é»„ä¸¸è½¯èƒ¶å›Š.&quot;} analyzer: æŒ‡å®šåˆ†æå™¨ã€‚ text: è¦è¢«åˆ†æçš„å†…å®¹ã€‚ ç»“æœä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„è¯æ¡ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546{ &quot;tokens&quot;: [ { &quot;token&quot;: &quot;å…­å‘³&quot;, &quot;start_offset&quot;: 0, &quot;end_offset&quot;: 2, &quot;type&quot;: &quot;mq&quot;, &quot;position&quot;: 0 }, { &quot;token&quot;: &quot;åœ°é»„&quot;, &quot;start_offset&quot;: 2, &quot;end_offset&quot;: 4, &quot;type&quot;: &quot;n&quot;, &quot;position&quot;: 1 }, { &quot;token&quot;: &quot;ä¸¸&quot;, &quot;start_offset&quot;: 4, &quot;end_offset&quot;: 5, &quot;type&quot;: &quot;q&quot;, &quot;position&quot;: 2 }, { &quot;token&quot;: &quot;è½¯&quot;, &quot;start_offset&quot;: 5, &quot;end_offset&quot;: 6, &quot;type&quot;: &quot;a&quot;, &quot;position&quot;: 3 }, { &quot;token&quot;: &quot;èƒ¶å›Š&quot;, &quot;start_offset&quot;: 6, &quot;end_offset&quot;: 8, &quot;type&quot;: &quot;n&quot;, &quot;position&quot;: 4 }, { &quot;token&quot;: &quot;.&quot;, &quot;start_offset&quot;: 8, &quot;end_offset&quot;: 9, &quot;type&quot;: &quot;w&quot;, &quot;position&quot;: 5 } ]}","link":"/2018/06/08/elasticsearch/logstashAPI-1/"},{"title":"logstash(ä¸€)","text":"ç®€ä»‹Logstashå¯ä»¥åŠ¨æ€æ”¶é›†ä¸åŒæ¥æºçš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®æ ‡å‡†åŒ–è¾“å‡ºåˆ°é€‰æ‹©çš„ç›®çš„åœ°ã€‚ä¸ºå„ç§åˆ†æå’Œå¯è§†åŒ–æ¸…ç†å’Œæ•´ç†æ‰€æœ‰æ•°æ® ã€‚åº”ç”¨ å·¥ä½œåŸç†logstashä¸­æœ‰ä¸‰ä¸ªå…ƒç´ ã€inputã€filter ã€outputï¼Œå¯¹åº”äº‹ä»¶å¤„ç†ç®¡é“çš„ä¸‰ä¸ªé˜¶æ®µï¼šè¾“å…¥â€“&gt;è¿‡æ»¤â€“&gt;è¾“å‡ºã€‚è¾“å…¥å’Œè¾“å‡ºæ”¯æŒç¼–è§£ç å™¨ï¼Œèƒ½å¤Ÿåœ¨æ•°æ®è¿›å…¥æˆ–é€€å‡ºç®¡é“æ—¶å¯¹æ•°æ®è¿›è¡Œç¼–ç æˆ–è§£ç ï¼Œè€Œæ— éœ€ä½¿ç”¨å•ç‹¬çš„è¿‡æ»¤å™¨ã€‚ Logstash é…ç½®æ–‡ä»¶Logstash æœ‰ä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šç®¡é“é…ç½®æ–‡ä»¶â€”ç”¨äºå®šä¹‰Logstash çš„å¤„ç†ç®¡é“ï¼›è®¾ç½®æ–‡ä»¶â€”ç”¨äºé…ç½®Logstash å¯åŠ¨å’Œæ‰§è¡Œçš„é€‰é¡¹ã€‚ ç®¡é“é…ç½®æ–‡ä»¶åœ¨å®šä¹‰Logstashå¤„ç†ç®¡é“çš„å„ä¸ªé˜¶æ®µæ—¶ï¼Œå¯ä»¥åˆ›å»ºç®¡é“é…ç½®æ–‡ä»¶ã€‚ ä¸€èˆ¬å¯æ”¾ç½®åœ¨logstash/conf.dç›®å½•ä¸­ ï¼Œæ‰©å±•åä¸º.conf æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é…ç½®Logstashã€‚ è®¾ç½®æ–‡ä»¶è®¾ç½®æ–‡ä»¶å·²åœ¨Logstashå®‰è£…ä¸­å®šä¹‰ã€‚LogstashåŒ…å«ä»¥ä¸‹è®¾ç½®æ–‡ä»¶ï¼š logstash.yml ï¼šå¯ä»¥åœ¨æ­¤æ–‡ä»¶ä¸­è®¾ç½®flags ï¼Œè€Œä¸æ˜¯åœ¨å‘½ä»¤è¡Œä¼ é€’flags ï¼Œå½“ç„¶åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®çš„ä»»ä½•flagséƒ½ä¼šè¦†ç›–logstash.ymlæ–‡ä»¶ä¸­çš„ç›¸åº”è®¾ç½® ã€‚å…·ä½“å¯å‚é˜…logstash.ymlã€‚ pipelines.yml ï¼šåŒ…å«åœ¨å•ä¸ªLogstashå®ä¾‹ä¸­è¿è¡Œå¤šä¸ªç®¡é“çš„æ¡†æ¶å’Œè¯´æ˜ã€‚å…·ä½“å¯å‚é˜…å¤šä¸ªç®¡é“ã€‚ jvm.options ï¼šæ­¤æ–‡ä»¶è®¾ç½®æ€»å †ç©ºé—´çš„åˆå§‹å€¼å’Œæœ€å¤§å€¼ã€‚è¿˜å¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶ä¸ºLogstashè®¾ç½®åŒºåŸŸ(local)è®¾ç½®ã€‚ log4j2.properties : åŒ…å«log4j 2åº“çš„é»˜è®¤è®¾ç½®ã€‚å…·ä½“å¯å‚é˜…Log4j 2é…ç½®ã€‚ startup.options (Linux)ï¼š åŒ…å«ç³»ç»Ÿå®‰è£…è„šæœ¬åœ¨ /usr/share/logstash/bin ä¸­ä½¿ç”¨çš„é€‰é¡¹ä¸ºæ‚¨çš„ç³»ç»Ÿæ„å»ºé€‚å½“çš„å¯åŠ¨è„šæœ¬ã€‚å®‰è£… Logstash è½¯ä»¶åŒ…æ—¶ï¼Œç³»ç»Ÿå®‰è£…è„šæœ¬å°†åœ¨å®‰è£…è¿‡ç¨‹ç»“æŸæ—¶æ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ startup.options ä¸­æŒ‡å®šçš„è®¾ç½®æ¥è®¾ç½®ç”¨æˆ·ï¼Œç»„ï¼ŒæœåŠ¡åç§°å’ŒæœåŠ¡æè¿°ç­‰é€‰é¡¹ã€‚ logstash.ymlè®¾ç½®é¡¹è¯¦ç»†å‚è€ƒï¼šhttps://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html å‚æ•° æè¿° é»˜è®¤å€¼ node.name èŠ‚ç‚¹å ä¸»æœºå path.data LogstashåŠå…¶æ’ä»¶ç”¨äºä»»ä½•æŒä¹…æ€§éœ€æ±‚çš„ç›®å½•ã€‚ LOGSTASH_HOME/data pipeline.workers åŒæ—¶æ‰§è¡Œç®¡é“çš„è¿‡æ»¤å™¨å’Œè¾“å‡ºé˜¶æ®µçš„å·¥ä½œä»»åŠ¡æ•°é‡ã€‚å¦‚æœå‘ç°äº‹ä»¶æ­£åœ¨å¤‡ä»½ï¼Œæˆ–CPUæœªé¥±å’Œï¼Œè¯·è€ƒè™‘å¢åŠ æ­¤æ•°å­—ä»¥æ›´å¥½åœ°åˆ©ç”¨æœºå™¨å¤„ç†èƒ½åŠ› ã€‚ Number of the hostâ€™s CPU cores pipeline.batch.size å°è¯•æ‰§è¡Œè¿‡æ»¤å™¨å’Œè¾“å‡ºä¹‹å‰ï¼Œå•ä¸ªå·¥ä½œçº¿ç¨‹ä»è¾“å…¥ç®¡é“æ”¶é›†çš„æœ€å¤§äº‹ä»¶æ•°é‡ã€‚è¾ƒå¤§çš„æ‰¹é‡å¤„ç†å¤§å°ä¸€èˆ¬æ¥è¯´æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ä»¥å¢åŠ çš„å†…å­˜å¼€é”€ä¸ºä»£ä»·ã€‚æ‚¨å¯èƒ½å¿…é¡»é€šè¿‡ jvm.options è®¾ç½® LS_HEAP_SIZE å˜é‡æ¥æœ‰æ•ˆä½¿ç”¨è¯¥é€‰é¡¹æ¥å¢åŠ JVMå †å¤§å°ã€‚ 125 pipeline.batch.delay åœ¨åˆ›å»ºç®¡é“äº‹ä»¶æ‰¹å¤„ç†æ—¶ï¼Œåœ¨å°†è¾ƒå°çš„æ‰¹å¤„ç†åˆ†æ´¾ç»™ç®¡é“å·¥ä½œè€…ä¹‹å‰ç­‰å¾…æ¯ä¸ªäº‹ä»¶çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ 50 pipeline.unsafe_shutdown è®¾ç½®trueä¸ºæ—¶ï¼Œå¼ºåˆ¶Logstashåœ¨å…³é—­æœŸé—´é€€å‡ºï¼Œå³ä½¿å†…å­˜ä¸­ä»æœ‰ inflight äº‹ä»¶ ã€‚ false path.config ä¸»ç®¡é“çš„Logstashé…ç½®çš„è·¯å¾„ã€‚å¦‚æœæŒ‡å®šç›®å½•æˆ–é€šé…ç¬¦ï¼Œåˆ™æŒ‰å­—æ¯é¡ºåºä»ç›®å½•ä¸­è¯»å–é…ç½®æ–‡ä»¶ã€‚ å‚é˜…Logstashç›®å½•å¸ƒå±€ã€‚ config.string åŒ…å«ç”¨äºä¸»ç®¡é“çš„ç®¡é“é…ç½®çš„å­—ç¬¦ä¸²ã€‚ none config.test_and_exit è®¾ç½®ä¸ºtrueæ—¶ï¼Œæ£€æŸ¥é…ç½®æ˜¯å¦æœ‰æ•ˆï¼Œç„¶åé€€å‡ºã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨æ­¤è®¾ç½®ä¸ä¼šæ£€æŸ¥grokæ¨¡å¼çš„æ­£ç¡®æ€§ã€‚ Logstashå¯ä»¥ä»ç›®å½•ä¸­è¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚å¦‚æœå°†æ­¤è®¾ç½®ä¸log.levelï¼šdebugç»“åˆä½¿ç”¨ï¼Œåˆ™Logstashå°†è®°å½•ç»„åˆçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶æ³¨æ‰å…¶æºæ–‡ä»¶çš„é…ç½®å—ã€‚ false config.reload.automatic è®¾ç½®trueä¸ºæ—¶ï¼Œå®šæœŸæ£€æŸ¥é…ç½®æ˜¯å¦å·²æ›´æ”¹ï¼Œå¹¶åœ¨é…ç½®å‘ç”Ÿæ›´æ”¹æ—¶é‡æ–°åŠ è½½é…ç½®ã€‚è¿™ä¹Ÿå¯ä»¥é€šè¿‡SIGHUPä¿¡å·æ‰‹åŠ¨è§¦å‘ã€‚ false config.reload.interval Logstash æ£€æŸ¥é…ç½®æ–‡ä»¶æ›´æ”¹çš„æ—¶é—´é—´éš”ã€‚ 3s config.debug è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†å®Œå…¨ç¼–è¯‘çš„é…ç½®æ˜¾ç¤ºä¸ºè°ƒè¯•æ—¥å¿—æ¶ˆæ¯ã€‚æ‚¨è¿˜å¿…é¡»è®¾ç½®log.levelï¼šdebugã€‚è­¦å‘Šï¼š æ—¥å¿—æ¶ˆæ¯å°†åŒ…å«ä½œä¸ºçº¯æ–‡æœ¬ä¼ é€’ç»™æ’ä»¶é…ç½®çš„ä»»ä½•å¯†ç é€‰é¡¹ï¼Œå¹¶å¯èƒ½å¯¼è‡´æ˜æ–‡å¯†ç å‡ºç°åœ¨æ‚¨çš„æ—¥å¿—ä¸­ï¼ false config.support_escapes è®¾ç½®trueä¸ºæ—¶ï¼Œå¸¦å¼•å·çš„å­—ç¬¦ä¸²å°†å¤„ç†ä»¥ä¸‹è½¬ä¹‰åºåˆ—ï¼š\\næˆä¸ºæ–‡å­—æ¢è¡Œç¬¦ï¼ˆASCII 10ï¼‰ã€‚\\ræˆä¸ºæ–‡å­—å›è½¦ï¼ˆASCII 13ï¼‰ã€‚\\tæˆä¸ºæ–‡å­—æ ‡ç­¾ï¼ˆASCII 9ï¼‰ã€‚\\\\æˆä¸ºä¸€ä¸ªå­—é¢åæ–œæ \\ã€‚\\&quot;æˆä¸ºå­—é¢åŒå¼•å·ã€‚\\'æˆä¸ºå­—é¢å¼•å·ã€‚ false modules é…ç½®æ—¶ï¼Œ modules å¿…é¡»å¤„äºä¸Šè¡¨æ‰€è¿°çš„åµŒå¥—YAMLç»“æ„ä¸­ã€‚ none queue.type ç”¨äºäº‹ä»¶ç¼“å†²çš„å†…éƒ¨é˜Ÿåˆ—æ¨¡å‹ã€‚æŒ‡å®šmemoryåŸºäºå†…å­˜çš„é˜Ÿåˆ—ï¼Œæˆ–persistedåŸºäºç£ç›˜çš„ACKedæ’é˜Ÿåˆ—ã€‚ memory path.queue å¯ç”¨æŒä¹…é˜Ÿåˆ—æ—¶å°†å­˜å‚¨æ•°æ®æ–‡ä»¶çš„ç›®å½•è·¯å¾„ï¼ˆqueue.type: persistedï¼‰ã€‚ path.data/queue http.host æ ‡å‡†RESTç«¯ç‚¹çš„ç»‘å®šåœ°å€ã€‚ â€œ127.0.0.1â€ http.port æ ‡å‡†RESTç«¯ç‚¹çš„ç»‘å®šç«¯å£ã€‚ 9600 log.level æ—¥å¿—çº§åˆ«ã€‚æœ‰æ•ˆé€‰é¡¹åŒ…æ‹¬ï¼šfatal ã€errorã€warnã€infoã€debugã€trace info log.format æ—¥å¿—æ ¼å¼ã€‚è®¾ç½®ä¸ºjsonï¼Œæˆ–plainä½¿ç”¨Object#.inspectã€‚ plain path.log æ—¥å¿—å­˜å‚¨çš„ç›®å½•ã€‚ LOGSTASH_HOME/logs path.plugins å“ªé‡Œå¯ä»¥æ‰¾åˆ°è‡ªå®šä¹‰æ’ä»¶ã€‚æ‚¨å¯ä»¥å¤šæ¬¡æŒ‡å®šæ­¤è®¾ç½®ä»¥åŒ…å«å¤šä¸ªè·¯å¾„ã€‚æ’ä»¶é¢„è®¡å°†åœ¨ä¸€ä¸ªç‰¹å®šçš„ç›®å½•å±‚æ¬¡ç»“æ„ï¼šPATH/logstash/TYPE/NAME.rbå…¶ä¸­TYPEæ˜¯inputsï¼Œfiltersï¼Œoutputsï¼Œæˆ–codecsï¼Œå¹¶ä¸”NAMEæ˜¯æ’ä»¶çš„åç§°ã€‚ å¯åŠ¨åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ 1$ bin/logstash [options] åŠ è½½æŒ‡å®šç®¡é“é…ç½®æ–‡ä»¶ 1$ bin/logstash -f mypipeline.conf æ›´å¤šå‘½ä»¤è¡Œå¯åŠ¨å‚æ•°ï¼šå‚è€ƒ åœ¨æµ‹è¯•Logstashæ—¶ï¼ŒæŒ‡å®šå‘½ä»¤è¡Œé€‰é¡¹å¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®æ‚¨ä½¿ç”¨ logstash.ymlæ¥æ§åˆ¶Logstashæ‰§è¡Œã€‚ä½¿ç”¨è®¾ç½®æ–‡ä»¶å¯ä»¥æ›´è½»æ¾åœ°æŒ‡å®šå¤šä¸ªé€‰é¡¹ ã€‚ ç®¡é“é…ç½®æ–‡ä»¶ç»“æ„1234567891011input { ...}filter { ...}output { ...} æ¯ä¸ªéƒ¨åˆ†éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶çš„é…ç½®é€‰é¡¹ã€‚å¦‚æœæŒ‡å®šäº†å¤šä¸ªè¿‡æ»¤å™¨ï¼Œåˆ™ä¼šæŒ‰ç…§å®ƒä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­çš„æ˜¾ç¤ºé¡ºåºåº”ç”¨å®ƒä»¬ã€‚ æ’ä»¶é…ç½®æ’ä»¶çš„é…ç½®ç”±æ’ä»¶åç§°å’Œæ’ä»¶çš„ä¸€ä¸ªè®¾ç½®å—ç»„æˆã€‚ ä¸‹é¢çš„ä¾‹å­ä¸­é…ç½®äº†ä¸¤ä¸ªè¾“å…¥æ–‡ä»¶é…ç½®ï¼š 1234567891011input { file { path =&gt; &quot;/var/log/messages&quot; type =&gt; &quot;syslog&quot; } file { path =&gt; &quot;/var/log/apache/access.log&quot; type =&gt; &quot;apache&quot; }} åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸ºæ¯ä¸ªæ–‡ä»¶è¾“å…¥é…ç½®äº†ä¸¤ä¸ªè®¾ç½®ï¼šè·¯å¾„å’Œç±»å‹ã€‚ æ‚¨å¯ä»¥é…ç½®çš„è®¾ç½®å› æ’ä»¶ç±»å‹è€Œå¼‚ã€‚æœ‰å…³æ¯ä¸ªæ’ä»¶çš„ä¿¡æ¯ ,è¯·å‚é˜… Input Plugins, Output Plugins, Filter Plugins, and Codec Plugins. å€¼ç±»å‹æ’ä»¶å¯ä»¥è¦æ±‚è®¾ç½®çš„å€¼ä¸ºç‰¹å®šç±»å‹ï¼Œä¾‹å¦‚å¸ƒå°”å€¼ï¼Œåˆ—è¡¨æˆ–æ•£åˆ—ã€‚æ”¯æŒä»¥ä¸‹å€¼ç±»å‹ã€‚ Arrayè¿™ç§ç±»å‹å¤§å¤šä¸èµæˆä½¿ç”¨ï¼Œä¾‹å¦‚å¯ä»¥å®šä¹‰:list =&gt; trueå±æ€§çš„æ’ä»¶ä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ä½†æ˜¯ä»ç„¶éœ€è¦Arrayå¤„ç†ä¸éœ€è¦ç±»å‹æ£€æŸ¥çš„æ•£åˆ—æˆ–æ··åˆç±»å‹çš„åˆ—è¡¨ã€‚ 1users =&gt; [{id =&gt; 1ï¼Œname =&gt; bob}ï¼Œ{id =&gt; 2ï¼Œname =&gt; jane}] Listså¯ä»¥é€šè¿‡æŒ‡å®š:list =&gt; trueä½•æ—¶å£°æ˜å‚æ•°æ¥å¯ç”¨åˆ—è¡¨æ£€æŸ¥ã€‚ 12path =&gt; [ &quot;/var/log/messages&quot;, &quot;/var/log/*.log&quot; ]uris =&gt; [ &quot;http://elastic.co&quot;, &quot;http://example.net&quot; ] Booleanå¸ƒå°”å€¼å¿…é¡»æ˜¯trueæˆ–falseã€‚è¯·æ³¨æ„ï¼Œtrueå’Œfalseå…³é”®å­—ä¸åŒ…å«åœ¨å¼•å·ä¸­ã€‚ 1ssl_enable =&gt; true Bytesè¡¨ç¤ºæœ‰æ•ˆçš„å­—èŠ‚å•ä½ ï¼Œæ­¤å­—æ®µä¸åŒºåˆ†å¤§å°å†™ï¼Œå¹¶å…è®¸å€¼å’Œå•ä½ä¹‹é—´å­˜åœ¨ç©ºæ ¼ã€‚å¦‚æœæœªæŒ‡å®šå•ä½ï¼Œåˆ™æ•´æ•°å­—ç¬¦ä¸²è¡¨ç¤ºå­—èŠ‚æ•°ã€‚ 1234my_bytes =&gt; &quot;1113&quot; # 1113 bytesmy_bytes =&gt; &quot;10MiB&quot; # 10485760 bytesmy_bytes =&gt; &quot;100kib&quot; # 102400 bytesmy_bytes =&gt; &quot;180 mb&quot; # 180000000 bytes codecç¼–è§£ç å™¨æ˜¯ç”¨äºè¡¨ç¤ºæ•°æ®çš„Logstashç¼–è§£ç å™¨çš„åç§°ã€‚ç¼–è§£ç å™¨å¯ç”¨äºè¾“å…¥å’Œè¾“å‡ºã€‚ è¾“å…¥ç¼–è§£ç å™¨æä¾›äº†ä¸€ç§åœ¨æ•°æ®è¿›å…¥è¾“å…¥ä¹‹å‰å¯¹å…¶è¿›è¡Œè§£ç çš„ä¾¿æ·æ–¹å¼ã€‚è¾“å‡ºç¼–è§£ç å™¨æä¾›äº†ä¸€ç§åœ¨æ•°æ®ç¦»å¼€è¾“å‡ºä¹‹å‰å¯¹æ•°æ®è¿›è¡Œç¼–ç çš„ä¾¿æ·æ–¹å¼ã€‚ä½¿ç”¨è¾“å…¥æˆ–è¾“å‡ºç¼–è§£ç å™¨æ— éœ€åœ¨Logstashç®¡é“ä¸­ä½¿ç”¨å•ç‹¬çš„è¿‡æ»¤å™¨ã€‚ ç¼–è§£ç å™¨åˆ—è¡¨ 1codec =&gt; &quot;json&quot; Hashå“ˆå¸Œæ˜¯æ ¼å¼ä¸­æŒ‡å®šçš„é”®å€¼å¯¹çš„é›†åˆ&quot;field1&quot; =&gt; &quot;value1&quot;ã€‚è¯·æ³¨æ„ï¼Œå¤šä¸ªé”®å€¼æ¡ç›®ç”±ç©ºæ ¼è€Œä¸æ˜¯é€—å·åˆ†éš”ã€‚ 12345match =&gt; { &quot;field1&quot; =&gt; &quot;value1&quot; &quot;field2&quot; =&gt; &quot;value2&quot; ...} Numberæ•°å­—å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ•°å€¼ï¼ˆæµ®ç‚¹æˆ–æ•´æ•°ï¼‰ã€‚ 1port =&gt; 33 Passwordå¯†ç æ˜¯å…·æœ‰å•ä¸ªå€¼ä½†æœªè®°å½•æˆ–æ‰“å°çš„å­—ç¬¦ä¸²ã€‚ 1my_password =&gt; &quot;password&quot; URLURIå¯ä»¥æ˜¯å®Œæ•´çš„URLï¼Œå¦‚http://elastic.co/ï¼Œä¹Ÿå¯ä»¥æ˜¯åƒfoobarè¿™æ ·çš„ç®€å•æ ‡è¯†ç¬¦ã€‚å¦‚æœURIåŒ…å«å¯†ç ï¼Œä¾‹å¦‚httpï¼š// userï¼špass@example.netï¼Œåˆ™ä¸ä¼šè®°å½•æˆ–æ‰“å°URIçš„å¯†ç éƒ¨åˆ†ã€‚ 1my_uri =&gt; &quot;http://foo:bar@example.net&quot; Stringå­—ç¬¦ä¸²å¿…é¡»æ˜¯å•ä¸ªå­—ç¬¦åºåˆ—ã€‚è¯·æ³¨æ„ï¼Œå­—ç¬¦ä¸²å€¼ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¯ä»¥æ˜¯doubleæˆ–singleã€‚ Pathè·¯å¾„æ˜¯è¡¨ç¤ºæœ‰æ•ˆæ“ä½œç³»ç»Ÿè·¯å¾„çš„å­—ç¬¦ä¸²ã€‚ 1my_path =&gt; &quot;/tmp/logstash&quot; è½¬ä¹‰å­—ç¬¦é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å¯ç”¨è½¬ä¹‰åºåˆ—ã€‚å¦‚æœæ‚¨å¸Œæœ›åœ¨å¸¦å¼•å·çš„å­—ç¬¦ä¸²ä¸­ä½¿ç”¨è½¬ä¹‰åºåˆ—ï¼Œåˆ™éœ€è¦åœ¨ logstash.yml ä¸­è®¾ç½®config.support_escapes: trueã€‚ 12name =&gt; &quot;Hello world&quot;name =&gt; 'It\\'s a beautiful day' æ’ä»¶ï¼šinputè¾“å…¥æ’ä»¶ä½¿Logstashèƒ½å¤Ÿè¯»å–ç‰¹å®šçš„äº‹ä»¶æºã€‚ å¸¸ç”¨ input æ’ä»¶: fileï¼šä»æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶è¯»å–ï¼Œå°±åƒUNIXå‘½ä»¤ tail -0F ã€‚ syslogï¼š ä¾¦å¬ç³»ç»Ÿç«¯å£514ä¸Šæ—¥å¿—æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®RFC3164æ ¼å¼è¿›è¡Œè§£æ ã€‚ redisï¼š ä»Rediså®ä¾‹è¯»å–äº‹ä»¶ ï¼ŒRedisç»å¸¸ç”¨ä½œé›†ä¸­å¼Logstashå®‰è£…ä¸­çš„â€œä»£ç†â€ï¼Œå®ƒå°†æ¥è‡ªè¿œç¨‹Logstashâ€œæ‰˜è¿äººâ€çš„Logstashäº‹ä»¶æ’é˜Ÿã€‚ beatsï¼šå¤„ç†ç”±Filebeatå‘é€çš„äº‹ä»¶ã€‚ æ›´å¤šè§ï¼šinput-plugins outputè¾“å‡ºæ’ä»¶å°†äº‹ä»¶æ•°æ®å‘é€åˆ°ç‰¹å®šç›®æ ‡ã€‚è¾“å‡ºæ˜¯äº‹ä»¶ç®¡é“çš„æœ€åé˜¶æ®µã€‚ å¸¸ç”¨ output æ’ä»¶: elasticsearchï¼šå°†äº‹ä»¶æ•°æ®å‘é€ç»™ Elasticsearchã€‚ fileï¼šå°†äº‹ä»¶æ•°æ®å†™å…¥æ–‡ä»¶æˆ–ç£ç›˜ã€‚ graphiteï¼šå°†äº‹ä»¶æ•°æ®å‘é€ç»™ graphiteï¼ˆä¸€ä¸ªæµè¡Œçš„å¼€æºå·¥å…·ï¼Œå­˜å‚¨å’Œç»˜åˆ¶æŒ‡æ ‡)ã€‚ statsdï¼šå°†äº‹ä»¶æ•°æ®å‘é€åˆ° statsd ï¼ˆè¿™æ˜¯ä¸€ç§ä¾¦å¬ç»Ÿè®¡æ•°æ®çš„æœåŠ¡ï¼Œå¦‚è®¡æ•°å™¨å’Œå®šæ—¶å™¨ï¼Œé€šè¿‡UDPå‘é€å¹¶å°†èšåˆå‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå¯æ’å…¥çš„åç«¯æœåŠ¡ï¼‰ã€‚ æ›´å¤šè§ï¼šOutput Plugins filterè¿‡æ»¤å™¨æ’ä»¶å¯¹äº‹ä»¶æ‰§è¡Œä¸­é—´å¤„ç†ã€‚è¿‡æ»¤å™¨é€šå¸¸æ ¹æ®äº‹ä»¶çš„ç‰¹å¾æœ‰æ¡ä»¶åœ°åº”ç”¨ã€‚ å¸¸ç”¨ filter æ’ä»¶: grokï¼šè§£æä»»æ„ç»“æ„æ–‡æœ¬ã€‚ Grokç›®å‰æ˜¯Logstashä¸­å°†éç»“æ„åŒ–æ—¥å¿—æ•°æ®è§£æä¸ºç»“æ„åŒ–å’Œå¯æŸ¥è¯¢çš„æœ€ä½³æ–¹æ³•ã€‚ mutateï¼šå¯¹mutateè¿‡æ»¤å™¨æ— æ³•å¤„ç†çš„å­—æ®µæ‰§è¡Œå¸¸è§„æ›´æ”¹ ã€‚å¯ä»¥é‡å‘½åï¼Œåˆ é™¤ï¼Œæ›¿æ¢å’Œä¿®æ”¹äº‹ä»¶ä¸­çš„å­—æ®µã€‚ dropï¼šå®Œå…¨æ”¾å¼ƒä¸€ä¸ªäº‹ä»¶ï¼Œä¾‹å¦‚è°ƒè¯•äº‹ä»¶ã€‚ cloneï¼šåˆ¶ä½œä¸€ä¸ªäº‹ä»¶çš„å‰¯æœ¬ï¼Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤å­—æ®µã€‚ geoipï¼šæ·»åŠ æœ‰å…³IPåœ°å€çš„åœ°ç†ä½ç½®çš„ä¿¡æ¯ æ›´å¤šè§ï¼šFilter Plugins codecç¼–è§£ç å™¨æ’ä»¶æ›´æ”¹äº‹ä»¶çš„æ•°æ®è¡¨ç¤ºã€‚ç¼–è§£ç å™¨æœ¬è´¨ä¸Šæ˜¯æµè¿‡æ»¤å™¨ï¼Œå¯ä»¥ä½œä¸ºè¾“å…¥æˆ–è¾“å‡ºçš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚ å¸¸ç”¨ codec æ’ä»¶ï¼š jsonï¼šä»¥JSONæ ¼å¼å¯¹æ•°æ®è¿›è¡Œç¼–ç æˆ–è§£ç ã€‚ multilineï¼šå°†å¤šè¡Œæ–‡æœ¬äº‹ä»¶ï¼ˆå¦‚javaå¼‚å¸¸å’Œå †æ ˆè·Ÿè¸ªæ¶ˆæ¯ï¼‰åˆå¹¶ä¸ºå•ä¸ªäº‹ä»¶ã€‚ æ›´å¤šè§ï¼šCodec Plugins å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1063984 logstashå®‰è£… 1ã€åˆ‡æ¢è‡³logstashç®¡ç†ç”¨æˆ·ï¼Œå¹¶ä¸‹è½½ 12$ su user$ wget https://artifacts.elastic.co/downloads/logstash/logstash-6.3.2.tar.gz https://www.elastic.co/downloads/logstash https://www.elastic.co/guide/en/logstash/6.2/installing-logstash.html","link":"/2018/06/08/elasticsearch/logstash/"},{"title":"Elasticsearchä¸mongodbåŒæ­¥","text":"Elasticsearchä¸mongodbåŒæ­¥ åˆ©ç”¨mongo-connectormongodbå®˜æ–¹ä»‹ç» github å®‰è£…æ ¹æ®å…·ä½“Elasticsearchç‰ˆæœ¬ï¼Œåˆ©ç”¨pipå®‰è£…æœ€æ–°ç‰ˆæœ¬mongo-connector 123$ pip install 'mongo-connector[elastic5]'$ mongo-connector --version mongo-connector version: 2.5.1 å¦‚æœæç¤ºpipæ²¡è£…ï¼Œåˆ™å…ˆå®‰è£…pip 1$ sudo apt-get install python-pip mongodbå¼€å¯å‰¯æœ¬é›†ï¼ˆå¿…é¡»å¼€å¯ï¼‰ï¼Œå·²å¼€å¯åˆ™å¿½ç•¥æ­¤æ­¥ã€‚deploy-replica-set (1) åœæ­¢mongodbæœåŠ¡ 1$ service mongodb stop (2) é€šè¿‡ --replSet è®¾å®šå‰¯æœ¬é›†åç§° 1$ mongod --replSet myDevReplSet æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ mongodb.conf ä¸­æ·»åŠ  12#å‰¯æœ¬é›†åç§°replSet=myDevReplSet è¯´æ˜ï¼š myDevReplSetæ˜¯å‰¯æœ¬é›†çš„åç§° (3) åˆå§‹åŒ–å‰¯æœ¬é›† 123456&gt; rs.initiate(){ \"info2\" : \"no configuration specified. Using a default configuration for the set\", \"me\" : \"ubuntu:27017\", \"ok\" : 1} (4) ã€éªŒè¯ã€‘åˆå§‹åŒ–å‰¯æœ¬é›†çš„é…ç½® 123456789101112131415161718192021222324252627282930313233343536myDevReplSet:OTHER&gt; rs.conf(){ &quot;_id&quot; : &quot;myDevReplSet&quot;, &quot;version&quot; : 1, &quot;protocolVersion&quot; : NumberLong(1), &quot;members&quot; : [ { &quot;_id&quot; : 0, &quot;host&quot; : &quot;ubuntu:27017&quot;, &quot;arbiterOnly&quot; : false, &quot;buildIndexes&quot; : true, &quot;hidden&quot; : false, &quot;priority&quot; : 1, &quot;tags&quot; : { }, &quot;slaveDelay&quot; : NumberLong(0), &quot;votes&quot; : 1 } ], &quot;settings&quot; : { &quot;chainingAllowed&quot; : true, &quot;heartbeatIntervalMillis&quot; : 2000, &quot;heartbeatTimeoutSecs&quot; : 10, &quot;electionTimeoutMillis&quot; : 10000, &quot;catchUpTimeoutMillis&quot; : 2000, &quot;getLastErrorModes&quot; : { }, &quot;getLastErrorDefaults&quot; : { &quot;w&quot; : 1, &quot;wtimeout&quot; : 0 }, &quot;replicaSetId&quot; : ObjectId(&quot;5b35a8568dccf16c7734a30b&quot;) }} (5)ã€éªŒè¯ã€‘å‰¯æœ¬é›†çš„çŠ¶æ€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142myDevReplSet:PRIMARY&gt; rs.status(){ \"set\" : \"myDevReplSet\", \"date\" : ISODate(\"2018-06-29T03:34:53.131Z\"), \"myState\" : 1, \"term\" : NumberLong(1), \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"durableOpTime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) } }, \"members\" : [ { \"_id\" : 0, \"name\" : \"ubuntu:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 282, \"optime\" : { \"ts\" : Timestamp(1530243289, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2018-06-29T03:34:49Z\"), \"electionTime\" : Timestamp(1530243158, 2), \"electionDate\" : ISODate(\"2018-06-29T03:32:38Z\"), \"configVersion\" : 1, \"self\" : true } ], \"ok\" : 1} æ•°æ®åŒæ­¥ å®˜æ–¹æ–‡æ¡£å‘½ä»¤æ ¼å¼ 123mongo-connector -m &lt;mongodb server hostname&gt;:&lt;replica set port&gt; \\ -t &lt;replication endpoint URL, e.g. http://localhost:8983/solr&gt; \\ -d &lt;name of doc manager, e.g., solr_doc_manager&gt; æ‰§è¡Œå‘½ä»¤ 1$ mongo-connector -m username:passwd@localhost:27017 -t username:passwd@localhost:9200 -d elastic2_doc_manager -n testDB.testCol è¯´æ˜ï¼š -m æŒ‡å®šmongodbçš„åœ°å€ä¸ç«¯å£ ã€‚ â€‹ -t ESçš„åœ°å€ä¸ç«¯å£ ã€‚ â€‹ -d doc managerçš„åç§°ï¼Œ2.xç‰ˆæœ¬ä¸ºï¼š elastic2-doc-managerã€‚ â€‹ -n æŒ‡å®šè¦åŒæ­¥çš„æ•°æ®åº“å’Œé›†åˆåã€‚ æ•°æ®åŒæ­¥å‰åº”å…ˆå»ºç«‹ç´¢å¼•ï¼Œå†è¿›è¡Œæ•°æ®åŒæ­¥ éªŒè¯æµ‹è¯• mongodbä¸­æ‰§è¡Œæ•°æ®æ’å…¥ 12345$ myDevReplSet:PRIMARY&gt; use test; # testå¯¹åº”ESçš„Indexswitched to db test# æ’å…¥æ•°æ® blogå¯¹åº”ESçš„type$ myDevReplSet:PRIMARY&gt; db.blog.insert({\"title\":\"æ ‡é¢˜ä¸€\",\"time\":\"2018-06-29\",\"content\":\"æµ‹è¯•MongoDBä¸ElasticSearchæ•°æ®åŒæ­¥\"});WriteResult({ \"nInserted\" : 1 }) ElasticSearchä¸­æ£€ç´¢æ•°æ® 12345678910111213141516171819202122232425262728&gt; GET /test/blog/_search{ \"took\": 0, \"timed_out\": false, \"_shards\": { \"total\": 5, \"successful\": 5, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": 1, \"max_score\": 1, \"hits\": [ { \"_index\": \"test\", \"_type\": \"blog\", \"_id\": \"5b35dafcad35569566d32bc7\", \"_score\": 1, \"_source\": { \"content\": \"æµ‹è¯•MongoDBä¸ElasticSearchæ•°æ®åŒæ­¥\", \"title\": \"æ ‡é¢˜ä¸€\", \"time\": \"2018-06-29\" } } ] }} mongo-connectorå·¥å…·æ”¯æŒMongoDBä¸ESä¹‹é—´çš„å®æ—¶å¢insertã€åˆ deleteã€æ”¹updateæ“ä½œã€‚ ä½†å¯¹äºå†å²æ•°æ® ä¸èƒ½ä¿å­˜åˆ°ESä¸­ MongoDB Riverçš„æ’ä»¶MongoDB River ç‰ˆæœ¬è¾ƒæ—§ä¸å»ºè®®ä½¿ç”¨ã€‚ å…¶å®ƒæ–¹æ¡ˆï¼šæš‚æœªæ·±ç©¶ https://elasticsearch.cn/question/1167 é€šè¿‡Bulk API å‚è€ƒï¼šhttps://blog.csdn.net/u011801161/article/details/71726495","link":"/2018/06/29/elasticsearch/mongo-connector/"},{"title":"elasticsearchå¥åº·çŠ¶æ€","text":"elasticsearchå¥åº·çŠ¶æ€ green æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å·²åˆ†é…ã€‚ä½ çš„é›†ç¾¤æ˜¯ 100% å¯ç”¨çš„ã€‚ yellow æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å·²ç»åˆ†ç‰‡äº†ï¼Œä½†è‡³å°‘è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬æ˜¯ç¼ºå¤±çš„ã€‚ä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥æœç´¢ç»“æœä¾ç„¶æ˜¯å®Œæ•´çš„ã€‚ä¸è¿‡ï¼Œä½ çš„é«˜å¯ç”¨æ€§åœ¨æŸç§ç¨‹åº¦ä¸Šè¢«å¼±åŒ–ã€‚å¦‚æœ æ›´å¤šçš„ åˆ†ç‰‡æ¶ˆå¤±ï¼Œä½ å°±ä¼šä¸¢æ•°æ®äº†ã€‚æŠŠ yellow æƒ³è±¡æˆä¸€ä¸ªéœ€è¦åŠæ—¶è°ƒæŸ¥çš„è­¦å‘Šã€‚ red è‡³å°‘ä¸€ä¸ªä¸»åˆ†ç‰‡ï¼ˆä»¥åŠå®ƒçš„å…¨éƒ¨å‰¯æœ¬ï¼‰éƒ½åœ¨ç¼ºå¤±ä¸­ã€‚è¿™æ„å‘³ç€ä½ åœ¨ç¼ºå°‘æ•°æ®ï¼šæœç´¢åªèƒ½è¿”å›éƒ¨åˆ†æ•°æ®ï¼Œè€Œåˆ†é…åˆ°è¿™ä¸ªåˆ†ç‰‡ä¸Šçš„å†™å…¥è¯·æ±‚ä¼šè¿”å›ä¸€ä¸ªå¼‚å¸¸ã€‚ å¥åº·çŠ¶æ€ä¸ºyellowæˆ–redæ—¶é¦–å…ˆæ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ã€‚","link":"/2018/07/05/elasticsearch/elasticsearch%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81/"},{"title":"x-packå®‰è£…","text":"X-Packæ˜¯ä¸€ä¸ªElastic Stackæ‰©å±•ï¼Œå®ƒå°†å®‰å…¨æ€§ï¼Œè­¦æŠ¥ï¼Œç›‘æ§ï¼ŒæŠ¥å‘Šå’Œå›¾å½¢åŠŸèƒ½æ†ç»‘åˆ°ä¸€ä¸ªæ˜“äºå®‰è£…çš„è½¯ä»¶åŒ…ä¸­ã€‚è™½ç„¶X-Packç»„ä»¶æ—¨åœ¨æ— ç¼åœ°ååŒå·¥ä½œï¼Œä½†æ‚¨å¯ä»¥è½»æ¾å¯ç”¨æˆ–ç¦ç”¨è¦ä½¿ç”¨çš„åŠŸèƒ½ã€‚ å®‰è£…1ã€å°†X-Packå®‰è£…åˆ°Elasticsearchä¸­å…·ä½“å‚è€ƒ 1$ bin/elasticsearch-plugin install x-pack 2ã€å¯åŠ¨Elasticsearch 1$ ./bin/elasticsearch -d -p pid è¯´æ˜ï¼š å¦‚æœè¦åœ¨å¤šèŠ‚ç‚¹ç¾¤é›†ä¸Šå®‰è£…X-Packï¼Œå‚è€ƒè¯´æ˜ç”Ÿæˆè¯ä¹¦å¹¶é…ç½®TLSä»¥è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚å¤šèŠ‚ç‚¹ç¾¤é›†éœ€è¦æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ 3ã€å°†X-Packå®‰è£…åˆ°Kibanaä¸­å…·ä½“å‚è€ƒ 1$ bin/kibana-plugin install x-pack 4ã€ç”Ÿæˆé»˜è®¤å¯†ç  12345678910111213$ ./bin/x-pack/setup-passwords auto Initiating the setup of passwords for reserved users elastic,kibana,logstash_system. The passwords will be randomly generated and printed to the console. Please confirm that you would like to continue [y/N]y Changed password for user kibana PASSWORD kibana = fzKfd9h55Pndfr4oPWNm Changed password for user logstash_system PASSWORD logstash_system = 7mSq7JebAE5f3UMUb5g9 Changed password for user elastic PASSWORD elastic = ARS22mBM9YIrxFBGD4pO setup-passwordså‘½ä»¤æŠŠelasticï¼Œ kibanaå’Œlogstash_systemç”¨æˆ·çš„éšæœºå¯†ç è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è®¾ç½®å¯†ç  5ã€ä¿®æ”¹kibana.ymlæ–‡ä»¶ 12345elasticsearch.username: &quot;kibana&quot;elasticsearch.password: &quot;&lt;pwd&gt;&quot;xpack.reporting.encryptionKey: &quot;a_random_string&quot;xpack.security.encryptionKey: &quot;something_at_least_32_characters&quot; è¯´æ˜ï¼šæ˜¯kibanaæ­¥éª¤4ä¸­è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æˆ·çš„å¯†ç ã€‚å¦‚æœæ‚¨åœ¨æ­¥éª¤2ä¸­è®¾ç½®äº†TLSï¼Œåˆ™è¿˜è¦å°†æ‚¨çš„è¯ä¹¦æ·»åŠ åˆ°kibana.ymlæ–‡ä»¶ä¸­ 6ã€å¯åŠ¨kibana 1$ bin/kibana 7ã€è®¿é—®http://localhost:5601ä½¿ç”¨æ­¥éª¤4ä¸­è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æˆ·å¯†ç ç™»å½•ã€‚ å¯ç”¨å’Œç¦ç”¨X-PackåŠŸèƒ½é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ç”¨æ‰€æœ‰åŸºæœ¬X-PackåŠŸèƒ½ã€‚å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„X-PackåŠŸèƒ½elasticsearch.ymlï¼Œkibana.ymlä»¥åŠ logstash.ymlé…ç½®æ–‡ä»¶ã€‚ è®¾ç½® æè¿° xpack.graph.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packå›¾å½¢åŠŸèƒ½ã€‚ xpack.ml.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½ã€‚ xpack.monitoring.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packç›‘è§†åŠŸèƒ½ã€‚ xpack.reporting.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-PackæŠ¥å‘ŠåŠŸèƒ½ã€‚ xpack.security.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packå®‰å…¨åŠŸèƒ½ã€‚ xpack.watcher.enabled è®¾ç½®falseä¸ºç¦ç”¨Watcherã€‚ æœ‰å…³æ¯ä¸ªé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨å“ªäº›è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… X-Packè®¾ç½®ã€‚ è®¾ç½®ç”¨æˆ·èº«ä»½éªŒè¯https://www.elastic.co/guide/en/x-pack/6.2/setting-up-authentication.html https://www.elastic.co/guide/en/elasticsearch/reference/6.2/security-api-users.html è·¨ç¾¤é›†æœç´¢ï¼Œéƒ¨è½ï¼Œå®¢æˆ·ç«¯å’Œé›†æˆhttps://www.elastic.co/guide/en/x-pack/6.2/ccs-tribe-clients-integrations.html å‚è€ƒï¼šhttps://www.elastic.co/downloads/x-packhttps://www.elastic.co/guide/en/x-pack/current/installing-xpack.html","link":"/2018/06/08/elasticsearch/x-pack%E7%9A%84%E5%AE%89%E8%A3%85/"},{"title":"electronæ‰“åŒ…æ¡Œé¢åº”ç”¨","text":"electronæ˜¯åŸºäºNode.jså’ŒChromiumåšçš„ä¸€ä¸ªå·¥å…·,å¯ä»¥æŠŠå‰ç«¯èµ„æºæ–‡ä»¶æ‰“åŒ…æˆæ¡Œé¢åº”ç”¨ã€‚æ”¯æŒWindowsã€OS Xã€Linuxå¹³å°ã€‚ä¾èµ–ï¼š éœ€è¦ Node.js 4.0 + electron-packageræ‰“åŒ…å…¨å±€å®‰è£…ï¼š 1$ npm install electron-packager -g é¦–å…ˆè¿›å…¥åº”ç”¨èµ„æºç›®å½•ä¸‹æ“ä½œè¯­æ³•æ ¼å¼ï¼šelectron-packager â€“platform= â€“arch= [optional flagsâ€¦] å‚æ•°è¯¦è§£ï¼šsourcedirï¼š é¡¹ç›®çš„ä½ç½®appnameï¼š åº”ç”¨åâ€“platform: æ‰“åŒ…çš„ç³»ç»Ÿ(darwin, linux, mas, win32)â€“arch: ç³»ç»Ÿä½æ•°(ia32, x64, armv7l)â€“icon=ï¼š æŒ‡å®šåº”ç”¨çš„å›¾æ ‡(Mac ä¸º .icns æ–‡ä»¶ï¼ŒWindows ä¸º .ico æˆ– .png)â€“out ï¼š æŒ‡å®šè¾“å‡ºçš„ç›®å½•â€“version=ï¼š æŒ‡å®šç¼–è¯‘çš„ electron-prebuilt ç‰ˆæœ¬ ç¤ºä¾‹ï¼š1ã€electron-packager . ks â€“plantform=win32 â€“arch=x64 â€“electron-version=1.7.3 â€“overwrite â€“ignore=node_moules2ã€electron-packager . qinfei â€“all â€“all â€“version=1.7.3 â€“ overwrite â€“ignore=node_moules3ã€æ·˜å®æºï¼ˆé€Ÿåº¦ï¼‰electron-packager . hello â€“all -all â€“electron-version=1.7.3 â€“download.mirror=https://npm.taobao.org/mirrors/electron/ electron-builderæ‰“æˆ.exeå…¨å±€å®‰è£…ï¼š 1$ npm install electron-builder â€“g linuxä¸‹å»ºç«‹è½¯è¿æ¥: 1$ ln -s /opt/node-v8.1.2-linux-x64/bin/electron-builder /usr/local/bin/electron-builder æŸ¥çœ‹ä¿¡æ¯: 1$ electron-builder --version æ‰“åŒ… 12$ build -help$ bulid --win --x64 è¿æ¥è¶…æ—¶ï¼Œå¯æŠŠæºåˆ‡æ¢åˆ°æ·˜å®ï¼š 1npm config set registry https://registry.npm.taobao.org åœ¨inuxä¸‹ ç¼–è¾‘ ~/.npmrc åŠ å…¥ä¸‹é¢å†…å®¹ 1234registry=https://registry.npm.taobao.orgsass_binary_site=https://npm.taobao.org/mirrors/node-sass/phantomjs_cdnurl=http://npm.taobao.org/mirrors/phantomjsELECTRON_MIRROR=http://npm.taobao.org/mirrors/electron/ è‡ªåŠ¨æ›´æ–°1ã€åœ¨åº”ç”¨ç›®å½•ä¸­å†™å®Œmain.jsã€package.jsonï¼ˆæ³¨æ„versionï¼‰ï¼ˆå‚è€ƒï¼šä»¥å‰å†™çš„ï¼‰2ã€æ‰§è¡Œ npm install3ã€ç„¶åæ‰§è¡Œ build â€“win â€“x64ï¼ˆwin64ç‰ˆæœ¬ï¼Œå…¶å®ƒå¦æŸ¥ï¼‰4ã€æŠŠç”Ÿæˆçš„distç›®å½•ä¸‹çš„exeæ–‡ä»¶å’Œlatest.ymlä¸package.jsonæ”¾åˆ°tomcatä¸­é¡¹ç›®è·¯å¾„ä¸‹ï¼ˆæ³¨æ„å’Œpackage.jsonä¸­urlè·¯å¾„ç›¸åŒï¼‰5ã€å®‰è£…ç¬¬ä¸€ä¸ªç‰ˆæœ¬6ã€ç„¶åç”Ÿæˆç¬¬äºŒä¸ªç‰ˆæœ¬7ã€åˆ æ‰node_modulesã€distç›®å½•8ã€é‡å¤2ã€3ã€49ã€å¯åŠ¨ç¬¬ä¸€æ¬¡å®‰è£…çš„ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨æ›´æ–°ã€‚ å¯å‚è€ƒï¼šhttps://electronjs.org/docshttps://www.electron.build/configuration/configurationhttps://www.electron.build/tutorials/two-package-structurehttps://github.com/megahertz/electron-simple-updaterhttps://github.com/iffy/electron-updater-examplehttps://gist.github.com/iffy/0ff845e8e3f59dbe7eaf2bf24443f104https://www.electron.build/auto-update é™„ï¼šä¸€ä¸ªæœ€ç®€å•çš„electroné¡¹ç›®åŒ…å«ä¸‰ä¸ªæ–‡ä»¶ index.html,package.json, main.jsã€‚index.htmlå¯çœ‹åšå‰ç«¯èµ„æºæ–‡ä»¶ã€‚package.jsonæ˜¯Node.jsé¡¹ç›®çš„é…ç½®æ–‡ä»¶ã€‚main.jsæ˜¯åº”ç”¨çš„å¯åŠ¨å…¥å£æ–‡ä»¶ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„package.jsoné…ç½®æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839{ &quot;name&quot;: &quot;zxks&quot;, &quot;version&quot;: &quot;2.1.1&quot;, &quot;main&quot;: &quot;main.js&quot;, &quot;description&quot;: &quot;åœ¨çº¿è€ƒè¯•0.1.0&quot;, &quot;author&quot;: &quot;äº‘ç¿¼äº’è”&quot;, &quot;devDependencies&quot;: { &quot;electron&quot;: &quot;^1.6.11&quot;, &quot;electron-builder&quot;: &quot;^19.6.3&quot;, &quot;http-server&quot;: &quot;^0.9.0&quot; }, &quot;dependencies&quot;: { &quot;electron-log&quot;: &quot;^1.3.0&quot;, &quot;electron-updater&quot;: &quot;^1.4.2&quot; }, //è‡ªåŠ¨æ›´æ–° &quot;build&quot;: { &quot;publish&quot;: [ { &quot;provider&quot;: &quot;generic&quot;, &quot;url&quot;: &quot;https://cloudtest.kszx365.com/cpnsp/&quot; } ], &quot;appId&quot;: &quot;com.kszx&quot;, &quot;mac&quot;: { &quot;category&quot;: &quot;your.app.category.type&quot;, &quot;target&quot;: [ &quot;zip&quot;, &quot;dmg&quot; ] }, &quot;nsis&quot;: { &quot;perMachine&quot;: true }, &quot;win&quot;:{ &quot;icon&quot;: &quot;res/icon2.ico&quot; } }} main.jsæ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253const {app, BrowserWindow, Menu, protocol, ipcMain} = require('electron')const log = require('electron-log');const {autoUpdater} = require(&quot;electron-updater&quot;);const path = require('path')const url = require('url')const electron = require('electron')const dialog = electron.dialogconst globalShortcut = electron.globalShortcut// ä¿æŒä¸€ä¸ªå¯¹äº window å¯¹è±¡çš„å…¨å±€å¼•ç”¨ï¼Œå¦‚æœä½ ä¸è¿™æ ·åšï¼Œ// å½“ JavaScript å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œ window ä¼šè¢«è‡ªåŠ¨åœ°å…³é—­let winfunction createWindow () { // åˆ›å»ºæµè§ˆå™¨çª—å£ã€‚ win = new BrowserWindow({ width: 1920, height: 1080, resizable: false, movable: false, minimizable: false, kiosk: true, alwaysOnTop :true, fullscreen:true, webPreferences: { defaultEncoding: 'UTF-8' } }) // åŠ è½½åº”ç”¨çš„ index.htmlã€‚ win.loadURL(url.format({ pathname: path.join(__dirname, 'index.html'), protocol: 'file:', slashes: true })) //è®¾ç½®å…¨å± win.setFullScreen(true) //è®©çª—å£ä¸åœ¨ä»»åŠ¡æ ä¸­æ˜¾ç¤º. //win.setSkipTaskbar(true) //kiosk æ¨¡å¼. win.setKiosk(true) // æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚ //win.webContents.openDevTools() win.on('move', () =&gt; { win.setFullScreen(true) }) win.on('leave-full-screen', () =&gt; { // win.setFullScreen(true) //app.quit() //dialog.showMessageBox({ // dialog.showErrorBox('ä¸€æ¡é”™è¯¯ä¿¡æ¯', 'é”™è¯¯æ¶ˆæ¯æ¼”ç¤º.') //type: 'info', // message: 'æˆåŠŸ!', // detail: 'ä½ æŒ‰ä¸‹äº†ä¸€ä¸ªå…¨å±€æ³¨å†Œçš„å¿«æ·é”®ç»‘å®š.', // buttons: ['å¥½çš„'] //}) }) win.on('blur', () =&gt; { //win.setFullScreen(true) //app.quit() // dialog.showMessageBox({ // dialog.showErrorBox('ä¸€æ¡é”™è¯¯ä¿¡æ¯', 'é”™è¯¯æ¶ˆæ¯æ¼”ç¤º.') // type: 'info', // message: 'æˆåŠŸ!', // detail: 'skä½ æŒ‰ä¸‹äº†ä¸€ä¸ªå…¨å±€æ³¨å†Œçš„å¿«æ·é”®ç»‘å®š.', // buttons: ['å¥½çš„'] //}) }) // å½“ window è¢«å…³é—­ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«è§¦å‘ã€‚ win.on('closed', () =&gt; { // å–æ¶ˆå¼•ç”¨ window å¯¹è±¡ï¼Œå¦‚æœä½ çš„åº”ç”¨æ”¯æŒå¤šçª—å£çš„è¯ï¼Œ // é€šå¸¸ä¼šæŠŠå¤šä¸ª window å¯¹è±¡å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œ // ä¸æ­¤åŒæ—¶ï¼Œä½ åº”è¯¥åˆ é™¤ç›¸åº”çš„å…ƒç´ ã€‚ win = null }) win.on('app-command', function (e, cmd) { // Navigate the window back when the user hits their mouse back button if (cmd === 'browser-backward' &amp;&amp; win.webContents.canGoBack()) { win.webContents.goBack() }})}// Electron ä¼šåœ¨åˆå§‹åŒ–åå¹¶å‡†å¤‡// åˆ›å»ºæµè§ˆå™¨çª—å£æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚// éƒ¨åˆ† API åœ¨ ready äº‹ä»¶è§¦å‘åæ‰èƒ½ä½¿ç”¨ã€‚app.on('ready', createWindow)//app.on('move', () =&gt; { // if (process.platform !== 'darwin') { // app.quit() // }//})app.on('ready', function () { globalShortcut.register('Super+D', function () { dialog.showMessageBox({ type: 'info', message: 'æˆåŠŸ!', detail: 'ä½ æŒ‰ä¸‹äº†ä¸€ä¸ªå…¨å±€æ³¨å†Œçš„å¿«æ·é”®ç»‘å®š.', buttons: ['å¥½çš„'] }) })})app.on('ready', () =&gt; { // Register a 'CommandOrControl+Y' shortcut listener. globalShortcut.register('Alt+Tab', () =&gt; { // Do stuff when Y and either Command/Control is pressed. app.quit() })})//app.on('ready', function () {// var electronScreen = electron.screen// var size = electronScreen.getPrimaryDisplay().workAreaSize// mainWindow = new BrowserWindow({ width: size.width, height: size.height })//})// å½“å…¨éƒ¨çª—å£å…³é—­æ—¶é€€å‡ºã€‚app.on('window-all-closed', () =&gt; { // åœ¨ macOS ä¸Šï¼Œé™¤éç”¨æˆ·ç”¨ Cmd + Q ç¡®å®šåœ°é€€å‡ºï¼Œ // å¦åˆ™ç»å¤§éƒ¨åˆ†åº”ç”¨åŠå…¶èœå•æ ä¼šä¿æŒæ¿€æ´»ã€‚ if (process.platform !== 'darwin') { app.quit() }})app.on('activate', () =&gt; { // åœ¨è¿™æ–‡ä»¶ï¼Œä½ å¯ä»¥ç»­å†™åº”ç”¨å‰©ä¸‹ä¸»è¿›ç¨‹ä»£ç ã€‚ // ä¹Ÿå¯ä»¥æ‹†åˆ†æˆå‡ ä¸ªæ–‡ä»¶ï¼Œç„¶åç”¨ require å¯¼å…¥ã€‚ if (win === null) { createWindow() }})// åœ¨è¿™æ–‡ä»¶ï¼Œä½ å¯ä»¥ç»­å†™åº”ç”¨å‰©ä¸‹ä¸»è¿›ç¨‹ä»£ç ã€‚// ä¹Ÿå¯ä»¥æ‹†åˆ†æˆå‡ ä¸ªæ–‡ä»¶ï¼Œç„¶åç”¨ require å¯¼å…¥ã€‚//-------------------------------------------------------------------// Logging//// THIS SECTION IS NOT REQUIRED//// This logging setup is not required for auto-updates to work,// but it sure makes debugging easier :)//-------------------------------------------------------------------autoUpdater.logger = log;autoUpdater.logger.transports.file.level = 'info';log.info('App starting...');//-------------------------------------------------------------------// Define the menu//// THIS SECTION IS NOT REQUIRED//-------------------------------------------------------------------let template = []if (process.platform === 'darwin') { // OS X const name = app.getName(); template.unshift({ label: name, submenu: [ { label: 'About ' + name, role: 'about' }, { label: 'Quit', accelerator: 'Command+Q', click() { app.quit(); } }, ] })}//-------------------------------------------------------------------// Open a window that displays the version//// THIS SECTION IS NOT REQUIRED//// This isn't required for auto-updates to work, but it's easier// for the app to show a window than to have to click &quot;About&quot; to see// that updates are working.//-------------------------------------------------------------------function sendStatusToWindow(text) { log.info(text); win.webContents.send('message', text);}autoUpdater.on('checking-for-update', () =&gt; { sendStatusToWindow('Checking for update...');})autoUpdater.on('update-available', (ev, info) =&gt; { sendStatusToWindow('Update available.');})autoUpdater.on('update-not-available', (ev, info) =&gt; { sendStatusToWindow('Update not available.');})autoUpdater.on('error', (ev, err) =&gt; { sendStatusToWindow('Error in auto-updater.');})autoUpdater.on('download-progress', (ev, progressObj) =&gt; { sendStatusToWindow('Download progress...');})autoUpdater.on('update-downloaded', (ev, info) =&gt; { sendStatusToWindow('Update downloaded; will install in 5 seconds');});//-------------------------------------------------------------------// Auto updates//// For details about these events, see the Wiki:// https://github.com/electron-userland/electron-builder/wiki/Auto-Update#events//// The app doesn't need to listen to any events except `update-downloaded`//// Uncomment any of the below events to listen for them. Also,// look in the previous section to see them being used.//-------------------------------------------------------------------// autoUpdater.on('checking-for-update', () =&gt; {// })// autoUpdater.on('update-available', (ev, info) =&gt; {// })// autoUpdater.on('update-not-available', (ev, info) =&gt; {// })// autoUpdater.on('error', (ev, err) =&gt; {// })// autoUpdater.on('download-progress', (ev, progressObj) =&gt; {// })autoUpdater.on('update-downloaded', (ev, info) =&gt; { // Wait 5 seconds, then quit and install // In your application, you don't need to wait 5 seconds. // You could call autoUpdater.quitAndInstall(); immediately setTimeout(function() { autoUpdater.quitAndInstall(); }, 5000)})app.on('ready', function() { autoUpdater.checkForUpdates();});","link":"/2018/01/23/electron/electron%E6%89%93%E5%8C%85%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8/"},{"title":"x-packç ´è§£","text":"x-packç ´è§£ å®‰è£…å®Œx-packå 1ã€è§£å‹x-pack-core-6.2.4.jar 123$ cp ES_HOME/plugins/x-pack/x-pack-corex-pack-core-6.2.4.jar /tmp/x-pack$ cd /tmp/x-pack$ jar -xvf x-pack-core-6.2.4.jar 2ã€ä¿®æ”¹javaæ–‡ä»¶ æ‰¾åˆ°org.elasticsearch.license.LicenseVerifier.classã€ org.elasticsearch.xpack.core.XPackBuild.class ï¼Œç”¨åç¼–è¯‘å·¥å…·ä¿å­˜ä¸ºJavaæ–‡ä»¶ã€‚ (1) ä¿®æ”¹LicenseVerifier LicenseVerifier ä¸­æœ‰ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œè¿™å°±æ˜¯éªŒè¯æˆæƒæ–‡ä»¶æ˜¯å¦æœ‰æ•ˆçš„æ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠå®ƒä¿®æ”¹ä¸ºå…¨éƒ¨è¿”å›true. 1234567891011121314151617181920212223242526272829303132package org.elasticsearch.license;import java.io.ByteArrayOutputStream;import java.io.IOException;import java.io.InputStream;import java.nio.ByteBuffer;import java.security.InvalidKeyException;import java.security.NoSuchAlgorithmException;import java.security.Signature;import java.security.SignatureException;import java.util.Arrays;import java.util.Base64;import java.util.Collections;import org.apache.lucene.util.BytesRef;import org.apache.lucene.util.BytesRefIterator;import org.elasticsearch.common.io.Streams;import org.elasticsearch.common.xcontent.XContentBuilder;import org.elasticsearch.common.xcontent.XContentFactory;import org.elasticsearch.common.xcontent.XContentType;import org.elasticsearch.common.xcontent.ToXContent.MapParams;import org.elasticsearch.license.CryptUtils;import org.elasticsearch.license.License;public class LicenseVerifier { public static boolean verifyLicense(License license, byte[] encryptedPublicKeyData) { return true; } public static boolean verifyLicense(License license) { return true; }} (2) ä¿®æ”¹XPackBuild XPackBuild ä¸­ æœ€åä¸€ä¸ªé™æ€ä»£ç å—ä¸­ tryçš„éƒ¨åˆ†å…¨éƒ¨åˆ é™¤ï¼Œè¿™éƒ¨åˆ†ä¼šéªŒè¯jaråŒ…æ˜¯å¦è¢«ä¿®æ”¹. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package org.elasticsearch.xpack.core;import java.io.IOException;import java.net.URISyntaxException;import java.net.URL;import java.nio.file.Files;import java.nio.file.OpenOption;import java.nio.file.Path;import java.util.jar.JarInputStream;import java.util.jar.Manifest;import org.elasticsearch.common.SuppressForbidden;import org.elasticsearch.common.io.PathUtils;public class XPackBuild { public static final XPackBuild CURRENT; private String shortHash; private String date; @SuppressForbidden( reason = \"looks up path of xpack.jar directly\" ) static Path getElasticsearchCodebase() { URL url = XPackBuild.class.getProtectionDomain().getCodeSource().getLocation(); try { return PathUtils.get(url.toURI()); } catch (URISyntaxException arg1) { throw new RuntimeException(arg1); } } XPackBuild(String shortHash, String date) { this.shortHash = shortHash; this.date = date; } public String shortHash() { return this.shortHash; } public String date() { return this.date; } static { Path path = getElasticsearchCodebase(); String shortHash = null; String date = null; Label_0157: { shortHash = \"Unknown\"; date = \"Unknown\"; } CURRENT = new XPackBuild(shortHash, date); }} 3ã€é‡æ–°ç¼–è¯‘ä»¥ä¸Šä¸¤æ–‡ä»¶ 123$ javac -cp \"$ES_HOME/lib/elasticsearch-6.2.4.jar:/opt/elasticsearch/lib/lucene-core-7.2.1.jar:$ES_HOME/plugins/x-pack/x-pack-core/x-pack-core-6.2.3.jar\" LicenseVerifier.java$ javac -cp \"$ES_HOME/lib/elasticsearch-6.2.4.jar:$ES_HOME/lib/elasticsearch-core-6.2.3.jar:$ES_HOME/lib/lucene-core-7.2.1.jar:$ES_HOME/plugins/x-pack/x-pack-core/x-pack-core-6.2.3.jar:$ES_HOME/plugins/x-pack/x-pack-core/netty-common-4.1.16.Final.jar\" XPackBuild.java æ³¨æ„ï¼šå¦‚æœæ˜¯åœ¨Windowsä¸Šæ“ä½œï¼Œå°±æŠŠjaråŒ…çš„åˆ†éš”ç¬¦ç”±å†’å·æ¢æˆåˆ†å·ã€‚ 4ã€æŠŠç¼–è¯‘çš„org.elasticsearch.license.LicenseVerifier.class org.elasticsearch.xpack.core.XPackBuild.classæ›¿æ¢åŸæ¥çš„classï¼Œé‡æ–°å‹ç¼©æ‰“åŒ… 12$ cd /tmp/x-pack$ jar -cvf x-pack-core-6.2.4.jar ./* 5ã€æŠŠä¹‹å‰elasricsearchå®‰è£…çš„x-pack ä¸­çš„x-pack-core-6.2.4.jar æ›¿æ¢æ‰ 6ã€ä¿®æ”¹elasticsearch.yml é…ç½®æ–‡ä»¶ elasticsearch 6.2.4 ä¸­é»˜è®¤å¼€å¯äº†å®‰å…¨éªŒè¯ï¼Œæˆ‘ä»¬æš‚æ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä»¥æ–¹ä¾¿å¯¼å…¥è‡ªå·±çš„æ–‡ä»¶ åœ¨elasticsearch.yml ä¸­ æ·»åŠ ä¸€ä¸‹é…ç½® 1xpack.security.enabled: false 7ã€ç„¶åé‡å¯elasticserach ã€‚kinaba å¯ä»¥ä¸é‡å¯ã€‚å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ESé›†ç¾¤ æ¯ä¸ªéƒ½æ›¿æ¢ä¸‹ï¼Œå¹¶é‡å¯ã€‚ 8ã€å¯¼å…¥æˆæƒæ–‡ä»¶ 12345678910111213{ \"license\": { \"uid\": \"22742aa9-068b-48b6-8b36-c36ff3a39ed7\", \"type\": \"platinum\", // ä¿®æ”¹æˆæƒä¸ºç™½é‡‘ç‰ˆæœ¬ \"issue_date_in_millis\": 1526860800000, \"expiry_date_in_millis\": 2524579200999, //ä¿®æ”¹åˆ°æœŸæ—¶é—´ \"max_nodes\": 100, // ä¿®æ”¹æœ€å¤§èŠ‚ç‚¹æ•° \"issued_to\": \"aa\", \"issuer\": \"Web Form\", \"signature\": \"AAAAAwAAAA2+OXa0Aq7HFDzGSxl1AAABmC9ZN0hjZDBGYnVyRXpCOW5Bb3FjZDAxOWpSbTVoMVZwUzRxVk1PSmkxaktJRVl5MUYvUWh3bHZVUTllbXNPbzBUemtnbWpBbmlWRmRZb25KNFlBR2x0TXc2K2p1Y1VtMG1UQU9TRGZVSGRwaEJGUjE3bXd3LzRqZ05iLzRteWFNekdxRGpIYlFwYkJiNUs0U1hTVlJKNVlXekMrSlVUdFIvV0FNeWdOYnlESDc3MWhlY3hSQmdKSjJ2ZTcvYlBFOHhPQlV3ZHdDQ0tHcG5uOElCaDJ4K1hob29xSG85N0kvTWV3THhlQk9NL01VMFRjNDZpZEVXeUtUMXIyMlIveFpJUkk2WUdveEZaME9XWitGUi9WNTZVQW1FMG1DenhZU0ZmeXlZakVEMjZFT2NvOWxpZGlqVmlHNC8rWVVUYzMwRGVySHpIdURzKzFiRDl4TmM1TUp2VTBOUlJZUlAyV0ZVL2kvVk10L0NsbXNFYVZwT3NSU082dFNNa2prQ0ZsclZ4NTltbU1CVE5lR09Bck93V2J1Y3c9PQAAAQCi1V5EMmUXsTUKTeVHJugLj0daqCDI/eAALGG2FWAnE7p9F9ZcCNp2cybBmJ8okoxEIvsUVHUEv50eodAzsxR7qYra1j3pbjMY9BSl13DTVByhow+ZbsXojEpxtXPv18Fd88iP7NcQDs/ERI3xQePDl4O3vB1qkpTxZiY+BC/YlCHF4VTz/sGq6PWvT0G7T4oUb91KIB42oFYNvS4SRkv4gvHOQWRkwdthA2dwpf2QNeH/5vMw9VWFV8x7hw+8HTcqkf2De3TFq94VvhWw9ZpXPaO79fuQoj7vR79BHbBLYnlHxMNAEGnzgJwK13DGDnHdoz0mGsCHgUuswn7+nTEX\", \"start_date_in_millis\": 1526860800000 }} æ‰§è¡Œå¯¼å…¥ 12$ curl -XPUT -u elastic:kY9j3OEFhQZ0LzD3kxEI 'http://127.0.0.1:9200/_xpack/license' -H \"Content-Type: application/json\" -d @/home/license.json{\"acknowledged\":true,\"license_status\":\"valid\"} é—®é¢˜ï¼š å¯¼å…¥æˆæƒæ–‡ä»¶åï¼Œä¸èƒ½å¼€å¯å®‰å…¨éªŒè¯ã€‚ å‚è€ƒï¼šhttps://www.jianshu.com/p/55b5c5d3a89c https://www.elastic.co/guide/en/elasticsearch/reference/6.2/update-license.html kinbanaçš„æ±‰åŒ–å¯å‚è€ƒï¼šhttps://blog.csdn.net/yinlongfei_love/article/details/81063464","link":"/2018/08/08/elasticsearch/x-pack%E7%A0%B4%E8%A7%A3/"},{"title":"nativefieræ‰“åŒ…åº”ç”¨","text":"nativefieræ‰“åŒ…å·¥å…· ï¼Œä¹Ÿæ˜¯electronå®ç°ã€‚ä¼˜ç‚¹ï¼šä¸€æ¡å‘½ä»¤å°±å¯ä»¥æŠŠå·²å­˜åœ¨çš„ç½‘ç«™æ‰“åŒ…æˆæ¡Œé¢ç‰ˆï¼Œé€Ÿåº¦å¿«ã€‚ä¾èµ–ï¼š éœ€è¦ Node.js 4.0 + å®‰è£…ï¼š 1$ npm install nativefier -g æ‰“åŒ…ï¼š 1$ nativefier &quot;http://baidu.com&quot; å…·ä½“å…¶å®ƒå‚æ•°å‚è€ƒï¼šhttps://github.com/jiahaog/nativefier","link":"/2018/01/23/electron/nativefier%E6%89%93%E5%8C%85%E5%BA%94%E7%94%A8/"},{"title":"hexo å¢åŠ ç›¸å†ŒåŠŸèƒ½","text":"hexo å¢åŠ ç›¸å†ŒåŠŸèƒ½ ä¸»é¢˜ä½¿ç”¨çš„ Yilia ä¸»é¢˜ã€‚ 1ã€åˆ›å»ºå¯ç‚¹å‡»é“¾æ¥ è¿›å…¥åšå®¢ç›®å½•æ‰§è¡Œ 1$ hexo new page photos ä¼šåœ¨sourceä¸‹ç”Ÿæˆphotos/index.mdæ–‡ä»¶ã€‚ç„¶ååœ¨ä¸»é¢˜ç«™ç‚¹çš„é…ç½®æ–‡ä»¶themes/yilia/_config.ymlä¸­æ·»åŠ ç‚¹å‡»çš„æ–‡æ¡ˆå’Œè·³è½¬åˆ°ä½ç½® ã€‚ 1234567menu: ä¸»é¡µ: / æ–‡ç« : /archives/ categories: /categories/ éšç¬”: /tags/éšç¬”/ ç›¸å†Œ: /photos/ about: /about å‚è€ƒï¼šhttps://blog.csdn.net/qq_22656383/article/details/79393146 https://github.com/maker997/backupBlog https://www.jianshu.com/p/370ca4ef808a https://github.com/luojinghui/luojinghui.github.io","link":"/2018/06/04/hexo/%E7%9B%B8%E5%86%8C%E5%8A%9F%E8%83%BD/"},{"title":"åˆ›å»ºæ­¥éª¤","text":"1ã€å®‰è£…node.js(windows) Quick Start Create a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy å‘å¸ƒæ–‡ç« ï¼š 1234$ cd /d/ProgramFiles/GitHub/myqzf$ hexo clean$ hexo generate$ hexo deploy More info: Deployment å‚è€ƒï¼šhttp://www.jianshu.com/p/1656489eff01","link":"/2017/07/30/hexo/%E5%88%9B%E5%BB%BA%E6%AD%A5%E9%AA%A4/"},{"title":"Javaåç¼–è¯‘","text":"Javaåç¼–è¯‘å·¥å…· JD-GUIJD-GUI æ˜¯ä¸€ä¸ªç”¨ C++ å¼€å‘çš„ Java åç¼–è¯‘å·¥å…·ï¼Œç”± Pavel Kouznetsovå¼€å‘ï¼Œæ”¯æŒWindowsã€Linuxå’Œè‹¹æœMac Osä¸‰ä¸ªå¹³å°ã€‚è€Œä¸”æä¾›äº†Eclipseå¹³å°ä¸‹çš„æ’ä»¶JD-Eclipseã€‚JD-GUIä¸éœ€è¦å®‰è£…ï¼Œç›´æ¥ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥åç¼–è¯‘jar,classæ–‡ä»¶ã€‚ ç›®å‰ç‰ˆæœ¬æ˜¯1.4.0ï¼Œåœç•™åœ¨2015å¹´ ã€‚å¯è·Ÿè¿›åç»­æ›´æ–°ã€‚ ecd-plugin (åœ¨ç”¨)å¢å¼ºå‹ç±»å‹åç¼–è¯‘å™¨å°†JDï¼ŒJadï¼ŒFernFlowerï¼ŒCFRï¼ŒProcyonä¸Eclipseæ— ç¼é›†æˆï¼Œå¹¶å…è®¸Javaå¼€å‘äººå‘˜ç›´æ¥è°ƒè¯•æ²¡æœ‰æºä»£ç çš„ç±»æ–‡ä»¶ã€‚å®ƒè¿˜é›†æˆäº†eclipseç±»ç¼–è¾‘å™¨ï¼Œm2eæ’ä»¶ï¼Œæ”¯æŒJavadocï¼Œ å¼•ç”¨æœç´¢ï¼Œåº“æºé™„åŠ ï¼Œå­—èŠ‚ç è§†å›¾å’ŒJDK8 lambdaè¡¨è¾¾å¼çš„è¯­æ³•ã€‚ ä¸€ã€eclipseä¸­å®‰è£… å¯åŠ¨Eclipseã€‚ ç‚¹å‡» *â€Help &gt; Install New Softwareâ€¦â€*ã€‚ ç‚¹å‡»æŒ‰é’®*â€Addâ€¦â€* æ·»åŠ ä¸€ä¸ªæ–°çš„å­˜å‚¨åº“ã€‚ è¾“å…¥åç§°ä¸ºâ€œEnhanced Class Decompiler Update Siteâ€å¹¶è¾“å…¥ä½ç½®ä¸ºâ€œ https://ecd-plugin.github.io/update â€ï¼Œç„¶åç‚¹å‡»â€œOKâ€æŒ‰é’®ã€‚ é€‰ä¸­â€œEnhanced Class Decompilerâ€ ã€‚ Next, next, nextâ€¦ æœ€åé‡å¯eclipseã€‚ äºŒã€é…ç½®æ–‡ä»¶å…³è” ç‚¹å‡»*â€Window &gt; Preferences &gt; General &gt; Editors &gt; File Associationsâ€* ã€‚ â€œ\\ .classâ€ï¼šé»˜è®¤æƒ…å†µä¸‹é€‰æ‹©â€œç±»åç¼–è¯‘å™¨æŸ¥çœ‹å™¨â€*ã€‚ â€œ\\ .class without sourceâ€ï¼šé»˜è®¤æƒ…å†µä¸‹é€‰æ‹©â€œç±»åç¼–è¯‘å™¨æŸ¥çœ‹å™¨â€*ã€‚ ä¸‰ã€é…ç½®ecdæ’ä»¶ ç‚¹å‡» â€œWindow &gt; Preferences &gt; Java &gt; Decompilerâ€è¿›è¡Œç›¸å…³é…ç½®ã€‚ å››ã€å¸è½½ecdæ’ä»¶ ç‚¹å‡»*â€Help &gt; About Eclipse &gt; Installation Details &gt; Installation Softwareâ€*ã€‚ é€‰æ‹© *â€Enhanced Class Decompilerâ€*ã€‚ ç‚¹å‡» *â€Uninstallâ€¦â€*ã€‚ JADJAD Java Decompiler Download Mirror å¯¹javaç‰ˆæœ¬æ”¯æŒåªåˆ°1.3ï¼Œåé¢ç‰ˆæœ¬å°±æä¸äº†ã€‚ å…¶å®ƒåç¼–è¯‘å·¥å…·å¯å‚è€ƒï¼šhttps://www.zhihu.com/question/20264247","link":"/2018/06/24/java/Java%E5%8F%8D%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7/"},{"title":"Jdkæ·»åŠ ä¿¡ä»»è¯ä¹¦","text":"åœ¨Javaç¨‹åºä¸­é€šè¿‡HttpClientè®¿é—®httpsçš„webæœåŠ¡ï¼ŒæŠ¥é”™ï¼šCaused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path ç¯å¢ƒï¼šlinux 1ã€æŸ¥çœ‹javahomeè·¯å¾„ 12$ echo $JAVA_HOME/usr/local/jdk1.8 2ã€æŸ¥çœ‹å½“å‰å·²åŠ å…¥ä¿¡ä»»çš„è¯ä¹¦ï¼Œéœ€è¦è¾“å…¥å¯†ç changeit 12$ keytool -list -keystore /usr/local/jdk1.8/jre/lib/security/cacertsEnter keystore password: /usr/local/jdk1.8/æ˜¯javahomeçš„è·¯å¾„ 3ã€ä»æµè§ˆå™¨å¯¼å‡ºè¯ä¹¦ ä»æµè§ˆå™¨è®¿é—®httpsæœåŠ¡ï¼Œç„¶åæŠŠè¯ä¹¦å¯¼å‡ºï¼Œå°†è¯ä¹¦ä¸Šä¼ è‡³LinuxæœåŠ¡å™¨ã€‚ 4ã€å¯¼å…¥è¯ä¹¦ï¼Œéœ€è¦è¾“å…¥å¯†ç changeit 12$ /usr/local/jdk1.8/jre/lib/security# keytool -import -alias LL1 -keystore /usr/local/jdk1.8/jre/lib/security/cacerts -file /usr/local/jdk1.8/jre/lib/security/cloudtestkszx365com.crtEnter keystore password: changeit 5ã€å¯¼å…¥å®Œæˆåï¼Œé‡å¯åº”ç”¨ã€‚","link":"/2017/09/28/java/Jdk%E6%B7%BB%E5%8A%A0%E4%BF%A1%E4%BB%BB%E8%AF%81%E4%B9%A6/"},{"title":"å…³äºckeditorç¼–è¾‘å™¨å›¾ç‰‡ä¸Šä¼ ","text":"ä¸Šä¼ æ–¹æ³• 1234567891011121314151617181920212223242526272829@RequestMapping(value = \"/uploadCkImg\", method = RequestMethod.POST)@ResponseBodypublic void uploadImage(@RequestParam MultipartFile upload, @RequestParam String CKEditor,@RequestParam String CKEditorFuncNum,@RequestParam String langCode, HttpServletRequest request, HttpServletResponse response) { byte[] imgBytes = null; String callback = CKEditorFuncNum; response.setContentType(\"text/html;charset=UTF-8\"); response.setHeader(\"X-Frame-Options\", \"SAMEORIGIN\"); PrintWriter out = null; try { if (upload == null || upload.isEmpty()) { return ; } out = response.getWriter(); imgBytes = upload.getBytes(); CkImgData imgData = new CkImgData(); imgData.setImgData(imgBytes); imgData.setFileName(upload.getOriginalFilename()); imgData.setUploadTime(Utils.getTimeString(new Date())); jdbcService.save(imgData); // å›¾ç‰‡è®¿é—®è·¯å¾„ String imgurl =request.getContextPath() + \"/admin/imgfile/\" + imgData.getUid(); out.print(\"&lt;script type=\\\"text/javascript\\\"&gt;window.parent.CKEDITOR.tools.callFunction(\" + callback + \",'\" + imgurl + \"','');&lt;/script&gt;\"); } catch (Exception e) { out.println(\"&lt;script type=\\\"text/javascript\\\"&gt;window.parent.CKEDITOR.tools.callFunction(\" + callback + \",'',\" + \"'æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');&lt;/script&gt;\"); }} æ³¨æ„ï¼š1ã€è·¨åŸŸé—®é¢˜ã€‚2ã€è¿”å›çš„jsä»£ç ä¸æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ ã€‚ å‚è€ƒï¼šhttp://wolfgangkiefer.blog.163.com/blog/static/86265503201421954732369/responseè¦è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š 12response.setContentType(\"text/html;charset=UTF-8\");response.setHeader(\"X-Frame-Options\", \"SAMEORIGIN\"); 3ã€ä¸€ä¸ªé—®é¢˜ï¼Œæœ¬åœ°é€šè¿‡ip+ç«¯å£è¿›è¡Œä¸Šä¼ å›¾ç‰‡ï¼Œä¸€ç›´ä¸å›æ˜¾å›¾ç‰‡ï¼Œå³è¿”å›çš„jsä¸æ‰§è¡Œã€‚ä½†æ”¾åˆ°ç½‘ä¸Šç”¨åŸŸåå°±æ²¡æœ‰é—®é¢˜ã€‚ä¼°è®¡æ˜¯è·¨åŸŸé—®é¢˜ã€‚ è§£å†³ï¼š æŠŠä¸Šé¢çš„ response.setHeader(â€œX-Frame-Optionsâ€, â€œSAMEORIGINâ€); å»æ‰æˆ–è€…æ”¹æˆ response.setHeader(â€œX-Frame-Optionsâ€, â€œallow-from http://xxxip:xxxport/&quot;); è·å–å›¾ç‰‡æ–¹æ³• 12345678910111213141516171819202122@RequestMapping(value = \"/imgfile/{uid}\")public void getCkImgfile(@PathVariable String uid, HttpServletRequest request, HttpServletResponse response) { CkImgData ckImg = jdbcDao.getByUid(CkImgData.class, uid, \"imgData\"); byte[] imgData = ckImg.getImgData(); showImg(imgData, withDefault, request, response);}private void showImg(byte[] imgData, Integer withDefault, HttpServletRequest request, HttpServletResponse response) { try { if (imgData != null) { IOUtils.write(imgData, response.getOutputStream()); } else { if (withDefault != null &amp;&amp; withDefault.intValue() == 1) { IOUtils.write(FileUtils.readFileToByteArray(new File(request.getSession().getServletContext().getRealPath(\"/assets/defaultUser.png\"))), response.getOutputStream()); } else { response.sendError(HttpServletResponse.SC_NOT_FOUND); } } } catch (IOException ioe) { } } X-Frame-Options HTTPå“åº”å¤´X-Frame-Optionsæ˜¯ç”¨æ¥ç¡®è®¤æ˜¯å¦æµè§ˆå™¨å¯ä»¥åœ¨frameæˆ–iframeæ ‡ç­¾ä¸­æ¸²æŸ“ä¸€ä¸ªé¡µé¢ï¼Œç½‘ç«™å¯ä»¥ç”¨è¿™ä¸ªå¤´æ¥ä¿è¯ä»–ä»¬çš„å†…å®¹ä¸ä¼šè¢«åµŒå…¥åˆ°å…¶å®ƒç½‘ç«™ä¸­ï¼Œä»¥æ¥é¿å…ç‚¹å‡»åŠ«æŒã€‚ è¯­æ³•ï¼š X-Frame-Options DENY â€” è¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä¾¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­åµŒå¥—ä¹Ÿä¸å…è®¸ã€‚ X-Frame-Options SAMEORIGIN â€” è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„ frame ä¸­å±•ç¤ºã€‚ X-Frame-Options allow-from https://example.com/ â€” è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ frame ä¸­å±•ç¤ºã€‚ è¿˜æœ‰ä¸€ç§ï¼ˆå¯å‚è§ï¼‰ï¼š X-Frame-Options ALLOWALL â€”è¡¨ç¤ºå…è®¸ä»»ä½•ç«™ç‚¹ã€‚ åœ¨ nginxä¸­é…ç½®ï¼š è‹¥è¦é…ç½®nginxä»¥å‘é€X-Frame-Optionsæ ‡å¤´ï¼Œå°†å…¶æ·»åŠ åˆ°httpï¼Œserver æˆ– location é…ç½®ä¸­ 1add_header X-Frame-Options sameorigin; ä¹Ÿå¯åœ¨ä»£ç ä¸­åŠ å…¥: 1response.setHeader(\"X-Frame-Options\", \"allow-from http://example.com/\"); æ³¨æ„ï¼šchromeä¸æ”¯æŒ ALLOW-FROMï¼Œä¼šæœ‰å¦‚ä¸‹æç¤º,ä½†ä¸å½±å“ä½¿ç”¨ã€‚æµè§ˆå™¨å…¼å®¹æ€§ å‚è€ƒï¼šhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options","link":"/2017/11/22/java/ckeditor%E7%BC%96%E8%BE%91%E5%99%A8/"},{"title":"jasperreportsæŠ¥è¡¨å¯¼å‡º","text":"ä»Šå¤©é€šçŸ¥çº¿ä¸ŠæœåŠ¡jasperreportsæŠ¥è¡¨pdfæ˜¾ç¤ºæœ‰é—®é¢˜ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ 1net.sf.jasperreports.engine.util.JRFontNotFoundException: Font 'å®‹ä½“' is not available to the JVM. See the Javadoc for more details. æœ¬åœ°æ˜¯æ­£å¸¸çš„ï¼Œæœäº†ä¸‹è¯´å’ŒLinuxå­—ä½“æœ‰å…³ã€‚ æ‹·è´windowsä¸‹çš„å­—ä½“åˆ°Ubuntuç³»ç»Ÿä¸­ï¼ŒæŠŠå­—ä½“æ”¾åœ¨é¡¹ç›®class pathä¸‹ï¼Œéƒ½å°è¯•äº†ï¼Œæ²¡èƒ½è§£å†³é—®é¢˜ã€‚ ä¸‹é¢æ˜¯è§£å†³çš„è¿‡ç¨‹ æŠŠwindowsä¸‹çš„éœ€è¦çš„å­—ä½“(C:\\Windows\\Fonts)åˆ°Ubuntuç›®å½•/usr/share/fonts/TTF(ä¸å­˜åœ¨åˆ™æ–°å»º)ä¸‹ã€‚ ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 1234$ apt-get update$ apt install xfonts-utils$ mkfontdir$ fc-cache -fv æœ€åé‡å¯æœåŠ¡ï¼Œä¾¿æ­£å¸¸æ˜¾ç¤ºäº†ã€‚ å‚è€ƒï¼šUbuntuç³»ç»Ÿå®‰è£…å­—ä½“æ–¹æ³•","link":"/2019/12/28/java/jasperreports%E6%8A%A5%E8%A1%A8%E5%AD%97%E4%BD%93%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/"},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2017/07/30/hexo/Hello%20World/"},{"title":"luceneå…¨æ–‡æ£€ç´¢","text":"Luceneå„ç‰ˆæœ¬ï¼Œç¼–ç¨‹é£æ ¼ä¸åŒï¼Œæ­¤æ–‡ä»¥Lucene1.6.0ä¸ºå‡†ã€‚ Analyzerè¯­è¨€åˆ†æå™¨ï¼Œä¸»è¦ç”¨äºåˆ‡è¯å¤„ç†ã€‚ Analyzeræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæœ‰å¤šä¸ªå®ç°ã€‚StandardAnalyzerã€CJKAnalyzerã€SmartChineseAnalyzerã€BrazilianAnalyzerã€KeywordAnalyzerã€FrenchAnalyzerã€CzechAnalyzerã€GreekAnalyzerã€PersianAnalyzerã€StopAnalyzerã€RussianAnalyzerã€ThaiAnalyzerã€WhitespaceAnalyzerã€‚ æ ¹æ®ä¸åŒçš„è¯­è¨€å’Œåº”ç”¨é€‰æ‹©åˆé€‚çš„Analyzerï¼ŒAnalyzeræŠŠåˆ†è¯åçš„å†…å®¹äº¤ç»™IndexWriteræ¥å»ºç«‹ç´¢å¼•ã€‚ Documentdocumentç±»ä¼¼æ•°æ®åº“ä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¯ä»¥æœ‰å¥½å‡ ä¸ªå­—æ®µï¼ˆFiledï¼‰ç»„æˆï¼Œå¹¶ä¸”å­—æ®µå¯ä»¥å¥—ç”¨ä¸åŒçš„ç±»å‹ã€‚ æœªå®Œï¼ï¼ï¼ ç»ƒä¹  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899package com.flexcms.utils;import java.io.IOException;import org.apache.lucene.analysis.standard.StandardAnalyzer;import org.apache.lucene.document.Document;import org.apache.lucene.document.Field;import org.apache.lucene.document.StringField;import org.apache.lucene.document.TextField;import org.apache.lucene.index.DirectoryReader;import org.apache.lucene.index.IndexReader;import org.apache.lucene.index.IndexWriter;import org.apache.lucene.index.IndexWriterConfig;import org.apache.lucene.queryparser.classic.ParseException;import org.apache.lucene.queryparser.classic.QueryParser;import org.apache.lucene.search.IndexSearcher;import org.apache.lucene.search.Query;import org.apache.lucene.search.ScoreDoc;import org.apache.lucene.search.TopScoreDocCollector;import org.apache.lucene.store.Directory;import org.apache.lucene.store.RAMDirectory;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;import org.topcloud.modules.mongodb.dao.MongoDao;import com.trainhelper.config.AppConfig; public class HelloLucene { // static MongoDao mongoDao; static Directory index; public static void main(String[] args) throws IOException, ParseException { ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);// mongoDao = (MongoDao) ac.getBean(\"mongoDao\"); index = (Directory)ac.getBean(\"cmsIndexDirectory\"); // 0. Specify the analyzer for tokenizing text. // The same analyzer should be used for indexing and searching StandardAnalyzer analyzer = new StandardAnalyzer();// CJKAnalyzer analyzer = new CJKAnalyzer(); // 1. create the index Directory index = new RAMDirectory(); IndexWriterConfig config = new IndexWriterConfig(analyzer); IndexWriter w = new IndexWriter(index, config); addDoc(w, \"Lucene in Action\", \"193398817\"); addDoc(w, \"Lucene for Dummies\", \"55320055Z\"); addDoc(w, \"Managing Gigabytes\", \"55063554A\"); addDoc(w, \"The Art of Computer Science\", \"9900333X\"); w.close(); // 2. query String querystr = args.length &gt; 0 ? args[0] : \"Lucene\"; // BooleanQuery.Builder builder = new BooleanQuery.Builder();// Query q = new QueryParser( \"title\", analyzer).createBooleanQuery(\"title\", querystr, Occur.MUST); // Query query1 = new TermQuery(new Term(\"title\", querystr));// Query query2 = new TermQuery(new Term(\"title\", \"ä¸‰\"));// BooleanClause bc1 = new BooleanClause(query1, Occur.MUST);// BooleanClause bc2 = new BooleanClause(query2, Occur.MUST_NOT);// BooleanQuery boolQuery = new BooleanQuery.Builder().add(bc1).add(bc2).build();// builder.add(new TermQuery(new Term(\"title\", querystr)), Occur.MUST); // the \"title\" arg specifies the default field to use // when no field is explicitly specified in the query. Query q = new QueryParser( \"title\", analyzer).parse(querystr); // 3. search int hitsPerPage = 10; IndexReader reader = DirectoryReader.open(index); IndexSearcher searcher = new IndexSearcher(reader); TopScoreDocCollector collector = TopScoreDocCollector.create(hitsPerPage); searcher.search(q, collector); ScoreDoc[] hits = collector.topDocs().scoreDocs; // 4. display results System.out.println(\"Found \" + hits.length + \" hits.\"); for(int i=0;i&lt;hits.length;++i) { int docId = hits[i].doc; Document d = searcher.doc(docId); System.out.println((i + 1) + \". \" + d.get(\"isbn\") + \"\\t\" + d.get(\"title\")); } // reader can only be closed when there // is no need to access the documents any more. reader.close(); } private static void addDoc(IndexWriter w, String title, String isbn) throws IOException { Document doc = new Document(); doc.add(new TextField(\"title\", title, Field.Store.YES)); // use a string field for isbn because we don't want it tokenized doc.add(new StringField(\"isbn\", isbn, Field.Store.YES)); w.addDocument(doc); }}","link":"/2017/10/16/java/lucene%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/"},{"title":"MD5 salt åŠ å¯†","text":"MD5 salt åŠ å¯† 12345678910111213141516171819202122232425262728293031import java.math.BigInteger;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import org.apache.commons.codec.digest.DigestUtils;public class MD5Utils { /** * ä½¿ç”¨md5çš„ç®—æ³•è¿›è¡ŒåŠ å¯† */ public static String md5(String plainText) { byte[] secretBytes = null; try { secretBytes = MessageDigest.getInstance(\"md5\").digest(plainText.getBytes()); } catch (NoSuchAlgorithmException e) { throw new RuntimeException(\"æ²¡æœ‰md5è¿™ä¸ªç®—æ³•ï¼\"); } String md5code = new BigInteger(1, secretBytes).toString(16);// 16è¿›åˆ¶æ•°å­— // å¦‚æœç”Ÿæˆæ•°å­—æœªæ»¡32ä½ï¼Œéœ€è¦å‰é¢è¡¥0 for (int i = 0; i &lt; 32 - md5code.length(); i++) { md5code += \"0\"; } return md5code; } public static void main(String[] args) { System.out.println(md5(\"123456\")); System.out.println(md5(\"123456{123456}\")); System.out.println(DigestUtils.md5Hex(\"123456\"+\"{123456}\")); }} DigestUtils.md5Hex(password+salt);//å¯†ç ä½¿ç”¨MD5åŠ å¯†,DigestUtilså·¥å…·ç±» å…¶ä¸­saltç”¨äºæ··æ·†çš„ï¼Œä¸€èˆ¬å–ç”¨æˆ·ä¸å˜çš„ä¿¡æ¯ï¼Œå¦‚èº«ä»½è¯å·ç ","link":"/2019/08/26/java/md5%E5%8A%A0%E5%AF%86/"},{"title":"jasperreportsæŠ¥è¡¨å¯¼å‡º","text":"ä¸€ã€å¯¼å‡ºPDFJARåŒ…çš„ä¾èµ–jasperreports-6.4.3.jarã€jasperreports-chart-themes-6.4.3.jarã€jasperreports-fonts-6.4.3.jarã€jasperreports-functions-6.4.3.jarã€commons-collections-3.2.1.jarã€commons-digester-2.1.jarã€joda-time_2.1.0.jarã€itext-2.1.7.js6.jarã€iTextAsian.jar 1ã€PDFä¸­æ–‡å­—ä½“æ˜¾ç¤ºé—®é¢˜åœ¨.jrxmlæ–‡ä»¶ä¸­çš„Sourceé€‰é¡¹å¡çš„åé¢åŠ ä¸Š 1&lt;style name=&quot;myStyle&quot; isDefault=&quot;true&quot; pdfFontName=&quot;STSong-Light&quot; pdfEncoding=&quot;UniGB-UCS2-H&quot; isPdfEmbedded=&quot;true&quot;/&gt; 2ã€PDFä¸­åŒ…å«å›¾ç‰‡é—®é¢˜å›¾ç‰‡çš„urlå¿…é¡»æ˜¯ä¸€ä¸ªç¡®å®šçš„urlå›¾ç‰‡è·¯å¾„å¦‚ï¼šhttp://jasperreports.sourceforge.net/jasperreports.png 1234567891011121314151617181920212223242526272829303132333435363738394041424344@RequestMapping(value = &quot;/contestEnrollReport/{contesterProjectUid}&quot;)public void contestEnrollReport(@PathVariable String contesterProjectUid,HttpServletRequest request, HttpServletResponse response) throws IOException { ScContesterProject contesterProject = mongoDao.getByUid(ScContesterProject.class, contesterProjectUid, null); ScContestProject contestProject = mongoDao.get(ScContestProject.class, contesterProject.getContestProjectId(), &quot;title&quot;); ScContester contester = mongoDao.get(ScContester.class, contesterProject.getContesterId(), &quot;id,uid,imgVer&quot;); File dir = TransferUtils.getStoreDir(SessionCookieUser.getSessionUserId().toString(), &quot;simg&quot;);//åœ¨ä¸´æ—¶ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¤¹ ImgData contesterImg = mongoDao.get(ImgData.class, SkillContestUtils.IMGTYPE_CONTESTER+&quot;_&quot;+contester.getUid(), null); byte[] imgData; if (contesterImg != null) { imgData = contesterImg.getData(); }else { imgData = Utils.getFileData(request, &quot;/default/headImg.png&quot;); } FileUtils.writeByteArrayToFile(new File(dir, contester.getUid()+&quot;.png&quot;), imgData); InputStream is = null; String fileDir = dir+&quot;\\\\&quot;+contester.getUid()+&quot;.png&quot;; List&lt;Object&gt; contestEnrollDtos= new ArrayList&lt;&gt;(); ScContestEnrollDto contestEnrollDto = new ScContestEnrollDto(contestProject.getTitle() ,contesterProject, fileDir); resolveCardId(contestEnrollDto); contestEnrollDtos.add(contestEnrollDto); ServletContext context = request.getSession().getServletContext(); File reportFile = new File(context.getRealPath(&quot;/jasperReports/ContestEnroll.jasper&quot;));//é€‰æ‰‹æŠ¥åè¡¨ try { SimpleXlsReportConfiguration configuration = new SimpleXlsReportConfiguration(); configuration.setAutoFitPageHeight(true); File targetFile = skillContestService.processReport(contestEnrollDtos, reportFile,configuration); is = new FileInputStream(targetFile); response.setContentType(&quot;application/pdf&quot;); String fileName = &quot;ç¬¬45å±Šä¸–ç•ŒæŠ€èƒ½å¤§èµ›æ¹–åŒ—çœé€‰æ‹”èµ›é€‰æ‰‹æŠ¥åè¡¨.pdf&quot;; response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + new String(fileName.getBytes(&quot;utf-8&quot;), &quot;ISO8859-1&quot;)); IOUtils.copy(is, response.getOutputStream()); } catch (Exception e) { e.printStackTrace(); } finally { if (is != null) { is.close(); } }} 12345678910111213141516171819202122public File processReport(List&lt;Object&gt; tableDto, File reportFile, SimpleXlsReportConfiguration configuration) throws Exception { JRDataSource datasource = new JRBeanCollectionDataSource(tableDto); Map&lt;String, Object&gt; parameters = new HashMap&lt;&gt;(); File targetFile = new File(TransferUtils.getStoreDir(SessionCookieUser.getSessionUserId().toString(), &quot;simge&quot;) + &quot;\\\\test.pdf&quot;); InputStream in = new FileInputStream(reportFile); JasperPrint jasperPrint; jasperPrint = JasperFillManager.fillReport(in, parameters, datasource);// byte[] bytes = JasperRunManager.runReportToPdf(in, parameters, datasource);// JRXlsExporter exporter = new JRXlsExporter(); JRPdfExporter exporter = new JRPdfExporter(); exporter.setExporterInput(new SimpleExporterInput(jasperPrint)); exporter.setExporterOutput(new SimpleOutputStreamExporterOutput(targetFile)); configuration.setRemoveEmptySpaceBetweenColumns(true); configuration.setRemoveEmptySpaceBetweenRows(true); configuration.setOnePagePerSheet(false);// configuration.setAutoFitPageHeight(true);// exporter.setConfiguration(configuration); exporter.exportReport(); return targetFile;} å…¶å®ƒè®¾ç½®æ¡ä»¶ æ˜¯å¦æ˜¾ç¤ºæŸå…ƒç´ åœ¨advancedä¸­é€‰æ‹©print when expressionï¼Œåœ¨å¼¹å‡ºæ¡†è®¾ç½®æ¡ä»¶ã€‚å¦‚ï¼šnew java.lang.Boolean($P{parameter1}.equals(â€œ1â€))ã€‚æ¡ˆä¾‹ï¼šå¯ä»¥å®ç°å¤é€‰æ¡†åŠŸèƒ½ã€‚å¯å‚è€ƒï¼šhttp://blog.csdn.net/sinat_24702667/article/details/50867691","link":"/2017/12/06/java/jasperreports%E6%8A%A5%E8%A1%A8%E5%AF%BC%E5%87%BA/"},{"title":"åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ—¥æœŸç±»å‹","text":"12345678910111213public static boolean isDateString(String datevalue, String dateFormat) { try { SimpleDateFormat sdf = new SimpleDateFormat(dateFormat); Date date = sdf.parse(datevalue); if (datevalue.equals(sdf.format(date))) { return true; } else { return false; } } catch (Exception e) { return false; } }","link":"/2018/08/10/java/%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%AF%E5%90%A6%E4%B8%BA%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B/"},{"title":"ç¬¬ä¸‰æ–¹æˆæƒ-QQ","text":"QQç¬¬ä¸‰æ–¹æˆæƒ ç”³è¯·appidå’Œappkeyç”³è¯·åœ°å€ è·å–æˆæƒ åœ¨å‰å°ç‚¹å‡»qqç™»å½•æ—¶å»è¯·æ±‚ 1https://graph.qq.com/oauth2.0/authorize?response_type=code&amp;client_id=[YOUR_APPID]&amp;redirect_uri=[YOUR_REDIRECT_URI]&amp;scope=[THE_SCOPE] 3ã€é€šè¿‡Authorization Codeè·å–Access Tokené€šè¿‡å›è°ƒè·å¾—çš„code å‘é€è¯·æ±‚ 1https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&amp;client_id= [YOUR_APP_ID]&amp;client_secret=[YOUR_APP_Key]&amp;code=[The_AUTHORIZATION_CODE]&amp;state=[The_CLIENT_STATE]&amp;redirect_uri=[YOUR_REDIRECT_URI] 4ã€ä½¿ç”¨Access Tokenæ¥è·å–ç”¨æˆ·çš„OpenID å‘é€è¯·æ±‚ 1https://graph.qq.com/oauth2.0/me?access_token=YOUR_ACCESS_TOKEN 5ã€ä½¿ç”¨Access Tokenä»¥åŠOpenIDæ¥è®¿é—®ç”¨æˆ·æ•°æ® 1https://graph.qq.com/user/get_user_info?access_token=YOUR_ACCESS_TOKEN&amp;oauth_consumer_key=YOUR_APP_ID&amp;openid=YOUR_OPENID å‚è€ƒæ–‡æ¡£ï¼šhttp://wiki.connect.qq.com/%e5%bc%80%e5%8f%91%e6%94%bb%e7%95%a5_server-side å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒç™»å½•","link":"/2018/05/30/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%88%E6%9D%83-QQ/"},{"title":"tomcatå•æœºå¤šå®ä¾‹éƒ¨ç½²","text":"å¤šå®ä¾‹éƒ¨ç½²tomcatï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæ–¹ä¾¿tomcatçš„æ›´æ–°ã€å‡çº§ç»´æŠ¤ã€‚tomcatå®ä¾‹ç»Ÿä¸€æŒ‡å‘åŒä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥å¤šä¸ªtomcatç”¨ä¸€ä»½åº”ç”¨æºç ï¼Œç®€å•éƒ¨ç½²ï¼Œå•æœºé«˜å¯ç”¨ä¹Ÿèƒ½å®ç°ï¼ˆè¦é…åˆnginxï¼‰ã€‚ 1ã€ä¸‹è½½tomcatï¼Œå¹¶è§£å‹,æ¯”å¦‚æ”¾åœ¨/usr/local/tomcatç›®å½•ä¸‹ï¼Œä½œä¸ºtomcatç¨‹åºä¸»ä½“å­˜æ”¾ä½ç½®ã€‚å»ºè®®ä¿ç•™binï¼Œlibå’Œwebappsç›®å½•ã€‚å‰ä¸¤ä¸ªç›®å½•å¿…é¡»æœ‰ï¼Œå› ä¸ºå…¶å®ƒå®ä¾‹éƒ½ç”¨è¿™ä¸¤ä¸ªç›®å½•çš„ç¨‹åºã€‚webappsçš„æ„ä¹‰æ˜¯å¯ä»¥ä¾›å…¶å®ƒå®ä¾‹å¼•ç”¨éœ€è¦éƒ¨ç½²çš„webappï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ä¸€ä»½webappçš„ä»£ç å³å¯ï¼Œæ— é¡»copyå¾ˆå¤šä»½ã€‚ 12$ tar -zxvf apache-tomcat-9.0.0.M17.tar.gz$ mv apache-tomcat-9.0.0.M17 /usr/local/tomcat 2ã€åˆ›å»º2ä¸ªtomcatå®ä¾‹ç›®å½•åœ¨/usr/local/tomcat_instanceï¼š 12$ mkdir -p /usr/local/tomcat_instance/tomcat1$ mkdir -p /usr/local/tomcat_instance/tomcat2 3ã€æ‹·è´tomcatä¸»ä½“ç›®å½•ä¸‹çš„confç›®å½•åˆ°å®ä¾‹ä¸­å¦å¤–ï¼Œlogs,work,temp,webappsä¿ç•™ä¸ºç©ºç›®å½•å³å¯ã€‚webappsç›®å½•å­˜åœ¨çš„æ„ä¹‰æ˜¯æœ¬å®ä¾‹ç‹¬ç«‹éƒ¨ç½²çš„webappï¼Œå¤šå®ä¾‹å…±äº«çš„è¿˜æ˜¯å»ºè®®æ”¾åœ¨ä¸€ä¸ªå…¬ç”¨ç›®å½•ä¸‹ã€‚ 12$ cp -R /usr/local/tomcat/conf /usr/local/tomcat_instance/tomcat1$ cp -R /usr/local/tomcat/conf /usr/local/tomcat_instance/tomcat2 4ã€åœ¨tomcatå®ä¾‹ä¸‹åˆ›å»ºå¯åŠ¨å’Œåœæ­¢è„šæœ¬å¯åŠ¨å’Œåœæ­¢è„šæœ¬æ”¾åˆ°tomcatå®ä¾‹çš„binç›®å½•ä¸‹ å¯åŠ¨è„šæœ¬vim /usr/local/tomcat_instance/tomcat1/bin/startup.sh12345678910111213141516171819#!/bin/bashexport CATALINA_HOME=/usr/local/tomcatexport CATALINA_BASE=/usr/local/tomcat_instance/tomcat1export CATALINA_TMPDIR=$CATALINA_BASE/tempexport CATALINA_PID=$CATALINA_BASE/bin/tomcat.pidexport JAVA_OPTS=&quot;-server -Xms1024m -Xmx1024m -Djava.awt.headless=true -Dtomcat.name=tomcat1&quot;#åˆ›å»ºlogsç›®å½•if [ ! -d &quot;$CATALINA_BASE/logs&quot; ]; then mkdir $CATALINA_BASE/logsfi#åˆ›å»ºtempç›®å½•if [ ! -d &quot;$CATALINA_BASE/temp&quot; ]; then mkdir $CATALINA_BASE/tempfi# è°ƒç”¨tomcatå¯åŠ¨è„šæœ¬bash $CATALINA_HOME/bin/startup.sh &quot;$@&quot; åœæ­¢è„šæœ¬vim /usr/local/tomcat_instance/tomcat1/bin/shutdown.sh1234567#!/bin/bashexport CATALINA_HOME=/usr/local/tomcatexport CATALINA_BASE=/usr/local/tomcat_instance/tomcat1export CATALINA_TMPDIR=$CATALINA_BASE/tempexport CATALINA_PID=$CATALINA_BASE/bin/tomcat.pidbash $CATALINA_HOME/bin/shutdown.sh &quot;$@&quot; 5ã€ä¿®æ”¹å®ä¾‹ä¸­server.xmlç«¯å£åŠåº”ç”¨æŒ‡å‘ç›®å½•1234567891011&lt;Server port=&quot;9105&quot; shutdown=&quot;SHUTDOWN&quot;&gt; .... &lt;Connector port=&quot;9100&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; ....&lt;Connector port=&quot;9109&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; .... &lt;Host name=&quot;localhost&quot; appBase=&quot;/usr/local/tomcat/tomcat/webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; .... æ³¨æ„:ä¿®æ”¹server.xmlä¸­HostèŠ‚ç‚¹çš„appBaseå±æ€§çš„å€¼ã€‚6ã€å¯åŠ¨æœåŠ¡12$ /usr/local/tomcat_instance/tomcat1/bin/startup.sh$ /usr/local/tomcat_instance/tomcat2/bin/startup.sh æœåŠ¡å™¨å¯åŠ¨ä¹‹åï¼Œä¼šåˆ†åˆ«åœ¨ç›¸åº”çš„å®ä¾‹ç›®å½•ä¸‹ç”Ÿæˆlogsã€tempã€workå’Œwebappsç›®å½•ã€‚å¦å¤–ä¹Ÿå¯ä»¥åœ¨å®ä¾‹ç›®å½•ä¸‹åˆ›å»ºlibç›®å½•ï¼Œç”¨äºå­˜æ”¾appçš„jarã€‚ç°åœ¨æ¥çœ‹å®ä¾‹çš„å®‰è£…ç›®å½•ï¼Œå°±å’Œtomcatçš„å®‰è£…åŒ…è§£å‹åçš„ç›®å½•ç»“æ„ä¸€æ ·äº†ï¼Œä½†æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€å¥—tomcatå®‰è£…ç¨‹åºçš„binå’Œlibã€‚åé¢å¦‚æœéœ€è¦å‡çº§tomcatæˆ–ä¿®æ”¹tomcatè„šæœ¬çš„ç›¸å…³é…ç½®ï¼Œåªéœ€è¦æ›´æ–°è¿™ä¸€å¥—ç¨‹åºå°±è¡Œï¼Œä¹Ÿæ–¹ä¾¿äº†æ—¥åçš„ç»´æŠ¤ã€‚å‚è€ƒï¼šhttp://blog.csdn.net/xyang81/article/details/51997053","link":"/2017/11/17/java/tomcat%E5%8D%95%E6%9C%BA%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/"},{"title":"Linuxå‘½ä»¤ä¹‹å…¶å®ƒ","text":"æŸ¥çœ‹javaçš„å¹¶å‘æ•°ï¼šnetstat -np|grep java|wc -l ä¸¤æ–‡ä»¶å¤¹åŒæ­¥ï¼š rsync -ru â€“progress â€“delete /opt/rsync_test/f1/ /opt/rsync_test/f2/","link":"/2017/08/31/linux/Linux%E5%91%BD%E4%BB%A4%E4%B9%8B%E5%85%B6%E5%AE%83/"},{"title":"UbuntuServer18å®‰è£…","text":"è®¾ç½®é™æ€IP https://my.oschina.net/u/3264690/blog/1811424 å¼€å¯rootç™»å½• https://www.cnblogs.com/longchang/p/11226236.html æ›´æ–°è½¯ä»¶æºåŠå‡çº§ç‰ˆæœ¬ 12$ apt update$ apt upgrade ç£ç›˜æŒ‚è½½ https://help.aliyun.com/document_detail/116650.html?spm=5176.11065259.1996646101.searchclickresult.7c222b88yoD7P7&amp;aly_as=1K_0_fkc mongodbå®‰è£… wifié…ç½® https://www.cnblogs.com/floud/p/10545924.html wifiä¸ç¨³å®š https://blog.csdn.net/vivian_wanjin/article/details/82928315 redis å®‰è£… https://www.cnblogs.com/ftl1012/p/9426231.html jenkisè¿ç§» https://segmentfault.com/a/1190000019505621","link":"/2019/11/11/linux/UbuntuServer18%E5%AE%89%E8%A3%85/"},{"title":"Ubuntuä¸‹é…ç½®rsync","text":"ç›®æ ‡ï¼šå®ç°å®¢æˆ·ç«¯å¼€æœºè‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯æŸä¸ªæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶ æœåŠ¡ç«¯1ã€æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦å·²ç»å®‰è£…rsync 12$ whereis rsyncrsync: /usr/bin/rsync /usr/share/man/man1/rsync.1.gz #è¯´æ˜å·²ç»å®‰è£…å¦åˆ™ï¼ˆapt-get install rsyncï¼‰ 2ã€ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¼€å¯rsync vim /etc/default/rsync 1RSYNC_ENABLE=true #æŠŠfalseæ”¹ä¸ºtrue 3ã€åˆ›å»ºrsyncd.conf 1$ cp /usr/share/doc/rsync/examples/rsyncd.conf /etc/ vim /etc/rsyncd.conf 1234567891011121314151617# GLOBAL OPTIONS strict modes = yes#motd file=/etc/motd port = 873 log file=/var/log/rsyncd.log pid file=/var/run/rsyncd.pid auth users =cpnsp_rsyncd secrets file = /etc/rsyncd.secrets# for pid file, do not use /var/run/rsync.pid if# you are going to run rsync out of the init.d script.# The init.d script does its own pid file handling,# so omit the \"pid file\" line completely in that case.#syslog facility=daemon#socket options=# MODULE OPTIONS[cpnsp_static] path = /usr/local/nginx/html è¯´æ˜ï¼šauth users é…åˆ¶ä¸€å®šè¦å’Œ/etc/rsyncd.secretsé‡Œçš„ç”¨æˆ·åä¿æŒä¸€è‡´ã€‚ è¦å¤‡ä»½çš„æ¯ä¸ªè·¯å¾„ä¸ºä¸€ä¸ªmoduleï¼Œå¯å¤šä¸ªã€‚ 4ã€æ–°å»ºå¯†ç æ–‡ä»¶/etc/rsyncd.secrets 1cpnsp_rsyncd:admin123 ç”¨æˆ·åä¸ºcpnsp_rsyncdï¼Œå¯†ç ä¸ºadmin123ï¼Œæ³¨æ„è¯¥æ–‡ä»¶å±æ€§ä¸º600 (å…¶ä»–ç”¨æˆ·æ²¡ç”¨è¯»å†™æ‰§è¡Œæƒé™) 5ã€å¼€å¯rsyncæœåŠ¡ 1$ /etc/init.d/rsync start å¯ç”¨netstat -tuplnæŸ¥çœ‹873ç«¯å£æœ‰æ²¡æœ‰æ‰“å¼€ã€‚ å®¢æˆ·ç«¯1ã€åœ¨~ä¸‹æ–°å»ºrsyncå·¥ä½œç›®å½• 2ã€åœ¨å·¥ä½œç›®å½•å†…åˆ›å»ºå¯†ç æ–‡ä»¶rsyncd.scrt 1cpnsp_rsyncd:admin123 å†…å®¹å’ŒæœåŠ¡å™¨ç«¯ä¿æŒä¸€æ ·ï¼Œå±æ€§ä¹Ÿä¸º600ã€‚ 3ã€åœ¨å·¥ä½œç›®å½•åˆ›å»ºclient.conf 1234567891011121314# this is a configure file for client backup machine# NOTE:# OPTIONS=\"-vazu --progreess --delete\"# client will backup all same files at server# when server delete a specific file, client also delete it.# and OPTIONS=\"-vazu --progress\"# client will keep server deleted files# MODULE responding to [modules] in server, seperated by space# BACKUPPATH client backup pathBACKUPPATH=\"/root/\";SERVERIP=\"192.168.1.26\"MODULE=\"cpnsp_static\"#OPTIONS=\"-vazu --progress\"OPTIONS=\"-vazu --progress --delete\" è¯´æ˜ï¼šå…¶ä¸­BACKUPPATHä¸ºå®¢æˆ·ç«¯åŒæ­¥æ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚ MODULEå¯¹åº”æœåŠ¡ç«¯/etc/rsyncd.confä¸‹çš„moduleï¼Œå¤šä¸ªmoduleä»¥ç©ºæ ¼åˆ†å¼€ã€‚ 4ã€åˆ›å»ºåŒæ­¥è„šæœ¬rsyncclient.sh 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#!/bin/bashABSPATH=$(dirname $0)source ${ABSPATH}/client.conffunction get-user-pwd(){#obtain usrname and password iUSR=$(cat ${ABSPATH}/rsyncd.scrt|tr -d ' ' |grep -v \"^$\" | \\ grep -v \"^#\"|head -n 1|awk -F : '{print $1}') iPWD=$(cat ${ABSPATH}/rsyncd.scrt|tr -d ' ' |grep -v \"^$\" | \\ grep -v \"^#\"|head -n 1|awk -F : '{print $2}') if [ -z ${iUSR} ] || [ -z ${iPWD} ];then echo \"iUSR=$iUSR iPWD=$iPWD\" echo \"rsyncd.scrt format illegal, please check!\"; exit -1; fi# produce password file echo \"$iPWD\" &gt; ${ABSPATH}/.pass chmod 600 ${ABSPATH}/.pass [ ! -d $BACKUPPATH ] &amp;&amp; mkdir -p ${BACKUPPATH}}function backup-module(){# print key information iModule=$1 echo echo \"---------------------------------------------------\" echo \"---- backup module ${iModule}@${SERVERIP} begin \" echo \"---- TIME=`date`----\" echo \"ABSPATH=${ABSPATH}\" echo \"BACKUPPATH=${BACKUPPATH}\" echo \"iUSR=$iUSR iPWD=$iPWD\" echo \"OPTIONS=${OPTIONS}\" iModuleBackpath=${BACKUPPATH}/${iModule}; [ ! -d ${iModuleBackpath} ] &amp;&amp; mkdir -p ${iModuleBackpath}# begin backup rsync ${OPTIONS} ${iUSR}@${SERVERIP}::${iModule} ${iModuleBackpath} \\ --password-file=${ABSPATH}/.pass if [ $? != 0 ];then echo \"---- backup module ${iModule}@${SERVERIP} failed.\" else echo \"---- backup module ${iModule}@${SERVERIP} succuess. \" fi echo \"---- TIME=`date`----\" echo \"---------------------------------------------------\" echo}function __main__(){ get-user-pwd for md in $MODULE do backup-module $md done}__main__ chmod a+x rsyncclient.sh 5ã€ è¿è¡Œ./rsyncclient.shï¼Œå°±æŠŠæœåŠ¡ç«¯/usr/local/nginx/htmlä¸‹çš„æ–‡ä»¶åŒæ­¥åˆ°/root/cpnsp_statiä¸‹ã€‚ 6ã€æ–°å»ºå¼€æœºå¯åŠ¨è„šæœ¬ vim /etc/init.d/rsync_cpnsp 12345#!/bin/bashcd /root/html/./rsyncclient.shsleep 2/etc/init.d/tomcat8080 start 123$ chmod a+x rsync_cpnsp$ update-rc.d rsync_cpnsp defaults$ update-rc.d -f tomcat8080 remove åº”ç”¨ï¼š å®ç°ç›’å­çš„æœåŠ¡ã€æ‰‹æœºç«¯è€ƒè¯•åŠPCç«¯è€ƒè¯•çš„è‡ªåŠ¨æ›´æ–° å‰æï¼šç›’å­å¿…é¡»åœ¨è”ç½‘çŠ¶æ€ä¸‹ å¯é€šè¿‡rsyncå®ç°ç›’å­ä¸­æœåŠ¡å’Œå‰ç«¯æ–‡ä»¶ä¸æœåŠ¡ç«¯è¿›è¡ŒåŒæ­¥ã€‚ å› é¿å…åœ¨è€ƒè¯•çŠ¶æ€ä¸‹æœåŠ¡æ›´æ–°çš„å½±å“ï¼Œæ‰€ä»¥åªåœ¨å¼€æœºæ—¶è¿›è¡ŒåŒæ­¥ã€‚ å®ç°ï¼š . åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šåˆ›å»ºç›’å­ä¸­æ‰€éœ€çš„æœåŠ¡åŠå‰ç«¯æ–‡ä»¶ã€‚. é…ç½®rsyncåŠå¼€å¯rsyncæœåŠ¡ã€‚. åœ¨ç›’å­ä¸­åˆ›å»ºé€šä¿¡æ–‡ä»¶åŠrsyncåŒæ­¥è„šæœ¬ã€‚. åˆ›å»ºå¼€æœºå¯åŠ¨è„šæœ¬ã€‚ å‚è€ƒï¼š http://www.linuxidc.com/Linux/2014-03/97592.htm http://blog.csdn.net/zpf336/article/details/51659666 rsyncå‚æ•°ï¼šhttp://roclinux.cn/?p=2643","link":"/2017/08/24/linux/Ubuntu%E4%B8%8B%E9%85%8D%E7%BD%AErsync/"},{"title":"Ubuntu è®¾ç½®å¼€æœºè‡ªå¯åŠ¨","text":"è®¾ç½®ç¨‹åºè‡ªå¯åŠ¨æˆ–è„šæœ¬å¼€æœºæ‰§è¡Œï¼Œæ˜¯ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªåœºæ™¯ã€‚ initåŸºæœ¬è¯´æ˜1ã€initæ˜¯å†…æ ¸åœ¨ç³»ç»Ÿå¼•å¯¼æœŸé—´å¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œåœ¨/sbinç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°init,å®ƒä¸»è¦å¤åˆ¶å¯åŠ¨å’Œç»ˆæ­¢ç³»ç»Ÿä¸­çš„åŸºç¡€æœåŠ¡è¿›ç¨‹ã€‚ 2ã€Linuxä¸­å‘å¸ƒäº†è®¸å¤šinitç³»ç»Ÿç‰ˆæœ¬ï¼Œè¢«å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªã€‚ initç±»å‹ è¯´æ˜ è¯†åˆ« Systemd systemdæ˜¯Linuxæ“ä½œç³»ç»Ÿçš„æ–°çš„initç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ã€‚ å¾ˆå¤šlinuxå‘è¡Œç‰ˆéƒ½å·²ç»æˆ–è€…è®¡åˆ’è½¬å‘Systemd å¦‚æœåœ¨ç³»ç»Ÿç›®å½•æ–‡ä»¶ä¸­æœ‰/usr/lib/systemdå’Œ/etc/systemd,è¯´æ˜æœ‰systemd Upstart Upstartæ˜¯/sbin/initå®ˆæŠ¤ç¨‹åºçš„åŸºäºäº‹ä»¶çš„æ›¿æ¢ã€‚ ç³»ç»Ÿç›®å½•æœ‰/etc/init,è€Œä¸”å…¶ä¸­æœ‰è®¸å¤šconfæ–‡ä»¶,è¯´æ˜ç³»ç»Ÿæœ‰upstart System V init æ˜¯UNIX / Linuxæ“ä½œç³»ç»Ÿçš„æœ€æ—©çš„ä¼ ç»Ÿåˆå§‹åŒ–ç³»ç»Ÿä¹‹ä¸€ï¼Œå¤§å¤šæ•°çš„linuxå‘è¡Œç‰ˆéƒ½ä¼šå…¼å®¹ã€‚ ç³»ç»Ÿæœ‰/etc/inittabæ–‡ä»¶,è¯´æ˜å¾ˆæœ‰å¯èƒ½æ˜¯System V init å…³äºinitç±»å‹çš„è¯†åˆ«å¯å‚è€ƒï¼šhow-to-determine-which-init-system-manager-is-running-on-linux-system ä¸‹é¢æ˜¯å‡ ç§è®¾ç½®è‡ªå¯åŠ¨çš„æ–¹å¼ systemdsystemdæ˜¯ä¸€ä¸ªæ–°çš„initç³»ç»Ÿå’Œç³»ç»Ÿç®¡ç†å™¨ï¼Œç°åœ¨å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆéƒ½åœ¨ä¼ ç»Ÿçš„SysVinitç®¡ç†å™¨ä¸Šé‡‡ç”¨äº†systemdã€‚ä¸åœ¨ä½¿ç”¨Upstart ç®¡ç†ç³»ç»Ÿã€‚ systemctlæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œæ˜¯ç®¡ç†systemdå®ˆæŠ¤ç¨‹åº/æœåŠ¡çš„ä¸»è¦å·¥å…·ï¼Œå…è®¸ç”¨æˆ·å¯åŠ¨ï¼Œé‡æ–°å¯åŠ¨ï¼Œåœæ­¢ï¼Œå¯ç”¨ï¼Œç¦ç”¨ï¼Œé‡æ–°åŠ è½½å’ŒéªŒè¯æœåŠ¡(start, restart, stop, enable, disable, reload, and verify )ã€‚ systemd é»˜è®¤è¯»å– /etc/systemd/system ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šé“¾æ¥/lib/systemd/system/ä¸‹çš„æ–‡ä»¶ã€‚ å½“ä½¿ç”¨systemdç®¡ç†ç¨‹åºæ—¶ï¼Œé¦–å…ˆç¼–å†™xxx.serviceæ–‡ä»¶ï¼Œxxx.serviceçš„ç¼–å†™å¯å‚è€ƒï¼šsystemd-tutorial ç„¶åå°±å¯ä½¿ç”¨systemctl è¿›è¡Œç®¡ç† 1234567891011$ systemctl start example #å¼€å§‹æœåŠ¡$ systemctl stop example #åœæ­¢æœåŠ¡$ systemctl restart example #é‡æ–°å¯åŠ¨æœåŠ¡$ systemctl reload example #é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶$ systemctl condrestart example #å¦‚æœæœåŠ¡å·²ç»åœ¨è¿è¡Œï¼Œåˆ™é‡æ–°å¯åŠ¨$ systemctl status example #æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€$ systemctl enable example #å¼€å¯å¼€æœºæ—¶è‡ªå¯åŠ¨$ systemctl disable example #ç¦ç”¨å¼€æœºæ—¶è‡ªå¯åŠ¨$ systemctl is-enabled example #æ£€æŸ¥æœåŠ¡æ˜¯å¦é…ç½®ä¸ºå¼€æœºæ—¶è‡ªå¯åŠ¨$ systemctl list-unit-files â€“type=service #å¯åŠ¨æ—¶æ˜¾ç¤ºå¸¦æœ‰è¿è¡Œçº§åˆ«ä¿¡æ¯çš„å·²å¯ç”¨æˆ–å·²ç¦ç”¨æœåŠ¡çš„åˆ—è¡¨$ systemctl daemon-reload #åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡æ–‡ä»¶æˆ–ä¿®æ”¹ä»»ä½•é…ç½®æ—¶æ‰§è¡Œ å…·ä½“åº”ç”¨è§ã€mongodbè®¾ç½®å¼€æœºè‡ªå¯ï¼ˆsystemdæ–¹å¼ï¼‰ã€‘ã€å°†spring-bootå®‰è£…ä¸ºsystemdæœåŠ¡ã€‘ å‚è€ƒï¼šSysVinit Vs systemd Cheatsheet å…¶å®ƒå…³äºSystemdä½¿ç”¨ä¸Šçš„å¼•å¯¼æ–¹å‘ https://www.centos.bz/tag/systemd/ sysv-rc-confæœåŠ¡è‡ªå¯åŠ¨ç®¡ç†å·¥å…·åœ¨Ubuntu16.10ä¹‹å‰å¯ä½¿ç”¨sysv-rc-confï¼Œåœ¨Redhatä¸‹æ˜¯chkconfig ä¹Ÿå¯ç”¨update-rc.d åœ¨18.04é‡Œå·²ç»æ²¡æœ‰sysv-rc-confå®‰è£…åŒ…äº†ï¼Œä½¿ç”¨systemd æ›¿ä»£ 1ã€å®‰è£… 1$ apt-get install sysv-rc-conf 2ã€æ”¾ç½®è„šæœ¬æœåŠ¡ æŠŠéœ€è¦è‡ªå¯åŠ¨çš„è„šæœ¬æ”¾ç½®çš„ /etc/init.d ç›®å½•ä¸‹ 3ã€ä½¿ç”¨ 1$ sysv-rc-conf åœ¨å›¾å½¢ç•Œé¢è¿›è¡Œè®¾ç½® ubuntuçš„service,update-rc.då’Œsystemctlå‘½ä»¤ rc.localè„šæœ¬rc.localè„šæœ¬æ˜¯ä¸€ä¸ªubuntuå¼€æœºåä¼šè‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥è„šæœ¬å†…æ·»åŠ å‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚è¯¥è„šæœ¬ä½äº/etc/è·¯å¾„ä¸‹ï¼Œéœ€è¦rootæƒé™æ‰èƒ½ä¿®æ”¹ã€‚ 1234567891011121314#!/bin/sh -e## rc.local## This script is executed at the end of each multiuser runlevel.# Make sure that the script will \"exit 0\" on success or any other# value on error.## In order to enable or disable this script just change the execution# bits.## By default this script does nothing.exit 0 æ³¨æ„: ä¸€å®šè¦å°†å‘½ä»¤æ·»åŠ åœ¨ exit 0ä¹‹å‰ åœ¨Ubuntu18.04ä¸­ä½¿ç”¨çš„æ˜¯systemdï¼Œä¸ºäº†åƒä»¥å‰ä¸€æ ·ï¼Œæƒ³åœ¨/etc/rc.localä¸­è®¾ç½®å¼€æœºå¯åŠ¨ç¨‹åºï¼Œéœ€è¦ä»¥ä¸‹å‡ æ­¥ã€‚ 1ã€å› ä¸ºsystemdé»˜è®¤è¯»å–/etc/systemd/systemä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šé“¾æ¥/lib/systemd/system/ä¸‹çš„æ–‡ä»¶ã€‚ä¸€èˆ¬ç³»ç»Ÿå®‰è£…å®Œ/lib/systemd/system/ä¸‹ä¼šæœ‰rc-local.serviceæ–‡ä»¶ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å°†rc-local.serviceé…ç½®æ–‡ä»¶ã€‚ é“¾æ¥è¿‡æ¥ï¼š 1$ ln -fs /lib/systemd/system/rc-local.service /etc/systemd/system/rc-local.service 2ã€ç¼–è¾‘rc-local.serviceæ–‡ä»¶vim /etc/systemd/system/rc-local.service åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  [Install] åŒºå— 123[Install]WantedBy=multi-user.targetAlias=rc-local.service 3ã€åˆ›å»º/etc/rc.localæ–‡ä»¶ 1$ touch /etc/rc.local 4ã€èµ‹å¯æ‰§è¡Œæƒé™ 1$ chmod 755 /etc/rc.local 5ã€ç¼–è¾‘rc.localï¼Œæ·»åŠ éœ€è¦å¼€æœºå¯åŠ¨çš„ä»»åŠ¡ 123#!/bin/bashecho \"test rc \" &gt; /var/test.log 6ã€æ‰§è¡Œrebooté‡å¯ç³»ç»Ÿï¼Œç„¶åæŸ¥çœ‹test.log Ubuntu 18.04 rc.local systemdè®¾ç½®","link":"/2019/11/27/linux/Ubuntu%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/"},{"title":"cwRsyncServer+rsyncå®ç°æ–‡ä»¶ä»windowsåŒæ­¥åˆ°linux","text":"cwRsyncServer+rsyncå®ç°æ–‡ä»¶ä»windowsåŒæ­¥åˆ°linux éœ€æ±‚ï¼šå®ç°æŠŠWindowsæŸæ–‡ä»¶å¤¹åŒæ­¥åˆ°linuxä¸‹ 1ã€åœ¨Windowsä¸‹å®‰è£…cwRsyncServer4.1.0å¹¶é…ç½® ä¸‹è½½cwRsyncServerï¼šhttps://pan.baidu.com/s/1ge6xpKn å›¾ï¼šå®‰è£…1 è®¾ç½®ç”¨æˆ·årsync å¯†ç ï¼šrsync ä¿®æ”¹rsyncd.confé…ç½®æ–‡ä»¶ 123456789101112131415161718use chroot = falsestrict modes = falsehosts allow = *log file = rsyncd.loguid = 0gid = 0# Module definitions# Remember cygwin naming conventions : c:\\work becomes /cygwin/c/work#[cpnsp] #æŒ‡å®šæ¨¡å—çš„å¤´ä¿¡æ¯path = /cygdrive/e/server/tomcat4/wtpwebapps #éœ€è¦åŒæ­¥æ•°æ®çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æŒ‡E:\\server\\tomcat4\\wtpwebappsç›®å½•exclude from = rsync.exclude #æ’é™¤è¦åŒæ­¥è¿‡å»çš„æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶å¤¹#exclude = test1/read only = false #æ˜¯å¦ä¸ºåªè¯»transfer logging = yeshosts allow =192.168.1.111 #å…è®¸è®¿é—®çš„ä¸»æœºï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”auth users = rsync #æŒ‡å®šè®¤è¯çš„ç”¨æˆ·åsecrets file = /cygdrive/d/ProgramFiles/cwRsync/ICW/rsyncd.secrets #æŒ‡å®šè®¤è¯ç”¨æˆ·çš„å¯†ç æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æŒ‡d:\\ProgramFiles\\cwRsync\\ICW\\rsyncd.secrets,ä¸€ä¼šéœ€è¦æ–°å»ºè¿™ä¸ªæ–‡ä»¶ã€‚ æ³¨æ„ï¼šè¦æ·»åŠ uid = 0åŠgid = 0ã€‚ åˆ›å»ºrsyncd.secretsæ–‡ä»¶ 1rsync:rsync åˆ›å»ºrsync.excludeæ–‡ä»¶ï¼ˆä¸rsyncd.confåŒç›®å½•ä¸‹ï¼‰ 12345WEB-INF/classes/sysproperty.propertiesWEB-INF/classes/mongodb.propertiesWEB-INF/classes/redis.propertiesckeditor/wlw/ ä¿®æ”¹cpnspæ–‡ä»¶å¤¹çš„å±æ€§ å›¾ï¼šæ–‡ä»¶å¤¹å±æ€§ â€‹ ç”¨æˆ·åå¡«å®‰è£…cwRsyncServeræ—¶åˆ›å»ºçš„ç”¨æˆ·å â€‹ å›¾ï¼šæ–‡ä»¶å¤¹å±æ€§2 å¯åŠ¨RsyncSeveræœåŠ¡å›¾ï¼šrsyncæœåŠ¡ é€‰ä¸­æˆ‘çš„ç”µè„‘â€“å³é”®ç®¡ç†â€”æœåŠ¡å’Œåº”ç”¨â€“æœåŠ¡ï¼Œæ‰¾åˆ°RsyncSeverï¼ŒåŒå‡»â€“å¯åŠ¨ æ£€æµ‹ å›¾ï¼šæ£€æµ‹ åœ¨cmdä¸‹è¾“å…¥telnet 192.168.1.101 873 rsyncçš„ç›‘å¬ç«¯å£ï¼Œå®ƒçš„é»˜è®¤ç›‘å¬çš„ç«¯å£æ˜¯873ã€‚ å‡ºç°@RSYNCD:30.0è¿™ä¸ªå°±è¯´æ˜å¯ä»¥è¿æ¥ä¸Šå»äº† 2ã€linuxç«¯é…ç½® ubuntu16.04é»˜è®¤å·²å®‰è£…rsync. æ–°å»ºvim /etc/rsyncd.secrets 1rsync å®¢æˆ·ç«¯å¯†ç é…ç½®æ–‡ä»¶ä¸­åªåŠ å…¥å¯†ç å°±è¡Œã€‚ ä¿®æ”¹æƒé™ï¼šchmod 600 /etc/rsyncd.secrets æ–°å»ºåŒæ­¥è¦æ’é™¤ç›®å½•æ–‡ä»¶ vim rsync.exclude 12345WEB-INF/classes/sysproperty.propertiesWEB-INF/classes/mongodb.propertiesWEB-INF/classes/redis.propertiesckeditor/wlw/ æ‰§è¡ŒåŒæ­¥å‘½ä»¤ï¼š 1rsync -vazrtopg --progress --delete --password-file=/etc/rsyncd.secrets --exclude-from=/opt/rsync_test/rsync.exclude rsync@192.168.1.101::cpnsp9.1/* /opt/rsync_test/ å‚è€ƒï¼šhttp://www.linuxidc.com/Linux/2014-08/105514.htm http://man.linuxde.net/rsync 2018-05-29æ›´æ–° Windowsåˆ°Linuxçš„æ–‡ä»¶åŒæ­¥ä¹Ÿå¯ä½¿ç”¨GoodSyncè½¯ä»¶ï¼Œæ›´æ–¹ä¾¿ï¼Œä½†ä¸çŸ¥å®‰å…¨æ€§å¦‚ä½•ï¼Œæš‚æœªåšç”Ÿäº§æœåŠ¡å™¨ä½¿ç”¨ã€‚","link":"/2017/09/06/linux/cwRsyncServer+rsync%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%BB%8Ewindows%E5%90%8C%E6%AD%A5%E5%88%B0linux/"},{"title":"inotify","text":"ä¸‹è½½å®‰è£…ï¼š 123456$ wget https://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz$ tar zxvf inotify-tools-3.14.tar.gz$ cd inotify-tools-3.14/$ ./configure --prefix=/usr/local/inotify$ make$ make install æœªå®Œæˆï¼Œæ—¥åè¡¥å……ã€‚","link":"/2017/09/21/linux/inotify/"},{"title":"äºŒå‰æ ‘çš„éå†è§„åˆ™(å‰åºéå†ã€ä¸­åºéå†ã€ååºéå†)","text":"æ ‘çš„éå†é¡ºåºå¤§ä½“åˆ†ä¸ºä¸‰ç§ï¼šå‰åºéå†ï¼ˆå…ˆæ ¹éå†ã€å…ˆåºéå†ï¼‰ï¼Œä¸­åºéå†ï¼ˆä¸­æ ¹éå†ï¼‰ï¼Œååºéå†ï¼ˆåæ ¹éå†ï¼‰ã€‚ å¦‚ä¸‹äºŒå‰æ ‘ é¦–å…ˆ è§‚å¯Ÿè¿™ä¸ªäºŒå‰æ ‘ å¯è§æ˜¯è¿™æ ·çš„ï¼š ä»¥Bä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ Aæ ¹èŠ‚ç‚¹ ä»¥Cä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ ã€‚ ä»¥Dä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ Bæ ¹èŠ‚ç‚¹ ä»¥Eä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ ã€‚ ä»¥Gä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ Dæ ¹èŠ‚ç‚¹ ä»¥Hä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ã€‚ ä»¥Kä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ Cæ ¹èŠ‚ç‚¹ ä»¥Fä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ ã€‚ ä»¥Iä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ Fæ ¹èŠ‚ç‚¹ å³å­æ ‘ä¸ºç©º ã€‚ å·¦å­æ ‘ä¸ºç©º Iæ ¹èŠ‚ç‚¹ ä»¥Jä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ ã€‚ æ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œéå†äº†ï¼š å‰åºéå†è§„åˆ™æ˜¯ï¼š æ ¹ ã€å·¦å­æ ‘ ã€å³å­æ ‘ï¼š â€‹ å³å…ˆæ˜¯æ ¹èŠ‚ç‚¹A ç„¶åéå† Bå­æ ‘ éå†å®ŒBå­æ ‘å å†éå†Cå­æ ‘ ã€‚ â€‹ å³æœ€åç­”æ¡ˆä¸ºï¼š ABDGHECKFIJ ä¸­åºéå†è§„åˆ™æ˜¯ï¼š å·¦å­æ ‘ ã€æ ¹ ã€å³å­æ ‘ â€‹ å³å…ˆéå† Bå­æ ‘ éå†å®Œäº† å†æ˜¯AèŠ‚ç‚¹ ç„¶åæ˜¯å³å­æ ‘ â€‹ ç­”æ¡ˆä¸ºï¼š GDHBEAKCIJF ååºéå†è§„åˆ™æ˜¯ï¼š å·¦å­æ ‘ã€ å³å­æ ‘ ã€æ ¹ â€‹ ç­”æ¡ˆä¸ºï¼š GHDEBKJIFCA","link":"/2018/09/01/java/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E8%A7%84%E5%88%99/"},{"title":"opensslå‡çº§","text":"é—®é¢˜ï¼šOpenSSL å®‰å…¨æ¼æ´(CVE-2016-8610)ã€åŸç†æ‰«æã€‘ä¿®å¤æ–¹å¼ï¼šå‡çº§æœ€æ–°ç‰ˆæœ¬ 1ã€æŸ¥çœ‹opensslç‰ˆæœ¬ 12$ openssl versionOpenSSL 1.0.2g 1 Mar 2016 2ã€ä¸‹è½½æœ€æ–°ç‰ˆæœ¬openssl 1$ wget https://www.openssl.org/source/openssl-1.1.1d.tar.gz 3ã€è§£å‹åè¿›å…¥ç›®å½•è¿›è¡Œç¼–è¯‘å®‰è£… 123$ cd /usr/local/src/openssl/openssl-1.1.1d$ ./config --prefix=/usr/local/openssl shared zlib$ make &amp;&amp; make install 4ã€å¤‡ä»½å½“å‰ç‰ˆæœ¬ 123$ find / -name openssl$ mv /usr/bin/openssl /usr/bin/openssl.bak$ mv /usr/include/openssl /usr/include/openssl.bak 5ã€é…ç½®ä½¿ç”¨æ–°ç‰ˆæœ¬ 1234$ ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl$ ln -s /usr/local/openssl/include/openssl /usr/include/openssl$ echo \"/usr/local/openssl/lib/\" &gt;&gt; /etc/ld.so.conf #æ›´æ–°åŠ¨æ€é“¾æ¥åº“æ•°æ®$ ldconfig -v #é‡æ–°åŠ è½½åŠ¨æ€é“¾æ¥åº“ 6ã€éªŒè¯ 123$ openssl version -a$ openssl versionOpenSSL 1.1.1d 10 Sep 2019","link":"/2019/09/16/linux/openssl%E5%8D%87%E7%BA%A7/"},{"title":"rinetd linuxç«¯å£è½¬å‘å·¥å…·","text":"rinetdï¼Œå¯ä»¥å®ç°linuxä¸‹ç«¯å£æ˜ å°„/è½¬å‘/é‡å®šå‘ã€‚Rinetdæ˜¯ä¸ºåœ¨ä¸€ä¸ªUnixå’ŒLinuxæ“ä½œç³»ç»Ÿä¸­ä¸ºé‡å®šå‘ä¼ è¾“æ§åˆ¶åè®®(TCP)è¿æ¥çš„ä¸€ä¸ªå·¥å…·ã€‚Rinetdæ˜¯å•ä¸€è¿‡ç¨‹çš„æœåŠ¡å™¨ï¼Œå®ƒå¤„ç†ä»»ä½•æ•°é‡çš„è¿æ¥åˆ°åœ¨é…ç½®æ–‡ä»¶etc/rinetdä¸­æŒ‡å®šçš„åœ°å€/ç«¯å£å¯¹ã€‚å°½ç®¡rinetdä½¿ç”¨éé—­é”I/Oè¿è¡Œä½œä¸ºä¸€ä¸ªå•ä¸€è¿‡ç¨‹ï¼Œå®ƒå¯èƒ½é‡å®šå‘å¾ˆå¤šè¿æ¥è€Œä¸å¯¹è¿™å°æœºå™¨å¢åŠ é¢å¤–çš„è´Ÿæ‹…ã€‚ 1ã€å®‰è£… 12345$ wget http://www.boutell.com/rinetd/http/rinetd.tar.gz$ tar -xvf rinetd.tar.gz &amp;&amp; cd rinetd$ sed -i 's/65536/65535/g' rinetd.c #(ä¿®æ”¹ç«¯å£èŒƒå›´)$ mkdir /usr/man$ make &amp;&amp; make install 2ã€ç¼–è¾‘é…ç½®æ–‡ä»¶vim /etc/rinetd.conf 1230.0.0.0 3306 172.19.94.3 33060.0.0.0 80 192.168.0.103 8080logfile /var/log/rinetd.log å°†æ‰€æœ‰å‘å¾€æœ¬æœº3306ç«¯å£çš„è¯·æ±‚è½¬å‘åˆ°172.19.94.3çš„3306ç«¯å£ã€‚å°†æ‰€æœ‰å‘å¾€æœ¬æœº80ç«¯å£çš„è¯·æ±‚è½¬å‘åˆ°192.168.0.103çš„8080ç«¯å£.3ã€å¯åŠ¨rinetd 1$ rinetd æ³¨æ„ï¼šé€šè¿‡echo rinetd &gt;&gt;/etc/rc.localå¯ä»¥è®¾ç½®ä¸ºè‡ªå¯åŠ¨ã€‚4ã€åœæ­¢rinetd 1$ pkill rinetd","link":"/2018/03/28/linux/rinetd%20linux%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%B7%A5%E5%85%B7/"},{"title":"ä¸»æœºé—´æ–‡ä»¶ä¼ è¾“","text":"scp ä¸ rsync scpä¸¤ä¸»æœºé—´éœ€è¦ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ä¸å¤ªå¤§å¯ä»¥ä½¿ç”¨scpè¿›è¡Œä¼ è¾“ã€‚ å¸¸ç”¨å‚æ•°ï¼š -Pï¼šæŒ‡å®šæ•°æ®ä¼ è¾“ç”¨åˆ°çš„ç«¯å£å·ã€‚ -rï¼šé€’å½’æ•´ä¸ªç›®å½• 1ã€ä»å¦ä¸€å°/opt/backç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°/rootç›®å½•ä¸‹ 1$ scp -P 22 -r root@43.224.0.1:/opt/back /root 2ã€å°†æœ¬åœ°/opt/backç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€å°/rootç›®å½•ä¸‹ 1$ scp -P 22 -r /opt/back root@123.152.2.3:/root å…å¯†ç ä¼ è¾“åœ¨éœ€è¦è¾“å…¥å¯†ç çš„æœºå™¨ä¸Šæ‰§è¡Œ 1$ ssh-keygen -t rsa ä¹‹å3æ¬¡å›è½¦æŠŠäº§ç”Ÿçš„id_rsa.pubæ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€å°çš„~/.sshä¸‹ï¼Œå¹¶æ”¹åä¸º authorized_keysï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œå°±æŠŠid_rsa.pubçš„å†…å®¹å¤åˆ¶åˆ°authorized_keysä¸‹ã€‚å³å¯ã€‚ rsyncå¦‚æœä¼ è¾“çš„æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¯èƒ½ä¼šåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ–­å¼€ï¼Œä½¿ç”¨rsyncå¯ä»¥åœ¨æ–­å¼€åç»§ç»­ä¼ è¾“è€Œä¸ç”¨é‡æ–°å¼€å§‹ã€‚ å¸¸ç”¨å‚æ•°ï¼š -Pï¼šåŒ…å«äº†â€œ--partial --progressâ€ ,éƒ¨åˆ†ä¼ é€å’Œæ˜¾ç¤ºè¿›åº¦ã€‚ â€“rsh=sshï¼šè¡¨ç¤ºä½¿ç”¨sshåè®®ä¼ é€æ•°æ®ã€‚ -rï¼šé€’å½’æ•´ä¸ªç›®å½•ã€‚ 1ã€æ–‡ä»¶æ–­ç‚¹ä¸‹è½½ 1$ rsync -P --rsh=ssh root@192.168.0.11:/root/large.tar.gz /dounine/targe.tar.gz 2ã€æ–‡ä»¶æ–­ç‚¹ä¸Šä¼  1$ rsync -P --rsh=ssh /dounine/targe.tar.gz root@192.168.0.11:/root/large.tar.gz 3ã€æ–‡ä»¶ç›®å½•æ–­ç‚¹ä¸‹è½½ 1$ rsync -P --rsh=ssh -r root@192.168.0.11:/root/storage /dounine 4ã€æ–‡ä»¶ç›®å½•æ–­ç‚¹ä¸Šä¼  1$ rsync -P --rsh=ssh -r /dounine root@192.168.0.11:/root/storage å¦å¤–wgetå‘½ä»¤ä¹Ÿæœ‰æ–­ç‚¹ç»­ä¼ (ä¸‹è½½)çš„åŠŸèƒ½ã€‚","link":"/2019/09/16/linux/%E4%B8%BB%E6%9C%BA%E9%97%B4%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/"},{"title":"ubuntuç³»ç»Ÿä¸Šé…ç½®seleniumè¿è¡ŒchromeDriver","text":"å¯å‚è€ƒï¼šhttps://tecadmin.net/setup-selenium-chromedriver-on-ubuntu/ å‰ææ¡ä»¶ 1ã€ç³»ç»Ÿå¤„ç†å™¨ä¸æ˜¯armv7læ¶æ„çš„ã€‚å› ä½¿ç”¨çš„æ ‘è“æ´¾å¤„ç†å™¨æ¶æ„æ˜¯armv7lï¼Œæ‰€ä»¥å®é™…æ“ä½œæœªæˆåŠŸã€‚ 2ã€å¯ä»¥è®¿é—®google (fq)ã€‚ 3ã€ç³»ç»Ÿæœ€å¥½æ˜¯64ä½ï¼Œå› ä¸ºchromeDriver è¾ƒæ–°ç‰ˆlinuxåªæœ‰64ä½çš„ã€‚chromedriverä¸‹è½½åœ°å€ ä¹Ÿå¯å‚è€ƒï¼šhttps://jiayi.space/post/zai-ubuntufu-wu-qi-shang-shi-yong-chrome-headless https://askubuntu.com/questions/79280/how-to-install-chrome-browser-properly-via-command-line","link":"/2018/09/30/linux/ubuntu%E7%B3%BB%E7%BB%9F%E4%B8%8A%E9%85%8D%E7%BD%AEselenium%E8%BF%90%E8%A1%8CchromeDriver/"},{"title":"LinuxæŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°","text":"df å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€çº§æ–‡ä»¶å¤¹å·¨ç»†ã€å ç”¨æ¯”ä¾‹ã€æŒ‚å…¥ç‚¹ç­‰ï¼Œä½†å¯¹æ–‡ä»¶å´æ— èƒ½ä¸ºåŠ›ã€‚ è€Œ du commandèƒ½æŸ¥çœ‹æ–‡ä»¶åŠæ–‡ä»¶å¤¹çš„å·¨ç»†ã€‚ dfï¼šæ˜¾ç°ç›®å‰å…¨éƒ¨æ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´åŠä½¿ç”¨å¢ƒåœ°å‚æ•° -h,äººæ€§åŒ–è¾“å‡ºï¼Œå°±æ˜¯æŠŠè·å¾—çš„æ•°æ®å•å…ƒè½¬ä¸º GBã€MB ç­‰æ˜“è¯»çš„æ ¼å¼ã€‚ è¾“å‡ºçš„ä¿¡æ¯ Filesystem\\Mounted onåˆ†åˆ«ä¸ºæ–‡ä»¶ç³»ç»ŸåŠå…¶æŒ‚å…¥ç‚¹ï¼ŒSizeã€Usedã€Availã€Use% åˆ†åˆ«æ˜¯åˆ†åŒºçš„å®¹é‡ã€å·²ä½¿ç”¨å·¨ç»†ã€ä¸‹å‰©å·¨ç»†ã€å ç”¨æ¯”ä¾‹ã€‚ duï¼šæŸ¥è¯¢æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å ç”¨ç©ºé—´å¦‚æœç›®å½•ä¸‹æ–‡ä»¶è®¸å¤šï¼Œæ„é€ åºå¤§ï¼Œå¦‚æœä½¿ç”¨ä¸å¸¦å‚æ•° du commandï¼Œåˆ™ä¼šè½®å›åˆ—å‡ºç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ï¼Œä»¥åŠå…¶å ç”¨çš„å·¨ç»†ã€‚ ä¸æœ‰ç›ŠæŸ¥æ‰¾ç©¶ç«Ÿæ˜¯å“ªä¸ªç›®å½•å ç”¨è¾ƒå¤§ï¼Œå› è€Œéœ€è¦ç»™du commandè¿›å…¥æŒ‡å®šæ‰«æç›®å½•çš„å±‚æ•°ï¼Œå‚æ•°ï¼š-d æˆ–è€… â€“max-depth 123#å¦‚ï¼šæŸ¥çœ‹ /usr ä¸‹å„ä¸ªæ–‡ä»¶å¤¹çš„å·¨ç»†ï¼Œ-d 1 è¡¨ç¤ºä»…æ‰«æä¸€å±‚ç›®å½•$ du -h -d 1 /usr$ du -h --max-depth=1","link":"/2019/09/14/linux/%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%A4%B9%E5%A4%A7%E5%B0%8F/"},{"title":"ubuntu æ— çº¿è¿æ¥","text":"å®‰è£…æ— çº¿ç®¡ç†å·¥å…·1$ apt-get install wireless-tools æŸ¥çœ‹æ˜¯å¦æœ‰æ— çº¿ç½‘å¡12345678910$ iwconfigwlan0 IEEE 802.11bgn ESSID:off/any Mode:Managed Access Point: Not-Associated Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:onlo no wireless extensions.wnet no wireless extensions. å¯ç”¨/ç¦ç”¨ç½‘å¡12$ ifconfig wlan0 up# $ ifconfig wlan0 down æ‰«ææ— çº¿ç½‘ç»œ12345678910111213141516171819202122232425$ iwlist wlan0 scanCell 04 - Address: 8C:A6:DF:43:C1:C5 Channel:11 Frequency:2.462 GHz (Channel 11) Quality=70/70 Signal level=-12 dBm Encryption key:on ESSID:&quot;wqyf2.4&quot; Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 6 Mb/s 9 Mb/s; 12 Mb/s; 18 Mb/s Bit Rates:24 Mb/s; 36 Mb/s; 48 Mb/s; 54 Mb/s Mode:Master Extra:tsf=0000000000000000 Extra: Last beacon: 80ms ago IE: Unknown: 000777717966322E34 IE: Unknown: 010882848B960C121824 IE: Unknown: 03010B IE: Unknown: 0506000101001008 IE: Unknown: 2A0100 IE: Unknown: 32043048606C IE: Unknown: 2D1AEE111BFFFFFF0000000000000000000100000000000000000000 IE: IEEE 802.11i/WPA2 Version 1 Group Cipher : CCMP Pairwise Ciphers (1) : CCMP Authentication Suites (1) : PSK .... è¿æ¥wqyf2.41ã€wqyf2.4ä¸ºWPA2 Version 1,éœ€è¦ä½¿ç”¨ä¸€ä¸ªå«åšwpasupplicantçš„å·¥å…· 1$ apt-get install wpasupplicant 2ã€åˆ›å»ºæ–‡ä»¶wpa_supplicant.confvim /etc/wpa_supplicant/wpa_supplicant.conf 123456789ctrl_interface=/var/run/wpa_supplicantap_scan=1network={ ssid=&quot;wqyf2.4&quot; psk=&quot;studio50&quot; priority=1} 3ã€åœ¨åå°å¯åŠ¨ 1$ wpa_supplicant -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf &amp; 4ã€é€šè¿‡DHCPè·å–ip 1$ dhclient wlan0 OK! å…¶å®ƒethtool ethtoolå‘½ä»¤ç½‘ç»œé…ç½® ethtoolå‘½ä»¤ç”¨äºè·å–ä»¥å¤ªç½‘å¡çš„é…ç½®ä¿¡æ¯ï¼Œæˆ–è€…ä¿®æ”¹è¿™äº›é…ç½®ã€‚ 1234567891011$ ethtool -i wlan0driver: brcmfmacversion: 7.45.41.26firmware-version: 01-4527cfabexpansion-rom-version:bus-info: mmc1:0001:1supports-statistics: nosupports-test: nosupports-eeprom-access: nosupports-register-dump: nosupports-priv-flags: no è¡¥å……ï¼šåæœŸå‘ç°é€šè¿‡æ— çº¿è¿æ¥ï¼Œç½‘ç»œä¼ è¾“å¼‚å¸¸æ…¢ï¼Œæ‰€ä»¥åªåšä¸´æ—¶ä½¿ç”¨ï¼Œé•¿æœŸæœ€å¥½è¿˜æ˜¯é€šè¿‡ç½‘çº¿è¿æ¥ã€‚19.12.28","link":"/2017/11/09/linux/%E6%97%A0%E7%BA%BF%E8%BF%9E%E6%8E%A5/"},{"title":"ubuntuä¿®æ”¹æ—¶åŒº-timedatectl","text":"æ£€æŸ¥ä¸ä¿®æ”¹æ—¶åŒºæŸ¥çœ‹æ—¶åŒº12$ date -RWed, 10 Jan 2018 11:26:47 +0800shell å½“å‰æ—¶é—´æ ¼å¼åŒ–è¾“å‡º1$ date \"+%Y-%m-%d %H:%M:%S\" ä¿®æ”¹æ—¶åŒºåˆ—å‡ºå¯ç”¨æ—¶åŒº1$ timedatectl list-timezones æ—¶åŒºåˆ—è¡¨å°†æ‰“å°åˆ°å±å¹•ä¸Šã€‚ å¯ä»¥æŒ‰SPACEå‘ä¸‹ç¿»é¡µï¼Œç„¶åæŒ‰bå‘ä¸Šç¿»é¡µã€‚ æ‰¾åˆ°æ­£ç¡®çš„æ—¶åŒºåï¼Œè®°ä¸‹å®ƒï¼Œç„¶åé”®å…¥qé€€å‡ºåˆ—è¡¨ã€‚ è®¾ç½®æ—¶åŒº1$ sudo timedatectl set-timezone Asia/Shanghai æ§åˆ¶æ—¶é—´åŒæ­¥æŸ¥çœ‹æ—¶é—´çŠ¶æ€12345678$ timedatectl Local time: Thu 2018-08-30 10:54:22 CST Universal time: Thu 2018-08-30 02:54:22 UTC RTC time: Thu 2018-08-30 02:54:22 Time zone: Asia/Shanghai (CST, +0800) System clock synchronized: yessystemd-timesyncd.service active: yes RTC in local TZ: no System clock synchronized: yesè¡¨ç¤ºæ—¶é—´å·²æˆåŠŸåŒæ­¥ï¼Œ systemd-timesyncd.service active: yesè¡¨ç¤ºtimesyncdå·²å¯ç”¨å¹¶æ­£åœ¨è¿è¡Œã€‚ å¦‚æœtimesyncdæœªæ¿€æ´»ï¼Œè¯·ä½¿ç”¨timedatectlå°†å…¶æ‰“å¼€ï¼š 1$ sudo timedatectl set-ntp on å†æ¬¡è¿è¡Œtimedatectlä»¥ç¡®è®¤ç½‘ç»œæ—¶é—´çŠ¶æ€ã€‚ å®é™…åŒæ­¥å¯èƒ½éœ€è¦ä¸€åˆ†é’Ÿï¼Œä½†æœ€ç»ˆNetwork time on:å’ŒNTP synchronized:åº”è¯¥è¯»å–yes ã€‚ æ£€æŸ¥NTPåŒæ­¥çš„åŒæ­¥çŠ¶æ€1234567891011121314$ systemctl status systemd-timesyncdsystemd-timesyncd.service - Network Time Synchronization Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: enabled) Active: active (running) since Thu 2018-08-30 10:40:29 CST; 20min ago Docs: man:systemd-timesyncd.service(8) Main PID: 3266 (systemd-timesyn) Status: \"Synchronized to time server 202.118.1.130:123 (ntp.neu6.edu.cn).\" Tasks: 2 (limit: 4915) CGroup: /system.slice/systemd-timesyncd.service â””â”€3266 /lib/systemd/systemd-timesyncdAug 30 10:40:29 ubuntu1804 systemd[1]: Starting Network Time Synchronization...Aug 30 10:40:29 ubuntu1804 systemd[1]: Started Network Time Synchronization.Aug 30 10:40:29 ubuntu1804 systemd-timesyncd[3266]: Synchronized to time server 202.118.1.130:123 (ntp.neu6.edu.cn). æœ€åä¸€è¡Œå’ŒçŠ¶æ€éƒ½æ¸…æ¥šåœ°æ˜¾ç¤ºæˆåŠŸçš„NTPåŒæ­¥çŠ¶æ€ã€‚ ä¿®æ”¹NTPæœåŠ¡å™¨åˆ—è¡¨æ›´æ”¹ systemd-timesyncdçš„ é…ç½®ï¼švim /etc/systemd/timesyncd.conf 1NTP=ntp.neu6.edu.cn é‡å¯systemd-timesyncd1$ systemctl restart systemd-timesyncd ntpæœåŠ¡ ä¸œåŒ—å¤§å­¦ ç›¸å…³è®¨è®ºhttps://www.v2ex.com/t/471414 å‚è€ƒï¼šhow-to-set-up-time-synchronization-on-ubuntu-18-04 [enable-ntp-sync](https://0049am.wordpress.com/2018/05/20/enable-ntp-sync-on-clean-ubuntu-18-04-server-installation/)","link":"/2018/08/30/linux/ubuntu%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4(%E4%BA%8C)/"},{"title":"æµé‡ç»Ÿè®¡å·¥å…·-vnstat","text":"vnstatæ˜¯ä¸€ä¸ªåŸºäºæ§åˆ¶å°çš„ç½‘ç»œæµé‡ç›‘è§†å™¨ ï¼Œå®ƒä¼šè®°å½•æŒ‡å®šç½‘å¡çš„æ¯å°æ—¶ï¼Œæ¯æ—¥å’Œæ¯æœˆç½‘ç»œæµé‡ ã€‚ å®ƒè¿˜è‡ªå¸¦äº† vnstati å‘½ä»¤,é€šè¿‡å®ƒå¯ä»¥ç›´æ¥å¯ä»¥è¾“å‡ºæµé‡ç»Ÿè®¡å›¾. å®‰è£…ä¸€ã€å®‰è£…vnstatä¸¤ç§æ–¹å¼ï¼š ï¼ˆ1ï¼‰åœ¨åŒ…ç®¡ç†ç¨‹åºä¸­å®‰è£…ï¼ˆubuntuï¼‰ 1$ sudo apt-get install vnstat vnstati ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…(å®‰è£…æœ€æ–°ç¨³å®šç‰ˆæœ¬) 1234$ wget https://humdi.net/vnstat/vnstat-1.18.tar.gz$ tar -zxvf vnstat-1.18.tar.gz$ cd vnstat-1.18$ make &amp;&amp; make install äºŒã€æŸ¥çœ‹ç½‘å¡ 1$ ifcongig -a ä¸‰ã€åˆå§‹åŒ–ç›¸åº”ç½‘å¡çš„æ•°æ®åº“ 1$ vnstat -u -i wnet å››ã€å¯åŠ¨ daemon è¿›ç¨‹ 1$ sudo /etc/init.d/vnstat start äº”ã€é»˜è®¤å¼€æœºå¯åŠ¨ 1$ sudo update-rc.d vnstat enable vnStatåŸºæœ¬åº”ç”¨1ã€æŒ‰å°æ—¶ç»Ÿè®¡ 1$ vnstat -i wnet -h -iï¼šæŒ‡å®šç½‘å¡ 2ã€æŒ‰å¤©ç»Ÿè®¡ 1$ vnstat -i wnet -d 3ã€æŒ‰å‘¨ç»Ÿè®¡ 1$ vnstat -i wnet -w 4ã€æŒ‰æœˆç»Ÿè®¡ 1$ vnstat -i wnet -m 5ã€ç»Ÿè®¡æ¶ˆè€—æµé‡æœ€å¤šçš„10å¤©çš„æƒ…å†µ 1$ vnstat -i wnet -t 6ã€å®æ—¶æµé‡æŸ¥çœ‹ 1$ vnstat -i wnet -l 7ã€è¾“å‡ºåˆ°å›¾å½¢ï¼šä½¿ç”¨ vnstati å‘½ä»¤ï¼Œæ›´å¤šè¯¦ç»†çš„å‚æ•°å¯ä»¥è¯· man vnstatiã€‚ 1$ vnstati -i wnet -m -o /tmp/month.png æ•ˆæœ å®˜æ–¹ä¸»é¡µï¼š http://humdi.net/vnstat å‚è€ƒï¼šhttp://www.vpswe.com/vps-jiaocheng/483.html","link":"/2018/09/01/linux/%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7-vnstat/"},{"title":"è®©è¿›ç¨‹åœ¨åå°è¿è¡Œæ–¹æ³•","text":"æˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œç”¨telnet/ssh ç™»é™†äº†è¿œç¨‹çš„linuxæœåŠ¡å™¨ï¼Œå¦‚æœè¿è¡Œä¸€äº›è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼Œç»“æœå´ç”±äºç½‘ç»œçš„ä¸ç¨³å®šå¯¼è‡´ä»»åŠ¡ä¸­é€”å¤±è´¥ã€‚å¦‚ä½•è®©å‘½ä»¤æäº¤åä¸å—æœ¬åœ°å…³é—­ç»ˆç«¯çª—å£/ç½‘ç»œæ–­å¼€è¿æ¥çš„å¹²æ‰°å‘¢ï¼Ÿ åœºæ™¯ä¸€ï¼šå¦‚æœåªæ˜¯ä¸´æ—¶æœ‰ä¸€ä¸ªå‘½ä»¤éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼Œä»€ä¹ˆæ–¹æ³•èƒ½æœ€ç®€ä¾¿çš„ä¿è¯å®ƒåœ¨åå°ç¨³å®šè¿è¡Œå‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼š æˆ‘ä»¬çŸ¥é“ï¼Œå½“ç”¨æˆ·æ³¨é”€ï¼ˆlogoutï¼‰æˆ–è€…ç½‘ç»œæ–­å¼€æ—¶ï¼Œç»ˆç«¯ä¼šæ”¶åˆ° HUPï¼ˆhangupï¼‰ä¿¡å·ä»è€Œå…³é—­å…¶æ‰€æœ‰å­è¿›ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„è§£å†³åŠæ³•å°±æœ‰ä¸¤ç§é€”å¾„ï¼šè¦ä¹ˆè®©è¿›ç¨‹å¿½ç•¥ HUP ä¿¡å·ï¼Œè¦ä¹ˆè®©è¿›ç¨‹è¿è¡Œåœ¨æ–°çš„ä¼šè¯é‡Œä»è€Œæˆä¸ºä¸å±äºæ­¤ç»ˆç«¯çš„å­è¿›ç¨‹ã€‚ hangup åç§°çš„æ¥ç”± åœ¨ Unix çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œæ¯ä¸ªç»ˆç«¯éƒ½ä¼šé€šè¿‡ modem å’Œç³»ç»Ÿé€šè®¯ã€‚å½“ç”¨æˆ· logout æ—¶ï¼Œmodem å°±ä¼šæŒ‚æ–­ï¼ˆhang upï¼‰ç”µè¯ã€‚ åŒç†ï¼Œå½“ modem æ–­å¼€è¿æ¥æ—¶ï¼Œå°±ä¼šç»™ç»ˆç«¯å‘é€ hangup ä¿¡å·æ¥é€šçŸ¥å…¶å…³é—­æ‰€æœ‰å­è¿›ç¨‹ã€‚ 1ã€nohup nohup çš„ç”¨é€”å°±æ˜¯è®©æäº¤çš„å‘½ä»¤å¿½ç•¥ hangup ä¿¡å·ã€‚ nohupçš„å¸®åŠ©ä¿¡æ¯ 12345678910111213141516NOHUP(1) User Commands NOHUP(1)NAME nohup - run a command immune to hangups, with output to a non-ttySYNOPSIS nohup COMMAND [ARG]... nohup OPTIONDESCRIPTION Run COMMAND, ignoring hangup signals. --help display this help and exit --version output version information and exit å¯è§ä½¿ç”¨æ—¶éå¸¸æ–¹ä¾¿çš„ï¼Œåªéœ€åœ¨è¦å¤„ç†çš„å‘½ä»¤å‰åŠ ä¸Š nohup å³å¯ï¼Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ç¼ºçœä¼šè¢«é‡å®šå‘åˆ° nohup.out æ–‡ä»¶ä¸­ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯åœ¨ç»“å°¾åŠ ä¸Šâ€œ&amp;â€æ¥å°†å‘½ä»¤åŒæ—¶æ”¾å…¥åå°è¿è¡Œï¼Œä¹Ÿå¯ç”¨&gt;filename 2&gt;&amp;1æ¥æ›´æ”¹ç¼ºçœçš„é‡å®šå‘æ–‡ä»¶åã€‚ ç¤ºä¾‹ï¼š 123456root@sfkzw5mp4Z:~# nohup ping www.baidu.com &amp; # nohup ping www.baidu.com &gt;nohup.log 2&gt;&amp;1 &amp;[1] 13004root@sfkzw5mp4Z:~# nohup: ignoring input and appending output to â€˜nohup.outâ€™root@sfkzw5mp4Z:~# ps -ef |grep 13004root 13004 12957 0 10:23 pts/1 00:00:00 ping www.baidu.comroot 13006 12957 0 10:23 pts/1 00:00:00 grep --color=auto 13004 æ­¤å¤„æœ‰ä¸ªå°é—®é¢˜ å½“ç”¨nohupå‘½ä»¤ä½¿ç¨‹åºåå°æ‰§è¡Œï¼Œä½†æ˜¯ç›´æ¥å…³é—­ç»ˆç«¯åï¼Œç¨‹åºåœ¨åå°å°±åœæ­¢äº†ã€‚åœ¨å…¶å®ƒæœºå™¨ä¸Šï¼Œå¹¶æœªå‡ºç°æ­¤æƒ…å†µã€‚ä»¥ä¸‹æ˜¯æŠšç´ç…®é…’çš„ã€Šæ„å»ºé«˜å¯ç”¨linuxæœåŠ¡å™¨ã€‹é‡Œæåˆ°çš„è¿™ä¸ªé—®é¢˜ ã€‚ æ‰€ä»¥ä½¿ç”¨nohupå‘½ä»¤æ‰§è¡Œåï¼Œå‡ºç°äº†æ­¤ç±»æƒ…å†µï¼Œä¸è¦ç›´æ¥å…³é—­ç»ˆç«¯ï¼Œä½¿ç”¨exitå‘½ä»¤é€€å‡ºä¼šè¯ã€‚ 2ã€setsid æš‚æœªå®é™…åº”ç”¨ï¼Œä¸è®¨è®º 3ã€&amp; å¾…è¡¥å…… åœºæ™¯äºŒï¼šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¦‚æœäº‹å…ˆåœ¨å‘½ä»¤å‰åŠ ä¸Š nohup æˆ–è€… setsid å°±å¯ä»¥é¿å… HUP ä¿¡å·çš„å½±å“ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœªåŠ ä»»ä½•å¤„ç†å°±å·²ç»æäº¤äº†å‘½ä»¤ï¼Œè¯¥å¦‚ä½•è¡¥æ•‘æ‰èƒ½è®©å®ƒé¿å… HUP ä¿¡å·çš„å½±å“å‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼š æƒ³åŠ  nohup æˆ–è€… setsid å·²ç»ä¸ºæ—¶å·²æ™šï¼Œåªèƒ½é€šè¿‡ä½œä¸šè°ƒåº¦å’Œ disown æ¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚ disown çš„å¸®åŠ©ä¿¡æ¯ 1234567891011disown: usage: disown [-h] [-ar] [jobspec ...] Without options, each jobspec is removed from the table of active jobs. If the -h option is given, each jobspec is not removed from the table, but is marked so that SIGHUP is not sent to the job if the shell receives a SIGHUP. If no jobspec is present, and neither the -a nor the -r option is supplied, the current job is used. If no jobspec is supplied, the -a option means to remove or mark all jobs; the -r option without a jobspec argument restricts operation to running jobs. The return value is 0 unless a jobspec does not specify a valid job. æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥è¾¾æˆæˆ‘ä»¬çš„ç›®çš„ã€‚ ç”¨disown -h jobspecæ¥ä½¿æŸä¸ªä½œä¸šå¿½ç•¥HUPä¿¡å· ã€‚ ç”¨disown -ahæ¥ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½å¿½ç•¥HUPä¿¡å·ã€‚ ç”¨disown -rhæ¥ä½¿æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¿½ç•¥HUPä¿¡å·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨è¿‡ disown ä¹‹åï¼Œä¼šå°†æŠŠç›®æ ‡ä½œä¸šä»ä½œä¸šåˆ—è¡¨ä¸­ç§»é™¤ï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä½¿ç”¨jobsæ¥æŸ¥çœ‹å®ƒï¼Œä½†æ˜¯ä¾ç„¶èƒ½å¤Ÿç”¨ps -efæŸ¥æ‰¾åˆ°å®ƒã€‚ ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§æ–¹æ³•çš„æ“ä½œå¯¹è±¡æ˜¯ä½œä¸šï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿è¡Œå‘½ä»¤æ—¶åœ¨ç»“å°¾åŠ äº†â€œ&amp;â€æ¥ä½¿å®ƒæˆä¸ºä¸€ä¸ªä½œä¸šå¹¶åœ¨åå°è¿è¡Œï¼Œé‚£ä¹ˆå°±ä¸‡äº‹å¤§å‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡jobså‘½ä»¤æ¥å¾—åˆ°æ‰€æœ‰ä½œä¸šçš„åˆ—è¡¨ã€‚ä½†æ˜¯å¦‚æœå¹¶æ²¡æœ‰æŠŠå½“å‰å‘½ä»¤ä½œä¸ºä½œä¸šæ¥è¿è¡Œï¼Œå¦‚ä½•æ‰èƒ½å¾—åˆ°å®ƒçš„ä½œä¸šå·å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç”¨ CTRL-zï¼ˆæŒ‰ä½Ctrlé”®çš„åŒæ—¶æŒ‰ä½zé”®ï¼‰äº†ï¼ CTRL-z çš„ç”¨é€”å°±æ˜¯å°†å½“å‰è¿›ç¨‹æŒ‚èµ·ï¼ˆSuspendï¼‰ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨jobså‘½ä»¤æ¥æŸ¥è¯¢å®ƒçš„ä½œä¸šå·ï¼Œå†ç”¨bg jobspecæ¥å°†å®ƒæ”¾å…¥åå°å¹¶ç»§ç»­è¿è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŒ‚èµ·ä¼šå½±å“å½“å‰è¿›ç¨‹çš„è¿è¡Œç»“æœï¼Œè¯·æ…ç”¨æ­¤æ–¹æ³•ã€‚ ç¤ºä¾‹ å¦‚æœæäº¤å‘½ä»¤æ—¶å·²ç»ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åå°è¿è¡Œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨â€œdisownâ€12345678[root@pvcent107 build]# cp -r testLargeFile largeFile &amp;[1] 4825[root@pvcent107 build]# jobs[1]+ Running cp -i -r testLargeFile largeFile &amp;[root@pvcent107 build]# disown -h %1[root@pvcent107 build]# ps -ef |grep largeFileroot 4825 968 1 09:46 pts/4 00:00:00 cp -i -r testLargeFile largeFileroot 4853 968 0 09:46 pts/4 00:00:00 grep largeFile ï¼ˆå¦‚æœæäº¤å‘½ä»¤æ—¶æœªä½¿ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åå°è¿è¡Œï¼Œå¯ä½¿ç”¨ CTRL-z å’Œâ€œbgâ€å°†å…¶æ”¾å…¥åå°ï¼Œå†ä½¿ç”¨â€œdisownâ€ï¼‰1234567891011[root@pvcent107 build]# cp -r testLargeFile largeFile2 [1]+ Stopped cp -i -r testLargeFile largeFile2[root@pvcent107 build]# bg %1[1]+ cp -i -r testLargeFile largeFile2 &amp;[root@pvcent107 build]# jobs[1]+ Running cp -i -r testLargeFile largeFile2 &amp;[root@pvcent107 build]# disown -h %1[root@pvcent107 build]# ps -ef |grep largeFile2root 5790 5577 1 10:04 pts/3 00:00:00 cp -i -r testLargeFile largeFile2root 5824 5577 0 10:05 pts/3 00:00:00 grep largeFile2 æ³¨æ„ï¼šç›´æ¥åœ¨shellä¸­ä¸æ–­è¾“å‡ºç»“æœçš„å‘½ä»¤ï¼Œå¦‚ping å¹¶æœªè¾¾åˆ°é¢„æƒ³ç›®æ ‡ï¼Œæ­¤å‘½ä»¤è¿˜å¾…æ·±ç©¶ã€‚ åœºæ™¯ä¸‰ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•è®©è¿›ç¨‹å…å— HUP ä¿¡å·çš„å½±å“ï¼Œä½†æ˜¯å¦‚æœæœ‰å¤§é‡è¿™ç§å‘½ä»¤éœ€è¦åœ¨ç¨³å®šçš„åå°é‡Œè¿è¡Œï¼Œå¦‚ä½•é¿å…å¯¹æ¯æ¡å‘½ä»¤éƒ½åšè¿™æ ·çš„æ“ä½œå‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼š æ­¤æ—¶æœ€æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ screen äº†ã€‚ç®€å•çš„è¯´ï¼Œscreen æä¾›äº† ANSI/VT100 çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œä½¿å®ƒèƒ½å¤Ÿåœ¨ä¸€ä¸ªçœŸå®ç»ˆç«¯ä¸‹è¿è¡Œå¤šä¸ªå…¨å±çš„ä¼ªç»ˆç«¯ã€‚screen çš„å‚æ•°å¾ˆå¤šï¼Œå…·æœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨æ­¤ä»…ä»‹ç»å…¶å¸¸ç”¨åŠŸèƒ½ä»¥åŠç®€è¦åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨ screen èƒ½å¤Ÿé¿å… HUP ä¿¡å·çš„å½±å“ã€‚ ä½¿ç”¨screenéœ€è¦å®‰è£… å…¶å®ƒï¼šå¦ä¸€ç¥å™¨ï¼šsupervisor å‚è€ƒï¼šhttps://www.ibm.com/developerworks/cn/linux/l-cn-nohup/","link":"/2018/07/01/linux/%E8%BF%9B%E7%A8%8B%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/"},{"title":"ubuntuä¿®æ”¹æ—¶åŒº","text":"æŸ¥çœ‹æ—¶åŒº12$ date -RWed, 10 Jan 2018 11:26:47 +0800shell ä¿®æ”¹æ—¶åŒº1$ tzselect 1ã€é€‰æ‹©åŒºåŸŸ 123456789101112131415$ tzselectPlease identify a location so that time zone rules can be set correctly.Please select a continent, ocean, \"coord\", or \"TZ\". 1) Africa 2) Americas 3) Antarctica 4) Asia 5) Atlantic Ocean 6) Australia 7) Europe 8) Indian Ocean 9) Pacific Ocean10) coord - I want to use geographical coordinates.11) TZ - I want to specify the time zone using the Posix TZ format.#? 4 2ã€é€‰æ‹©å›½å®¶ 12345678910111213141516171819Please select a country whose clocks agree with yours. 1) Afghanistan 18) Israel 35) Palestine 2) Armenia 19) Japan 36) Philippines 3) Azerbaijan 20) Jordan 37) Qatar 4) Bahrain 21) Kazakhstan 38) Russia 5) Bangladesh 22) Korea (North) 39) Saudi Arabia 6) Bhutan 23) Korea (South) 40) Singapore 7) Brunei 24) Kuwait 41) Sri Lanka 8) Cambodia 25) Kyrgyzstan 42) Syria 9) China 26) Laos 43) Taiwan10) Cyprus 27) Lebanon 44) Tajikistan11) East Timor 28) Macau 45) Thailand12) Georgia 29) Malaysia 46) Turkmenistan13) Hong Kong 30) Mongolia 47) United Arab Emirates14) India 31) Myanmar (Burma) 48) Uzbekistan15) Indonesia 32) Nepal 49) Vietnam16) Iran 33) Oman 50) Yemen17) Iraq 34) Pakistan#? 9 3ã€é€‰æ‹©æ—¶åŒº 1234Please select one of the following time zone regions.1) Beijing Time2) Xinjiang Time#? 1 4ã€ç¡®è®¤éªŒè¯ 123456789101112The following information has been given: China Beijing TimeTherefore TZ='Asia/Shanghai' will be used.Local time is now: Wed Jan 10 11:33:01 CST 2018.Universal Time is now: Wed Jan 10 03:33:01 UTC 2018.Is the above information OK?1) Yes2) No#? 1 5ã€å¤åˆ¶æ–‡ä»¶åˆ°/etcç›®å½•ä¸‹,é˜²æ­¢ç³»ç»Ÿé‡å¯åæ—¶åŒºæ”¹å˜ã€‚ 1$ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 6.æ›´æ–°æ—¶é—´ 1$ ntpdate time.windows.com å½“å‰æ—¶é—´æ ¼å¼åŒ–è¾“å‡º 1$ date \"+%Y-%m-%d %H:%M:%S\" ntpæœåŠ¡ ä¸œåŒ—å¤§å­¦ ç›¸å…³è®¨è®ºhttps://www.v2ex.com/t/471414","link":"/2018/01/10/linux/ubuntu%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4(%E4%B8%80)/"},{"title":"è¿›ç¨‹ç®¡ç†å·¥å…·htop","text":"1ã€ å®‰è£…htop ä¸‹è½½ 123456$ tar -zxvf htop-2.0.2.tar.gz$ mv htop-2.0.2 htop$ cd htop/$ ./configure$ make$ make install è¯´æ˜ï¼š æ‰§è¡Œconfigureæ—¶å¯èƒ½é‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š 1configure: error: You may want to use --disable-unicode or install libncursesw. éœ€è¦å®‰è£…libncursesw ncursesåŒ…çš„ä½œç”¨ï¼šæä¾›å­—ç¬¦ç»ˆç«¯å¤„ç†åº“ï¼ŒåŒ…æ‹¬é¢æ¿å’Œèœå•ã€‚ 1$ apt-get install libncursesw5 é»˜è®¤æƒ…å†µä¸‹make installä¼šå®‰è£…åˆ°/usr/localï¼Œç”¨äºæ›´æ”¹è·¯å¾„ä½¿ç”¨./configure â€“prefix=/some/pathã€‚","link":"/2017/09/11/linux/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7htop/"},{"title":"Linuxé€šè¿‡pidæŸ¥æ‰¾å¯¹åº”åº”ç”¨ç¨‹åºåŠæ‰€åœ¨ç›®å½•","text":"æœ‰æ—¶é€šè¿‡topå‘½ä»¤çœ‹åˆ°æŸäº›è¿›ç¨‹å ç”¨å†…å­˜è¾ƒå¤§ã€‚å¦‚å›¾ï¼š å¦‚æœè¦æŸ¥æ‰¾å…·ä½“è¿›ç¨‹æ‰§è¡Œæ–‡ä»¶åŠç›®å½•ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š1ã€é€šè¿‡pså‘½ä»¤å®šä½ï¼š 1$ ps -ef |grep -v grep |grep PID 2ã€é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ç›®å½•ï¼š 1$ ll /proc/PID/","link":"/2018/05/25/linux/%E9%80%9A%E8%BF%87pid%E6%9F%A5%E6%89%BE%E5%AF%B9%E5%BA%94%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%8A%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95/"},{"title":"nginxå®‰è£…","text":"å®‰è£…ä¾èµ–åº“1ã€å®‰è£…g++ä¾èµ–åº“ 123$ sudo apt-get update$ apt-get install build-essential #å®‰è£…GCC$ apt-get install libtool 2ã€å®‰è£… pcreä¾èµ–åº“ï¼ˆhttp://www.pcre.org/ï¼‰ 1$ sudo apt-get install libpcre3 libpcre3-dev 3ã€å®‰è£… zlibä¾èµ–åº“ï¼ˆhttp://www.zlib.netï¼‰ 1$ apt-get install zlib1g-dev 4ã€å®‰è£… sslä¾èµ–åº“ 1$ apt-get install openssl libssl-dev å®‰è£…nginx123456$ wget http://nginx.org/download/nginx-1.12.1.tar.gz$ tar -zxvf nginx-1.12.1.tar.gz$ cd nginx-1.12.1$ ./configure --prefix=/usr/local/nginx # --with-http_ssl_module$ make$ make install nginxå¼€æœºå¯åŠ¨1ã€ç¼–å†™å¯åŠ¨è„šæœ¬ vim /etc/init.d/nginx 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#! /bin/sh### BEGIN INIT INFO# Provides: nginx# Required-Start: $local_fs $remote_fs $network $syslog $named# Required-Stop: $local_fs $remote_fs $network $syslog $named# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: starts the nginx web server# Description: starts nginx using start-stop-daemon### END INIT INFOPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/binDESC=\"nginx daemon\"NAME=nginxDAEMON=/usr/local/nginx/sbin/$NAMECONFIGFILE=/usr/local/nginx/conf/$NAME.confPIDFILE=/usr/local/nginx/logs/$NAME.pidSCRIPTNAME=/etc/init.d/$NAMEset -e[ -x \"$DAEMON\" ] || exit 0do_start() {$DAEMON -c $CONFIGFILE || echo -n \"nginx already running\"}do_stop() {kill -INT `cat $PIDFILE` || echo -n \"nginx not running\"}do_reload() {kill -HUP `cat $PIDFILE` || echo -n \"nginx can't reload\"}case \"$1\" instart)echo -n \"Starting $DESC: $NAME\"do_startecho \".\";;stop)echo -n \"Stopping $DESC: $NAME\"do_stopecho \".\";;reload|graceful)echo -n \"Reloading $DESC configuration...\"do_reloadecho \".\";;restart)echo -n \"Restarting $DESC: $NAME\"do_stopdo_startecho \".\";;*)echo \"Usage: $SCRIPTNAME {start|stop|reload|restart}\" &gt;&amp;2exit 3;;esacexit 0 2ã€æ³¨å†Œä¸ºæœåŠ¡ 12$ chmod a+x /etc/init.d/nginx$ update-rc.d nginx defaults","link":"/2017/09/27/nginx/nginx%E5%AE%89%E8%A3%85/"},{"title":"ubuntué•œåƒæº","text":"Debain stretch(stable) 1234567891011echo &quot;deb http://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb-src http://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb http://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb-src http://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb http://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb-src http://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb http://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free&quot; &gt;&gt; sources.listecho &quot;deb-src http://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free&quot; &gt;&gt; sources.list","link":"/2017/11/09/linux/%E9%95%9C%E5%83%8F%E6%BA%90/"},{"title":"nginxæ—¥å¿—åˆ‡å‰²","text":"ä¸€ã€è„šæœ¬åˆ‡å‰² 1ã€ç¼–å†™åˆ‡å‰²è„šæœ¬ 12345678910#!/bin/bash## Nginx æ—¥å¿—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•LOGS_PATH=/var/log/nginx/bjcscn## è·å–æ˜¨å¤©çš„ yyyy-MM-ddYESTERDAY=$(date -d \"yesterday\" +%Y-%m-%d)## ç§»åŠ¨æ–‡ä»¶mv ${LOGS_PATH}/access.log ${LOGS_PATH}/access_${YESTERDAY}.logmv ${LOGS_PATH}/error.log ${LOGS_PATH}/error_${YESTERDAY}.log## å‘ Nginx ä¸»è¿›ç¨‹å‘é€ USR1 ä¿¡å·ã€‚USR1 ä¿¡å·æ˜¯é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶kill -USR1 $(cat /run/nginx.pid) æ·»åŠ æ‰§è¡Œæƒé™ï¼šchmod a+x bjcscn_cutlog.sh 2ã€åŠ å…¥å®šæ—¶ä»»åŠ¡crontab -e 10 0 * * * /bin/bash /etc/nginx/scripts/bjcscn_cutlog.sh è¿™æ ·å°±ä¼šåœ¨æ¯å¤©é›¶ç‚¹é›¶åˆ†å¯¹æ—¥å¿—è¿›è¡Œåˆ‡å‰² äºŒã€logrotateåˆ‡å‰² logrotateæ—¥å¿—åˆ‡å‰²æ˜¯linuxè‡ªå¸¦çš„ é…ç½®ç›®å½•ï¼š/etc/logrotate.d/ æ‰§è¡Œæ—¶é—´ç”±cronæ§åˆ¶ï¼š cat /etc/crontab logrotateæ˜¯åŸºäºcronè¿è¡Œçš„ï¼šè„šæœ¬ä¸ºï¼š/etc/cron.daily/logrotate logrotateå‘½ä»¤ 123456Usage: logrotate [OPTION...] &lt;configfile&gt;-d, --debug ï¼šdebugæ¨¡å¼ï¼Œæµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ã€‚-f, --force ï¼šå¼ºåˆ¶è½¬å‚¨æ–‡ä»¶ã€‚-m, --mail=command ï¼šå‹ç¼©æ—¥å¿—åï¼Œå‘é€æ—¥å¿—åˆ°æŒ‡å®šé‚®ç®±ã€‚-s, --state=statefile ï¼šä½¿ç”¨æŒ‡å®šçš„çŠ¶æ€æ–‡ä»¶ã€‚-v, --verbose ï¼šæ˜¾ç¤ºè½¬å‚¨è¿‡ç¨‹ã€‚ logrotateé…ç½®æ–‡ä»¶å‚æ•° 1234567891011121314151617181920212223242526compress é€šè¿‡gzip å‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—nocompress ä¸åšgzipå‹ç¼©å¤„ç†copytruncate ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­ï¼›æ˜¯å…ˆæ‹·è´å†æ¸…ç©ºçš„æ–¹å¼ï¼Œæ‹·è´å’Œæ¸…ç©ºä¹‹é—´æœ‰ä¸€ä¸ªæ—¶é—´å·®ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ—¥å¿—æ•°æ®ã€‚nocopytruncate å¤‡ä»½æ—¥å¿—æ–‡ä»¶ä¸è¿‡ä¸æˆªæ–­create mode owner group è½®è½¬æ—¶æŒ‡å®šåˆ›å»ºæ–°æ–‡ä»¶çš„å±æ€§ï¼Œå¦‚create 0777 nobody nobodynocreate ä¸å»ºç«‹æ–°çš„æ—¥å¿—æ–‡ä»¶delaycompress å’Œcompress ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè½¬å‚¨çš„æ—¥å¿—æ–‡ä»¶åˆ°ä¸‹ä¸€æ¬¡è½¬å‚¨æ—¶æ‰å‹ç¼©nodelaycompress è¦†ç›– delaycompress é€‰é¡¹ï¼Œè½¬å‚¨åŒæ—¶å‹ç¼©ã€‚missingok å¦‚æœæ—¥å¿—ä¸¢å¤±ï¼Œä¸æŠ¥é”™ç»§ç»­æ»šåŠ¨ä¸‹ä¸€ä¸ªæ—¥å¿—errors address ä¸“å‚¨æ—¶çš„é”™è¯¯ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„Email åœ°å€ifempty å³ä½¿æ—¥å¿—æ–‡ä»¶ä¸ºç©ºæ–‡ä»¶ä¹Ÿåšè½®è½¬ï¼Œè¿™ä¸ªæ˜¯logrotateçš„ç¼ºçœé€‰é¡¹ã€‚notifempty å½“æ—¥å¿—æ–‡ä»¶ä¸ºç©ºæ—¶ï¼Œä¸è¿›è¡Œè½®è½¬mail address æŠŠè½¬å‚¨çš„æ—¥å¿—æ–‡ä»¶å‘é€åˆ°æŒ‡å®šçš„E-mail åœ°å€nomail è½¬å‚¨æ—¶ä¸å‘é€æ—¥å¿—æ–‡ä»¶olddir directory è½¬å‚¨åçš„æ—¥å¿—æ–‡ä»¶æ”¾å…¥æŒ‡å®šçš„ç›®å½•ï¼Œå¿…é¡»å’Œå½“å‰æ—¥å¿—æ–‡ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿnoolddir è½¬å‚¨åçš„æ—¥å¿—æ–‡ä»¶å’Œå½“å‰æ—¥å¿—æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹sharedscripts è¿è¡Œpostrotateè„šæœ¬ï¼Œä½œç”¨æ˜¯åœ¨æ‰€æœ‰æ—¥å¿—éƒ½è½®è½¬åç»Ÿä¸€æ‰§è¡Œä¸€æ¬¡è„šæœ¬ã€‚å¦‚æœæ²¡æœ‰é…ç½®è¿™ä¸ªï¼Œé‚£ä¹ˆæ¯ä¸ªæ—¥å¿—è½®è½¬åéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡è„šæœ¬prerotate åœ¨logrotateè½¬å‚¨ä¹‹å‰éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ä¿®æ”¹æ–‡ä»¶çš„å±æ€§ç­‰åŠ¨ä½œï¼›å¿…é¡»ç‹¬ç«‹æˆè¡Œpostrotate åœ¨logrotateè½¬å‚¨ä¹‹åéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¾‹å¦‚é‡æ–°å¯åŠ¨ (kill -HUP) æŸä¸ªæœåŠ¡ï¼å¿…é¡»ç‹¬ç«‹æˆè¡Œdaily æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯å¤©weekly æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯å‘¨monthly æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯æœˆrotate count æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°ï¼Œ0 æŒ‡æ²¡æœ‰å¤‡ä»½ï¼Œ5 æŒ‡ä¿ç•™5 ä¸ªå¤‡ä»½dateext ä½¿ç”¨å½“æœŸæ—¥æœŸä½œä¸ºå‘½åæ ¼å¼dateformat .%s é…åˆdateextä½¿ç”¨ï¼Œç´§è·Ÿåœ¨ä¸‹ä¸€è¡Œå‡ºç°ï¼Œå®šä¹‰æ–‡ä»¶åˆ‡å‰²åçš„æ–‡ä»¶åï¼Œå¿…é¡»é…åˆdateextä½¿ç”¨ï¼Œåªæ”¯æŒ %Y %m %d %s è¿™å››ä¸ªå‚æ•°size(æˆ–minsize) log-size å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾æŒ‡å®šçš„å¤§å°æ—¶æ‰è½¬å‚¨ï¼Œlog-sizeèƒ½æŒ‡å®šbytes(ç¼ºçœ)åŠKB (sizek)æˆ–MB(sizem). nginxä¾‹å­å‚è€ƒ(é»˜è®¤)ï¼š 12345678910111213141516171819$ cat /etc/logrotate.d/nginx/var/log/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts prerotate if [ -d /etc/logrotate.d/httpd-prerotate ]; then \\ run-parts /etc/logrotate.d/httpd-prerotate; \\ fi \\ endscript postrotate invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1 endscript} invoke-rc.dçš„ç”¨æ³•ä¸serviceåŸºæœ¬ç›¸åŒ é…ç½®æ­¥éª¤ 1ã€ç¼–å†™é…ç½®æ–‡ä»¶ vim /etc/logrotate.d/nginx 123456789101112131415161718#éœ€è¦å¤‡ä»½çš„æ—¥å¿—è·¯å¾„ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªéƒ½å¯ä»¥/usr/local/nginx/logs/*.log/usr/local/nginx/logs/teachhelper/*.log{ daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts prerotate if [ -f /usr/local/nginx/logs/nginx.pid ]; then kill -USR1 `cat /usr/local/nginx/logs/nginx.pid` fi endscript} 2ã€æµ‹è¯• 1$ logrotate -vf /etc/logrotate.d/nginx 3ã€å®šæ—¶æ‰§è¡Œ æ‰§è¡Œæ—¶é—´ç”±cronæ§åˆ¶ï¼š cat /etc/crontab logrotateçš„è„šæœ¬æ˜¯æŒ‰ /etc/cron.dailyä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ‰§è¡Œã€‚ æš‚æ—¶æ˜¯é»˜è®¤å³å¯ï¼Œå³æ¯å¤©æ—©ä¸Š6:25","link":"/2017/08/29/nginx/nginx%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2/"},{"title":"nginx-upload-moduleæ¨¡å—","text":"ä½¿ç”¨ Nginx Upload Module å®ç°ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ ä¸‹è½½nginxåŠnginx_upload_moduleæ¨¡å— 12$ wget http://nginx.org/download/nginx-1.16.1.tar.gz$ wget https://github.com/fdintino/nginx-upload-module/archive/2.3.0.tar.gz ç¼–è¯‘æ‰§è¡Œnginx 1234$ ./configure --prefix=/usr/local/nginx --with-http_ssl_module --add-module=/usr/local/src/nginx/nginx-upload-module-2.3.0# --with-http_ssl_module å¼€å¯SSLæ¨¡å— --add-moduleæ·»åŠ é™„åŠ æ¨¡å—$ make$ make install #æ³¨æ„å¦‚æœä¹‹å‰å®‰è£…è¿‡ï¼Œä¸è¦make install é…ç½® nginx-upload.conf 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354#nginx-upload moduleserver { listen 80; server_name localhost; client_max_body_size 100m; #ä¸Šä¼ å¤§å°é™åˆ¶ client_body_buffer_size 512k; # Upload form should be submitted to this location location /upload { # nginxæ¥æ”¶å®Œä¸Šä¼ çš„æ–‡ä»¶åï¼Œç„¶åäº¤ç»™åç«¯å¤„ç†çš„åœ°å€ã€‚ upload_pass @test; #ä¸´æ—¶ä¿å­˜è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨æ•£åˆ—ï¼Œ #æŒ‡å®šlevel 1 æ—¶ï¼Œéœ€æå‰åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œä» 0 åˆ° 9 upload_store /usr/local/nginx/upload; # upload_store /usr/local/nginx/upload 1; #ä¸Šä¼ æ–‡ä»¶çš„æƒé™ï¼Œrw è¯»å†™ï¼Œråªè¯» upload_store_access user:rw; #è¿™é‡Œå†™å…¥httpæŠ¥å¤´ï¼Œpassåˆ°åå°é¡µé¢èƒ½è·å–è¿™é‡Œsetçš„æŠ¥å¤´å­—æ®µ upload_set_form_field \"${upload_field_name}_name\" $upload_file_name; upload_set_form_field \"${upload_field_name}_content_type\" $upload_content_type; upload_set_form_field \"${upload_field_name}_path\" $upload_tmp_path; #Uploadæ¨¡å—è‡ªåŠ¨ç”Ÿæˆçš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶å¤§å°ä¸æ–‡ä»¶md5å€¼ç­‰ upload_aggregate_form_field \"${upload_field_name}_md5\" $upload_file_md5; upload_aggregate_form_field \"${upload_field_name}_size\" $upload_file_size; # å…è®¸çš„å­—æ®µï¼Œå…è®¸å…¨éƒ¨å¯ä»¥ \"^.*$\" #upload_pass_form_field \"^submit$|^description$\"; upload_pass_form_field \"^.*$\"; # æŒ‡å®šä¸Šè½½é€Ÿç‡é™åˆ¶ï¼Œä»¥æ¯ç§’å­—èŠ‚æ•°ä¸ºå•ä½ 0è¡¨ç¤ºä¸é™åˆ¶ã€‚ upload_limit_rate 0; # å¦‚æœpassé¡µé¢æ˜¯ä»¥ä¸‹çŠ¶æ€ç ï¼Œå°±åˆ é™¤æ­¤æ¬¡ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ upload_cleanup 400 404 499 500-505; # æ‰“å¼€å¼€å…³ï¼Œæ„æ€å°±æ˜¯æŠŠå‰ç«¯è„šæœ¬è¯·æ±‚çš„å‚æ•°ä¼šä¼ ç»™åç«¯,å¦‚/upload?id=5 upload_pass_args on; } # Pass altered request body to a backend location @test { #åç«¯æœåŠ¡è·¯å¾„ï¼šhttp://192.168.1.101:8080/cpnsp/admin/ta/nginxUploadFile #å¦‚æœå­˜åœ¨å‚æ•°å¯é€šè¿‡setè®¾ç½®ï¼Œå¯å‚è€ƒhttp://www.udpwork.com/item/12552.html rwrite . /cpnsp/admin/ta/nginxUploadFile break; proxy_pass http://192.168.1.101:8080; #proxy_pass http://localhost:8080; # default_type text/html; # return 200 \"success\"; ## å¦‚æœä¸éœ€è¦åç«¯ç¨‹åºå¤„ç†ï¼Œç›´æ¥è¿”å›200 }} upload.html 12345678910111213141516171819&lt;html&gt; &lt;head&gt; &lt;title&gt;Test upload&lt;/title&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/&gt; &lt;/head&gt; &lt;body&gt; &lt;h2&gt;Select files to upload&lt;/h2&gt; &lt;form enctype=\"multipart/form-data\" action=\"/upload\" method=\"post\"&gt; &lt;input type=\"file\" name=\"file1\"&gt;&lt;br&gt; &lt;input type=\"file\" name=\"file2\"&gt;&lt;br&gt; &lt;input type=\"file\" name=\"file3\"&gt;&lt;br&gt; &lt;input type=\"file\" name=\"file4\"&gt;&lt;br&gt; &lt;input type=\"file\" name=\"file5\"&gt;&lt;br&gt; &lt;input type=\"file\" name=\"file6\"&gt;&lt;br&gt; &lt;input type=\"submit\" name=\"submit\" value=\"Upload\"&gt; &lt;input type=\"hidden\" name=\"test\" value=\"value\"&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; åç«¯å¤„ç†ç¨‹åº 12345678910111213@RequestMapping(value = \"/nginxUploadFile\", method = RequestMethod.POST)@ResponseBody@RequiresPermissions(AuthorizerInterceptor.PERMISSION_NONE)public ResponseData&lt;Map&lt;String, Object&gt;&gt; nginxUploadFile(HttpServletRequest request, HttpServletResponse response) { ResponseData&lt;Map&lt;String, Object&gt;&gt; rd = new ResponseData&lt;&gt;(new HashMap&lt;&gt;()); rd.getData().put(\"fileName\", request.getParameter(\"file1_name\")); rd.getData().put(\"contentType\", request.getParameter(\"file1_content_type\")); rd.getData().put(\"filePath\", request.getParameter(\"file1_path\")); rd.getData().put(\"fileSize\", request.getParameter(\"file1_size\")); rd.getData().put(\"fileMd5\", request.getParameter(\"file1_md5\")); return rd;} é…ç½®å‚æ•°å‚è€ƒï¼šupload","link":"/2019/09/18/nginx/nginx-upload-module%E6%A8%A1%E5%9D%97/"},{"title":"echo-nginx-moduleæ¨¡å—","text":"ä½¿ç”¨ Nginx Upload Module å®ç°ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ ä¸‹è½½nginxåŠecho-nginx-moduleæ¨¡å— 12$ wget http://nginx.org/download/nginx-1.16.1.tar.gz$ wget https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz ç¼–è¯‘æ‰§è¡Œnginx 1234$ ./configure --prefix=/usr/local/nginx --with-http_ssl_module --add-module=/usr/local/src/nginx/echo-nginx-module-0.61 --add-module=/usr/local/src/nginx/nginx-upload-module-2.3.0# --with-http_ssl_module å¼€å¯SSLæ¨¡å— --add-moduleæ·»åŠ é™„åŠ æ¨¡å— nginx_upload_moduleæ¨¡å—$ make$ make install #æ³¨æ„å¦‚æœä¹‹å‰å®‰è£…è¿‡ï¼Œä¸è¦make install é…ç½® nginx-upload.conf 12345678#echo-nginx-module moduleserver { location /sub { echo \"querystring: $query_string\"; echo \"method: $echo_request_method\"; } } åœ¨æµè§ˆå™¨è¯·æ±‚ http://localhost/sub?name=11 123#è¾“å‡ºquerystring: name=11method: GET å¦‚æœè¯·æ±‚ånginxæŠŠå“åº”ä½œä¸ºæœªçŸ¥ç±»å‹çš„æ–‡ä»¶ä¿å­˜ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸‹Content-Typeï¼š default_type text/plain; é…ç½®å‚æ•°å‚è€ƒï¼šecho-nginx-module","link":"/2020/04/29/nginx/echo-nginx-module%E6%A8%A1%E5%9D%97/"},{"title":"nginxé™åˆ¶é¡µé¢è®¿é—®","text":"é™åˆ¶é¡µé¢è®¿é—®æƒé™ å¯å‚è€ƒï¼š http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html https://www.sunzhongwei.com/nginx-http-authentication.html","link":"/2019/09/19/nginx/nginx%E9%99%90%E5%88%B6%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE/"},{"title":"python2ä¸python3ç‰ˆæœ¬çš„åˆ‡æ¢","text":"ubuntuç³»ç»Ÿ python2ä¸python3ç‰ˆæœ¬çš„åˆ‡æ¢ ç³»ç»Ÿä¸­python2ä¸python3åŒæ—¶å­˜åœ¨ï¼Œå¦‚æœè¦åœ¨ä¸¤è€…ä¹‹é—´åˆ‡æ¢ã€‚è¦æ›´æ”¹pythonçš„è½¯é“¾æ¥ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚å¯ä»¥ä½¿ç”¨ alternativesè¿›è¡Œç®¡ç†å‘½ä»¤çš„è½¯é“¾æ¥ã€‚ 1ã€æ·»åŠ å¯¹pythonè½¯é“¾æ¥çš„ç®¡ç† 12$ sudo update-alternatives --install /usr/local/bin/python python /usr/bin/python2 100$ sudo update-alternatives --install /usr/local/bin/python python /usr/bin/python3 150 2ã€æŸ¥çœ‹ 123456$ ls -al `which python` lrwxrwxrwx 1 root root 7 May 27 16:06 /usr/local/bin/python -&gt; /etc/alternatives/python$ python --version Python 3.5.2$ ls -al /etc/alternatives/python lrwxrwxrwx 1 root root 16 May 27 17:27 /etc/alternatives/python -&gt; /usr/bin/python3 è¿™æ ·pythonç‰ˆæœ¬é»˜è®¤å°±ä¸ºpython3ã€‚ 3ã€åˆ‡æ¢åˆ°python2 1234567$ update-alternatives --config python Selection Path Priority Status------------------------------------------------------------* 0 /usr/bin/python3 150 auto mode 1 /usr/bin/python2 100 manual mode 2 /usr/bin/python3 150 manual mode æŒ‰ç…§æç¤ºè¾“å…¥é€‰æ‹©æ•°å­—2å›è½¦å³å¯ã€‚ åŒæ ·æ€è·¯å¯ä»¥å¯¹javaç‰ˆæœ¬è¿›è¡Œå¦‚æ­¤ç®¡ç†ã€‚ å…³äºalternativeså‘½ä»¤çš„å…·ä½“ä½¿ç”¨å¾…äº†è§£ã€‚","link":"/2018/05/27/python/Python%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/"},{"title":"sambaçš„å®‰è£…","text":"sambaçš„ç¼–è¯‘å®‰è£… samba æ˜¯ç”¨äºLinuxå’Œwindowsä¹‹é—´æ–‡ä»¶å…±äº«çš„æœåŠ¡ã€‚ ubuntu16.04 è¿›è¡Œsamba å®‰è£… ç¼–è¯‘å®‰è£…1ã€é¦–å…ˆè¦æ£€æŸ¥pythonçš„é»˜è®¤ç‰ˆæœ¬æ˜¯å¦ä¸º2ã€‚ä¸æ˜¯çš„è¯ï¼Œå…ˆå®‰è£…python2 æˆ–è€…åˆ‡æ¢ç‰ˆæœ¬ä¸º2 12$ python --version Python 2.7.15 2ã€ä»å®˜ç½‘ä¸‹è½½sambaå®˜ç½‘ 1$ wget https://download.samba.org/pub/samba/stable/samba-4.8.2.tar.gz 1ã€è§£å‹ 1$ tar zxvf samba-4.8.2.tar.gz -C /usr/local/src/ 4ã€ç¼–è¯‘ 1234$ cd /usr/local/src/samba-4.8.2/$ ./configure --prefix=/usr/local/samba/$ make$ make install æœªè§£å†³ï¼š 12345Checking for Python version &gt;= 2.6.0 : ok 2.7.15Checking for library python2.7 : yesChecking for program python2.7-config : /usr/local/bin/python2.7-configChecking for custom code : Could not find the python development headers/opt/compile/samba/samba-4.8.2/wscript:124: error: the configuration failed (see '/opt/compile/samba/samba-4.8.2/bin/config.log') å¾ˆæ˜¯éƒé—·ã€‚æœ€ç»ˆç¼–è¯‘å®‰è£…å¤±è´¥ï¼ï¼ï¼ apt å®‰è£… 1ã€ç›´æ¥aptè¿›è¡Œå®‰è£…apt-get install samba 2ã€æ–°å»ºå…±äº«æ–‡ä»¶å¤¹ 12$ mkdir /opt/share/$ chmod 777 /opt/share/ 2ã€ä¿®æ”¹sambaé…ç½®æ–‡ä»¶ â€‹ /etc/samba/smb.conf 123456789[usershare] comment = Home Directories path = /opt/share public = yes browseable = yes writable = yes guest ok = yes create mask = 0777 directory mask = 0777 3ã€é‡å¯æœåŠ¡ 1$ service smbd restart åœ¨Windowsä¸­cmd è¾“å…¥ \\192.168.1.90 è¿›å…¥å…±äº«æ–‡ä»¶å¤¹","link":"/2018/05/27/samba/samba%E5%AE%89%E8%A3%85/"},{"title":"Python2.7ç¼–è¯‘å®‰è£…","text":"ubuntu16.04ç³»ç»Ÿè‡ªå¸¦Pythonç‰ˆæœ¬ä¸ºPython3ï¼Œæœ‰æ—¶ä¼šä½¿ç”¨åˆ°python2.7ç‰ˆæœ¬ã€‚å°±éœ€è¦è¿›è¡Œå®‰è£…ã€‚ 1ã€ä»pythonå®˜ç½‘ä¸‹è½½2.7ç‰ˆæœ¬ã€‚å®˜ç½‘ 1$ wget https://www.python.org/ftp/python/2.7.15/Python-2.7.15.tgz 2ã€è§£å‹ 1$ tar zxvf Python-2.7.15.tgz -C /usr/local/src/ 3ã€ç¼–è¯‘ 1234$ cd /usr/local/src/Python-2.7.15/$ ./configure --prefix=/usr/local$ make$ make install 4ã€éªŒè¯ 12345$ pythonPython 2.7.15 (default, May 27 2018, 15:08:52)[GCC 5.4.0 20160609] on linux2Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; exit() python2ä¸python3çš„åˆ‡æ¢æš‚ä¸æ·±ç©¶ã€‚","link":"/2018/05/27/python/python2.7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"},{"title":"tomcatå¯åŠ¨åæŠ¥ to the cache because there was insufficient free space available after evicting expired cache entri","text":"tomcat å¯åŠ¨åä¸€ç›´æŠ¥ä¸€å¤§å †è­¦å‘Š XXâ€¦to the cache because there was insufficient free space available after evicting expired cache entriï¼Œå¤§è‡´æ˜¯æ„æ€æ˜¯tomcatçš„ç¼“å­˜å› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ååŠ è½½æ–‡ä»¶ã€‚ è§£å†³æ–¹æ³•ä¿®æ”¹tomcat/conf/context.xmlæ–‡ä»¶ï¼Œå¢åŠ èµ„æºæœ€å¤§å¯ç¼“å­˜çš„å¤§å°ï¼šåœ¨æ ‡ç­¾ä¸­æ·»åŠ  1&lt;Resources cacheMaxSize=&quot;200000&quot; cachingAllowed=&quot;true&quot;/&gt; å¦‚æœæ·»åŠ åè¿˜æ˜¯å‡ºç°ï¼Œåˆ™é‡æ–°æ·»åŠ ä¸€ä¸ªtomcatã€‚ è¯´æ˜ï¼šResources æ˜¯èµ„æºå®šä¹‰å…ƒç´ ï¼ŒcachingAllowedå’ŒcacheMaxSizeæ˜¯å…¬å…±å±æ€§ã€‚cachingAllowedï¼šé™æ€èµ„æºç¼“å­˜çš„æœ€å¤§å¤§å°ï¼Œä»¥åƒå­—èŠ‚ä¸ºå•ä½ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤å€¼ä¸º10240 ï¼ˆ10å…†å­—èŠ‚ï¼‰ã€‚åœ¨Webåº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡JMXï¼‰ï¼Œå¯èƒ½ä¼šæ›´æ”¹æ­¤å€¼ã€‚å¦‚æœç¼“å­˜ä½¿ç”¨çš„å†…å­˜å¤§äºæ–°çš„é™åˆ¶ï¼Œé‚£ä¹ˆç¼“å­˜å°†å°è¯•ç¼©å°è§„æ¨¡ä»¥é€‚åº”æ–°çš„é™åˆ¶ã€‚å¦‚æœ‰å¿…è¦ï¼ŒcacheObjectMaxSizeå°†è¢«ç¼©å°ä»¥ç¡®ä¿å®ƒä¸å¤§äº cacheMaxSize/20ã€‚cachingAllowedï¼šå¦‚æœæ­¤æ ‡å¿—çš„å€¼æ˜¯trueï¼Œåˆ™å°†ä½¿ç”¨é™æ€èµ„æºçš„ç¼“å­˜ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œæ ‡å¿—çš„é»˜è®¤å€¼æ˜¯trueã€‚åœ¨Webåº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡JMXï¼‰ï¼Œå¯èƒ½ä¼šæ›´æ”¹æ­¤å€¼ã€‚å½“ç¦ç”¨é«˜é€Ÿç¼“å­˜æ—¶ï¼Œé«˜é€Ÿç¼“å­˜ä¸­çš„å½“å‰ä»»ä½•èµ„æºéƒ½å°†ä»é«˜é€Ÿç¼“å­˜ä¸­æ¸…é™¤ã€‚ å…·ä½“å«ä¹‰å’Œå±æ€§å‚è€ƒï¼šhttps://tomcat.apache.org/tomcat-8.0-doc/config/resources.html#Attributes","link":"/2018/01/10/windows/tomcat%E5%90%AF%E5%8A%A8%E5%90%8E%E6%8A%A5%20to%20the%20cache%20because%20there%20was%20insufficient%20free%20space%20available%20after%20evicting%20expired%20cache%20entri/"},{"title":"TOMCAT å…³é—­æŠ¥é”™ï¼šTomcat did not stop in time. PID file was not removed","text":"å‚è€ƒï¼šhttp://blog.csdn.net/mchdba/article/details/46482499ç”±æ­¤å¼•å‘ ScheduledThreadPoolExecutorã€quartzè°ƒåº¦ã€å†…å­˜æ³„æ¼æ£€æµ‹ã€åˆ†æã€‚","link":"/2018/03/15/windows/TOMCAT%20%E5%85%B3%E9%97%AD%E6%8A%A5%E9%94%99%EF%BC%9ATomcat%20did%20not%20stop%20in%20time.%20PID%20file%20was%20not%20removed/"},{"title":"windowsä¸‹tomcatæ³¨å†Œä¸ºæœåŠ¡","text":"åœ¨å…å®‰è£…tomcatçš„binç›®å½•ä¸‹æœ‰service.batæ–‡ä»¶ï¼Œåˆ©ç”¨æ­¤æ–‡ä»¶è¿›è¡Œæ³¨å†Œä¸ºæœåŠ¡ã€‚ 1ã€å‘½ä»¤çª—å£ä¸‹ï¼Œç›®å½•åˆ‡æ¢åˆ°tomcatçš„binç›®å½•ä¸‹ã€‚2ã€å®‰è£…tomcatæœåŠ¡ ï¼š service install3ã€æŸ¥çœ‹æœåŠ¡ ï¼š win + Rã€services.mscã€Enter æ‰“å¼€æœåŠ¡ç®¡ç†ç•Œé¢ï¼Œæ‰¾åˆ°tomcatæœåŠ¡é¡¹ ç¡®å®štomcatæœåŠ¡å·²ç»å®‰è£…ï¼Œå¹¶å³é”®æŸ¥çœ‹æœåŠ¡çš„åç§°ï¼Œæˆ‘çš„å°±æ˜¯tomcat7ã€‚4ã€å¯åŠ¨tomcatæœåŠ¡ï¼šnet start tomcat75ã€åœæ­¢tomcatæœåŠ¡: net stop tomcat76ã€å¸è½½TomcatæœåŠ¡ï¼šservice remove å…¶å®ƒé—®é¢˜å¯æŸ¥çœ‹logs/é”™è¯¯æ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—è¿›è¡Œåˆ†æã€‚1ã€å®‰è£…æ—¶å‡ºç° Failed to install Tomcat7 service å¯èƒ½æ˜¯æ²¡æœ‰æƒé™ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmdã€‚2ã€Windows æ— æ³•åœ¨æœ¬åœ°è®¡ç®—æœºå¯åŠ¨Apache tomcat å¯èƒ½æ˜¯tomcatä½æ•°ä¸å¯¹ï¼Œä¸‹è½½ç³»ç»Ÿjdkå¯¹åº”ç‰ˆæœ¬Tomcat.","link":"/2018/01/09/windows/tomcat%E6%B3%A8%E5%86%8C%E4%B8%BA%E6%9C%8D%E5%8A%A1/"},{"title":"jiraçš„å®‰è£…ä¸é…ç½®","text":"å‚è€ƒï¼šjira confluenceå‚è€ƒï¼šconfluence_1confluence_2confluence_3confluence_4","link":"/2018/03/28/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/jira%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"},{"title":"æ— é¢˜","text":"â€‹ å¦‚æœæˆ‘ä»¬æ€»åœ¨ç­‰å¾…ç»å¯¹çš„ä¸€åˆ‡å°±ç»ªï¼Œé‚£æˆ‘ä»¬å°†æ°¸è¿œæ— æ³•å¼€å§‹ã€‚ â€”â€” ä¼Šä¸‡Â·å± æ ¼æ¶…å¤«","link":"/2018/06/10/%E5%85%B6%E5%AE%83/2018-06-10/"},{"title":"æµè§ˆå™¨ç½‘é¡µå»é™¤å¹¿å‘Š","text":"æ¯å½“æŸ¥èµ„æ–™ç¿»æ–°é—»æ€»æœ‰å¹¿å‘Šå‡ºæ¥æ¶å¿ƒäººã€‚åƒcsdnä¾§è¾¹æ çš„ç™¾åº¦å¹¿å‘Šã€‚ chromeæµè§ˆå™¨å®‰è£… Adblock Plus æ‰©å±•ç¨‹åº QQæµè§ˆå™¨å®‰è£… Adblock Plus æˆ–è€… å¹¿å‘Šå±è”½+é¡µé¢å…ƒç´ éšè—åŠ©æ‰‹ æ’ä»¶","link":"/2018/11/15/%E5%85%B6%E5%AE%83/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%BB%E9%99%A4%E5%B9%BF%E5%91%8A/"},{"title":"termux","text":"termux åˆ‡æ¢root: $ termux-chroot cd /storage/emulated/0/ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149$ du -h -d 1 ./328.2M ./Movies22.9M ./Music253.3M ./Pictures2.1M ./baidu8.0K ./Themes4.5K ./Documents4.0K ./.tbs3.9M ./ColorOS1.3M ./QQBrowser42.9M ./Download402.8M ./netease20.5K ./.com.oupeng.max.sdk60.6M ./Market1.1G ./Android4.8M ./data8.0K ./zapya213.0K ./.mcs8.0K ./.UTSystemConfig672.9M ./DCIM8.0K ./.OnePlusH2Ota94.0K ./backups420.1M ./alipay4.0K ./.DataStorage612.0K ./Backucup9.5K ./.com.taobao.dp3.5K ./Podcasts6.8M ./amap8.0K ./com.eg.android.AlipayGphone37.8M ./UCDownloads 10.8G ./tencent7.4M ./.system20.0K ./tbs10.8M ./backup10.5K ./KMP112.8M ./sina19.9M ./.wbadcache22.9M ./autonavi3.5K ./douban36.0K ./com.sina.weibo32.0K ./.skynet79.0K ./.unicomCache24.0K ./.nearme235.2M ./Snapseed8.0K ./InAppBillingLibrary136.0K ./.plugin64.0K ./appstat8.0K ./egame16.0K ./skynet2.5G ./Telegram4.2M ./Youdao8.0K ./netease_pushservice16.0K ./bluetooth819.5K ./Qmap16.0K ./sysdata140.0K ./tencentmapsdk3.5K ./KMP_SUBTITLES24.0K ./didi9.4M ./Browser16.0K ./.AppCenterWebBuffer_QQ8.0K ./tmpaeucache64.0K ./Mob4.5K ./Alarms12.0K ./Ctrip16.0K ./CtripPushSDK68.3M ./Record8.0K ./mfcache149.5K ./amap_ams41.1M ./ting8.0K ./ickeck3.4M ./games16.0K ./.growingio16.0K ./.jgads38.6M ./vue25.7M ./500pxme92.0K ./appubk140.0K ./dobest48.0K ./sgsupdate267.7M ./KineMaster8.0K ./.fileManager8.0K ./umeng_cache3.5K ./.vue815.0K ./cmgame1.5M ./oem_log8.0K ./.Ota60.0K ./com.youdao.dict8.0K ./.chinaunicomfs7.5K ./.omgid3.1M ./JDIM3.5K ./keep1.4M ./autohome12.5K ./txrtmp3.5K ./com.tencent.edu80.0K ./com.netease.vopen11.5K ./com.tencent.qqlive227.7M ./com.tencent.litchi2.6M ./migu2.5M ./UCMobile947.5K ./autohomemain8.0K ./autolog8.0K ./autohome_ums8.0K ./com.cubic.autohome12.5K ./.uxx12.5K ./.cc109.0K ./txcache8.0K ./XHS24.0K ./360131.6M ./nk_download3.9M ./PicsArt3.1M ./ç‰›å®¢19.0K ./cache28.0K ./.vivo62.0K ./msc52.0K ./PayGateWayLibrary35.5K ./HelloImageLoader24.5K ./com.bankcomm.Bankcomm16.0K ./jtyh7.0K ./zhuntiku11.5K ./Unicom13.0K ./app12.5K ./bytedance4.0K ./dgdf_configqwpo12.5K ./.jds140.0K ./cnb8.2M ./soul180.2M ./baidunetdisk12.5K ./.zp19.5K ./Geetest28.0K ./com.hpbr.bosszhipin23.0K ./com.UCMobile4.0K ./at4.0K ./MQ4.7M ./weishi_yt_model4.0K ./dgdf_configqwpo1112.7M ./.videocache43.5K ./com.netease.cloudmusic4.0K ./.xiachufang_first_install_info4.5K ./Ringtones3.5K ./OnePlusBBS4.5K ./userexperience3.0M ./Mindmaster5.5K ./Catfish5.0K ./zhihu3.5K ./OSSLog15.5K ./cqrcb87.2M ./sogou7.0K ./.awp355.5K ./.shareTemp18.1G ./","link":"/2019/10/31/%E5%85%B6%E5%AE%83/termux/"},{"title":"inotify","text":"inotify ä¸‹è½½å®‰è£…ï¼š 123456wget https://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gztar zxvf inotify-tools-3.14.tar.gzcd inotify-tools-3.14/./configure --prefix=/usr/local/inotifymakemake install æœªå®Œæˆï¼Œæ—¥åè¡¥å……ã€‚","link":"/2017/09/21/%E5%90%8C%E6%AD%A5/inotify/"},{"title":"rsyncåŒæ­¥","text":"rsyncåŒæ­¥ï¼Œå¯é…åˆinotifyåšåˆ°å®æ—¶åŒæ­¥ æŠŠ112.124.41.198ä¸Šçš„/dbdata/ç›®å½•ä¸‹æ–‡ä»¶åŒæ­¥åˆ°æœ¬åœ°/tmpç›®å½•ä¸‹ã€‚ 1$ rsync -avzP -e 'ssh -p 22' root@112.124.41.198:/dbdata/ /tmp åŒæ­¥112.124.41.198ä¸Šçš„mongoDB_aliä¸‹çš„testenroll180228æ–‡ä»¶å¤¹åˆ°æœ¬åœ°/tmpç›®å½•ä¸‹ 1$ rsync -vazrtopgP --password-file=/etc/rsync.password cpnsp@112.124.41.198::mongoDB_ali/testenroll180228 /tmp/ nohup rsync -avzrtopgL â€“progress /data/opt /data2/ &gt;/var/log/$(date +%Y%m%d).mail.log &amp; -v, â€“verbose è¯¦ç»†æ¨¡å¼è¾“å‡ºã€‚-q, â€“quiet ç²¾ç®€è¾“å‡ºæ¨¡å¼ã€‚-a, â€“archive å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§ï¼Œç­‰äº-rlptgoDã€‚-z, â€“compress å¯¹å¤‡ä»½çš„æ–‡ä»¶åœ¨ä¼ è¾“æ—¶è¿›è¡Œå‹ç¼©å¤„ç†ã€‚-r, â€“recursive å¯¹å­ç›®å½•ä»¥é€’å½’æ¨¡å¼å¤„ç†ã€‚-t, â€“times ä¿æŒæ–‡ä»¶æ—¶é—´ä¿¡æ¯ã€‚-o, â€“owner ä¿æŒæ–‡ä»¶å±ä¸»ä¿¡æ¯ã€‚-p, â€“perms ä¿æŒæ–‡ä»¶æƒé™ã€‚-g, â€“group ä¿æŒæ–‡ä»¶å±ç»„ä¿¡æ¯ã€‚-P ç­‰åŒäº â€“partial â€“â€“progressã€‚â€“â€“partial ä¿ç•™é‚£äº›å› æ•…æ²¡æœ‰å®Œå…¨ä¼ è¾“çš„æ–‡ä»¶ï¼Œä»¥æ˜¯åŠ å¿«éšåçš„å†æ¬¡ä¼ è¾“ã€‚â€“progress æ˜¾ç¤ºå¤‡ä»½è¿‡ç¨‹ã€‚â€“password-file=FILE ä»FILEä¸­å¾—åˆ°å¯†ç ã€‚","link":"/2018/03/12/%E5%90%8C%E6%AD%A5/rsync/"},{"title":"Ubuntuä¸‹é…ç½®rsync","text":"ç›®æ ‡ï¼šå®ç°å®¢æˆ·ç«¯å¼€æœºè‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯æŸä¸ªæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶ æœåŠ¡ç«¯1ã€æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦å·²ç»å®‰è£…rsync 12$ whereis rsyncrsync: /usr/bin/rsync /usr/share/man/man1/rsync.1.gz #è¯´æ˜å·²ç»å®‰è£…å¦åˆ™ï¼ˆapt-get install rsyncï¼‰2ã€ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¼€å¯rsync vim /etc/default/rsync 1RSYNC_ENABLE=true #æŠŠfalseæ”¹ä¸ºtrue 3ã€åˆ›å»ºrsyncd.conf cp /usr/share/doc/rsync/examples/rsyncd.conf /etc/ vim /etc/rsyncd.conf1234567891011121314151617181920 # GLOBAL OPTIONS strict modes = yes#motd file=/etc/motd port = 873 log file=/var/log/rsyncd.log pid file=/var/run/rsyncd.pid auth users =cpnsp_rsyncd secrets file = /etc/rsyncd.secrets# for pid file, do not use /var/run/rsync.pid if# you are going to run rsync out of the init.d script.# The init.d script does its own pid file handling,# so omit the &quot;pid file&quot; line completely in that case.#syslog facility=daemon#socket options=# MODULE OPTIONS[cpnsp_static] path = /usr/local/nginx/html è¯´æ˜ï¼šauth users é…åˆ¶ä¸€å®šè¦å’Œ/etc/rsyncd.secretsé‡Œçš„ç”¨æˆ·åä¿æŒä¸€è‡´ã€‚ è¦å¤‡ä»½çš„æ¯ä¸ªè·¯å¾„ä¸ºä¸€ä¸ªmoduleï¼Œå¯å¤šä¸ªã€‚4ã€æ–°å»ºå¯†ç æ–‡ä»¶/etc/rsyncd.secrets1cpnsp_rsyncd:admin123 ç”¨æˆ·åä¸ºcpnsp_rsyncdï¼Œå¯†ç ä¸ºadmin123ï¼Œæ³¨æ„è¯¥æ–‡ä»¶å±æ€§ä¸º600 (å…¶ä»–ç”¨æˆ·æ²¡ç”¨è¯»å†™æ‰§è¡Œæƒé™)5ã€å¼€å¯rsyncæœåŠ¡ 1$ /etc/init.d/rsync start å¯ç”¨netstat -tuplnæŸ¥çœ‹873ç«¯å£æœ‰æ²¡æœ‰æ‰“å¼€ã€‚å®¢æˆ·ç«¯1ã€åœ¨~ä¸‹æ–°å»ºrsyncå·¥ä½œç›®å½• 2ã€åœ¨å·¥ä½œç›®å½•å†…åˆ›å»ºå¯†ç æ–‡ä»¶rsyncd.scrt 1cpnsp_rsyncd:admin123 å†…å®¹å’ŒæœåŠ¡å™¨ç«¯ä¿æŒä¸€æ ·ï¼Œå±æ€§ä¹Ÿä¸º600ã€‚ 3ã€åœ¨å·¥ä½œç›®å½•åˆ›å»ºclient.conf 123456789101112131415# this is a configure file for client backup machine# NOTE:# OPTIONS=&quot;-vazu --progreess --delete&quot;# client will backup all same files at server# when server delete a specific file, client also delete it.# and OPTIONS=&quot;-vazu --progress&quot;# client will keep server deleted files# MODULE responding to [modules] in server, seperated by space# BACKUPPATH client backup pathBACKUPPATH=&quot;/root/&quot;;SERVERIP=&quot;192.168.1.26&quot;MODULE=&quot;cpnsp_static&quot;#OPTIONS=&quot;-vazu --progress&quot;OPTIONS=&quot;-vazu --progress --delete&quot; è¯´æ˜ï¼šå…¶ä¸­BACKUPPATHä¸ºå®¢æˆ·ç«¯åŒæ­¥æ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚ MODULEå¯¹åº”æœåŠ¡ç«¯/etc/rsyncd.confä¸‹çš„moduleï¼Œå¤šä¸ªmoduleä»¥ç©ºæ ¼åˆ†å¼€ã€‚4ã€åˆ›å»ºåŒæ­¥è„šæœ¬rsyncclient.sh 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#!/bin/bashABSPATH=$(dirname $0)source ${ABSPATH}/client.conffunction get-user-pwd(){#obtain usrname and password iUSR=$(cat ${ABSPATH}/rsyncd.scrt|tr -d ' ' |grep -v &quot;^$&quot; | \\ grep -v &quot;^#&quot;|head -n 1|awk -F : '{print $1}') iPWD=$(cat ${ABSPATH}/rsyncd.scrt|tr -d ' ' |grep -v &quot;^$&quot; | \\ grep -v &quot;^#&quot;|head -n 1|awk -F : '{print $2}') if [ -z ${iUSR} ] || [ -z ${iPWD} ];then echo &quot;iUSR=$iUSR iPWD=$iPWD&quot; echo &quot;rsyncd.scrt format illegal, please check!&quot;; exit -1; fi# produce password file echo &quot;$iPWD&quot; &gt; ${ABSPATH}/.pass chmod 600 ${ABSPATH}/.pass [ ! -d $BACKUPPATH ] &amp;&amp; mkdir -p ${BACKUPPATH}}function backup-module(){# print key information iModule=$1 echo echo &quot;---------------------------------------------------&quot; echo &quot;---- backup module ${iModule}@${SERVERIP} begin &quot; echo &quot;---- TIME=`date`----&quot; echo &quot;ABSPATH=${ABSPATH}&quot; echo &quot;BACKUPPATH=${BACKUPPATH}&quot; echo &quot;iUSR=$iUSR iPWD=$iPWD&quot; echo &quot;OPTIONS=${OPTIONS}&quot; iModuleBackpath=${BACKUPPATH}/${iModule}; [ ! -d ${iModuleBackpath} ] &amp;&amp; mkdir -p ${iModuleBackpath}# begin backup rsync ${OPTIONS} ${iUSR}@${SERVERIP}::${iModule} ${iModuleBackpath} \\ --password-file=${ABSPATH}/.pass if [ $? != 0 ];then echo &quot;---- backup module ${iModule}@${SERVERIP} failed.&quot; else echo &quot;---- backup module ${iModule}@${SERVERIP} succuess. &quot; fi echo &quot;---- TIME=`date`----&quot; echo &quot;---------------------------------------------------&quot; echo}function __main__(){ get-user-pwd for md in $MODULE do backup-module $md done}__main__ chmod a+x rsyncclient.sh 5ã€ è¿è¡Œ./rsyncclient.shï¼Œå°±æŠŠæœåŠ¡ç«¯/usr/local/nginx/htmlä¸‹çš„æ–‡ä»¶åŒæ­¥åˆ°/root/cpnsp_statiä¸‹ã€‚ 6ã€æ–°å»ºå¼€æœºå¯åŠ¨è„šæœ¬ vim /etc/init.d/rsync_cpnsp 12345#!/bin/bashcd /root/html/./rsyncclient.shsleep 2/etc/init.d/tomcat8080 start 123$ chmod a+x rsync_cpnsp$ update-rc.d rsync_cpnsp defaults$ update-rc.d -f tomcat8080 remove åº”ç”¨ï¼šå®ç°ç›’å­çš„æœåŠ¡ã€æ‰‹æœºç«¯è€ƒè¯•åŠPCç«¯è€ƒè¯•çš„è‡ªåŠ¨æ›´æ–° å‰æï¼šç›’å­å¿…é¡»åœ¨è”ç½‘çŠ¶æ€ä¸‹ å¯é€šè¿‡rsyncå®ç°ç›’å­ä¸­æœåŠ¡å’Œå‰ç«¯æ–‡ä»¶ä¸æœåŠ¡ç«¯è¿›è¡ŒåŒæ­¥ã€‚ å› é¿å…åœ¨è€ƒè¯•çŠ¶æ€ä¸‹æœåŠ¡æ›´æ–°çš„å½±å“ï¼Œæ‰€ä»¥åªåœ¨å¼€æœºæ—¶è¿›è¡ŒåŒæ­¥ã€‚ å®ç°ï¼š åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šåˆ›å»ºç›’å­ä¸­æ‰€éœ€çš„æœåŠ¡åŠå‰ç«¯æ–‡ä»¶ã€‚. é…ç½®rsyncåŠå¼€å¯rsyncæœåŠ¡ã€‚. åœ¨ç›’å­ä¸­åˆ›å»ºé€šä¿¡æ–‡ä»¶åŠrsyncåŒæ­¥è„šæœ¬ã€‚. åˆ›å»ºå¼€æœºå¯åŠ¨è„šæœ¬ã€‚ å‚è€ƒï¼š http://www.linuxidc.com/Linux/2014-03/97592.htm http://blog.csdn.net/zpf336/article/details/51659666 rsyncå‚æ•°ï¼šhttp://roclinux.cn/?p=2643","link":"/2017/08/24/%E5%90%8C%E6%AD%A5/Ubuntu%E4%B8%8B%E9%85%8D%E7%BD%AErsync/"},{"title":"Jmeterå‹æµ‹","text":"é¦–å…ˆä½¿ç”¨chromeæ’ä»¶BlazeMeterï¼Œå½•åˆ¶jmeterè¯·æ±‚è„šæœ¬ï¼Œå¯¼å…¥åˆ°jmeterä¸­ã€‚ å¯¹éœ€è¦å¼•ç”¨å¤§é‡çš„å¤–éƒ¨æ•°æ®ï¼Œå¦‚ç”¨æˆ·åå¯†ç ï¼Œå¯ä»¥æ·»åŠ  é…ç½®åŸä»¶â€“&gt;CSV æ•°æ®æ–‡ä»¶è®¾ç½®å˜é‡ï¼Œåœ¨è¯·æ±‚ä¸­è¿›è¡Œå¼•ç”¨ã€‚ å¯¹éœ€è¦å¼•ç”¨è·å–åˆ°çš„è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥åœ¨æ‰€éœ€è¯·æ±‚åæ·»åŠ  åç½®å¤„ç†å™¨â€“&gt;æ­£åˆ™è¡¨è¾¾å¼æå–å™¨,å¯¹å˜é‡å€¼è¿›è¡Œæå–ï¼Œç„¶åå†åç»­è¯·æ±‚ä¸­å¼•ç”¨ã€‚ ä½¿ç”¨é›†åˆç‚¹ï¼Œé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æŒ‡å®šçš„çº¿ç¨‹æ•°é‡åˆ°è¾¾åï¼Œå†ä¸€èµ·é‡Šæ”¾ï¼Œå¯ä»¥ç¬é—´äº§ç”Ÿå¾ˆå¤§çš„å‹åŠ›ã€‚ï¼ˆæ·»åŠ â€“&gt;å®šæ—¶å™¨â€“&gt;åŒæ­¥å®šæ—¶å™¨ï¼‰ï¼ˆå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†çº¿ç¨‹ç»„ä¸€ç›´ä¸ç»“æŸï¼‰ å‹æµ‹ å¼€å¯5000ä¸ªçº¿ç¨‹ç»„æ—¶ï¼Œå¤§é‡è¯·æ±‚æŠ¥é”™ java.net.BindException: Address already in use: connect åŸå› ï¼šå¯èƒ½æ˜¯ç”±TCP / IPç«¯å£è€—å°½å¼•èµ·çš„ã€‚åœ¨éå¸¸é«˜çš„è´Ÿè½½ä¸‹ï¼Œåå¤è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„æœåŠ¡å™¨å¯èƒ½ä¼šè€—å°½ä¸´æ—¶ç«¯å£ã€‚ åˆšåˆšå…³é—­çš„ç«¯å£å·åœ¨é‡æ–°ä½¿ç”¨ä¹‹å‰ï¼Œä¼šä¿æŒä¸€æ®µæ—¶é—´çš„ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœè¿æ¥é€Ÿç‡è¶³å¤Ÿé«˜ï¼Œåˆ™æ‰€æœ‰ç«¯å£æœ€ç»ˆéƒ½å°†å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿå°†æ— æ³•å†å°†è¿æ¥ç»‘å®šåˆ°ç«¯å£ã€‚ æ’æŸ¥ï¼šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ç¡®å®šç«¯å£è€—å°½æ˜¯å¦æ˜¯çœŸæ­£çš„ç“¶é¢ˆ ã€‚ 1ã€åœ¨å³°å€¼è´Ÿè½½ä¸‹ï¼Œè¿è¡Œâ€œ netstat -ano -p tcpâ€å°†åˆ—å‡ºæ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„ç«¯å£ã€‚ 2ã€ä½¿ç”¨â€œ netsh int ipv4 show dynamicport tcpâ€ç›‘è§†èŒƒå›´å†…çš„å¯ç”¨ç«¯å£ã€‚ ç¡®å®šäº†å¦‚æ˜¯å¯¼è‡´çš„åŸå› ï¼Œè§£å†³ 1ã€å¢åŠ åŠ¨æ€ç«¯å£èŒƒå›´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€å¤§å€¼ä¸º5000ï¼Œæœ€å¤šå¯ä»¥å°†å…¶è®¾ç½®ä¸º65534ï¼Œ HKLM\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters\\MaxUserPort ã€‚ 2ã€å‡å°‘TIME_WAIT çŠ¶æ€ çš„æ—¶é—´ ï¼Œé»˜è®¤ä¸º4åˆ†é’Ÿï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸º30ç§’ ï¼Œ HKLM\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters\\TCPTimedWaitDelay ã€‚ å‚è€ƒï¼šAddress already in use: connectâ€ in EngageOne Vault æ¥ä¸‹æ¥æµ‹è¯• åå°æœåŠ¡ä¸­æŠ¥ org.apache.catalina.connector.ClientAbortException: java.io.IOException: Broken pipeã€‚ ä¸»è¦åŸå› æ˜¯ å®¢æˆ·ç«¯å…ˆå…³é—­äº†è¿æ¥ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰æ‰§è¡Œå…³é—­è¿æ¥çš„æ“ä½œã€‚ å‹æµ‹æ—¶åœ¨æœåŠ¡å™¨æ‰§è¡Œ netstat -n | awk â€˜/^tcp/ {++state[$NF]} END {for(key in state) print key,â€\\tâ€,state[key]}â€™ æŸ¥çœ‹äº†ä¸‹å½“æ—¶tcpipè¿æ¥çš„çŠ¶æ€ï¼Œè¿›ä¸€æ­¥æ’æŸ¥ã€‚ è¿™ä¸ªåŸå› æ˜¯å› ä¸ºjmeterçº¿ç¨‹ç»„ä¸€ç›´ä¸ç»“æŸï¼Œåœ¨jmeterä¸­æ‰‹åŠ¨åœæ­¢äº†æ‰€æœ‰çº¿ç¨‹å¯¼è‡´ã€‚ åœ¨jmeterè¯·æ±‚ä¸­ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯java net SocketException: Socket closed å‚è€ƒ:[java.io.IOException: Broken pipe](https://blog.csdn.net/zqz_zqz/article/details/52235479 N ) æ¥ç€æµ‹è¯• ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡åˆ°ä¸¤ä¸ªåå°æœåŠ¡æ—¶ï¼Œnginxæ—¥å¿—å‘ç°socket() failed (24: Too many open files) while connecting to upstream ä¿®æ”¹linuxæ‰“å¼€æ–‡ä»¶å¥æŸ„æ•°(å¯èƒ½é‡åˆ°ä¿®æ”¹åä¸ç”Ÿæ•ˆé—®é¢˜) å‚è€ƒ:ulimit: open files: cannot modify limit 123456789$ vim /etc/security/limits.confroot soft nproc 16384root hard nproc 16384root soft nofile 65535root hard nofile 65535root soft memlock 4000000root hard memlock 4000000$ shutdown â€“r now #é‡å¯æœåŠ¡å™¨$ ulimit -a #æ£€æŸ¥ç”Ÿæ•ˆå¦ ä¿®æ”¹nginxæ‰“å¼€æ–‡ä»¶æ•° åœ¨nginx.conf æ·»åŠ äº†worker_rlimit_nofile 20480; æ¥ç€æµ‹è¯• åé¢æµ‹è¯•nginxåˆæŠ¥1024 worker_connections are not enoughã€‚ ä¿®æ”¹nginx.confä¸­é…ç½® worker_connections 10240 å†æ¬¡æµ‹è¯• å‘ç°æœ‰äº›è¯·æ±‚nginxå¼‚å¸¸ 131175 no live upstreams while connecting to upstream å‘ç°nginxè´Ÿè½½åˆ°çš„å…¶ä¸­ä¸€ä¸ªæœåŠ¡æ²¡å¯åŠ¨ã€‚ æ’ä»¶ jp@gc - PerfMon Metrics Collectorï¼šæœåŠ¡å™¨æ€§èƒ½ç›‘æµ‹æ§ä»¶ï¼ŒåŒ…æ‹¬CPUï¼ŒMemoryï¼ŒNetworkï¼Œï¼©/ï¼¯ç­‰ç­‰ï¼ˆæ­¤åŠŸèƒ½ç”¨åˆ°åœ¨éœ€ç›‘å¬çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨startAgentï¼‰ æ ¹æ®éœ€è¦é€‰æ‹©CPUï¼ŒMemoryï¼ŒNetwork ï¼©/ï¼¯ç­‰ PerfMon wiki jp@gc - Respose Times Over Timeï¼š å“åº”æ—¶é—´è¶…æ—¶ï¼Œæ˜¾ç¤ºæ¯ä¸ªé‡‡æ ·ä»¥æ¯«ç§’ä¸ºå•ä½çš„å¹³å‡å“åº”æ—¶é—´ jp@gc - Transactions per Secondï¼š æ¯ç§’äº‹åŠ¡æ•°ï¼ŒæœåŠ¡å™¨æ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•° jp@gc - Actiive Threads Over Timeï¼šä¸åŒæ—¶é—´çš„æ´»åŠ¨ç”¨æˆ·æ•°é‡å±•ç¤º jp@gc - Reponse Times Distributionï¼š æ˜¾ç¤ºæµ‹è¯•çš„å“åº”æ—¶é—´åˆ†å¸ƒï¼ŒXè½´æ˜¾ç¤ºç”±æ—¶é—´é—´éš”åˆ†ç»„çš„å“åº”æ—¶é—´ï¼ŒYè½´åŒ…å«æ¯ä¸ªåŒºé—´çš„æ ·æœ¬æ•° Distribution/Percentile Graphs JMeteråˆ†å¸ƒå¼å¹¶å‘æ—¶ï¼Œå‡ ä¸ªé—®é¢˜è§£å†³æ–¹æ³•ï¼Œ1ã€æ¯ä¸ªrequestçš„å…·ä½“responseè¿”å›ã€‚2ã€ç¦æ‰ä¸ä½¿ç”¨çš„è™šæ‹Ÿæœºç½‘å¡ https://www.cnblogs.com/jane4321/p/11013042.html https://www.zhihu.com/question/45406520 https://www.cnblogs.com/zonlo/p/8422583.html","link":"/2019/12/16/%E5%B7%A5%E4%BD%9C/Jmeter%E5%8E%8B%E6%B5%8B-DESKTOP-S52MH0E/"},{"title":"Jmeterå‹æµ‹","text":"é¦–å…ˆä½¿ç”¨chromeæ’ä»¶BlazeMeterï¼Œå½•åˆ¶jmeterè¯·æ±‚è„šæœ¬ï¼Œå¯¼å…¥åˆ°jmeterä¸­ã€‚ å¯¹éœ€è¦å¼•ç”¨å¤§é‡çš„å¤–éƒ¨æ•°æ®ï¼Œå¦‚ç”¨æˆ·åå¯†ç ï¼Œå¯ä»¥æ·»åŠ  é…ç½®åŸä»¶â€“&gt;CSV æ•°æ®æ–‡ä»¶è®¾ç½®å˜é‡ï¼Œåœ¨è¯·æ±‚ä¸­è¿›è¡Œå¼•ç”¨ã€‚ å¯¹éœ€è¦å¼•ç”¨è·å–åˆ°çš„è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥åœ¨æ‰€éœ€è¯·æ±‚åæ·»åŠ  åç½®å¤„ç†å™¨â€“&gt;æ­£åˆ™è¡¨è¾¾å¼æå–å™¨,å¯¹å˜é‡å€¼è¿›è¡Œæå–ï¼Œç„¶åå†åç»­è¯·æ±‚ä¸­å¼•ç”¨ã€‚ ä½¿ç”¨é›†åˆç‚¹ï¼Œé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æŒ‡å®šçš„çº¿ç¨‹æ•°é‡åˆ°è¾¾åï¼Œå†ä¸€èµ·é‡Šæ”¾ï¼Œå¯ä»¥ç¬é—´äº§ç”Ÿå¾ˆå¤§çš„å‹åŠ›ã€‚ï¼ˆæ·»åŠ â€“&gt;å®šæ—¶å™¨â€“&gt;åŒæ­¥å®šæ—¶å™¨ï¼‰ï¼ˆå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†çº¿ç¨‹ç»„ä¸€ç›´ä¸ç»“æŸï¼‰ å‹æµ‹ å¼€å¯5000ä¸ªçº¿ç¨‹ç»„æ—¶ï¼Œå¤§é‡è¯·æ±‚æŠ¥é”™ java.net.BindException: Address already in use: connect åŸå› ï¼šå¯èƒ½æ˜¯ç”±TCP / IPç«¯å£è€—å°½å¼•èµ·çš„ã€‚åœ¨éå¸¸é«˜çš„è´Ÿè½½ä¸‹ï¼Œåå¤è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„æœåŠ¡å™¨å¯èƒ½ä¼šè€—å°½ä¸´æ—¶ç«¯å£ã€‚ åˆšåˆšå…³é—­çš„ç«¯å£å·åœ¨é‡æ–°ä½¿ç”¨ä¹‹å‰ï¼Œä¼šä¿æŒä¸€æ®µæ—¶é—´çš„ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœè¿æ¥é€Ÿç‡è¶³å¤Ÿé«˜ï¼Œåˆ™æ‰€æœ‰ç«¯å£æœ€ç»ˆéƒ½å°†å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿå°†æ— æ³•å†å°†è¿æ¥ç»‘å®šåˆ°ç«¯å£ã€‚ æ’æŸ¥ï¼šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ç¡®å®šç«¯å£è€—å°½æ˜¯å¦æ˜¯çœŸæ­£çš„ç“¶é¢ˆ ã€‚ 1ã€åœ¨å³°å€¼è´Ÿè½½ä¸‹ï¼Œè¿è¡Œâ€œ netstat -ano -p tcpâ€å°†åˆ—å‡ºæ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„ç«¯å£ã€‚ 2ã€ä½¿ç”¨â€œ netsh int ipv4 show dynamicport tcpâ€ç›‘è§†èŒƒå›´å†…çš„å¯ç”¨ç«¯å£ã€‚ ç¡®å®šäº†å¦‚æ˜¯å¯¼è‡´çš„åŸå› ï¼Œè§£å†³ 1ã€å¢åŠ åŠ¨æ€ç«¯å£èŒƒå›´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€å¤§å€¼ä¸º5000ï¼Œæœ€å¤šå¯ä»¥å°†å…¶è®¾ç½®ä¸º65534ï¼Œ HKLM\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters\\MaxUserPort ã€‚ 2ã€å‡å°‘TIME_WAIT çŠ¶æ€ çš„æ—¶é—´ ï¼Œé»˜è®¤ä¸º4åˆ†é’Ÿï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸º30ç§’ ï¼Œ HKLM\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters\\TCPTimedWaitDelay ã€‚ å‚è€ƒï¼šAddress already in use: connectâ€ in EngageOne Vault æ¥ä¸‹æ¥æµ‹è¯• åå°æœåŠ¡ä¸­æŠ¥ org.apache.catalina.connector.ClientAbortException: java.io.IOException: Broken pipeã€‚ ä¸»è¦åŸå› æ˜¯ å®¢æˆ·ç«¯å…ˆå…³é—­äº†è¿æ¥ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰æ‰§è¡Œå…³é—­è¿æ¥çš„æ“ä½œã€‚ å‹æµ‹æ—¶åœ¨æœåŠ¡å™¨æ‰§è¡Œ netstat -n | awk â€˜/^tcp/ {++state[$NF]} END {for(key in state) print key,â€\\tâ€,state[key]}â€™ æŸ¥çœ‹äº†ä¸‹å½“æ—¶tcpipè¿æ¥çš„çŠ¶æ€ï¼Œè¿›ä¸€æ­¥æ’æŸ¥ã€‚ è¿™ä¸ªåŸå› æ˜¯å› ä¸ºjmeterçº¿ç¨‹ç»„ä¸€ç›´ä¸ç»“æŸï¼Œåœ¨jmeterä¸­æ‰‹åŠ¨åœæ­¢äº†æ‰€æœ‰çº¿ç¨‹å¯¼è‡´ã€‚ åœ¨jmeterè¯·æ±‚ä¸­ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯java net SocketException: Socket closed å‚è€ƒ:[java.io.IOException: Broken pipe](https://blog.csdn.net/zqz_zqz/article/details/52235479 N ) æ¥ç€æµ‹è¯• ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡åˆ°ä¸¤ä¸ªåå°æœåŠ¡æ—¶ï¼Œnginxæ—¥å¿—å‘ç°socket() failed (24: Too many open files) while connecting to upstream ä¿®æ”¹linuxæ‰“å¼€æ–‡ä»¶å¥æŸ„æ•°(å¯èƒ½é‡åˆ°ä¿®æ”¹åä¸ç”Ÿæ•ˆé—®é¢˜) å‚è€ƒ:ulimit: open files: cannot modify limit 123456789$ vim /etc/security/limits.confroot soft nproc 16384root hard nproc 16384root soft nofile 65535root hard nofile 65535root soft memlock 4000000root hard memlock 4000000$ shutdown â€“r now #é‡å¯æœåŠ¡å™¨$ ulimit -a #æ£€æŸ¥ç”Ÿæ•ˆå¦ ä¿®æ”¹nginxæ‰“å¼€æ–‡ä»¶æ•° åœ¨nginx.conf æ·»åŠ äº†worker_rlimit_nofile 20480; æ¥ç€æµ‹è¯• åé¢æµ‹è¯•nginxåˆæŠ¥1024 worker_connections are not enoughã€‚ ä¿®æ”¹nginx.confä¸­é…ç½® worker_connections 10240 å†æ¬¡æµ‹è¯• å‘ç°æœ‰äº›è¯·æ±‚nginxå¼‚å¸¸ 131175 no live upstreams while connecting to upstream å‘ç°nginxè´Ÿè½½åˆ°çš„å…¶ä¸­ä¸€ä¸ªæœåŠ¡æ²¡å¯åŠ¨ã€‚ æ’ä»¶ jp@gc - PerfMon Metrics Collectorï¼šæœåŠ¡å™¨æ€§èƒ½ç›‘æµ‹æ§ä»¶ï¼ŒåŒ…æ‹¬CPUï¼ŒMemoryï¼ŒNetworkï¼Œï¼©/ï¼¯ç­‰ç­‰ï¼ˆæ­¤åŠŸèƒ½ç”¨åˆ°åœ¨éœ€ç›‘å¬çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨startAgentï¼‰ æ ¹æ®éœ€è¦é€‰æ‹©CPUï¼ŒMemoryï¼ŒNetwork ï¼©/ï¼¯ç­‰ PerfMon wiki jp@gc - Respose Times Over Timeï¼š å“åº”æ—¶é—´è¶…æ—¶ï¼Œæ˜¾ç¤ºæ¯ä¸ªé‡‡æ ·ä»¥æ¯«ç§’ä¸ºå•ä½çš„å¹³å‡å“åº”æ—¶é—´ jp@gc - Transactions per Secondï¼š æ¯ç§’äº‹åŠ¡æ•°ï¼ŒæœåŠ¡å™¨æ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•° jp@gc - Actiive Threads Over Timeï¼šä¸åŒæ—¶é—´çš„æ´»åŠ¨ç”¨æˆ·æ•°é‡å±•ç¤º jp@gc - Reponse Times Distributionï¼š æ˜¾ç¤ºæµ‹è¯•çš„å“åº”æ—¶é—´åˆ†å¸ƒï¼ŒXè½´æ˜¾ç¤ºç”±æ—¶é—´é—´éš”åˆ†ç»„çš„å“åº”æ—¶é—´ï¼ŒYè½´åŒ…å«æ¯ä¸ªåŒºé—´çš„æ ·æœ¬æ•° Distribution/Percentile Graphs JMeteråˆ†å¸ƒå¼å¹¶å‘æ—¶ï¼Œå‡ ä¸ªé—®é¢˜è§£å†³æ–¹æ³•ï¼Œ1ã€æ¯ä¸ªrequestçš„å…·ä½“responseè¿”å›ã€‚2ã€ç¦æ‰ä¸ä½¿ç”¨çš„è™šæ‹Ÿæœºç½‘å¡ https://www.cnblogs.com/jane4321/p/11013042.html 1./bin/jmeter-server -Djava.rmi.server.hostname=192.168.1.80 https://www.zhihu.com/question/45406520","link":"/2019/12/16/%E5%B7%A5%E4%BD%9C/Jmeter%E5%8E%8B%E6%B5%8B/"},{"title":"WindowsæŸ¥çœ‹ç«¯å£å ç”¨è¿›ç¨‹","text":"æŸ¥çœ‹8080ç«¯å£å¯¹åº”çš„è¿›ç¨‹pid 1&gt; netstat -ano |findstr 8080 å³å¯å¾—åˆ° pidï¼Œç”±ä¸‹å›¾çŸ¥ï¼Œ8080ç«¯å£å¯¹åº”è¿›ç¨‹pidä¸º11200 æŸ¥çœ‹è¯¥PIDå¯¹åº”çš„è¿›ç¨‹åç§°ã€‚ 1&gt; tasklist |findstr 11200 ç”±ä¸‹å›¾çŸ¥ï¼Œè¿›ç¨‹pid 11200å¯¹åº”è¿›ç¨‹åç§°ä¸ºjavaw.exeã€‚ å¦‚ä¸‹å›¾ï¼š ç„¶åè°ƒå‡ºä»»åŠ¡ç®¡ç†å™¨ ç‚¹å‡»ï¼šæŸ¥çœ‹â€“&gt;é€‰æ‹©åˆ—â€“&gt;å‹¾é€‰pid ä¹‹åå³å¯åœ¨ä»»åŠ¡ç®¡ç†å™¨çš„è¿›ç¨‹ä¸­å¯¹è¯¥è¿›ç¨‹æ‰§è¡Œæ“ä½œï¼ˆç»“æŸè¿›ç¨‹ï¼‰ã€‚","link":"/2018/09/28/%E5%B7%A5%E4%BD%9C/Windows%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E8%BF%9B%E7%A8%8B/"},{"title":"fastdfs","text":"ç¼–è¯‘ç¯å¢ƒ 1$ apt-get install build-essential libtool libpcre3-dev libpcre3 zlib1g-dev openssl libssl-dev ä¸€ä¸ªtrackeræœåŠ¡å¯¹åº”ä¸€ä¸ªstorageï¼Œstorageä¸­å­˜åœ¨ä¸€ä¸ªstore_pathã€‚ ä½ç½® ç›¸å…³å®‰è£…åŒ…è·¯å¾„ /usr/local/src/fastdfs fastdfé…ç½®æ–‡ä»¶ /etc/fdfs trackeråŸºç¡€ä¿¡æ¯ä½ç½® /ssdb2/data/fastdfs/tracker storageåŸºç¡€ä¿¡æ¯ä½ç½® /ssdb2/data/fastdfs/storage/storage_base storageæ–‡ä»¶å­˜å‚¨è·¯å¾„ /ssdb2/data/fastdfs/storage/storage_data1 2ã€ 2.1 libfastcommonåŒ…å®‰è£… 123$ git clone https://github.com/happyfish100/libfastcommon.git --depth 1$ cd libfastcommon/$ ./make.sh &amp;&amp; ./make.sh install 2.2 FastDFS å®‰è£… 1234567891011$ cd ../ #è¿”å›ä¸Šä¸€çº§ç›®å½•$ git clone https://github.com/happyfish100/fastdfs.git --depth 1$ cd fastdfs/$ ./make.sh &amp;&amp; ./make.sh install##é…ç½®æ–‡ä»¶å‡†å¤‡$ cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf$ cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf$ cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œæµ‹è¯•ç”¨$ cp /usr/local/src/fastdfs/fastdfs/conf/http.conf /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨$ cp /usr/local/src/fastdfs/fastdfs/conf/mime.types /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨ 2.3 ä¸‹è½½fastdfs-nginx-module 123$ cd ../ #è¿”å›ä¸Šä¸€çº§ç›®å½•$ git clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1$ cp /usr/local/src/fastdfs/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/ 2.4 å®‰è£…nginx 1234567$ cd /usr/local/src/nginx$ wget http://nginx.org/download/nginx-1.16.1.tar.gz$ tar -zxvf nginx-1.16.1.tar.gz$ cd nginx-1.16.1/## æ·»åŠ fastdfs-nginx-moduleæ¨¡å—$ ./configure --prefix=/usr/local/nginx --with-http_ssl_module --add-module=/usr/local/src/fastdfs/fastdfs-nginx-module/src$ make &amp;&amp; make install #ç¼–è¯‘å®‰è£… 2.5 Tracker å®‰è£… åˆ›å»ºTrackeræœåŠ¡å™¨çš„æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå­˜å‚¨Trackerçš„æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ç­‰ï¼š 1$ makdir /ssdb2/data/fastdfs/tracker ç¼–è¾‘trackeré…ç½®æ–‡ä»¶/etc/fdfs/tracker.confï¼Œéƒ¨åˆ†é…ç½®å‚æ•°é‡Šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516vim /etc/fdfs/tracker.confdisabled=false #å¯ç”¨é…ç½®æ–‡ä»¶(é»˜è®¤false)bind_addr= #è§£æä¸»æœºåœ°å€ï¼Œç©ºåˆ™è§£ææ‰€æœ‰ä¸»æœºport=22122 #trackeræœåŠ¡ç«¯å£connect_timeout=30 #è¿æ¥è¶…æ—¶æ—¶é—´30Snetwork_timeout=60 #ç½‘ç»œè¶…æ—¶æ—¶é—´60Sbase_path=/ssdb2/data/fastdfs/tracker #trackeråŸºç¡€æ•°æ®å­˜å‚¨è·¯å¾„åŠæ—¥å¿—å­˜æ”¾è·¯å¾„max_connections=256 #æœ€å¤§å¹¶å‘è¿æ¥æ•°work_threads=4 #å·¥ä½œçº¿ç¨‹æ•°ï¼Œæœ€å¥½å’Œcpuæ ¸æ•°ä¿æŒä¸€è‡´store_lookup=0 #é€‰æ‹©ä¸Šä¼ æ–‡ä»¶æ¨¡å¼ 0ä»£è¡¨groupè½®è¯¢ 1æŒ‡å®šç‰¹å®šgroup 2é€‰æ‹©ç©ºé—´æœ€å¤§çš„group#store_group= #ä¸Šä¼ æ–‡ä»¶ç»„ï¼Œå¦‚æœæ¨¡å¼ä¸º1ï¼Œåˆ™å¿…é¡»è®¾ç½®æˆæ ¸ç‰¹å®šgroupä¸€è‡´çš„ç»„åstore_server=0 #é€‰æ‹©å­˜å‚¨æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ 0ä»£è¡¨è½®è¯¢ï¼Œ1æ ¹æ®é€šè¿‡IPç¬¬çš„é¡ºåº 2é€šè¿‡ä¼˜å…ˆçº§store_path=0 #é€‰æ‹©å“ªå—å­˜å‚¨ç›˜ä¸Šä¼ æ–‡ä»¶ 0ä»£è¡¨è½®è¯¢ï¼Œ2ä»£è¡¨ä¼˜å…ˆæœ€å¤§å­˜å‚¨ç©ºé—´ç›˜(è·¯å¾„)download_server=0 #é€‰æ‹©å“ªå°å­˜å‚¨æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶0ä»£è¡¨è½®è¯¢ï¼Œ1ä»£è¡¨å½“å‰æ–‡ä»¶ä¸Šä¼ çš„æºæœåŠ¡å™¨reserved_storage_space = 10% #ç³»ç»Ÿä¿ç•™å­˜å‚¨ç©ºé—´10%######å…¶ä½™éƒ½é»˜è®¤å°±å¥½ å¯åŠ¨trackeræœåŠ¡ 12$ /etc/init.d/fdfs_trackerd start$ netstat -unltp|grep fdfs # æ£€æŸ¥æœåŠ¡è¿è¡Œçš„22122ç«¯å£æ˜¯å¦æ­£å¸¸ 2.6 Storageå®‰è£… åˆ›å»ºStorageæœåŠ¡å™¨çš„æ–‡ä»¶ç›®å½•ï¼Œæ³¨æ„åŒTrackerç›¸æ¯”è¦å¤šå»ºä¸€ä¸ªç›®å½•ï¼Œå› ä¸ºStorageè¿˜éœ€è¦ä¸€ä¸ªæ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œç”¨äºå­˜æ”¾æ¥æ”¶çš„æ–‡ä»¶ï¼š 12$ mkdir /ssdb2/data/fastdfs/storage/storage_base$ mkdir /ssdb2/data/fastdfs/storage/storage_data1 ä¿®æ”¹/etc/fdfs/storage.confé…ç½®æ–‡ä»¶ï¼Œéƒ¨åˆ†é…ç½®å‚æ•°é‡Šä¹‰å¦‚ä¸‹ 123456789group_name=group1 #å­˜å‚¨ç»„åclient_bind=true #å½“è¿æ¥å…¶ä»–æœåŠ¡å™¨æ—¶è§£æè¯¥ä¸»æœºåœ°å€port=23000 #storageç«¯å£ 23000store_path_count=1 #å­˜å‚¨è·¯å¾„ä¸ªæ•°ï¼Œéœ€è¦å’Œstore_pathä¸ªæ•°åŒ¹é…base_path=/ssdb2/data/fastdfs/storage/storage_base #åŸºç¡€å­˜å‚¨æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶store_path0=/ssdb2/data/fastdfs/storage/storage_data #groupæ‰€å ç”¨çš„ç›®å½•æˆ–ç¡¬ç›˜ï¼Œæœ‰å‡ ä¸ªå†™å‡ ä¸ªtracker_server=192.168.1.80:22122 #æŒ‡å®štracker1æœåŠ¡å™¨#tracker_server=10.124.164.138:22122 #æŒ‡å®štracker2æœåŠ¡å™¨#tracker_server=10.124.164.139:22122 #æŒ‡å®štracker3æœåŠ¡å™¨ å¯åŠ¨StorageæœåŠ¡ï¼š 12$ /etc/init.d/fdfs_storaged start #å¯åŠ¨storageæœåŠ¡$ netstat -unltp|grep fdfs # æ£€æŸ¥ä¸€ä¸‹storageæœåŠ¡çš„ç«¯å£ç›‘å¬æƒ…å†µ æˆåŠŸåï¼Œå°†åœ¨/ssdb2/data/fastdfs/storage/storage_data/dataç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶å¤¹ï¼Œdataä¸‹æœ‰256ä¸ª1çº§ç›®å½•ï¼Œæ¯çº§ç›®å½•ä¸‹åˆæœ‰256ä¸ª2çº§å­ç›®å½•ï¼Œæ€»å…±65536ä¸ªæ–‡ä»¶å¤¹ã€‚ æ–°å†™çš„æ–‡ä»¶ä¼šä»¥hashçš„æ–¹å¼è¢«è·¯ç”±åˆ°å…¶ä¸­æŸä¸ªå­ç›®å½•ä¸‹ï¼Œç„¶åå°†æ–‡ä»¶æ•°æ®ç›´æ¥ä½œä¸ºä¸€ä¸ªæœ¬åœ°æ–‡ä»¶å­˜å‚¨åˆ°è¯¥ç›®å½•ä¸­ã€‚ 2.7 ä¿®æ”¹æœ¬åœ°å®¢æˆ·ç«¯é…ç½® åˆ›å»ºäº†å®¢æˆ·ç«¯åŸºç¡€æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶ç›®å½• 1$ mkdir /ssdb2/data/fastdfs/client ä¿®æ”¹å®¢æˆ·ç«¯é…ç½® 12345vim /etc/fdfs/client.confbase_path=/ssdb2/data/fastdfs/client #åŸºç¡€æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶tracker_server=192.168.1.80:22122 #tracker1æœåŠ¡å™¨#tracker_server=10.124.164.138:22122 #tracker2æœåŠ¡å™¨#tracker_server=10.124.164.139:22122 #tracker3æœåŠ¡å™¨ 2.8 ç¼–è¾‘mod_fastdfs.confæ–‡ä»¶ 12345678vim /etc/fdfs/mod_fastdfs.confï¼šbase_path=/ssdb2/data/fastdfs/storage/storage_base #ä¿®æ”¹æˆå’Œstorage å­˜æ”¾è·¯å¾„ä¸€è‡´tracker_server=192.168.1.80:22122 #é…ç½®æˆtracker server åœ°å€å’Œç«¯å£#tracker_server=10.124.164.138:22122 #é…ç½®æˆtracker server åœ°å€å’Œç«¯å£#tracker_server=10.124.164.139:22122 #é…ç½®æˆtracker server åœ°å€å’Œç«¯å£url_have_group_name = true #urlä¸­æ˜¯å¦åŒ…ç»„å(é»˜è®¤ä¸ºfalseï¼Œéœ€è¦æ”¹æˆtrue)store_path0=/ssdb2/data/fastdfs/storage/storage_data1 #æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œä¸storage ä¸€è‡´group_count = 0 #0ä»£è¡¨å•ç»„ï¼Œéé›¶ä»£è¡¨å¤šç»„ï¼Œä¸€èˆ¬è®¾ç½®å‡ å°±ä¸ºå‡ ç»„ 2.9 é…ç½®nginxè®¿é—® 12345678910111213$ vim /usr/local/nginx/conf/conf.d/fastdfs.conf#æ·»åŠ å¦‚ä¸‹é…ç½®server { listen 8888; ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çš„http.server_portç›¸åŒ server_name localhost; location ~/group[0-9]/ { ngx_fastdfs_module; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; }} 2.10 clientæµ‹è¯• 12$ fdfs_upload_file /etc/fdfs/client.conf /ssdb1/temp.jpggroup1/M00/00/00/wKgBUF3Lnq6ALtZwAAC9nZtf_Qw171.jpg è®¿é—® 1http://192.168.1.80:8888/group1/M00/00/00/wKgBUF3Lnq6ALtZwAAC9nZtf_Qw171.jpg å‚è€ƒï¼šfastdfs/wiki FastDFSéƒ¨ç½²åŠä½¿ç”¨ç®€ä»‹","link":"/2019/11/12/%E5%B7%A5%E4%BD%9C/fastdfs/"},{"title":"fastdfsæ·»åŠ åˆ†ç»„","text":"fastdfsæ·»åŠ groupã€‚ å¤šä¸ªgroupï¼Œå°±éœ€è¦å¤šä¸ªstorageï¼Œæ¯ä¸ªstorageå¯¹åº”ä¸€ä¸ªgroup æ¯ä¸ªgroupå¯å¯¹åº”å¤šä¸ªstore_pathï¼ˆstore_path0ã€store_path1ã€store_path2ç­‰ï¼‰ä½œç”¨æ˜¯ä¸ºäº†æ‰©å®¹ï¼Œå³å…¶ä¸­ä¸€ä¸ªstore_path0ç©ºé—´å­˜å‚¨å°†è¦æ»¡äº†ï¼Œå¯è‡ªåŠ¨å­˜å‚¨åˆ°store_path1ã€store_path2é‡Œã€‚ éœ€æ±‚ï¼šæ·»åŠ group2ç»„ï¼Œä»¥åŠgroup2ç»„å¯¹åº”å­˜å‚¨è·¯å¾„storage2 1ã€å¤åˆ¶storageé…ç½®æ–‡ä»¶ cp /etc/fdfs/storage.conf /etc/fdfs/storage2.conf 2ã€ä¿®æ”¹ storage2.conf 12345group_name=group2port=24000base_path=/ssdb2/data/fastdfs/storage2/storage_basestore_path0=/ssdb2/data/fastdfs/storage2/storage_data1store_path1=/ssdb2/data/fastdfs/storage2/storage_data2 å…¶å®ƒçš„æŒ‰group1è®¾ç½®çš„é»˜è®¤å³å¯ã€‚ 3ã€ä¿®æ”¹mod_fastdfs.conf 123456789101112131415161718192021group_count = 2# group settings for group #1# since v1.14# when support multi-group on this storage server, uncomment following section[group1]group_name=group1storage_server_port=23000store_path_count=2store_path0=/ssdb2/data/fastdfs/storage1/storage_data1store_path1=/ssdb2/data/fastdfs/storage1/storage_data2#store_path1=/home/yuqing/fastdfs1# group settings for group #2# since v1.14# when support multi-group, uncomment following section as neccessary[group2]group_name=group2storage_server_port=24000store_path_count=2store_path0=/ssdb2/data/fastdfs/storage2/storage_data1store_path1=/ssdb2/data/fastdfs/storage2/storage_data2 è®¾ç½®äº†å¤šä¸ªgroupåï¼Œå…¶å®ƒå‚æ•°å¦‚base_pathã€storage_server_portã€group_nameã€store_path0å¯ä¸ç”¨è®¾ç½®ï¼Œ 4ã€å¯åŠ¨group2 storage 1$ fdfs_storaged /etc/fdfs/storage2.conf 5ã€æ£€æµ‹é›†ç¾¤ 12/usr/bin/fdfs_monitor /etc/fdfs/storage.conf# ä¼šæ˜¾ç¤ºä¼šæœ‰å‡ å°æœåŠ¡å™¨ æœ‰3å°å°±ä¼š æ˜¾ç¤º Storage 1-Storage 2çš„è¯¦ç»†ä¿¡æ¯ ä¸€å°æœåŠ¡å™¨å¯ä»¥è£…å¤šä¸ªç»„(group)ï¼Œå°±éœ€è¦å¤šä¸ªstorageï¼Œæ¯ä¸ªstorageå¯¹åº”ä¸€ä¸ªgroupã€‚ ä¸èƒ½åŒä¸€å°æœåŠ¡å™¨è£…åŒç»„çš„å¤šä¸ªStorageï¼ŒåŒç»„(group)çš„Storage2å’ŒStorage3 FastDFSæœåŠ¡ç«¯å£å¿…é¡»ä¸€è‡´","link":"/2019/11/20/%E5%B7%A5%E4%BD%9C/fastdfs%E5%88%86%E7%BB%84/"},{"title":"javaæœåŠ¡CPUå ç”¨é«˜","text":"ç”±ä¸Šç¯‡å†…å­˜å ç”¨è¿‡é«˜ï¼Œæœªå®šä½åˆ°å‡†ç¡®çš„é—®é¢˜ï¼Œä»Šå¤©æŸæ—¶æ®µæœåŠ¡çš„CPUçªç„¶å ç”¨é«˜ï¼Œæˆ–è®¸æ˜¯å¼•èµ·å†…å­˜å ç”¨çš„å…ƒå‡¶ã€‚ â‘ é€šè¿‡topæ‰¾åˆ°å ç”¨cpuæœ€é«˜çš„ pid[è¿›ç¨‹id] é€šè¿‡Shift+PæŒ‰CUPæ’åºï¼Œå®šä½åˆ°pidæ˜¯ 13748 â‘¡é€šè¿‡ top -Hp pid æŸ¥çœ‹è¿›ç¨‹ä¸­å ç”¨cpuè¿‡é«˜çš„ tid[çº¿ç¨‹id] å ç”¨cpuè¿‡é«˜çš„çº¿ç¨‹æœ‰äº”ä¸ªï¼Œä»¥å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹åšç¤ºä¾‹ â‘¢é€šè¿‡ printf â€˜%x/nâ€™ tid æŠŠçº¿ç¨‹idè½¬åŒ–ä¸ºåå…­è¿›åˆ¶ 12$ printf '%x/n' 1379635e4 â‘£é€šè¿‡ jstack pid | grep tid -A 50 å®šä½çº¿ç¨‹å †æ ˆä¿¡æ¯ â‘¤ æ ¹æ®å †æ ˆä¿¡æ¯å°±å¯ä»¥å®šä½ä»£ç  å‘ç°occupationIdsè¿›è¡Œäº†æ— é™å¾ªç¯ã€‚ â‘¥åŒæ ·æŠŠå‰©ä½™çš„4ä¸ªçº¿ç¨‹åˆ†æä¸‹ä¹Ÿæ˜¯æ­¤åŸå›  ä¹‹å‰é€šè¿‡dumpçº¿ä¸Šç¯å¢ƒçš„JVMå†…å­˜è¿›è¡Œåˆ†æï¼Œæœ‰æ­¤æ–¹æ³•çš„å½±å­ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®Œå…¨ç¡®å®šã€‚ åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªè¾ƒå¿«å®šä½é—®é¢˜è¯·æ±‚çš„æ–¹æ³•(JVM å †å†…å­˜ä½¿ç”¨ç‡æŒç»­ä¸Šå‡çš„ä¸€ç§æ’æŸ¥æ€è·¯) ï¼Œç›´æ¥åœ¨nginxæ—¥å¿—ä¸­æœç´¢å“åº”ç ä¸º504çš„è¯·æ±‚ï¼Œç„¶åçœ‹æ—¥å¿—æ—¶é—´æ˜¯å¦ä¸å†…å­˜æˆ–CPUä¸Šå‡æ—¶é—´ç‚¹å»åˆï¼Œåˆ†æ504çš„è¯·æ±‚ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨æ­»å¾ªç¯ã€‚504å“åº”ç ä¸ºç½‘å…³è¶…æ—¶ï¼Œå½“ä¸€ä¸ªè¯·æ±‚åˆ°Tomcatåï¼Œtomcatå¦‚æœé™·å…¥æ­»å¾ªç¯ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚è‡ªç„¶æ— æ³•å¾—åˆ°å“åº”ï¼Œnginxç­‰å¾…å“åº”è¶…æ—¶ï¼Œå“åº”ç»™ç”¨æˆ·504ã€‚ å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/69342660","link":"/2020/04/20/%E5%B7%A5%E4%BD%9C/java%E6%9C%8D%E5%8A%A1CPU%E5%8D%A0%E7%94%A8%E9%AB%98/"},{"title":"cwRsyncServer+rsyncå®ç°æ–‡ä»¶ä»windowsåŒæ­¥åˆ°linux","text":"cwRsyncServer+rsyncå®ç°æ–‡ä»¶ä»windowsåŒæ­¥åˆ°linuxéœ€æ±‚ï¼šå®ç°æŠŠWindowsæŸæ–‡ä»¶å¤¹åŒæ­¥åˆ°linuxä¸‹1ã€åœ¨Windowsä¸‹å®‰è£…cwRsyncServer4.1.0å¹¶é…ç½® ä¸‹è½½cwRsyncServerï¼šhttps://pan.baidu.com/s/1ge6xpKnå›¾ï¼šå®‰è£…1è®¾ç½®ç”¨æˆ·årsync å¯†ç ï¼šrsync ä¿®æ”¹rsyncd.confé…ç½®æ–‡ä»¶12345678910111213141516171819use chroot = falsestrict modes = falsehosts allow = *log file = rsyncd.loguid = 0gid = 0# Module definitions# Remember cygwin naming conventions : c:\\work becomes /cygwin/c/work#[cpnsp] #æŒ‡å®šæ¨¡å—çš„å¤´ä¿¡æ¯path = /cygdrive/e/server/tomcat4/wtpwebapps #éœ€è¦åŒæ­¥æ•°æ®çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æŒ‡E:\\server\\tomcat4\\wtpwebappsç›®å½•exclude from = rsync.exclude #æ’é™¤è¦åŒæ­¥è¿‡å»çš„æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶å¤¹#exclude = test1/read only = false #æ˜¯å¦ä¸ºåªè¯»transfer logging = yeshosts allow =192.168.1.111 #å…è®¸è®¿é—®çš„ä¸»æœºï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”auth users = rsync #æŒ‡å®šè®¤è¯çš„ç”¨æˆ·åsecrets file = /cygdrive/d/ProgramFiles/cwRsync/ICW/rsyncd.secrets #æŒ‡å®šè®¤è¯ç”¨æˆ·çš„å¯†ç æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æŒ‡d:\\ProgramFiles\\cwRsync\\ICW\\rsyncd.secrets,ä¸€ä¼šéœ€è¦æ–°å»ºè¿™ä¸ªæ–‡ä»¶ã€‚ æ³¨æ„ï¼šè¦æ·»åŠ uid = 0åŠgid = 0ã€‚ åˆ›å»ºrsyncd.secretsæ–‡ä»¶1rsync:rsync åˆ›å»ºrsync.excludeæ–‡ä»¶ï¼ˆä¸rsyncd.confåŒç›®å½•ä¸‹ï¼‰12345WEB-INF/classes/sysproperty.propertiesWEB-INF/classes/mongodb.propertiesWEB-INF/classes/redis.propertiesckeditor/wlw/ ä¿®æ”¹cpnspæ–‡ä»¶å¤¹çš„å±æ€§å›¾ï¼šæ–‡ä»¶å¤¹å±æ€§ç”¨æˆ·åå¡«å®‰è£…cwRsyncServeræ—¶åˆ›å»ºçš„ç”¨æˆ·åå›¾ï¼šæ–‡ä»¶å¤¹å±æ€§2 å¯åŠ¨RsyncSeveræœåŠ¡å›¾ï¼šrsyncæœåŠ¡ é€‰ä¸­æˆ‘çš„ç”µè„‘â€“å³é”®ç®¡ç†â€”æœåŠ¡å’Œåº”ç”¨â€“æœåŠ¡ï¼Œæ‰¾åˆ°RsyncSeverï¼ŒåŒå‡»â€“å¯åŠ¨ æ£€æµ‹å›¾ï¼šæ£€æµ‹åœ¨cmdä¸‹è¾“å…¥telnet 192.168.1.101 873 rsyncçš„ç›‘å¬ç«¯å£ï¼Œå®ƒçš„é»˜è®¤ç›‘å¬çš„ç«¯å£æ˜¯873ã€‚å‡ºç°@RSYNCD:30.0è¿™ä¸ªå°±è¯´æ˜å¯ä»¥è¿æ¥ä¸Šå»äº†2ã€linuxç«¯é…ç½® ubuntu16.04é»˜è®¤å·²å®‰è£…rsync. æ–°å»ºvim /etc/rsyncd.secrets1rsync å®¢æˆ·ç«¯å¯†ç é…ç½®æ–‡ä»¶ä¸­åªåŠ å…¥å¯†ç å°±è¡Œã€‚ ä¿®æ”¹æƒé™ï¼šchmod 600 /etc/rsyncd.secrets æ–°å»ºåŒæ­¥è¦æ’é™¤ç›®å½•æ–‡ä»¶ vim rsync.exclude12345WEB-INF/classes/sysproperty.propertiesWEB-INF/classes/mongodb.propertiesWEB-INF/classes/redis.propertiesckeditor/wlw/ æ‰§è¡ŒåŒæ­¥å‘½ä»¤ï¼š1rsync -vazrtopg --progress --delete --password-file=/etc/rsyncd.secrets --exclude-from=/opt/rsync_test/rsync.exclude rsync@192.168.1.101::cpnsp9.1/* /opt/rsync_test/ å‚è€ƒï¼šhttp://www.linuxidc.com/Linux/2014-08/105514.htm http://man.linuxde.net/rsync 2018-05-29æ›´æ–° Windowsåˆ°Linuxçš„æ–‡ä»¶åŒæ­¥ä¹Ÿå¯ä½¿ç”¨GoodSyncè½¯ä»¶ï¼Œæ›´æ–¹ä¾¿ï¼Œä½†ä¸çŸ¥å®‰å…¨æ€§å¦‚ä½•ï¼Œæš‚æœªåšç”Ÿäº§æœåŠ¡å™¨ä½¿ç”¨ã€‚","link":"/2017/09/06/%E5%90%8C%E6%AD%A5/cwRsyncServer+rsync%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%BB%8Ewindows%E5%90%8C%E6%AD%A5%E5%88%B0linux/"},{"title":"javaæœåŠ¡å†…å­˜å ç”¨å®šä½","text":"topéƒ¨åˆ†äº¤äº’å‘½ä»¤ 1234c: æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤dï¼š æ›´æ”¹åˆ·æ–°é¢‘ç‡Pï¼š æ ¹æ®CPUèµ„æºä½¿ç”¨å¤§å°è¿›è¡Œæ’åºMï¼š æ ¹æ®å†…å­˜èµ„æºä½¿ç”¨å¤§å°è¿›è¡Œæ’åº é€šè¿‡jinfoæŸ¥çœ‹JVMå¯åŠ¨ä¿¡æ¯ 123456789101112131415161718# æŸ¥çœ‹å†…å­˜å ç”¨ï¼Œrszä¸ºå®é™…å†…å­˜ï¼Œå•ä½kb# ps -eo 'pid,rsz,vsz' |grep pid$ ps -eo 'pid,rsz,vsz' |grep 2784327843 1684668 12343528# æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯# jinfo -sysprops pid$ jinfo -sysprops 27843# æŸ¥çœ‹JVMä¿¡æ¯# jinfo -flags pid$ jinfo -flags 27843Attaching to process ID 27843, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.231-b11Non-default VM flags: -XX:CICompilerCount=3 -XX:InitialHeapSize=528482304 -XX:+ManagementServer -XX:MaxHeapSize=8434745344 -XX:MaxNewSize=2811232256 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=176160768 -XX:OldSize=352321536 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGCCommand line: ... é€šè¿‡jmapæŸ¥çœ‹å †å†…å­˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# jmap -heap pid$ jmap -heap 497Attaching to process ID 497, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.221-b11using thread-local object allocation.Parallel GC with 4 thread(s)Heap Configuration: MinHeapFreeRatio = 0 MaxHeapFreeRatio = 100 MaxHeapSize = 8434745344 (8044.0MB) NewSize = 176160768 (168.0MB) MaxNewSize = 2811232256 (2681.0MB) OldSize = 352321536 (336.0MB) NewRatio = 2 SurvivorRatio = 8 MetaspaceSize = 21807104 (20.796875MB) CompressedClassSpaceSize = 1073741824 (1024.0MB) MaxMetaspaceSize = 17592186044415 MB G1HeapRegionSize = 0 (0.0MB)Heap Usage:PS Young GenerationEden Space: capacity = 1774190592 (1692.0MB) used = 156138392 (148.9051742553711MB) free = 1618052200 (1543.094825744629MB) 8.800542213674415% usedFrom Space: capacity = 1048576 (1.0MB) used = 0 (0.0MB) free = 1048576 (1.0MB) 0.0% usedTo Space: capacity = 1048576 (1.0MB) used = 0 (0.0MB) free = 1048576 (1.0MB) 0.0% usedPS Old Generation capacity = 606601216 (578.5MB) used = 90496000 (86.3037109375MB) free = 516105216 (492.1962890625MB) 14.91853257346586% used47600 interned Strings occupying 4865784 bytes. dumpå†…å­˜ï¼Œä½¿ç”¨jvisualvmåˆ†æ 12# jmap -dump:format=b,file=file.dump pid$ jmap -dump:format=b,file=497.dump 497 å°†dumpæ–‡ä»¶å¯¼å…¥jvisualvm,åœ¨å †ä¸­åŒ…å«çš„ç±»ä¸­ï¼Œé€æ­¥å±•å¼€è‡³å®ä¾‹ã€‚ å †å†…å­˜åˆ†æ https://heaphero.io/ https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/index.html å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/73727459 ç›¸å…³ï¼šhttps://www.v2ex.com/t/669244","link":"/2020/04/19/%E5%B7%A5%E4%BD%9C/java%E6%9C%8D%E5%8A%A1%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%AE%9A%E4%BD%8D/"},{"title":"jvisualvmè¿œç¨‹ç›‘æ§JVM","text":"jvmè¿›ç¨‹å¯åŠ¨é¡¹é…ç½® 1$ nohup /usr/local/java/jdk1.8.0_231/bin/java -Djava.rmi.server.hostname=192.168.1.80 -Dcom.sun.management.jmxremote.port=1100 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=true -Dcom.sun.management.jmxremote.password.file=/ssdb1/bootserver/jmxremote.passwd -Dcom.sun.management.jmxremote.access.file=/ssdb1/bootserver/jmxremote.access -jar /ssdb1/bootserver/boot8100/cpnspcms/cpnsp-api-1.0.0-SNAPSHOT.jar --server.port=8100 --name=cpnspcms_box &gt; 8100.log 2&gt;&amp;1 &amp; 123456-Djava.rmi.server.hostname=192.168.1.80 # é…ç½®è¿œç¨‹æœåŠ¡IP-Dcom.sun.management.jmxremote.port=1100 # é…ç½®è¿œç¨‹ connection çš„ç«¯å£å·-Dcom.sun.management.jmxremote.ssl=false # æ˜¯å¦å¯ç”¨ ssl-Dcom.sun.management.jmxremote.authenticate=true # æ˜¯å¦å¯ç”¨é‰´æƒï¼ˆéœ€è¦ç”¨æˆ·åï¼Œå¯†ç é‰´æƒï¼‰-Dcom.sun.management.jmxremote.password.file=/ssdb1/bootserver/jmxremote.passwd -Dcom.sun.management.jmxremote.access.file=/ssdb1/bootserver/jmxremote.access å¦‚æœauthenticate=falseçš„æ—¶å€™ä¸éœ€è¦é…ç½®jmxremote.passwd å’Œjmxremote.access å¦åˆ™éœ€è¦åœ¨jmxremote.accessä¸­æŒ‡å®šç”¨æˆ·åå’Œè¯»å†™æƒé™ 12monitorRole readonlycontrolRole readwrite jmxremote.passwdä¸­æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œæ ¼å¼å¦‚ 12monitorRole tomcatcontrolRole tomcat è®¾ç½®æ–‡ä»¶æƒé™ 12$ chmod 400 jmxremote.access$ chmod 400 jmxremote.passwd ç„¶ååœ¨jvisualvmæ·»åŠ JMXè¿æ¥ã€‚","link":"/2020/04/15/%E5%B7%A5%E4%BD%9C/jvisualvm%E8%BF%9C%E7%A8%8B%E7%9B%91%E6%8E%A7JVM/"},{"title":"mongodb-ä¿®æ”¹å¤‡æ¡ˆèŒä¸šçº§åˆ«ä¸­ç§‘ç›®Id(0->5)","text":"ä¿®æ”¹å¤‡æ¡ˆèŒä¸šçº§åˆ«ä¸­ç§‘ç›®èŒä¸šé“å¾·çš„ç§‘ç›®Id(0 -&gt;5 )ï¼ŒåŠå¯¹åº”çš„é»˜è®¤æŠ¥åè´¹ç”¨{0:0 -&gt; 5:0} æ•°æ®ç»“æ„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205{ \"_id\" : NumberLong(8), \"recordPlanId\" : NumberLong(3), \"userGroup\" : \"45\", \"occupationId\" : NumberLong(2567), \"occupationTitle\" : \"è½¦å·¥\", \"testLevels\" : [1, 2, 3, 4, 5], \"testSubjects\" : { \"5\" : [{ \"subjectId\" : 0, \"title\" : \"èŒä¸šé“å¾·\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 1, \"title\" : \"ç†è®º\", \"testType\" : 100, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 2, \"title\" : \"æŠ€èƒ½\", \"testType\" : 200, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 4, \"title\" : \"å·¥ä½œä¸šç»©\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }], \"4\" : [{ \"subjectId\" : 0, \"title\" : \"èŒä¸šé“å¾·\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 1, \"title\" : \"ç†è®º\", \"testType\" : 100, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 2, \"title\" : \"æŠ€èƒ½\", \"testType\" : 200, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 4, \"title\" : \"å·¥ä½œä¸šç»©\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }], \"3\" : [{ \"subjectId\" : 0, \"title\" : \"èŒä¸šé“å¾·\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 1, \"title\" : \"ç†è®º\", \"testType\" : 100, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 2, \"title\" : \"æŠ€èƒ½\", \"testType\" : 200, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 4, \"title\" : \"å·¥ä½œä¸šç»©\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }], \"2\" : [{ \"subjectId\" : 0, \"title\" : \"èŒä¸šé“å¾·\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 1, \"title\" : \"ç†è®º\", \"testType\" : 100, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 2, \"title\" : \"æŠ€èƒ½\", \"testType\" : 200, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 3, \"title\" : \"ç»¼åˆ\", \"testType\" : 300, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 4, \"title\" : \"å·¥ä½œä¸šç»©\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }], \"1\" : [{ \"subjectId\" : 0, \"title\" : \"èŒä¸šé“å¾·\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 1, \"title\" : \"ç†è®º\", \"testType\" : 100, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 2, \"title\" : \"æŠ€èƒ½\", \"testType\" : 200, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 3, \"title\" : \"ç»¼åˆ\", \"testType\" : 300, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }, { \"subjectId\" : 4, \"title\" : \"å·¥ä½œä¸šç»©\", \"testType\" : 0, \"isComputerTest\" : false, \"isReadCard\" : false, \"isMobileScore\" : false }] }, \"enrollFees\" : { \"1\" : { \"0\" : 0, \"1\" : 0, \"2\" : 0, \"3\" : 0, \"4\" : 0 }, \"2\" : { \"0\" : 0, \"1\" : 0, \"2\" : 0, \"3\" : 0, \"4\" : 0 }, \"3\" : { \"0\" : 0, \"1\" : 0, \"2\" : 0, \"4\" : 0 }, \"4\" : { \"0\" : 0, \"1\" : 0, \"2\" : 0, \"4\" : 0 }, \"5\" : { \"0\" : 0, \"1\" : 0, \"2\" : 0, \"4\" : 0 } }, \"uid\" : \"d75f8deffe5b4e81babbf6b76ae02144\", \"unitId\" : NumberLong(2)} 12345678910111213141516171819202122# ä¿®æ”¹å¤‡æ¡ˆèŒä¸šçº§åˆ«ä¸­ç§‘ç›®èŒä¸šé“å¾·çš„ç§‘ç›®Id(0-&gt;5)db.irTestRange.find({\"testSubjects.1\":{\"$elemMatch\":{\"subjectId\":0}}})db.irTestRange.find({\"testSubjects.2\":{\"$elemMatch\":{\"subjectId\":0}}})db.irTestRange.find({\"testSubjects.3\":{\"$elemMatch\":{\"subjectId\":0}}})db.irTestRange.find({\"testSubjects.4\":{\"$elemMatch\":{\"subjectId\":0}}})db.irTestRange.find({\"testSubjects.5\":{\"$elemMatch\":{\"subjectId\":0}}})db.irTestRange.update({\"testSubjects.1\":{\"$elemMatch\":{\"subjectId\":0}}},{\"$set\":{\"testSubjects.1.$.subjectId\":NumberInt(5),\"enrollFees.1.5\":NumberInt(0)},\"$unset\":{\"enrollFees.1.0\":1}},false,true)db.irTestRange.update({\"testSubjects.2\":{\"$elemMatch\":{\"subjectId\":0}}},{\"$set\":{\"testSubjects.2.$.subjectId\":NumberInt(5),\"enrollFees.2.5\":NumberInt(0)},\"$unset\":{\"enrollFees.2.0\":1}},false,true)db.irTestRange.update({\"testSubjects.3\":{\"$elemMatch\":{\"subjectId\":0}}},{\"$set\":{\"testSubjects.3.$.subjectId\":NumberInt(5),\"enrollFees.3.5\":NumberInt(0)},\"$unset\":{\"enrollFees.3.0\":1}},false,true)db.irTestRange.update({\"testSubjects.4\":{\"$elemMatch\":{\"subjectId\":0}}},{\"$set\":{\"testSubjects.4.$.subjectId\":NumberInt(5),\"enrollFees.4.5\":NumberInt(0)},\"$unset\":{\"enrollFees.4.0\":1}},false,true)db.irTestRange.update({\"testSubjects.5\":{\"$elemMatch\":{\"subjectId\":0}}},{\"$set\":{\"testSubjects.5.$.subjectId\":NumberInt(5),\"enrollFees.5.5\":NumberInt(0)},\"$unset\":{\"enrollFees.5.0\":1}},false,true)","link":"/2019/12/12/%E5%B7%A5%E4%BD%9C/mongodb-%E4%BF%AE%E6%94%B9%E5%A4%87%E6%A1%88%E8%81%8C%E4%B8%9A%E7%BA%A7%E5%88%AB%E4%B8%AD%E7%A7%91%E7%9B%AEId(0-5)/"},{"title":"mongodbæ•°æ®å¯¼å…¥åˆ°mysql","text":"1ã€é¦–å…ˆæŠŠmongodbæ•°æ®å¯¼å‡ºï¼Œç±»å‹ä¸ºcsv 1$ mongoexport --host 192.168.1.101 --authenticationDatabase admin -u root -d hbcms -c ostaCert -q '{certType:\"osta\"}' -f cardId,name,occupation,testLevel,certNum --type=csv -o /dbdata/db_backup/mongodb_ali/ostaCert.csv å‚æ•°è¯´æ˜ï¼š-d æŒ‡æ˜å¯¼å‡ºçš„æ•°æ®åº“ã€‚ -c æŒ‡æ˜è¦å¯¼å‡ºçš„è¡¨ã€‚ -f æŒ‡æ˜å¯¼å‡ºçš„å­—æ®µï¼Œä»¥é€—å·åˆ†éš”ã€‚å¦‚ï¼š-f name,email,age -q å¯ä»¥æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¯¼å‡ºï¼Œå¦‚ï¼š-q &apos;{ &quot;uid&quot; : &quot;100&quot; }&apos; å¯¼å‡ºuidä¸º100çš„æ•°æ® -o æŒ‡æ˜è¦åˆ°å¤„çš„æ–‡ä»¶ååŠç›®å½•ã€‚ --csv è¡¨ç¤ºå¯¼å‡ºçš„æ–‡ä»¶æ ¼å¼ä¸ºcsvçš„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„å…³ç³»å‹æ•°æ®åº“éƒ½æ˜¯æ”¯æŒcsvã€‚å…¶å®ƒå‚æ•° è¯´æ˜æŸ¥çœ‹ mongoexport â€“help å¯¼å‡ºåå¯èƒ½æ‰“å¼€æ˜¯ä¹±ç ï¼Œç”¨è®°äº‹æœ¬æˆ–è€…Notepadå¦å­˜ä¸ºUTF8å³å¯ã€‚ 2ã€å°†CSVå¯¼å…¥åˆ°MySQL åˆ›å»ºMySQLæ•°æ®åº“å’Œæ¥æ”¶æ•°æ®çš„è¡¨ï¼Œæ³¨æ„è¡¨çš„é¡ºåºå’Œå­—æ®µè¦å’ŒMongoDBå¯¼å‡ºçš„å­—æ®µåŠCSVä¸­çš„æ–‡ä»¶è¡¨å¤´ä¸€æ ·ã€‚ åœ¨æ­¤å¤„è¦æ³¨æ„ï¼Œå°†ç¼–ç éƒ½è®¾ç½®ä¸ºutf8ã€‚ æ‰§è¡Œï¼š 12345mysql&gt; load data infile '/opt/ostaCert.csv' -&gt; into table `tweets` character set utf8 -&gt; fields terminated by ',' optionally enclosed by '&quot;' -&gt; lines terminated by '\\n' -&gt; ignore 1 lines; å¯èƒ½ä¼šæŠ¥å‡ºè¿™ä¸ªé”™è¯¯ï¼š 1ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement å› ä¸ºMySQLå¯¼å…¥å¯¼å‡ºä¸æ˜¯ä»»æ„æ–‡ä»¶ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªcsvæ–‡ä»¶æ”¾åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹å³å¯ã€‚ ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹å¯è¿›è¡Œæ“ä½œçš„æ–‡ä»¶å¤¹ï¼š æ‰€ä»¥æŠŠæ–‡ä»¶æ”¾åˆ°è¯¥ä½ç½®å³å¯ã€‚ å†æ¬¡æ‰§è¡Œä¸Šé¢çš„å¯¼å…¥è¯­å¥ï¼Œå³å¯å¯¼å…¥æˆåŠŸã€‚ å‚è€ƒï¼šhttps://blog.csdn.net/gpf951101/article/details/79907393","link":"/2018/09/10/%E5%B7%A5%E4%BD%9C/mongodb%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%88%B0mysql/"},{"title":"nethogsä¸nloadå•ä½æ¯”è¾ƒ","text":"é€šè¿‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 12$ nload eth0$ nethogs -U h eth0 nload ä¸Šå›¾ä¸­å•ä½æ˜¯ KB/sec nethogsé€šè¿‡ -UæŒ‡å®šäº†å•ä½æ˜¯ bit 1Byte = 8bits 383KB/sec = 383*8 = 3064Kbit/s = 3.06Mbit/s ä¸nloadä¸­çš„2.69ç›¸å·®ä¸å¤§ å› ä¸ºå­˜åœ¨åˆ·æ–°é¢‘ç‡å’Œé—´éš”ï¼Œæ‰€ä»¥å­˜åœ¨è¯¯å·®ã€‚ æš‚æ—¶å…ˆè¿™æ ·ç†è§£","link":"/2018/09/21/%E5%B7%A5%E4%BD%9C/nethogs%E4%B8%8Enload%E5%8D%95%E4%BD%8D%E6%AF%94%E8%BE%83/"},{"title":"tomcatæ—¥å¿—åˆ†æ","text":"tomcat è¯·æ±‚æ—¥å¿—æ ¼å¼ä¸º 1server.tomcat.accesslog.pattern=%t %a \"%r\" %s %S (%D ms) å¦‚ä¸‹ï¼š 1[19/Sep/2018:11:18:00 +0800] 127.0.0.1 \"GET /cpnsp/ws/ths/getSignToken HTTP/1.0\" 200 - (4 ms) æ¯ç§’è¯·æ±‚é‡ç»Ÿè®¡ç»Ÿè®¡æ¯ç§’çš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°ç§’) 1$ awk '{print $1}' access_log.2018-09-19.log |cut -c 14-21|sort|uniq -c|sort -nr|head -n 100 æ¯åˆ†é’Ÿè¯·æ±‚é‡ç»Ÿè®¡ç»Ÿè®¡æ¯åˆ†é’Ÿçš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°åˆ†é’Ÿ) 1$ awk '{print $1}' access_log.2018-09-19.log |cut -c 14-18|sort|uniq -c|sort -nr|head -n 100 æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡æ¯å°æ—¶çš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°å°æ—¶) 1$ awk '{print $1}' access_log.2018-09-19.log |cut -c 14-15|sort|uniq -c|sort -nr|head -n 100 æŸ¥çœ‹javaçš„å¹¶å‘æ•°ï¼šnetstat -np|grep java|wc -l ä¸¤æ–‡ä»¶å¤¹åŒæ­¥ï¼š rsync -ru â€“progress â€“delete /opt/rsync_test/f1/ /opt/rsync_test/f2/","link":"/2018/09/19/%E5%B7%A5%E4%BD%9C/tomcat%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"},{"title":"å…³äºç§»åŠ¨ç«¯çš„æµå¼åˆ†é¡µ","text":"å…³äºç§»åŠ¨ç«¯appåˆ†é¡µçš„è®°å½• ä¸€èˆ¬é¡¹ç›®ä¸­webç®¡ç†ç«¯åˆ†é¡µé€šå¸¸ä½¿ç”¨ é¡µç pageNoå’Œåˆ†é¡µå¤§å°pageSizeè¿›è¡Œåˆ†é¡µ ã€‚ å¦‚æœappåˆ†é¡µé‡‡ç”¨webç«¯åˆ†é¡µçš„è¯ï¼Œé€šå¸¸ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ã€‚ 1ã€æ•°æ®é‡å¤ã€‚ 2ã€æ•°æ®ä¸¢å¤±ã€‚ 3ã€æ•ˆç‡åº•ã€‚ appåº”ç”¨é¢å‘äººç¾¤ä¸ºcç«¯ç”¨æˆ·ï¼Œæ•°æ®é‡ä¸€å¤§ï¼Œlimitæ€§èƒ½å°±æ€¥å‰§ä¸‹é™ã€‚ æ‰€ä»¥webç«¯åˆ†é¡µæ–¹å¼ä¸å¤ªé€‚åˆã€‚ ä¹‹å‰é¡¹ç›®ç§»åŠ¨ç«¯åˆ†é¡µé‡‡ç”¨ refreId (å³æœ€åä¸€æ¡æ•°æ®çš„Id)ä½œä¸ºä¸‹ä¸€é¡µæŸ¥è¯¢çš„æ¡ä»¶ï¼Œè¿™æ ·æ»¡è¶³å¯¹æ’åºæ²¡æœ‰ç¡®åˆ‡è¦æ±‚æˆ–è€…æŒ‰Idæ’åºçš„æƒ…å†µã€‚ å¦‚æœè¦æŒ‰å‘å¸ƒæ—¶é—´è¿›è¡Œæ’åºï¼Œæˆ–è®¸å¯ä»¥ç”¨ referTime (æœ€åä¸€æ¡æ•°æ®çš„å‘å¸ƒæ—¶é—´)ä½œä¸ºæ¡ä»¶ï¼Œè¿™æ ·ä¹Ÿå¯æ»¡è¶³å¯¹æŒ‰å‘å¸ƒæ—¶é—´è¿›è¡Œæ’åºçš„éœ€æ±‚ã€‚ä½†æ˜¯å‰ææ¡ä»¶æ˜¯ referTime çš„ç²¾ç¡®å€¼ï¼ˆä¸€èˆ¬æ˜¯ç”¨ç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³ï¼‰ï¼Œè€ƒè™‘åˆ°å‘å¸ƒæ—¶é—´å¯èƒ½å­˜åœ¨ç›¸åŒçš„å€¼ï¼Œè¿™æ ·åœ¨ç§»åŠ¨ç«¯å°±å¯èƒ½ä¼šå‡ºç°æ°¸ä¹…ä¸¢å¤±æ•°æ®çš„æƒ…å†µã€‚ å¦ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨å‘å¸ƒçš„æ—¶å€™ç»´æŠ¤ä¸€ä¸ªæ’åºå­—æ®µ sortNum ä½¿å…¶å€¼ä¸ºæ—¶é—´+Idï¼Œå¦‚ä¸‹è¿™ç§ï¼š lite1234public Long getPublishSortNum(Long contentId) { SimpleDateFormat sdf = new SimpleDateFormat(\"yyMMddHHmm\"); return Long.valueOf(sdf.format(Utils.getDateFromStr(Utils.getNowTimeShortString(), \"yy-MM-dd HH:mm\")) + StringUtils.leftPad(contentId.toString(), 8, \"0\")); } è¿™æ ·æ—¢å¯é¿å…æ‰å‘å¸ƒæ—¶é—´ç›¸åŒçš„æƒ…å†µä¸‹çš„æ’åºã€‚ å¯»åˆ°å…¶ä»–å¯è¡Œæ–¹æ¡ˆã€‚ å¼•ç”³ï¼šhttps://www.jianshu.com/p/13941129c826 â€‹ https://www.v2ex.com/t/328806","link":"/2018/07/07/%E5%B7%A5%E4%BD%9C/%E5%85%B3%E4%BA%8E%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9A%84%E6%B5%81%E5%BC%8F%E5%88%86%E9%A1%B5/"},{"title":"ç”¨Clonezillaå†ç”Ÿé¾™å¤‡ä»½ç³»ç»ŸåŠè¿˜åŸç³»ç»Ÿ","text":"å¤šå°æœºå™¨ç³»ç»Ÿçš„å…‹éš† å‡†å¤‡ï¼š2ä¸ªUç›˜ 1ã€ ä¸‹è½½Clonezillaç³»ç»Ÿ download 2ã€ä½¿ç”¨UltraISOåˆ¶ä½œå¯åŠ¨ç›˜ å¯å‚è€ƒï¼šultraiso ç°åœ¨ä¸€èˆ¬ç”¨ rufus åˆ¶ä½œç³»ç»Ÿã€‚ 3ã€å¤‡ä»½ï¼šåœ¨è¦å¤‡ä»½çš„ç³»ç»Ÿä½¿ç”¨Uç›˜å¯åŠ¨ å¯å‚è€ƒï¼šhttp://forum.ubuntu.org.cn/viewtopic.php?p=2643583 4ã€è¿˜åŸï¼šåœ¨è¦è¿˜åŸçš„ç³»ç»Ÿä½¿ç”¨Uç›˜å¯åŠ¨ å¯å‚è€ƒï¼šhttp://tiancong.blog.51cto.com/783138/776309 å› å›¾ç‰‡è¿˜ä¸ä¼šç”¨ï¼Œå¾…å®Œå–„ã€‚","link":"/2017/08/21/%E5%B7%A5%E4%BD%9C/%E7%94%A8Clonezilla%E5%86%8D%E7%94%9F%E9%BE%99%E5%A4%87%E4%BB%BD%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%BF%98%E5%8E%9F%E7%B3%BB%E7%BB%9F/"},{"title":"ä¸¤è·¯ç”±å±€åŸŸç½‘æœåŠ¡è®¿é—®","text":"ä¸¤è·¯ç”±ç»„å»ºå±€åŸŸç½‘ï¼Œå®ç°æœåŠ¡è®¿é—® éœ€æ±‚ï¼šåœ¨ä¸ä¿®æ”¹å’Œå½±å“åŸæœ‰ç½‘ç»œåŠç›’å­IPçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡pcè®¿é—®ç›’å­ä¸Šçš„æœåŠ¡ã€‚ çº¦å®š 1ã€åŸæœ‰ç½‘ç»œå±€åŸŸç½‘ç°çŠ¶ ä¸»è·¯ç”±ï¼šç½‘å…³ï¼š192.168.1.2 å­ç½‘æ©ç ï¼š255.255.255.0 IP:192.168.1.xxx PC : IPï¼š192.168.1.101 å­ç½‘æ©ç ï¼š255.255.255.0 ç½‘å…³ï¼š192.168.1.2 2ã€å‰¯è·¯ç”± LANå£ï¼š IP:10.10.10.1 å­ç½‘æ©ç ï¼š255.0.0.0 WANå£ï¼š IP:192.168.1.20 å­ç½‘æ©ç ï¼š255.255.255.0 ç½‘å…³ï¼š192.168.1.2 3ã€ç›’å­ IP:10.10.10.100 å­ç½‘æ©ç ï¼š255.0.0.0 ç½‘å…³ï¼š10.10.10.1 å‰¯è·¯ç”± ï¼ˆTP-LINKï¼‰è®¾ç½® 1ã€è·¯ç”±é€šç”µåï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®è·¯ç”±åœ°å€ï¼ˆ192.168.0.1ï¼‰ã€‚ 2ã€LANå£è®¾ç½®ï¼šIPåœ°å€ï¼š10.10.10.1ï¼ˆå¯ä»»æ„ï¼‰ï¼Œå­ç½‘æ©ç ï¼š255.0.0.0ï¼ˆæ ¹æ®IPå®šï¼‰ã€‚ 3ã€ä¿å­˜ï¼Œé‡å¯è·¯ç”±ã€‚ 4ã€é€šè¿‡æµè§ˆå™¨è®¿é—®è·¯ç”±åœ°å€10.10.10.1 5ã€WANå£è®¾ç½® æ¨¡å¼ï¼šé™æ€IP IPåœ°å€ï¼š192.168.1.20ï¼ˆåœ¨åŸå±€åŸŸç½‘å†…ä¸å†²çªå³å¯ï¼Œæ­¤IPç”¨äºç›’å­æœåŠ¡çš„è®¿é—®ï¼‰ å­ç½‘æ©ç ï¼š255.255.255.0 ç½‘å…³ï¼š192.168.1.2 DNSæœåŠ¡å™¨ï¼š192.168.1.2 6ã€è™šæ‹ŸæœåŠ¡å™¨ ç«¯å£æ˜ å°„ æŠŠ80ç«¯å£æ˜ å°„åˆ°ç›’å­ip:10.10.10.100 7ã€æŠŠç½‘çº¿ä»åŸè·¯ç”±LANå£è¿æ¥åˆ°å‰¯è·¯ç”±WANå£ã€‚ ç›’å­æœåŠ¡å®‰è£…åŠè®¾ç½® 1ã€å®‰è£…å¥½TomcatåŠnginxæœåŠ¡ã€‚(æ³¨æ„ï¼šé™æ€é¡µé¢ä¸­IPè¦ä¸ºåŠ¨æ€è·å–ã€‚) 2ã€ä¿®æ”¹nginxé…ç½®ï¼šç›‘å¬80ç«¯å£ï¼Œè½¬å‘åˆ°tomcatã€‚å³å¯åœ¨PCä¸Šé€šè¿‡192.168.1.20è®¿é—®ç›’å­ä¸Šçš„tomcatæœåŠ¡ã€‚ ä¸‹é¢å®ç°å¯ä»¥åŸŸåè®¿é—®å‰æï¼šæ‹¥æœ‰ä¸»è·¯ç”±çš„ç®¡ç†æƒï¼ˆè¦ä¿®æ”¹DNSï¼‰ å› è¦è€ƒè™‘åœ¨æ— ç½‘ç»œçš„æƒ…å†µåŠä¸ä¿®æ”¹åŸæœ‰ç½‘ç»œæœºå™¨ï¼Œæ‰€ä»¥åœ¨ç›’å­ä¸Šéƒ¨ç½²DNSæœåŠ¡å™¨ã€‚ 1ã€åœ¨ç›’å­ä¸Šéƒ¨ç½²DNSæœåŠ¡å™¨ã€‚ï¼ˆå‚è€ƒä¸Šç¯‡ï¼šDNSä¸»å¤‡æœåŠ¡ï¼‰ 2ã€é…ç½®åŸŸåæŒ‡å‘,åŸŸåæŒ‡å‘çš„IPåœ°å€åº”ä¸ºå‰¯è·¯ç”±WANå£åœ°å€ï¼ˆ192.168.1.20ï¼‰ 3ã€åœ¨å‰¯è·¯ç”±ä¸­é…ç½®DNS åœ¨è™šæ‹ŸæœåŠ¡å™¨ ç«¯å£æ˜ å°„æ·»åŠ è®°å½•ï¼ŒæŠŠ53ç«¯å£æŒ‡å‘åˆ°ç›’å­IP:10.10.10.100,åè®®ä¸ºå…¨éƒ¨ã€‚ 4ã€åœ¨ä¸»è·¯ç”±ä¸­é…ç½®DNS åœ¨DHCPæœåŠ¡å™¨ä¸­é¦–é€‰DNSè¾“å…¥192.168.1.20ï¼Œå¤‡ç”¨DNSè¾“å…¥114.114.114.114å³å¯åœ¨PCä¸Šé€šè¿‡åŸŸåè®¿é—®ç›’å­ä¸ŠæœåŠ¡ã€‚ å…¶å®ƒå¦‚è‹¥åœ¨å‡†å¤‡é˜¶æ®µå°±å¯ç»™ç›’å­åˆ†é…ä¸€è¯¥ç½‘ç»œä¸‹å›ºå®šçš„IPï¼Œå°±å¯çœå»è·¯ç”±è¿™ä¸€æ­¥ã€‚","link":"/2020/01/02/%E5%B7%A5%E4%BD%9C/%E4%B8%A4%E8%B7%AF%E7%94%B1%E5%B1%80%E5%9F%9F%E7%BD%91%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE/"},{"title":"å¾®ä¿¡æ”¯ä»˜XXEæ¼æ´","text":"è¿‘å‡ å¤©ä»æ—¥å¿—æ–‡ä»¶ä¸­å‘ç°ï¼Œæ¯å¤©å‡Œæ™¨3ç‚¹å¤šç§å°±ä¼šæœ‰å‡ ä¸ªå¾®ä¿¡æ”¯ä»˜çš„å›è°ƒï¼Œå¾ˆæ˜¯å¥‡æ€ªã€‚ å…·ä½“æŠ¥é”™å¦‚ä¸‹ï¼š å‰å‡ å¤©å¬è¯´å¾®ä¿¡æ”¯ä»˜å­˜åœ¨ä»€ä¹ˆæ¼æ´ï¼Œå› æœ‰åŒäº‹è´Ÿè´£ä¿®å¤ï¼Œæ²¡å¤ªåœ¨æ„ï¼Œç”±æŠ¥é”™ä¿¡æ¯æŸ¥æ‰¾ç¡®å®å’ŒXXEæ”»å‡»æœ‰å…³ç³»ï¼Œ å¹¸å¥½å·²ç»è¢«ä¿®å¤äº†ï¼Œ æ¥ä¸‹æ¥å°±åº”è¯¥åšå¥½é˜²æŠ¤ï¼Œç¦ç”¨æ‰è¯¥æ¶æ„è¯·æ±‚ã€‚ ä»nginxæ—¥å¿—ä¸­æŸ¥åˆ°è¯¥æ¶æ„IPï¼š ç„¶ååœ¨nginxä¸­ç¦ç”¨æ‰è¯¥IP: 12345 location / { deny 101.91.62.170; #ç¦ç”¨æ¶æ„IP ....} $ service nginx reload æ¼æ´çš„ä¿®å¤å¯å‚è€ƒï¼šhttps://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5 https://my.oschina.net/u/574353/blog/1841103 https://blog.csdn.net/u013224189/article/details/49759845 https://my.oschina.net/u/1788620/blog/2051289","link":"/2018/11/28/%E5%B7%A5%E4%BD%9C/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98XXE%E6%BC%8F%E6%B4%9E/"},{"title":"è®°å½•","text":"è´¨é‡ç£å¯¼ã€ç‰©æ–™å¹³å°ä¸­è¿æ¥MySQLæ•°æ®åº“æ˜¯å°è£…çš„jdbcTemplateã€‚ ä¿å­˜è¯ä¹¦çš„ä¸­ç»§æœåŠ¡ä½¿ç”¨çš„æ˜¯springboot-jpaï¼Œå› ä¸ºä¸šåŠ¡è¾ƒç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„ SQL ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨çš„jpaï¼Œæ²¡æœ‰æ¶‰åŠmybatis Springæ˜¯é€šè¿‡ä»»åŠ¡æ‰§è¡Œå™¨(TaskExecutor)æ¥å®ç°å¤šçº¿ç¨‹å’Œå¹¶å‘ç¼–ç¨‹ï¼Œä½¿ç”¨ThreadPoolTaskExecutoræ¥åˆ›å»ºä¸€ä¸ªåŸºäºçº¿åŸæ± çš„TaskExecutorã€‚åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¼‚æ­¥éé˜»å¡çš„ã€‚æˆ‘ä»¬é…ç½®æ³¨è§£@EnableAsyncå¯ä»¥å¼€å¯å¼‚æ­¥ä»»åŠ¡ã€‚ç„¶ååœ¨å®é™…æ‰§è¡Œçš„æ–¹æ³•ä¸Šé…ç½®æ³¨è§£@Asyncä¸Šå£°æ˜æ˜¯å¼‚æ­¥ä»»åŠ¡ã€‚ win10ä¸­Javaæ‰§è¡Œå±æ€§å¤åˆ¶æ–‡ä»¶è·¯å¾„çš„å‘ï¼ˆä»å³åˆ°å·¦å¤åˆ¶è·¯å¾„æ—¶ï¼Œä¼šå¸¦æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œåªæœ‰åœ¨cmdä¸‹æ‰èƒ½çœ‹å‡ºæ¥ï¼‰","link":"/2019/10/24/%E5%B7%A5%E4%BD%9C/%E8%AE%B0%E5%BD%95/"},{"title":"è®¿é—®ä¸ƒç‰›èµ„æºè·¨åŸŸé—®é¢˜","text":"ç³»ç»Ÿä¸­tsæ–‡ä»¶æ˜¯å­˜åœ¨ä¸ƒç‰›ä¸Šçš„ï¼Œé€šè¿‡åœ¨ç³»ç»Ÿåå°ï¼ˆhttp://resbank.bjuri.comï¼‰é€šè¿‡æµè§ˆå™¨è¯·æ±‚tsæ–‡ä»¶æ—¶ï¼Œå‡ºç°äº†è·¨åŸŸçš„é—®é¢˜ã€‚ 1ã€é¦–å…ˆåœ¨nginxä¸‹é…ç½® 12345678910111213location /cpnsp/{ proxy_connect_timeout 3; proxy_send_timeout 600; proxy_read_timeout 600; proxy_pass http://resstrem1; proxy_set_header REMOTE_ADDR $remote_addr; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # add_header X-Frame-Options sameorigin; # add_header X-Frame-Options ALLOW-FROMhttp://qiniu.resbank.bjuri.com; # add_header Access-Control-Allow-Origin *; } ä¸èµ·ä½œç”¨ï¼Œç„¶åå¤åŸé…ç½®ã€‚ 2ã€ç„¶åæŠŠä¸ƒç‰›ç»‘å®šçš„åŸŸåæ”¹æˆäº†ç³»ç»Ÿçš„å­åŸŸåã€‚ï¼ˆå³æŠŠä¸ƒç‰›ç»‘å®šçš„åŸŸåæ”¹ä¸ºäº†http://qiniu.resbank.bjuri.comï¼‰ã€‚ ä¸èµ·ä½œç”¨ã€‚ 3ã€ç„¶åè®©å‰ç«¯çœ‹ï¼Œå‰ç«¯æŠŠè¯·æ±‚ä¸ƒç‰›èµ„æºæ—¶æºå¸¦çš„cookieå»æ‰äº†ï¼Œä¾¿è§£å†³äº†ã€‚ https://blog.csdn.net/zhangxiaohui4445/article/details/100162317","link":"/2018/12/19/%E5%B7%A5%E4%BD%9C/%E8%AE%BF%E9%97%AE%E4%B8%83%E7%89%9B%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"},{"title":"é˜¿é‡Œäº‘SLBè¯ä¹¦","text":"é€šè¿‡https://freessl.org ç”³è¯·çš„ ç±»å‹ä¸ºRSA çš„ TrustAsia è¯ä¹¦ä¸‹è½½ååŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼Œfull_chain.pem å’Œprivate.keyã€‚ åœ¨é˜¿é‡Œäº‘SLBä¸Šä¼ æœåŠ¡å™¨è¯ä¹¦ 1ã€ç§é’¥ ä¸Šä¼ è¯ä¹¦çš„ç§é’¥ç±»å‹å¿…é¡»ä¸ºRSAç§é’¥ã€‚å³å¿…é¡»ä»¥-----BEGIN RSA PRIVATE KEY-----, -----END RSA PRIVATE KEY-----å¼€å¤´å’Œç»“å°¾ã€‚ è€Œä¸‹è½½çš„ç§é’¥private.key æ˜¯ä»¥-----BEGIN PRIVATE KEY-----,``-----BEGIN PRIVATE KEY-----çš„å¼€å¤´å’Œç»“å°¾ã€‚æ‰€ä»¥éœ€è¦å…ˆè¿›è¡Œè½¬æ¢ï¼š 1$ openssl rsa -in private.key -out new_server_key.pem 2ã€å…¬é’¥è¯ä¹¦ ä¸ºäº†ç¡®ä¿å…¼å®¹åˆ°æ‰€æœ‰æµè§ˆå™¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨é˜¿é‡Œäº‘ä¸Šéƒ¨ç½²ä¸­é—´è¯ä¹¦ï¼Œå¦‚æœä¸éƒ¨ç½²ä¸­é—´è¯ä¹¦ï¼Œè™½ç„¶å®‰è£…è¿‡ç¨‹å¯ä»¥å®Œå…¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´Androidç³»ç»Ÿï¼ŒChrome å’Œ Firefoxç­‰æµè§ˆå™¨æ— æ³•è¯†åˆ«ã€‚å¦‚å¾®ä¿¡å°ç¨‹åºå¯èƒ½ä¼šå‡ºç°request:fail ssl hand shake error é”™è¯¯ã€‚ å¯ä»¥æŠŠfull_chain.pem é€šè¿‡ ä¸­é—´è¯ä¹¦ç”Ÿæˆå·¥å…·ï¼Œç”Ÿæˆä¸­é—´è¯ä¹¦ï¼Œå†è¿›è¡Œä¸Šä¼ ã€‚(æŠŠfull_chain.pemåŠç”Ÿæˆçš„chain.crtç²˜è´´è¿›å») ä¼šåŒ…å«ä¸‰æ®µä»¥-----BEGIN CERTIFICATE-----,-----END CERTIFICATE-----å¼€å¤´ç»“å°¾çš„å­—ç¬¦ã€‚ ä¿å­˜åï¼Œå³å®Œæˆäº†é˜¿é‡Œäº‘SLBçš„è¯ä¹¦ä¸Šä¼ ã€‚ é˜¿é‡Œäº‘SLB HTTPS æ‰©å±•åŸŸåï¼ˆä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå¤šä¸ªåŸŸåï¼Œå¤šä¸ªè¯ä¹¦ï¼Œè¿›è¡Œè½¬å‘ï¼‰é…ç½®å‚è€ƒï¼šhttps://help.aliyun.com/document_detail/87023.html å…¶å®ƒï¼š ä½¿ç”¨é˜¿é‡Œäº‘æ§åˆ¶å°ç”³è¯·çš„Symantec å…è´¹è¯ä¹¦ï¼Œé…ç½®SLBæ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼š SLBé…ç½®ç›‘å¬ç«¯å£æ˜¯443ï¼Œè½¬å‘ç­–ç•¥ä¸­é…ç½®çš„è½¬å‘åå°æœåŠ¡ç«¯å£ä¸º443ï¼Œåå°nginxæœåŠ¡ç›‘å¬443ä¸80ç«¯å£ï¼Œä¸ä¹‹å‰å¹¶æ— ä¸åŒï¼Œä½†æ˜¯nginx é”™è¯¯æ—¥å¿—ä¸­ä¸€ç›´æ˜¯ï¼š 12018/12/14 11:03:19 [error] 11429#0: *655 no \"ssl_certificate\" is defined in server listening on SSL port while SSL handshaking, client: 100.116.145.180, server: 0.0.0.0:443 æš‚æœªå‘ç°å…¶åŸå› ã€‚ ä¸´æ—¶è§£å†³åŠæ³•ï¼Œåœ¨SLBçš„è½¬å‘ç­–ç•¥ä¸­é…ç½®çš„è½¬å‘åå°æœåŠ¡ç«¯å£ä¸º80ã€‚ 18.12.14 å‚è€ƒï¼šhttps://www.cnblogs.com/sslwork/p/5984167.html","link":"/2018/09/25/%E5%B7%A5%E4%BD%9C/%E9%98%BF%E9%87%8C%E4%BA%91SLB%E8%AF%81%E4%B9%A6/"},{"title":"éƒ¨ç½²æœåŠ¡æ­¥éª¤","text":"é€šè¿‡jenkinsè‡ªåŠ¨éƒ¨ç½² 1ã€åœ¨112.124.xx.xxxä¸Šæ–°å»ºsvnä»“åº“ï¼ˆé…ç½®æ–‡ä»¶ç”¨ï¼‰ 12345$ cd /usr/local/svn/repos$ svnadmin create testenroll$ cd testenroll/conf/$ rm authz$ rm passwd 2ã€ä½¿ç”¨ç»Ÿä¸€å¯†ç æƒé™ç®¡ç†vim svnserve.conf 1234anon-access = noneauth-access = writepassword-db = /usr/local/svn/repos/codeAuth/passwdauthz-db = /usr/local/svn/repos/codeAuth/authz 3ã€é‡å¯svnserve 123$ ps -ef |grep svnserve$ pkill svnserve$ svnserve -d -r /usr/local/svn 4ã€ä¹‹åæœ¬åœ°æ£€å‡º å»ºç«‹ç›¸åº”ç›®å½•ç»“æ„ï¼ˆåªéœ€é…ç½®æ–‡ä»¶ï¼‰ æœ€åjenkins åˆ›å»ºé¡¹ç›®","link":"/2018/09/15/%E5%B7%A5%E4%BD%9C/%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E6%AD%A5%E9%AA%A4/"},{"title":"http 304é—®é¢˜","text":"http è¯·æ±‚çŠ¶æ€ç 304 è¯´æ˜å†…å®¹æœªæ”¹å˜ï¼Œè¯´æ˜æ— éœ€å†æ¬¡ä¼ è¾“è¯·æ±‚çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„å†…å®¹ ã€‚ é€šå¸¸æ˜¯åœ¨ä¸€äº›å®‰å…¨çš„æ–¹æ³•ï¼ˆsafeï¼‰ï¼Œä¾‹å¦‚GET æˆ–HEAD è¯·æ±‚ æˆ–åœ¨è¯·æ±‚ä¸­é™„å¸¦äº†å¤´éƒ¨ä¿¡æ¯ï¼š If-None-Match æˆ–If-Modified-Sinceã€‚ å¦‚æœæ˜¯ 200 OK ï¼Œå“åº”ä¼šå¸¦æœ‰å¤´éƒ¨ Cache-Control, Content-Location, Date, ETag, Expiresï¼Œå’Œ Vary. å¦‚æœä¸æƒ³å®¢æˆ·ç«¯å¯¹å…¶è¿›è¡Œç¼“å­˜ å¯ä»¥åœ¨ responeä¸­è®¾ç½®ä¸€ä¸ªå±æ€§ cache-control:no-store æˆ–è€…åœ¨nginxé…ç½®å®¢æˆ·ç«¯ç¼“å­˜æ¸…é™¤ 1234location / { ...... add_header Cache-Control no-cache; } []","link":"/2018/06/21/%E6%9C%AA%E5%88%86%E7%B1%BB/http%E8%AF%B7%E6%B1%82304%E9%97%AE%E9%A2%98/"},{"title":"ç™¾åº¦ç½‘ç›˜ä¸‹è½½proxyee-down","text":"Proxyee-down è¿™æ¬¾å¼€æºå·¥å…·å¯å¸®åŠ©æˆ‘ä»¬æ„å»ºç½‘é¡µä»£ç†å—…æ¢ç™¾åº¦ä¸‹è½½åœ°å€ï¼Œå—…æ¢åçš„åœ°å€ç›´æ¥åœ¨ç½‘é¡µå»ºç«‹å¤šä¸ªè¿æ¥åŠ é€Ÿä¸‹è½½ã€‚ å®æµ‹è¯¥å·¥å…·åœ¨ç™¾å…†å¸¦å®½ä¸‹ä¸‹è½½é€Ÿåº¦å¯ä»¥è¾¾åˆ°6~9MBæ¯ç§’ã€‚ å¼€æºé¡¹ç›®åœ°å€ï¼šhttps://github.com/monkeyWie/proxyee-down 1ã€ä¸‹è½½proxyee-downå‹ç¼©åŒ…åï¼Œ è¿è¡Œproxyee-down.exe 2ã€å®‰è£…SwitchyOmegaæ’ä»¶ï¼ˆFirefoxæˆ–chromeï¼‰ 3ã€ç„¶ååœ¨chromeä¸­è¿›å…¥ç™¾åº¦äº‘ï¼Œé€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶ï¼Œå°±æ­£å¸¸ç‚¹å‡»ä¸‹è½½å°±å¥½äº†ã€‚ æ­¤æ—¶ä¼šè°ƒç”¨Proxyee-downã€‚ è§£é‡Šï¼šå¯ä»¥æŠŠproxyee-downç†è§£ä¸ºä¸€ä¸ªä¸‹è½½å™¨ï¼Œæ­£å¸¸ä¸‹è½½ä¼šè°ƒç”¨chromeçš„å†…ç½®ä¸‹è½½å™¨ï¼Œè€ŒSwitchyOmegaä¼šå¼•å¯¼ä½ çš„chromeæ‰“å¼€proxyee-downè¿›è¡Œä¸‹è½½ï¼Œç®€å•çš„è¿è¡ŒåŸç†å°±æ˜¯å¦‚æ­¤ã€‚ å…¶å®ƒï¼š å¦ä¸€å·¥å…·ï¼šBaiduPCS-Go å‚è€ƒï¼šproxyee-down [SwitchyOmegaæ’ä»¶å®‰è£…ä¸è®¾ç½®](https://github.com/proxyee-down-org/proxyee-down/blob/v2.5/.guide/common/switchy/read.md) [doub.io éœ€fq](https://doub.io/dbrj-9/)","link":"/2018/08/30/%E5%B7%A5%E5%85%B7/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BDproxyee-down/"},{"title":"USBå¯åŠ¨ç›˜åˆ¶ä½œRufus","text":"Rufus Rufus æ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„å¿«é€Ÿåˆ¶ä½œ U ç›˜ç³»ç»Ÿå¯åŠ¨ç›˜å’Œæ ¼å¼åŒ– USB çš„å®ç”¨å°å·¥å…·ï¼Œå®ƒå¯ä»¥å¿«é€ŸæŠŠ ISO æ ¼å¼çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶å¿«é€Ÿåˆ¶ä½œæˆå¯å¼•å¯¼çš„ USB å¯åŠ¨å®‰è£…ç›˜ï¼Œæ”¯æŒ Windows æˆ– Linux å¯åŠ¨ã€‚Rufus å°å·§ç²ç‘ï¼Œè½¯ä»¶ä½“ç§¯ä»…å‡ ç™¾å¤š KBï¼Œç„¶è€Œéº»é›€è™½å°ï¼Œå®ƒå´äº”è„ä¿±å…¨ï¼Œè€Œä¸”é€Ÿåº¦æå¿«ã€‚ åœ°å€ï¼šhttp://rufus.akeo.ie/?locale=zh_CN","link":"/2018/08/30/%E5%B7%A5%E5%85%B7/USB%E5%90%AF%E5%8A%A8%E7%9B%98%E5%88%B6%E4%BD%9CRufus/"},{"title":"JRebelæ¿€æœåŠ¡å™¨","text":"Jrebel å¯å¿«é€Ÿå®ç°çƒ­éƒ¨ç½²ï¼ŒèŠ‚çœäº†å¤§é‡é‡å¯æ—¶é—´ï¼Œæé«˜äº†ä¸ªäººå¼€å‘æ•ˆç‡ã€‚ å¯å‚è€ƒï¼šè‡ªå·±æ­å»ºå†…ç½‘å¯ç”¨çš„Jrebel License Serveræ¿€æ´»Jrebel é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/gsls200808/JrebelLicenseServerforJava å¯ç”¨çš„æ¿€æ´»æœåŠ¡ï¼šhttps://blog.xihefeng.com/archives/205.html Guidç”Ÿæˆï¼šGUID","link":"/2018/10/19/%E5%B7%A5%E5%85%B7/JRebel%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"é™æ€èµ„æºå®¢æˆ·ç«¯ç¼“å­˜é—®é¢˜","text":"1ã€å¯¹å‰å°é™æ€èµ„æºæ›´æ–°åï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®å¦‚æœä¹‹å‰è®¿é—®è¿‡ï¼Œå¯èƒ½ä¼šè®¿é—®çš„æ˜¯ç¼“å­˜æ–‡ä»¶ã€‚2ã€ç”Ÿæˆç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œç”±äºå‰ç«¯é™æ€èµ„æºæ–‡ä»¶è¾ƒå¤§ï¼Œå®¹æ˜“å ç”¨æœåŠ¡å™¨çš„å¸¦å®½ï¼Œè®¿é—®é‡è¿‡å¤§æ—¶ï¼Œå¯¼è‡´æœåŠ¡å™¨å¸¦å®½è·‘æ»¡ç°è±¡ã€‚é—®é¢˜ä¸€å¯ä»¥é€šè¿‡å¼ºåˆ¶åˆ·æ–°æˆ–è€…æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æ¥é¿å…ã€‚é—®é¢˜äºŒå¯ä»¥å‡çº§å¸¦å®½è§£å†³ã€‚ä¸Šé¢ä¸¤è€…éƒ½ä¸æ˜¯æœ€ä¼˜è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨CDNè§£å†³çš„é—®é¢˜ã€‚ ä»¥ä¸ƒç‰›ä¸ºä¾‹ï¼Œä¹Ÿå¯ä½¿ç”¨é˜¿é‡Œäº‘ã€‚æˆ‘ä»¬æŠŠå‰å°é™æ€èµ„æºæ”¾åœ¨ä¸ƒç‰›çš„å¯¹è±¡å­˜å‚¨ç©ºé—´bucketä¸­ï¼Œé»˜è®¤è¿›è¡Œäº†cdnåŠ é€Ÿã€‚ç»‘å®šè‡ªå®šä¹‰åŸŸåå‡è®¾ä¸º bucket.yewuxitong.comï¼Œå°†åŸŸå cname æ·»åŠ åˆ°åŸŸåè§£æã€‚é™æ€æ–‡ä»¶ä¸­çš„åå°æœåŠ¡åœ°å€ä¸ºå¦å¤–è§£æä¸€ä¸ªAè®°å½•æŒ‡å‘åå°æœåŠ¡åœ°å€ ã€‚å¦‚api.yewuxitong.comè¿™æ ·å³è§£å†³äº†é—®é¢˜äºŒï¼Œé¿å…äº†å‰ç«¯é™æ€èµ„æºå ç”¨æœåŠ¡å™¨å¸¦å®½ã€‚ è¿™æ ·ä¸ƒç‰›é»˜è®¤çš„ç¼“å­˜ç­–ç•¥ä¼šå¯¼è‡´ ä¸ƒç‰›CDNç¼“å­˜é—®é¢˜ï¼Œç°è±¡åŒé—®é¢˜ä¸€ç±»ä¼¼ã€‚ å¯ä»¥é€šè¿‡CDN ç¼“å­˜è§„åˆ™è®¾ç½®æ¥è§£å†³ã€‚å‚è€ƒä¸ƒç‰›å®˜æ–¹æ–‡æ¡£ CDN ç¼“å­˜è§„åˆ™è®¾ç½® ä¹Ÿå¯å‚è€ƒæ­¤æ–‡ å…³äºä¸ƒç‰›CDNç¼“å­˜é—®é¢˜çš„å¤„ç†æ–¹å¼ é—®é¢˜ï¼šä¼šéœ€è¦è§£æä¸¤ä¸ªåŸŸåä¸€ä¸ªä¸ƒç‰›å‰ç«¯æ–‡ä»¶çš„cnameè®°å½•åŸŸåï¼Œä¸€ä¸ªåç«¯æœåŠ¡çš„Aè®°å½•åŸŸåã€‚ ç†æƒ³çŠ¶æ€ï¼šé™æ€èµ„æºæ”¾åœ¨æœåŠ¡å™¨ï¼Œæ›´æ–°åªå¯¹æœåŠ¡å™¨æ–‡ä»¶æ›´æ–°ï¼Œå¦‚å‚è€ƒæ–‡ä¸­æ‰€è¯´çš„æ–‡ä»¶åå¯ä»¥åšç›¸åº”è°ƒæ•´ã€‚æºç«™ï¼ˆæœåŠ¡å™¨ï¼‰æ›´æ–°çš„å†…å®¹åŒæ­¥æ›´æ–°åˆ°ä¸ƒç‰›çš„ç©ºé—´ï¼Œä¸çŸ¥ä¸ƒç‰›çš„å›æº HOSTæˆ–è€…é•œåƒå­˜å‚¨å¯å¦å®ç°ã€‚","link":"/2018/05/22/%E6%9C%AA%E5%88%86%E7%B1%BB/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"},{"title":"tesseract_OCR å›¾ç‰‡æ–‡å­—è¯†åˆ«","text":"OCRå›¾ç‰‡æ–‡å­—è¯†åˆ«","link":"/2018/12/03/%E6%9C%AA%E5%88%86%E7%B1%BB/tesseract_OCR%20%E5%9B%BE%E7%89%87%E6%96%87%E5%AD%97%E8%AF%86%E5%88%AB/"},{"title":"æˆ‘çš„2018","text":"å—¨ï¼Œè¯·å‡†ç¡®æ— è¯¯åœ°è¾“å…¥å¯†ç æŸ¥çœ‹å“Ÿï¼ eae51fbb59b95cb8cdadae924379d82fabbba470c51aafeebfed22460b4b569527d3b88cba009e61fcdab2463f51821c26bccfd89f9ab9d450f48f2c7016e3fcf839781f2f24f44218cda309b993b576571ddcb26a6fa5bba7045d324a115524ad8bc1e16a32df8ffae14b76a60e406860eb1b8710ff4fbe5d68f9b8b26721b7920c96d1e6f7b7c4a3c66541689c79bb448a2739c91766663bc5a791c11734f7f9b75e3a550d8897cc3201c78bba521b79b2fb742ec7f4659881e2c91877c20367522f42038067f357c36bcac65371aa40c164b64a02381c33356c15c642bd1cd407977257584b49744149101927f52e726b882b8649d4d34d5ffd438531c30eb8bfd155757f94e9938f27f83e1571e71e08b5273029f2ba44886b4c3e2aa3c87f6d9fd51a503ea0b83242bc55b89beb1b3b76d6660017acb1e56597007b860af0e8d3707db6c7cb5f0d13c6f971d73381fffde799cd2049a4786e7921b886f8c2456e3f789abd5ae2bb8ca948aa026786fad6cdaab5d5c7c05f73c471c1183a92909b6c81ddf8a6dc6b013095b1df91c80ade7db112196c1dc1f11cbaecf99fb08982fb46930e5784146c136f9b4f264df88d220d4c13260461843e9d170154e57872766f1b6cfb1ca585e1ab9586d40bd877530e7b39d2f6df9c325986c1c8cbda2e1c44f57de1725ac537d2355535f53f36afeaf7f5c8fc5a6dc27f3779f3fab72d57a51f1225262a5e3a11c593fd0143aca86060d046c8a24839224e0a2b99ade74cc0c9ecec249ef8bde5b68000d2a34139934dcd6d300aba19c0dd279b1fb9c9664850ccd7e6495b0ddcc7146d392c4afb29efbee829e4d6f4875ad73146a05dcee838cafcc47d82bb21b969334abda861bfc3cb7ce488290e86f21151021f40c0d593a9fa700fde2cd3f3f433d3f5e54063bc02614f982749c5dbf05d8e2c4bcb475af970b9307e919a10a1e76d2702f70d25c172581f6f868fe9f18913fa0ce4abb409487c8dc8cea3085c5c5b7c90cbab63c0b85459706c2052c81d2799170c69dae7f7fc3217c908d188a9a109edb8a126441454444fc8bf11a81e772e1f2b69242562ca335863cc501bfbb9bb48cf97ad526b918738422cfef2bb8a9bc0d0e5bc6196d249ea702cb9ebed493ff3a9ff006a8f0ed4ad9e9e463fde84e8c5083f9b1463fecddcf5cfa85c8b9f41d92dfecd54586407e487ad7d3381feebadaee90bf7ea81789be65ba30385b0a276aa01545274cf35b32027f8ad4a16828c6c6c6a71b7ae8570ec45cb512a0ff34397d98dda6434525352fb8c9d63555f8dff7b3baa67662a5d1c9f7ac872f523c77e12c839571baa5f5506cef6e222e918c82ed0bac8dd4a692fefa62642c9bc7ca426e3c342c93e010289f78bde164f6b40a8fb58a23a5028dacd8faf073a438481f95c8a349b3b9faf3005f65d3dfabc4e19bef1d775e62d40c89c3792fcb80affec3ebd83eb0220c0fa9c678d886837de5fae8f60c081e13f0bb4379009dfb9c8ec06a9bf7fe60a8feb1c49ab36a2a7149afe11bb4d95fe0b4c60badbaa8f8ab89f4a358bed4a1232eb64662ae9c6397e2528eab083ffbfe0a3b4ac9197d6cc562718c19894d79500a877fb3d9f0203848033c51d1991fff5009b49b4ed41c5e127469902198a85d7e01011d77544c39c25b158ad9955e6e2cfb04536097a6e7346b039c45a71eee7652ddd9d95c918379bdf214af9e7fc97c0b0f0f3252c547f83771f40d7f5dcb6850f9a7b004107ea4107ca73396245af3ec31ea26e63d4a73360f16602dcb862934115c23676e0eadcc8f9c3c9a8813cd2cd71184b88af11a31b462b5762658a4b39aba324b35468f7c8095d0cf7960abcf251a635e41da5d0b4a26acea6683e365a8d1d41719df7a8035494ff86eeb1f87aa7ade8266c2bd63b3f3e3342eefa8891578a4d3f617fad5db11f96b82a1ae310cde9f80dae852096535f63878464b22abceb9b4d456c119cd9c605a9e1707ff6f801790ac51c2cb4f30e103ca49395e42b1a456f838d7cd65c5fbde63fd513be294748cff27e46191473f46532e7e1f5a40749073f17315f2ab21bb78ada2c7801c511cc197d4147a7b946090968eae74609df8540fa3c863f2952367cd957d8232d54721c111c2370ad26863d7573ae2e68f4eeaa890f78d8aed6aaffba338f815c7c764351a9834baff4ccbadb74ac3b0ab411aea6b2222a22a9527cb25634f61812ba430b8a409275589609aa4420ae15b13504c0d30cb5aaf11cf23a6da953efe2af9bcd576d71c3545bc8ef8828c2f7c8464cfc1320c2bfb1bb00f7c06140712838fa9d22664037353a16050d09f721ded0cc35b8af4003b7acf79d9bfbe47086e8e86aae15c72f6d65529c314a7d9b933c67b5b120c9702dd9e59cfe9bf4690e8b3f15038ea3c3275bde56597157eeb20c2d4a85690af29ec0b2d841a8a6141f60f6b58ace887e41b774794af5707b642d9182bd34b48f8eb7be768f0ef4628bd84ccd551fd1c561f70401531089d2537bacf4b0692807540d7377bcb7271589f46f43bf82e093b55c3cf99238ba26db1325b8bb144104817e5d9b39e8597652d40e525b620027ac5e76ba4b0e8167c09e5b74cb3cd45612545382c165ad6fc4b439d2c71f54b3e787f406d0a8a6813198f616fc9ef7ce9fdc241b11e12c1cd2015b5e6eca3b1c77a2277803dd771351a009abb02b276e0aa559df66960e39d4bf3a887db640e634dcab6c093ae5f0f0abbe316448df5b0e1941e9b6cf5b8656792ddfbd558f5f455f42baf2b44a362484cb517b81c157ab7df4531ea8efe4d647a09991b15496efc44309968212367d5f44478db9713db085583e0ee52ebd1de1546c1d68deada98817a6bfc178cf755c3655f30f0a60c1cc4e28802eb9871e33d0daa49fab4270f247a62fffa4b95298fc9c937ad48b7374e3e453c9106b88620ee1aa14ad0ab018370f5409ed0e0daed8a561a3892fbe7409568539d11a2d823731a2d6c9b7a7d43f87d0180c352d3fe201141f2e09e4b3811524e20519c2f5cd6934586f0800e09f03aed30d69f7f01c527562d59cb19dc0376ee33605595cc82254c962f3fb45b7d85ef00ed08c6aeabd06458e099a0a201063d595637e42c01445bd849ce9aa8c59074c3d5575681cd136166f758e7ae22eb267f8bd9f3b77132f1fb472aa0f77a40653b46304782b5f8aaad51e27166a41c8be37352edf88711c8624ce1d9532a9f20654da2ec15e830a20086f2a074180e846a43d0d3427454d906a929ee0a6a494f6e4dc2cd90d056f8061180f541bf05dbadce91ca157a52e8dba2480d2030d2ce678de675be3474c832534962d51843de528dcf2f946e76118178fc72c24f4f1e0d92d6e7c434668fb8a92dd93a40bba00f93c78acbc215e2b08a12ca4ca3de512566ebe158b1b4428cf40d5448135453a9eb994734af3db5d2a2945627b7ba19adfb5eab52a9cef2a9f71019aac4e9e03c26a42d826a24f01a3f73163f533c52e75fbd7a89e305a0e4ed0190486660b0140cdc0916f737ef5bf06f037a5baeb021e1e3f5dde5b188b778aa629776ebc5e6fa96879247bbcf8fa417ced05a4461fa8e4e80560ced517741975906193f1592d50bfcf6e625f418bb3a16629d7bc32f1a32bcf8f871d48a45bbb42a6df6abe5d759e8f8ad7d5c5ad287b658d8f947058476ba6816a3a8cbfdb91a1f2f66191eb0ef53ac0a16bfdefb511975197cb76cb958bb324f7a0acc5f53924df666a1ce10cb1ded69bdd2f62e6a279cab95bfb404f91b03a5b24862592b419d73c11c502577e4d28408dc69b9f59cd72f303829b51e1b8141fe7cde49a8cdf6e4d23856c08381823da20f3e2d2cbcd6e025351c453aaf078fce6fd65275e8ab5208eb137be5444eac8ce45fc9d6544802b068d23acc4d0f7576db86cf847ea39e40f8063d2df5d28b090c94155658d36c39d6a48da042698b0b6830e73e0175724291978cfdf443188ab115a658bc1ea0de41ec49a7f06e05c094c99c28359edbbca7beb0dbfa35ef652cddaed80613b7aebcfef80be05e5200bdb9aee8f25b9e7a3537371e12eaff70a0fb4ee143a71b4526c7460e0037b3a0c90ff246a4280ba09a9224f025edae1ae0f88febb318ccec2db5076c68f24b3b740a97cbf19dd555f500bc237b806c61473cd814c7a3b5641d6ab695ea3404514cb99f05a115b046c4e34352dde6db334b79a34e64e65321300277b55118be37dde7768950468ff09819d8edfde4bc342911051e196f13ffd8d773bc4d394f8d734e5daad66a922b0dee9f8c39baf189f05b5f9334c27466f6210cecbd35ed5776e1002023e7b4b036e38a4c417127f994c69bea39c726e0044c45d00ce73d6da3c4f77b1d508ec6a175949c5ba91ebb225a55a6207eba8ed189ed90ced0b4b11f7e97fa350171f4a8e924d50c95d15a5bc9222b16ff174992d49c615ee2a821c9582a5e73a303409c98afdd5bb4376b87301608b36ffcc0ccc69c2e438114d45eed55154222f9ac8f33f0e633ae6830a7c0448d7abf71998f063c5c12eafb3556221919e6daa235a7311b61af127afa2f7baffd22af5022df961b9ba27df061eee3d0fa8f0ac02d44a162866e8e23623b11b3ad37fb8cf60e47732681d45ae7eaf5024cdd6bbab63c0a12f01ef5a2a8c801a42746b10aa23eae22e8e3b7daf66dbaeab63b4e2a13b876cec0defc88233084bc634cf1aac8922d617ebc40ef0a66285170061d7f4f4ab53595859c1bcd0bfa361426a74a3d329549399db2fd23e739defab891d5bff30e1044c81a68ead186f663ad9dfbc540c60dc9a68c376dac6402dadf77dfd77535e134c6b213baa8cb324d1d339c43d0e285f3f369f43d4551e82e706ae3a61d17a18b4bbdb33f2a0fde78e7bde6b9da0c50a078479ad90cea8a9e275f7d7b10f0cbeb35cd496d3bd019a558ad40e848821587a2c1a02dfed23b977f269c89f97b92af4e9bb3e8c5bc35185fa9a850241fa91f57da24181a29d8d04763d38293e6b3194fe2019dfa7a0475a0a7dae90c63b8ec993e177854a3711efa16ecbbb927a415215beac93936186a46ef5ac03e00611c9228a72c4b206c85db1d13dc4b34c419491d26f5412678a9356b276c5fc78469363fbb377ad6185a2166e27f1a20e21b7f1d11cf38fd7ee2b4088ac1e9a81023b82c337031951731a5e38b29c60b4531fc6107937474a7f927c773d2dadd2396959dd8373d80a9ea1f7431554fb298b14a103251259d88d8f19dca5c15a6830ecceaa36f701db9e293a055398e352feb83939e29c3c44365c9b43bcc5c01aa8c4a22945f5303eb14ed3ee7412caa0f3a6db0c4e6316749e35eb2a8870f488b31a76b5e9bdb90a4410b61b0602ea7b7a695cee04579b94424003238f4d7cf54405e11a9c2d1f088539fdfdab43eaf1c551243c97e77799f88860ac56b48a965e3d9e82f39baab7f7a130a1179213c08f470cd68ccd7f886f2e4be22b2d5948d011e27331adcead912c9b809c8bd3d400e65962c5c6fa0d50c1e1044bb2f340bd9c227b567d823cbeb6c436141dbd9f0cd7b98a6056df4dc326688ed51b37984642003e973254db0190a44e3de84f65d0665ac668f75c43d8703b7adf08bd704370c7f9c57fa973e0b9461e9f4bc9f08a36aeb373fd201a481cf7fa6ed0b9fa354cbc5e9a899542f15eb32a968362330774341c30938048c4e20bcca0d1cca75373754aadf8b76d17ae4faef09fbedab105f1c1286cb1e8a02c7f124ffcc4fc953af91e53b0b6dac2d56bb67ee62309a53bc9a86c06ed94c2f0a52ac1c731741f02e0d19c30484fb203dd794f26a70c10011704170330c688cd200e2141f9ac7381e1e625c13b1d32d6e1cdee7f935f23276964a40f6fce78dc9ff36c047ef6052ce47e42c71b80f18fb53f91dcb77164abd61706b2af2e8de8e870506cf5b9f4603e67430640d1a2252d17e2de221dcecf02efd721eeb55821d8f0687c977a8b35288b5ee830dfd4eb16a3e0018e318da61706a85b40b361b047bf09c671694bde4e1b56e62671d44d3075bfab9ca5bd7ce2b929dcb7fea518ed9de322a506152f8177f3960933beb98620fcfec64771aebc68906942f78fa3c84548574c01faace7bfc013885d9b8a6b3fc161d9850a4daf80080940293dee50ae76c9a74f62be78c34301dd546bfbb26befd405e97c8aba82a6c623940f579fc4ecba98820f8f0086934f1495a4476bcb883ccfbaa268f3c033f9de602a6181e80175a7aec01bfa3a74b9f97e886f14e20277a86ea0235e6c4c0e33e05ae895132f14346baae957b7aab6287fe279a34bb212554b775076bed48c7b27bf678023299cb1e52491630c80683fc6ef07c3e5eabe9acd6063d9f0440c95cff2adea5ebfd49631f58e65d810d747262ed4160f961a166c965efd8e5bdef91935baaa11684b26811a1bfaef95f1de7d8887f5e1eb12a2426f6cccad4d1cf4474f00d080dbf4bdc226a495eac990c0cf543d72fce9f1f2b4350c29190df06b067d933159ee5641358db673467afaf38f37736e36ea3a8a1b9f19776efa2089c3e25031a198596d0658990e6a941fb4da3def9c5de00e65a2e52bbde7fa8620d9e9d6f4c8da43c868481c8ad9fde87af1ab7f4cca5e1cd2788988f68ecd4cf38780e7a6e33bba5834e3fe0e6cc308754f5f970217b74714e661","link":"/2018/12/31/%E7%94%9F%E6%B4%BB/%E6%88%91%E7%9A%842018/"},{"title":"æ‰¶æ‘‡å‰§","text":"å®—è¶Šæ˜¯ä¸€ä¸ªå¸¦ç€ä»‡æ¨é•¿å¤§çš„å­©å­ï¼Œè‡ªå·±äº²çœ¼ç›®ç¹çˆ¶æ¯çš„è¢«å®³ï¼Œå®¶æ—çš„ç­é—¨ï¼Œä½¿ä»–ä¸å¾—ä¸èƒŒè´Ÿè¿™æ ·çš„ä½¿å‘½ï¼Œæˆ–è®¸åªæœ‰æœ€ç»ˆå®Œæˆè¿™ä¸ªä½¿å‘½ï¼Œä»–æ‰ä¼šå½’äºå¹³é™ï¼ŒåšçœŸæ­£çš„åŒ»åœ£å§ã€‚äº‘ç—•æ˜¯è¢«ä»‡äººå…»å¤§ï¼Œè‡ªå·±ä¸æ¯«ä¸çŸ¥ï¼Œå†…å¿ƒä¹Ÿæ˜¯æ„Ÿæ¿€å…¶å…»è‚²ä¹‹æ©ã€‚æˆ–è®¸å¦‚æœä¸æ˜¯å®—è¶Šçš„å‘ŠçŸ¥ï¼Œè‡ªå·±ä¸€ç”Ÿä¹Ÿå°±å¦‚æ­¤ã€‚å“¥å“¥çš„å‡ºç°å¯¹ä»–æ˜¯ä¸€ä¸ªæ™´å¤©éœ¹é›³ï¼Œä¸€æ—¶é—´ä¼šæ— æ³•æ¥å—è¿™æ ·çš„ç°å®ï¼Œå¯æ¯•ç«Ÿæµçš„æ˜¯è½©è¾•çš„è¡€ï¼Œæœ€ç»ˆæ˜¯è¦é¢å¯¹çš„ã€‚ æœ‰çš„äººç”Ÿä¸‹æ¥å°±æ˜¯å¸¦ç€ä½¿å‘½çš„ï¼Œä»–å°†ä¸ºè¿™ä¸ªä½¿å‘½è€Œæ´»","link":"/2018/07/08/%E7%94%9F%E6%B4%BB/%E6%89%B6%E6%91%87%E5%89%A7/"},{"title":"é˜¿é‡Œäº‘æœåŠ¡å™¨æ¼æ´ä¿®å¤","text":"ç³»ç»Ÿç‰ˆæœ¬ï¼šUbuntu 16.04.4 LTS ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°å‘ç°æœ‰å¦‚ä¸‹æ¼æ´ï¼š ä¸¾ä¾‹ä¿®å¤å¦‚ä¸‹æ¼æ´ ä¿®å¤ï¼š 12$ apt-get update$ apt-get install krb5-locales éªŒè¯ï¼š åœ¨æ§åˆ¶å°ç‚¹å‡»éªŒè¯ï¼Œç­‰ä¼šä¼šçœ‹åˆ°ä¿®å¤æˆåŠŸã€‚ é™„æ­¤æ‰¹æ¬¡å…¶å®ƒæ¼æ´ä¿®å¤å‘½ä»¤ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243$ apt-get update$ apt-get install krb5-locales$ apt-get install patch$ apt-get install libprocps4$ apt-get install libelf1$ apt-get install file$ apt-get install libssl1.0.0$ apt-get install libnss3$ apt-get install libgcrypt20$ apt-get install ntp$ apt-get install libx11-6$ apt-get install libpython2.7 -y$ apt-get install libpython3.5 -y$ apt-get install libtiff5$ apt-get install curl -y$ apt-get install openssh-client -y$ apt-get install busybox-static$ apt-get install libjpeg-turbo8$ apt-get install libcups2$ apt-get install ntfs-3g$ apt-get install libarchive13$ apt-get install libbind9-140 -y$ apt-get install libldap-2.4-2$ apt-get install libperl5.22 -y$ apt-get install libxml2$ apt-get install libglib2.0-0$ apt-get install libavahi-client3$ apt-get install libpam-systemd$ apt-get install python3-requests$ apt-get install libsqlite3-0$ apt-get install sudo$ apt-get install dbus -y$ apt-get install vim -y$ apt-get install wget$ apt-get install gnupg$ apt-get install libpng12-0$ apt-get install libarchive-zip-perl$ apt-get install libpolkit-gobject-1-0$ apt-get install apt -y$ apt-get install linux-image-generic$ apt-get install linux-image-4.4.0-117-generic","link":"/2019/08/15/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E9%98%BF%E9%87%8C%E4%BA%91%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D/"},{"title":"keepalivedå®ç°redisä¸»ä»å¤åˆ¶é«˜å¯ç”¨","text":"å®ç°ç›®æ ‡ï¼š A ã€B ä¾æ¬¡å¯åŠ¨ï¼ŒAï¼ˆ192.168.1.34ï¼‰ä½œä¸ºä¸»ã€Bï¼ˆ192.168.1.33ï¼‰ä¸ºä» ä¸»A æŒ‚æ‰ï¼ŒBæ¥ç®¡ä¸šåŠ¡ï¼Œä½œä¸ºä¸» A èµ·æ¥ï¼Œä½œä¸ºä»SLAVEOF B B æŒ‚æ‰ï¼ŒA åˆ‡å›ä¸» redisä¸»ä»é…ç½®ä¸»ä»ä¸¤å°æœºå™¨éƒ½æŒ‰å®‰è£…å¥½rediså 1ã€ ç¼–è¾‘ä¿®æ”¹ä¸»æœåŠ¡é…ç½®æ–‡ä»¶ 12345bind 0.0.0.0daemonize yes #åå°å¯åŠ¨logfile \"/var/log/redis/redis.log\"slave-server-stale-data no #åŒæ­¥æœªå®Œæˆä»æœºä¸èƒ½æ¥æ”¶é™¤slaveofå’Œinfoä¹‹å¤–çš„å‘½ä»¤ï¼Œç›¸å½“é‡è¦slave-read-only no #ä»æœºæ—¶ä¹Ÿå¯ä»¥æ‰§è¡Œå†™å‘½ä»¤ 2ã€ ç¼–è¾‘ä¿®æ”¹ä»æœåŠ¡é…ç½®æ–‡ä»¶ 123456bind 0.0.0.0daemonize yes #åå°å¯åŠ¨logfile \"/var/log/redis/redis.log\"slaveof 192.168.1.34 6379slave-server-stale-data no #åŒæ­¥æœªå®Œæˆä»æœºä¸èƒ½æ¥æ”¶é™¤slaveofå’Œinfoä¹‹å¤–çš„å‘½ä»¤ï¼Œç›¸å½“é‡è¦slave-read-only no #ä»æœºæ—¶ä¹Ÿå¯ä»¥æ‰§è¡Œå†™å‘½ä»¤ 3ã€ é‡å¯æœåŠ¡åredis-cliç™»å½•ä¸»ä»æœåŠ¡è¾“å…¥infoæŸ¥çœ‹æ˜¯å¦æ­£ç¡® ä¸»æœåŠ¡ 123456789101112# Replication role:master connected_slaves:1 slave0:ip=192.168.1.33,port=6379,state=online,offset=98646,lag=1 master_replid:5b18fec8936e046d517269c36d1ab538626962a1 master_replid2:a7ba915e664ecdfdb17be4ebd8d5b3ec1f95b9e1 master_repl_offset:98646 second_repl_offset:449 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:407 repl_backlog_histlen:98240 ä»æœåŠ¡ 12345678910111213141516171819# Replicationrole:slavemaster_host:192.168.1.34master_port:6379master_link_status:upmaster_last_io_seconds_ago:3master_sync_in_progress:0slave_repl_offset:98870slave_priority:100slave_read_only:1connected_slaves:0master_replid:5b18fec8936e046d517269c36d1ab538626962a1master_replid2:a7ba915e664ecdfdb17be4ebd8d5b3ec1f95b9e1master_repl_offset:98870second_repl_offset:449repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:407repl_backlog_histlen:98464 å¯ä»¥çœ‹åˆ°redisä¸»ä»æœåŠ¡çš„å…³ç³»ã€‚ 4ã€ æµ‹è¯• åœ¨ä¸»æœåŠ¡ä¸Šset key1 value1 å¯ä»¥åœ¨ä»æœåŠ¡ä¸ŠæŸ¥åˆ°get key1 è¯´æ˜redisçš„ä¸»ä»å¤åˆ¶éƒ¨ç½²æˆåŠŸã€‚ KEEPALIVEDé…ç½®åœ¨keepalived æœ‰ä¸¤ä¸ªè§’è‰²ï¼šMaster(ä¸€ä¸ª)ã€Backupï¼ˆå¤šä¸ªï¼‰ï¼Œå¦‚æœè®¾ç½®ä¸€ä¸ªä¸ºMasterï¼Œä½†MasteræŒ‚äº†åå†èµ·æ¥ï¼Œå¿…ç„¶å†æ¬¡ä¸šåŠ¡åˆä¸€æ¬¡åˆ‡æ¢ï¼Œè¿™å¯¹äºæœ‰çŠ¶æ€æœåŠ¡æ˜¯ä¸å¯æ¥å—çš„ã€‚ è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸¤å°æœºå™¨éƒ½è®¾ç½®ä¸ºBackupï¼Œè€Œä¸”ä¼˜å…ˆçº§é«˜çš„Backupè®¾ç½®ä¸ºnopreemt ä¸æŠ¢å ã€‚ 1ã€ ä¸»æœåŠ¡keepalivedé…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#vrrp_script chk_nginx {# script \"/etc/keepalived/check_nginx.sh\" //æ£€æµ‹nginxè¿›ç¨‹çš„è„šæœ¬# interval 2# weight 2#}vrrp_script chk_redis { script \"/etc/keepalived/scripts/check_redis.sh 127.0.0.1 6379\" #redis æ£€æŸ¥å¥åº·çŠ¶æ€ interval 2 #å¥åº·çŠ¶æ€æ£€æŸ¥æ—¶é—´é—´éš” 2ç§’ timeout 2 # è¯·æ±‚è¶…æ—¶æ—¶é—´ 2ç§’ fall 3 #å¤±è´¥æ¬¡æ•°}global_defs {# notification_email {# poiu00998@126.com #å¯ä»¥æ·»åŠ é‚®ä»¶æé†’# }# notification_email_from root #é…ç½®å‘ä»¶äºº# smtp_server 127.0.0.1 #é…ç½®é‚®ä»¶æœåŠ¡å™¨# smtp_connect_timeout 30# router_id LVS_DEVEL router_id node1}vrrp_instance VI_1 {# state MASTER #ä¸»æœåŠ¡å™¨ state BACKUP #ä¸»æœåŠ¡å™¨ interface ens33 virtual_router_id 51 mcast_src_ip 192.168.1.34 priority 250 nopreempt #ä¸æŠ¢å MASTER advert_int 1 authentication { auth_type PASS auth_pass 123456 } track_script { chk_redis } virtual_ipaddress { 192.168.1.35 } notify_master \"/etc/keepalived/scripts/redis_master.sh 127.0.0.1 192.168.1.33 6379\" #å½“keepalived åˆ‡æ¢åˆ°masterçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_backup \"/etc/keepalived/scripts/redis_backup.sh 127.0.0.1 192.168.1.33 6379\" #å½“keepalived åˆ‡æ¢åˆ°bakcupçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_fault /etc/keepalived/scripts/redis_fault.sh #å½“keepalived å‡ºç°æ•…éšœçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_stop /etc/keepalived/scripts/redis_stop.sh #å½“keepalived åœæ­¢è¿è¡Œå‰æ‰§è¡Œæ­¤è„šæœ¬} #ä»¥ä¸‹ä¸ºnginxé…ç½®æ‰€éœ€virtual_server 192.168.1.35 80 { delay_loop 6 lb_algo rr lb_kind DR nat_mask 255.255.255.0 #persistence_timeout 50 protocol TCP real_server 192.168.1.34 80 { #é…ç½®realaserver weight 1 HTTP_GET { #ç›‘æ§é…ç½® url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } real_server 192.168.1.33 80 { weight 1 HTTP_GET { url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } sorry_server 127.0.0.1 80 #é”™è¯¯é¡µé¢} 2ã€ ä»æœåŠ¡keepalivedé…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#vrrp_script chk_nginx { # script \"/etc/keepalived/check_nginx.sh\" //æ£€æµ‹nginxè¿›ç¨‹çš„è„šæœ¬ # interval 2 # weight 2 #} vrrp_script chk_redis { script \"/etc/keepalived/scripts/check_redis.sh 127.0.0.1 6379\" #redis æ£€æŸ¥å¥åº·çŠ¶æ€ interval 2 #å¥åº·çŠ¶æ€æ£€æŸ¥æ—¶é—´é—´éš” 2ç§’ timeout 2 # è¯·æ±‚è¶…æ—¶æ—¶é—´ 2ç§’ fall 3 #å¤±è´¥æ¬¡æ•° } global_defs { # notification_email { # poiu00998@126.com #å¯ä»¥æ·»åŠ é‚®ä»¶æé†’ # } # notification_email_from root #é…ç½®å‘ä»¶äºº # smtp_server 127.0.0.1 #é…ç½®é‚®ä»¶æœåŠ¡å™¨ # smtp_connect_timeout 30 router_id node2 } vrrp_instance VI_1 { state BACKUP #ä»æœåŠ¡å™¨ interface ens33 virtual_router_id 51 mcast_src_ip 192.168.1.33 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 123456 } track_script { chk_redis } virtual_ipaddress { 192.168.1.35 } notify_master \"/etc/keepalived/scripts/redis_master.sh 127.0.0.1 192.168.1.34 6379\" #å½“keepalived åˆ‡æ¢åˆ°masterçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_backup \"/etc/keepalived/scripts/redis_backup.sh 127.0.0.1 192.168.1.34 6379\" #å½“keepalived åˆ‡æ¢åˆ°bakcupçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_fault /etc/keepalived/scripts/redis_fault.sh #å½“keepalived å‡ºç°æ•…éšœçš„æ—¶å€™æ‰§è¡Œæ­¤è„šæœ¬ notify_stop /etc/keepalived/scripts/redis_stop.sh #å½“keepalived åœæ­¢è¿è¡Œå‰æ‰§è¡Œæ­¤è„šæœ¬ }# ä»¥ä¸‹ä¸»è¦ä¸ºnginxé…ç½®æ‰€éœ€ virtual_server 192.168.1.35 80 { delay_loop 6 lb_algo rr lb_kind DR nat_mask 255.255.255.0 #persistence_timeout 50 protocol TCP real_server 192.168.1.33 80 { #é…ç½®realaserver weight 1 HTTP_GET { #ç›‘æ§é…ç½® url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } real_server 192.168.1.34 80 { weight 1 HTTP_GET { url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } sorry_server 127.0.0.1 80 #é”™è¯¯é¡µé¢} 3ã€ åˆ›å»ºkeepalivedé…ç½®æ–‡ä»¶é‡Œæ‰€éœ€çš„è„šæœ¬æ–‡ä»¶ vim /etc/keepalived/scripts/check_redis.sh 12345678910111213#!/bin/bashALIVE=`/usr/local/bin/redis-cli -h $1 -p $2 PING`#redis-cliå‘½ä»¤æ‰€åœ¨è·¯å¾„ï¼Œæ ¹æ®è‡ªå·±é…ç½®æ›´æ”¹ï¼Œå¯ç”¨ç”¨which redis-cliå‘½ä»¤æŸ¥çœ‹è·¯å¾„ã€‚LOGFILE=\"/var/log/keepalived-redis-check.log\"echo \"[CHECK]\" &gt;&gt; $LOGFILEdate &gt;&gt; $LOGFILEif [ $ALIVE == \"PONG\" ]; then : echo \"Success: redis-cli -h $1 -p $2 PING $ALIVE\" &gt;&gt; $LOGFILE 2&gt;&amp;1 exit 0else echo \"Failed:redis-cli -h $1 -p $2 PING $ALIVE \" &gt;&gt; $LOGFILE 2&gt;&amp;1 exit 1fi vim /etc/keepalived/scripts/redis_master.sh 123456789101112#!/bin/bashREDISCLI=\"/usr/local/bin/redis-cli -h $1 -p $3\" #redis-cliå‘½ä»¤æ‰€åœ¨è·¯å¾„ï¼Œæ ¹æ®è‡ªå·±é…ç½®æ‰€æ›´æ”¹ã€‚LOGFILE=\"/var/log/keepalived-redis-state.log\"echo \"[master]\" &gt;&gt; $LOGFILEdate &gt;&gt; $LOGFILEecho \"Being master....\" &gt;&gt; $LOGFILE 2&gt;&amp;1echo \"Run SLAVEOF cmd ... \" &gt;&gt; $LOGFILE#$REDISCLI SLAVEOF $2 $3 &gt;&gt; $LOGFILE 2&gt;&amp;1#echo \"SLAVEOF $2 cmd can't excute ... \" &gt;&gt; $LOGFILEsleep 10 ##delay 15 s wait data sync exchange roleecho \"Run SLAVEOF NO ONE cmd ...\" &gt;&gt; $LOGFILE$REDISCLI SLAVEOF NO ONE &gt;&gt; $LOGFILE 2&gt;&amp;1 vim /etc/keepalived/scripts/redis_backup.sh 1234567891011#!/bin/bashREDISCLI=\"/usr/local/bin/redis-cli\"#è®¾ç½®redis-cliçš„å‘½ä»¤æ‰€åœ¨è·¯å¾„å³å¯LOGFILE=\"/var/log/keepalived-redis-state.log\"echo \"[BACKUP]\" &gt;&gt; $LOGFILEdate &gt;&gt; $LOGFILEecho \"Being slave....\" &gt;&gt; $LOGFILE 2&gt;&amp;1echo \"Run SLAVEOF cmd ...\" &gt;&gt; $LOGFILE 2&gt;&amp;1$REDISCLI SLAVEOF $2 $3 &gt;&gt; $LOGFILEsleep 100 #delay 10 s wait data async cancel syncexit(0) vim /etc/keepalived/scripts/redis_fault.sh 1234#!/bin/bashLOGFILE=/var/log/keepalived-redis-state.logecho \"[fault]\" &gt;&gt; $LOGFILEdate &gt;&gt; $LOGFILE vim /etc/keepalived/scripts/redis_stop.sh 1234#!/bin/bashLOGFILE=/var/log/keepalived-redis-state.logecho \"[stop]\" &gt;&gt; $LOGFILEdate &gt;&gt; $LOGFILE æ¥ä¸‹æ¥å°±å¯ä»¥æµ‹è¯•äº†æ³¨ï¼šredis SLAVEOFå‘½ä»¤ å¯ä»¥åŠ¨æ€æ›´æ”¹ä»å±çš„å¤åˆ¶è®¾ç½®ã€‚å¦‚æœRedisæœåŠ¡å™¨å·²ç»å……å½“ä»ç«™å‘½ä»¤SLAVEOF NO ONE ä¼šå…³æ‰å¤åˆ¶ï¼Œè½¬RedisæœåŠ¡å™¨ä¸ºä¸»ã€‚ åœ¨é€‚å½“çš„å½¢å¼SLAVEOFä¸»æœºç«¯å£å°†ä½¿å¦ä¸€å°æœåŠ¡å™¨ç›‘å¬æŒ‡å®šçš„ä¸»æœºåå’Œç«¯å£ä¸ºä»æœºã€‚ å¦‚æœæœåŠ¡å™¨å·²ç»æ˜¯ä¸€ä¸ªä»äºä¸€ä¸ªä¸»ï¼ŒSLAVEOFä¸»æœºç«¯å£å°†åœæ­¢å¯¹æ—§æœåŠ¡å™¨çš„å¤åˆ¶ï¼Œå¹¶å¼€å§‹å¯¹æ–°çš„åŒæ­¥ï¼Œä¸¢å¼ƒæ—§çš„æ•°æ®é›†ã€‚ è¯­æ³•ï¼š 1redis 127.0.0.1:6379&gt; SLAVEOF host port","link":"/2017/08/05/%E9%AB%98%E5%8F%AF%E7%94%A8/keepalived%E5%AE%9E%E7%8E%B0redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"title":"keepalivedå®ç°nginxé«˜å¯ç”¨è´Ÿè½½å‡è¡¡","text":"éœ€æ±‚ï¼šä¸¤å°ç›’å­æœåŠ¡å™¨ï¼ˆå†…ç½‘æœåŠ¡å™¨ï¼‰ç›¸åŒé…ç½®ã€ç›¸åŒè§„æ ¼ï¼Œå®ç°å…¶ä¸­ä¸€å°æŒ‚æ‰ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€å°å¤‡ä»½æœåŠ¡å™¨ï¼Œä»è€Œä¸å½±å“ç”¨æˆ·çš„è®¿é—®ã€‚ è®¾ç½®è™šæ‹ŸIPä¸´æ—¶è®¾ç½®ï¼š1$ ifconfig ens33:0 192.168.1.35 netmask 255.255.255.0 up æ‰§è¡Œifconfigä¾¿çœ‹åˆ°æ•ˆæœï¼Œé‡å¯åè‡ªåŠ¨å¤±æ•ˆã€‚ æ°¸ä¹…é…ç½® :å†™å…¥/etc/network/interfacesé…ç½®æ–‡ä»¶ 123456#è™šæ‹Ÿipauto ens33:0iface ens33:0 inet staticaddress 192.168.1.35netmask 255.255.255.0gateway 192.168.1.2 é‡å¯ç½‘å¡ï¼š123$ service networking restart $ nohup service network restart &amp; # æˆ–è€…#ï¼ˆè™½ç„¶æ²¡åœ¨æ§åˆ¶å°æŠ¥é”™ï¼Œä½†åœ¨æ—¥å¿—ä¸­å¯ä»¥æŸ¥çœ‹ï¼‰ é‡å¯åä¼šå‡ºé”™ï¼Œä½†ifconfigæŸ¥çœ‹å·²ç»æˆåŠŸï¼Œæ‰€ä»¥æš‚å¿½ç•¥ã€‚ è®¾ç½®å®Œè™šæ‹Ÿipåå·²æ»¡è¶³éœ€æ±‚ ç”±äºå…³æ‰æ­£åœ¨æœåŠ¡çš„nginxæˆ–tomcatä¸èƒ½é©¬ä¸Šåˆ‡æ¢åˆ°å¦ä¸€å°æœåŠ¡ä¸Šæ‰€ä»¥è¿˜éœ€keepalived KEEPALIVEDå®‰è£…åŠé…ç½®å‡†å¤‡ï¼šï¼ˆè™šæ‹Ÿipä¸º192.168.1.35ï¼Œä¸»æœåŠ¡å™¨ä¸º192.168.1.34 ä»æœåŠ¡å™¨ä¸º192.168.1.33ï¼‰ä¸»ä»æœåŠ¡å™¨éƒ½å·²å®‰è£…nginxã€tomcatï¼Œä¸”nginxå·²åšå¥½è½¬å‘ 1ã€å®‰è£…keepalivedï¼š 1$ apt-get install keepalived 2ã€åˆ›å»ºkeepalived.confæ–‡ä»¶ (vim /etc/keepalived/keepalived.conf) ä¸»æœåŠ¡å™¨keepalived.confæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#vrrp_script chk_nginx { # script \"/etc/keepalived/check_nginx.sh\" //æ£€æµ‹nginxè¿›ç¨‹çš„è„šæœ¬ # interval 2 # weight 2 #} global_defs { # notification_email { # poiu00998@126.com #å¯ä»¥æ·»åŠ é‚®ä»¶æé†’ # } # notification_email_from root #é…ç½®å‘ä»¶äºº # smtp_server 127.0.0.1 #é…ç½®é‚®ä»¶æœåŠ¡å™¨ # smtp_connect_timeout 30 # router_id LVS_DEVEL } vrrp_instance VI_1 { state MASTER #ä¸»æœåŠ¡å™¨ interface ens33 virtual_router_id 51 mcast_src_ip 192.168.1.34 priority 250 advert_int 1 authentication { auth_type PASS auth_pass 123456 } track_script { chk_nginx } virtual_ipaddress { 192.168.1.35 }}virtual_server 192.168.1.35 80 { delay_loop 6 lb_algo rr lb_kind DR nat_mask 255.255.255.0 #persistence_timeout 50 protocol TCP real_server 192.168.1.34 80 { #é…ç½®realaserver weight 1 HTTP_GET { #ç›‘æ§é…ç½® url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } real_server 192.168.1.33 80 { weight 1 HTTP_GET { url { path / status_code 200 } connect_timeout 2 nb_get_retry 3 delay_before_retry 1 } } sorry_server 127.0.0.1 80 #é”™è¯¯é¡µé¢} ä»æœåŠ¡å™¨keepalived.confæ–‡ä»¶é™¤äº†ä¼˜å…ˆçº§ï¼Œstateå’Œmcast_src_ipä¸ä¸€æ ·ï¼Œå…¶ä»–çš„å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„å‡ ç‚¹æ˜¯ï¼š ä¸»æœåŠ¡å™¨çš„stateä¸ºMASTER,ä»æœåŠ¡å™¨çš„stateä¸ºBACKUP ä¸»æœåŠ¡å™¨çš„priorityä¸€å®šè¦æ¯”ä»æœåŠ¡å™¨çš„priorityå¤§ mcast_src_ipå°±æ˜¯å¯¹åº”æœåŠ¡å™¨çš„å±€åŸŸç½‘ip â€œ{â€å‰é¢ä¸€å®šè¦æœ‰ä¸ªç©ºæ ¼ï¼Œä¸èƒ½è·Ÿå‰é¢çš„å­—ç¬¦è¿èµ·æ¥ï¼Œå¦åˆ™å‡ºç°é—®é¢˜å¾ˆéš¾å‘ç° real_server ipä¸ºçœŸå®IPã€‚ æœåŠ¡å™¨çš„é‚®ä»¶æœåŠ¡smtpæœªé…ç½®ï¼Œæš‚ä¸å¯å‘é€é‚®ä»¶é€šçŸ¥ã€‚ keepalivedé‡Œçš„check_nginx.shè„šæœ¬(æš‚æœªç”¨) 12345678910#!/bin/bash#ä»£ç ä¸€å®šæ³¨æ„ç©ºæ ¼ï¼Œé€»è¾‘å°±æ˜¯ï¼šå¦‚æœnginxè¿›ç¨‹ä¸å­˜åœ¨åˆ™å¯åŠ¨nginx,å¦‚æœnginxæ— æ³•å¯åŠ¨åˆ™killæ‰keepalivedæ‰€æœ‰è¿›ç¨‹A=ps -C nginx --no-header |wc -lif [ $A -eq 0 ];then/etc/init.d/nginx startsleep 3if [ ps -C nginx --no-header |wc -l -eq 0 ];thenkillall keepalivedfifi 3ã€å¯åŠ¨ä¸»ã€ä»çš„keepalivedæœåŠ¡ 1$ service keepalived start 4ã€æŸ¥çœ‹ keepalivedçš„æ—¥å¿— 1$ vim /var/log/syslog 5ã€æŸ¥çœ‹ä¸€ä¸‹LVSçŠ¶æ€ï¼š 1234567$ /var/log# ipvsadm -L -nIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags-&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 192.168.1.35:80 rr-&gt; 192.168.1.33:80 Route 1 0 0-&gt; 192.168.1.34:80 Route 1 0 103 6ã€æµ‹è¯• åœ¨æµè§ˆå™¨è®¿é—®192.168.1.35 å¤šæ¬¡åˆ·æ–°ï¼Œå°±ä¼šçœ‹åˆ°æœåŠ¡çš„åˆ‡æ¢ã€‚ æ¨¡æ‹Ÿæ•…éšœ åœæ­¢å…¶ä¸­ä¸€å°tomcatæˆ–è€…nginx(åœæ‰çš„192.168.1.33çš„nginx) ï¼Œç„¶åæŸ¥çœ‹lvs 123456$ /var/log# ipvsadm -L -nIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags-&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 192.168.1.35:80 rr-&gt; 192.168.1.34:80 Route 1 0 103 å¯ä»¥çœ‹åˆ°192.168.1.33ä¾¿ä¸å­˜åœ¨äº†ï¼Œæµè§ˆå™¨è®¿é—®192.168.1.35åªè½¬å‘192.168.1.34äº†ï¼ˆåœæ­¢å¦ä¸€å°ï¼Œæ•ˆæœç›¸åŒï¼‰","link":"/2017/08/02/%E9%AB%98%E5%8F%AF%E7%94%A8/keepalived%E5%AE%9E%E7%8E%B0nginx%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"title":"å…³äºé—®ç­”çˆ¬è™«éœ€æ±‚çš„åˆ†æ","text":"çŸ¥ä¹çˆ¬è™« çˆ¬å–è¯é¢˜ 1ã€çŸ¥ä¹æ ¹è¯é¢˜ï¼ˆhttps://www.zhihu.com/topic/19776749/hotï¼‰ 1https://www.zhihu.com/api/v4/topics/19776749/feeds/top_activity?include=data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.is_normal,comment_count,voteup_count,content,relevant_info,excerpt.author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=article)].target.content,voteup_count,comment_count,voting,author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=people)].target.answer_count,articles_count,gender,follower_count,is_followed,is_following,badge[?(type=best_answerer)].topics;data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=answer)].target.author.badge[?(type=best_answerer)].topics;data[?(target.type=article)].target.content,author.badge[?(type=best_answerer)].topics;data[?(target.type=question)].target.comment_count&amp;offset=5&amp;limit=10 1https://www.zhihu.com/api/v4/topics/19776749/feeds/top_activity?include=data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.is_normal,comment_count,voteup_count,content,relevant_info,excerpt.author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=article)].target.content,voteup_count,comment_count,voting,author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=people)].target.answer_count,articles_count,gender,follower_count,is_followed,is_following,badge[?(type=best_answerer)].topics;data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=answer)].target.author.badge[?(type=best_answerer)].topics;data[?(target.type=article)].target.content,author.badge[?(type=best_answerer)].topics;data[?(target.type=question)].target.comment_count&amp;limit=10&amp;after_id=4847.84338&amp;offset=5 2ã€è¨€è¯´çŸ¥ä¹æœ€çƒ­ï¼ˆçˆ¬å–å…¨éƒ¨150å¤šé¡µï¼‰ï¼ˆhttps://www.yanshuo.me/r/zhihuhotï¼‰ è§£æhttps://www.yanshuo.me/r/zhihuhot è·å–åˆ—è¡¨ç½‘å€ï¼Œå³å¯è·å¾—å…·ä½“è¯é¢˜çš„IDï¼Œç„¶åå°±å¯æ‹¼æ¥å‡ºå¦‚ä¸‹æ¥å£ã€‚ https://www.zhihu.com/api/v4/answers/147785918https://www.zhihu.com/api/v4/questions/31271400 3ã€æ–°åª’ä½“ç®¡å®¶çŸ¥ä¹ç²¾é€‰ï¼ˆçˆ¬å–ä»Šæ—¥æœ€çƒ­ã€ç¼–è¾‘æ¨èå’Œ33ä¸ªè¯é¢˜ä¸‹çš„é—®é¢˜ï¼‰ï¼ˆhttps://article.xmt.cn/#/zhihu/hotï¼‰ ï¼ˆ1ï¼‰ä»Šæ—¥æœ€çƒ­http://zhihu.sogou.com/include/pc/pc/hot/hot0.htmlè§£æä»¥ä¸Šç±»ä¼¼htmlå³å¯ï¼Œé¡µæ•°æ˜¯åé¢çš„0ã€‚ ï¼ˆ2ï¼‰ç¼–è¾‘æ¨èhttp://zhihu.sogou.com/include/pc/pc/recommend/recommend0.htmlåŒä»Šæ—¥æœ€çƒ­ã€‚ ï¼ˆ3ï¼‰33ä¸ªè¯é¢˜ 123v_categoryList: [{ name: 'æ¸¸æˆ', index: 0, nav: 'topic0_0' }, { name: 'è¿åŠ¨', index: 1, nav: 'topic1_0' }, { name: 'äº’è”ç½‘', index: 2, nav: 'topic2_0' }, { name: 'è‰ºæœ¯', index: 3, nav: 'topic3_0' }, { name: 'é˜…è¯»', index: 4, nav: 'topic4_0' }, { name: 'ç¾é£Ÿ', index: 5, nav: 'topic5_0' }, { name: 'åŠ¨æ¼«', index: 6, nav: 'topic6_0' }, { name: 'æ±½è½¦', index: 7, nav: 'topic7_0' }, { name: 'ç”Ÿæ´»æ–¹å¼', index: 8, nav: 'topic8_0' }, { name: 'æ•™è‚²', index: 9, nav: 'topic9_0' }, { name: 'æ‘„å½±', index: 10, nav: 'topic10_0' }, { name: 'å†å²', index: 11, nav: 'topic11_0' }, { name: 'æ–‡åŒ–', index: 12, nav: 'topic12_0' }, { name: 'æ—…è¡Œ', index: 13, nav: 'topic13_0' }, { name: 'èŒä¸šå‘å±•', index: 14, nav: 'topic14_0' }],v_categoryList2: [{ name: 'ç»æµå­¦', index: 15, nav: 'topic15_0' }, { name: 'è¶³çƒ', index: 16, nav: 'topic16_0' }, { name: 'ç¯®çƒ', index: 17, nav: 'topic17_0' }, { name: 'æŠ•èµ„', index: 18, nav: 'topic18_0' }, { name: 'éŸ³ä¹', index: 19, nav: 'topic19_0' }, { name: 'ç”µå½±', index: 20, nav: 'topic20_0' }, { name: 'æ³•å¾‹', index: 21, nav: 'topic21_0' }, { name: 'è‡ªç„¶ç§‘å­¦', index: 22, nav: 'topic22_0' }, { name: 'è®¾è®¡', index: 23, nav: 'topic23_0' }, { name: 'åˆ›ä¸š', index: 24, nav: 'topic24_0' }, { name: 'å¥åº·', index: 25, nav: 'topic25_0' }, { name: 'å•†ä¸š', index: 26, nav: 'topic26_0' }, { name: 'ä½“è‚²', index: 27, nav: 'topic27_0' }, { name: 'ç§‘æŠ€', index: 28, nav: 'topic28_0' }, { name: 'åŒ–å­¦', index: 29, nav: 'topic29_0' }, { name: 'ç‰©ç†å­¦', index: 30, nav: 'topic30_0' }, { name: 'ç”Ÿç‰©å­¦', index: 31, nav: 'topic31_0' }, { name: 'é‡‘è', index: 32, nav: 'topic32_0' }] è§£æhttp://zhihu.sogou.com/include/pc/5/topic/topic0_0.html 4ã€X æ˜¯ç§æ€æ ·çš„ä½“éªŒ 1https://www.zhihu.com/api/v4/topics/20011035/feeds/top_activity?include=data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=topic_sticky_module)].target.data[?(target.type=answer)].target.is_normal,comment_count,voteup_count,content,relevant_info,excerpt.author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=article)].target.content,voteup_count,comment_count,voting,author.badge[?(type=best_answerer)].topics;data[?(target.type=topic_sticky_module)].target.data[?(target.type=people)].target.answer_count,articles_count,gender,follower_count,is_followed,is_following,badge[?(type=best_answerer)].topics;data[?(target.type=answer)].target.content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp;data[?(target.type=answer)].target.author.badge[?(type=best_answerer)].topics;data[?(target.type=article)].target.content,author.badge[?(type=best_answerer)].topics;data[?(target.type=question)].target.comment_count&amp;offset=5&amp;limit=10 æ‚Ÿç©ºé—®ç­” ä»¥ç¤¾ä¼šæ ‡ç­¾ä¸ºä¾‹ï¼Œ concern_id ä¸ºâ€œç¤¾ä¼šâ€æ ‡ç­¾Id,tä¸ºå½“å‰æ—¶é—´çš„æ¯«ç§’æ•°ã€‚_signatureä¸ºä¸€ä¸ªç­¾åã€‚max_behot_time ä¸ºä¸Šä¸€æ¥å£è¿”å›çš„æœ€åä¸€æ¡ä¸­çš„behot_timeçš„å€¼ã€‚ æ¯æ¬¡è¯·æ±‚æœ€å¤šè¿”å›15æ¡æ•°æ®ã€‚ https://www.wukong.com/wenda/web/nativefeed/brow/?concern_id=6215497899397089794&amp;t=1535695219126&amp;_signature=EpFuSRAcSR4Gf9W44qy9xxKRbl https://www.wukong.com/wenda/web/nativefeed/brow/?concern_id=6215497899397089794&amp;t=1535695230470&amp;max_behot_time=1535695169&amp;_signature=EpFuSRAcSR4Gf9W44qzD4BKRbl https://www.wukong.com/wenda/web/nativefeed/brow/?concern_id=6215497899397089794&amp;t=1535695757329&amp;max_behot_time=1535695107&amp;_signature=EpFuSRAcSR4Gf9W44qzCChKRbl https://www.wukong.com/wenda/web/nativefeed/brow/?concern_id=6215497899397089794&amp;t=1535696088148&amp;max_behot_time=1535694957&amp;_signature=EpFuSRAcSR4Gf9W44qzwwxKRbl ç„¶åçˆ¬å–é—®é¢˜å¯¹åº”çš„æ‰€æœ‰å›ç­”ã€‚ éœ€è§£æhttps://www.wukong.com/question/6474295200058441997/ ç±»å‹htmlé¡µé¢ èŠéº»é—®ç­”æ¥å£ä¸ºpostè¯·æ±‚ï¼Œè¯·æ±‚æ—¶éœ€æ‹¿ç€ä¸Šæ¬¡çš„cookieå»è¯·æ±‚ https://www.zhimawenda.com/api/client/moon_index.json ç„¶åè·å–æ¯ä¸ªé—®é¢˜çš„æ‰€æœ‰å›ç­”https://www.zhimawenda.com/api/questions/43519/answers.json?page=1","link":"/2018/08/31/%E7%88%AC%E8%99%AB/%E5%85%B3%E4%BA%8E%E9%97%AE%E7%AD%94%E7%88%AC%E8%99%AB%E9%9C%80%E6%B1%82%E7%9A%84%E5%88%86%E6%9E%90/"},{"title":"Keepalivedå®ç°mongoDBçš„é«˜å¯ç”¨","text":"å®ç°ç›®æ ‡ï¼š A(192.168.1.34)ã€B(192.168.1.33)ä¸¤æœºå™¨åŒæ—¶å·¥ä½œï¼Œäº’ä¸ºä¸»ä»ï¼Œå…¶ä¸­ä¸€å°å®•æœºï¼Œä¸šåŠ¡è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€å°ï¼Œä¸å½±å“ç”¨æˆ·è®¿é—®ã€‚ æ­¤ç¯‡æ˜¯ä»¥mongoDBæ•°æ®åº“çš„åŒå‘å¤åˆ¶å®Œæˆæ•°æ®åº“çš„é«˜å¯ç”¨æ€§ã€‚ å®‰è£…mongoDB1ã€è§£å‹ 1$ tar -zxvf mongodb-linux-x86_64-ubuntu1604-3.4.2.tgz -C /usr/local 2ã€æ·»åŠ pathè·¯å¾„ vim /etc/profile 123#MONGODBexport MONGO_HOME=/usr/local/mongodbexport PATH=$PATH:$MONGO_HOME/bin æ‰§è¡Œsource /etc/profileï¼Œä½¿profileç”Ÿæ•ˆã€‚ 3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ï¼švim /etc/mongodb.conf 1234567bind_ip = 127.0.0.1port = 27017dbpath =/usr/local/mongodb/datalogpath = /usr/local/mongodb/logs/master.logpidfilepath = /var/run/mongodb/mongodb.pidfork = truejournal = true 4ã€åˆ›å»ºæœåŠ¡è„šæœ¬vim /etc/init.d/mongodb 1234567891011121314151617181920212223242526272829303132333435#!/bin/sh### BEGIN INIT INFO# Provides: mongodb# Required-Start:# Required-Stop:# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: mongodb# Description: mongo db server### END INIT INFO. /lib/lsb/init-functionsPROGRAM=/usr/local/mongodb/bin/mongodMONGOPID=`ps -ef | grep 'mongod' | grep -v grep | awk '{print $2}'`test -x $PROGRAM || exit 0case \"$1\" in start) ulimit -n 3000 log_begin_msg \"Starting MongoDB server\" $PROGRAM --config /etc/mongodb.conf log_end_msg 0 ;; stop) log_begin_msg \"Stopping MongoDB server\" if [ ! -z \"$MONGOPID\" ]; then kill -15 $MONGOPID fi log_end_msg 0 ;; status) ;; *) log_success_msg \"Usage: /etc/init.d/mongodb {start|stop|status}\" exit 1esacexit 0 5ã€èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ 1$ chmod +x mongodb 6ã€æ³¨å†Œä¸ºæœåŠ¡ 1$ update-rc.d mongodb defaults MONGODBçš„åŒå‘å¤åˆ¶1ã€ä¿®æ”¹ä¸»æœåŠ¡Açš„é…ç½®æ–‡ä»¶:vim /etc/mongodb.conf 123456789#master.confdbpath=/usr/local/mongodb/datalogpath=/usr/local/mongodb/logs/master.logmaster=trueslave=truesource=192.168.1.33:27017fork=trueport=27017oplogSize=2048 2ã€ä¿®æ”¹ä»æœåŠ¡Bçš„é…ç½®æ–‡ä»¶: vim /etc/mongodb.conf 123456789#master.confdbpath=/usr/local/mongodb/datalogpath=/usr/local/mongodb/logs/slave.logmaster=trueslave=truesource=192.168.1.34:27017fork=trueport=27017autoresync=true 3ã€æµ‹è¯•åŒå‘å¤åˆ¶ å¯åŠ¨ä¸¤æœºå™¨mongoDBæœåŠ¡åç™»å½•è¿›å» 123456789101112&gt; db.isMaster(){ \"ismaster\" : true, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 1000, \"localTime\" : ISODate(\"2017-08-08T01:44:45.150Z\"), \"maxWireVersion\" : 5, \"minWireVersion\" : 0, \"readOnly\" : false, \"ok\" : 1} å¯ä»¥çœ‹åˆ°ä¸¤æœºå™¨éƒ½ä¸ºä¸»æœåŠ¡ã€‚ 1ã€åœ¨Aæœºå™¨æ·»åŠ ä¸€æ¡æ•°æ® 123456&gt; use testswitched to db test&gt; db.test.save({age:18})WriteResult({ \"nInserted\" : 1 })&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 } åœ¨Bæœºå™¨ä¸ŠæŸ¥è¯¢ 1234&gt; use testswitched to db test&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 } çœ‹åˆ°å¯ä»¥æŸ¥åˆ° 2ã€åœ¨Bæœºå™¨ä¸Šæ·»åŠ ä¸€æ¡æ•°æ® 12345&gt; db.test.save({age:22})WriteResult({ \"nInserted\" : 1 })&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 }{ \"_id\" : ObjectId(\"598917c62e7723e440d366a7\"), \"age\" : 20 } åœ¨Aæœºå™¨ä¸ŠæŸ¥è¯¢ 123&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 }{ \"_id\" : ObjectId(\"598917c62e7723e440d366a7\"), \"age\" : 20 } çœ‹åˆ°ä¹Ÿå¯ä»¥æŸ¥åˆ° 3ã€æŠŠAæœåŠ¡åœæ‰ï¼šservice mongodb stop åœ¨Bæœºå™¨ä¸Šæ·»åŠ ä¸€æ¡æ•°æ® 123456&gt; db.test.save({age:22})WriteResult({ \"nInserted\" : 1 })&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 }{ \"_id\" : ObjectId(\"598917c62e7723e440d366a7\"), \"age\" : 20 }{ \"_id\" : ObjectId(\"59891827da882ffb1ce7b7e3\"), \"age\" : 22 } å†å¯åŠ¨AæœåŠ¡ï¼šservice mongodb start ç„¶ååœ¨Aæœºå™¨ä¸ŠæŸ¥è¯¢ 1234&gt; db.test.find(){ \"_id\" : ObjectId(\"59883e2ca5f50d892813d7af\"), \"age\" : 18 }{ \"_id\" : ObjectId(\"598917c62e7723e440d366a7\"), \"age\" : 20 }{ \"_id\" : ObjectId(\"59891827da882ffb1ce7b7e3\"), \"age\" : 22 } å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»ä»BæœåŠ¡ä¸ŠåŒæ­¥è¿‡æ¥ã€‚ å·²ç»å®ç°é¢„æœŸç›®æ ‡ã€‚ KEEPALIVEDç›‘æ§MONGODBæœåŠ¡çŠ¶æ€å¾…å®Œå–„ ç›®å‰å®ç°æ£€æµ‹åˆ°ä¸»æœåŠ¡Açš„mongoDBæŒ‚æ‰åè‡ªåŠ¨æŠŠAæœºå™¨ä¸Šçš„keepalivedæœåŠ¡ä¹Ÿåœæ‰ã€‚ ä¿®æ”¹keepalivedé…ç½®æ–‡ä»¶ï¼švim /etc/keepalived/keepalived.conf 1234567891011121314151617181920212223242526272829303132333435363738394041vrrp_script chk_mongodb { script \"/etc/keepalived/mongodb_check.sh\" interval 2 weight 2 } vrrp_instance VI_1 { #state MASTER #ä¸»æœåŠ¡å™¨ state BACKUP #ä¸»æœåŠ¡å™¨ interface ens33 virtual_router_id 51 mcast_src_ip 192.168.1.34 priority 250 nopreempt #ä¸æŠ¢å MASTER advert_int 1 authentication { auth_type PASS auth_pass 123456 } track_script { chk_redis chk_mongodb } virtual_ipaddress { 192.168.1.35 }}virtual_server 192.168.1.35 27017 { delay_loop 6 lb_algo rr persistence_timeout 5 protocol TCP real_server 192.168.1.34 27017 { notify_down /etc/keepalived/killkeep.sh TCP_CHECK { connect_timeout 3 nb_get_retry 3 delay_before_retry 3 connect_port 27017 } } } åˆ›å»ºkillkeep.shè„šæœ¬ 12#!/bin/bashservice keepalived stop æµ‹è¯• æŠŠAæœºå™¨ä¸Šçš„mongoDBæœåŠ¡åœæ‰å ps -ef |grep keepalived å‘ç°keepalivedæœåŠ¡ä¹Ÿåœæ‰äº†ã€‚","link":"/2017/08/08/%E9%AB%98%E5%8F%AF%E7%94%A8/Keepalived%E5%AE%9E%E7%8E%B0mongoDB%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"title":"XPack Watcher","text":"æ¦‚è¿°å¯ä»¥å¯¹ElasticSearché€šè¿‡æ·»åŠ Watcherå®ç°å½“æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚å½“logsç´¢å¼•ä¸­å‡ºç°ERRORæ—¥å¿—æ—¶ï¼Œè‡ªåŠ¨å‘é€æŠ¥è­¦é‚®ä»¶æˆ–é’‰é’‰æ¶ˆæ¯ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºWatcheræ˜¯ä¸€ä¸ªåŸºäºElasticSearchå®ç°çš„ç›‘æ§æŠ¥è­¦æœåŠ¡ã€‚ åŠŸèƒ½ä»‹ç»XPack WatcheråŠŸèƒ½ä¸»è¦ç”±Triggerã€Inputã€Conditionã€Actionsç»„æˆã€‚ Triggerç¡®å®šä½•æ—¶æ£€æŸ¥ï¼Œåœ¨é…ç½®Watcheræ—¶å¿…é¡»è®¾ç½®ã€‚æ”¯æŒä¸°å¯Œçš„æ—¶é—´è®¡åˆ’æ–¹å¼ï¼Œè¯¦æƒ…è¯·å‚è§Schedule Triggerã€‚ Inputå¯ä»¥ç†è§£ä¸ºæ‚¨éœ€è¦å¯¹ç›‘æ§çš„ç´¢å¼•æ‰§è¡Œçš„ç­›é€‰æ¡ä»¶ï¼Œè¯¦æƒ…è¯·å‚è§Inputsã€‚ Conditionæ‰§è¡ŒActionsçš„æ¡ä»¶ã€‚ Actionså½“æ¡ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œçš„å…·ä½“æ“ä½œã€‚ å…·ä½“ä½¿ç”¨å‚è€ƒï¼šhttps://www.elastic.co/guide/en/x-pack/current/xpack-alerting.html https://www.elastic.co/guide/en/elasticsearch/reference/current/watcher-api.html æœ¬æ–‡ä¸»è¦æ˜¯ .watcher-history* ç´¢å¼• çš„æ¸…ç† åœ¨Elasticsearch5.0é»˜è®¤watcheræ˜¯å¯ç”¨çš„ï¼Œå®ƒæ¯å¤©äº§ç”Ÿä¸€ä¸ª.watcher-history* çš„ç´¢å¼•ï¼Œæ—¶é—´é•¿äº†ï¼Œå ç”¨è¾ƒå¤šçš„ç£ç›˜ç©ºé—´ã€‚ å¯ä»¥è®¾ç½®å¯ç”¨è‡ªåŠ¨æ¸…ç†ã€‚ 1234567PUT _cluster/settings{ \"persistent\": { \"xpack.monitoring.history.duration\": \"1d\", \"xpack.watcher.history.cleaner_service.enabled\": true }} æŸ¥çœ‹è®¾ç½®æƒ…å†µï¼š 1234567891011121314151617181920&gt; GET _cluster/settings{ \"persistent\": { \"xpack\": { \"monitoring\": { \"history\": { \"duration\": \"1d\" } }, \"watcher\": { \"history\": { \"cleaner_service\": { \"enabled\": \"true\" } } } } }, \"transient\": {}} é€šè¿‡ç›‘æ§å‘ç°ï¼Œå…·ä½“æ‰§è¡Œæ¸…ç†çš„æ—¶é—´ä¸ºä¸Šåˆ8ï¼š00 å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/notification-settings.html https://help.aliyun.com/document_detail/74927.html","link":"/2018/09/12/elasticsearch/elastic%E9%97%AE%E9%A2%98/XPack%20Watcher/"},{"title":"elasticsearchç›‘æ§æ—¥å¿—","text":"é»˜è®¤æƒ…å†µä¸‹ x-pack ç›‘æ§å®¢æˆ·ç«¯ï¼Œä¼šæ¯éš”10sé‡‡é›†é›†ç¾¤çš„ç›‘æ§ä¿¡æ¯åˆ°æ‚¨è´­ä¹°å®ä¾‹çš„ä»¥.monitoring-*ä¸ºå‰ç¼€çš„ç´¢å¼•ä¸­ã€‚ ç›®å‰ä¸»è¦æœ‰.monitoring-es-6-*ã€.monitoring-kibana-6-*è¿™ä¸¤ç§ç´¢å¼•ï¼Œä»¥å¤©ä¸ºå•ä½æ»šåŠ¨åˆ›å»ºã€‚é‡‡é›†å®Œçš„ä¿¡æ¯ä¼šä¿å­˜åœ¨ä»¥.monitoring-es-6-ä¸ºå‰ç¼€ï¼ŒåŠ å½“å‰æ—¥æœŸä¸ºåç¼€çš„ç´¢å¼•ä¸­ã€‚ å…¶ä¸­.monitoring-es-6-*ç´¢å¼•ç›¸å¯¹å ç”¨ç£ç›˜ç©ºé—´è¾ƒå¤§ï¼Œä¸»è¦å­˜æ”¾äº†é›†ç¾¤çŠ¶æ€ã€é›†ç¾¤ç»Ÿè®¡ã€èŠ‚ç‚¹ç»Ÿè®¡ã€ç´¢å¼•ç»Ÿè®¡ç­‰ä¿¡æ¯ã€‚ æ—¥å¿—ä¿ç•™è®¾ç½®é»˜è®¤ä¿ç•™æœ€è¿‘7å¤©çš„ç›‘æ§ç´¢å¼•ï¼Œæ­¤ç±».monitoring-es-6-*ç´¢å¼•ä¼šå ç”¨ä¸€å®šçš„å­˜å‚¨ç©ºé—´ï¼Œç´¢å¼•çš„å¤§å°è·Ÿé›†ç¾¤ä¸­ç´¢å¼•ä¸ªæ•°ï¼ˆåŒ…å«ç³»ç»Ÿç´¢å¼•ï¼‰èŠ‚ç‚¹ä¸ªæ•°æœ‰å…³ç³»ã€‚ä¸ºäº†é¿å…æœåŠ¡å™¨å¤§éƒ¨åˆ†ç£ç›˜ç©ºé—´è¢«ç›‘æ§ç´¢å¼•æ‰€å ç”¨ï¼Œå¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆä¼˜åŒ–ã€‚ 1ã€å¯é€šè¿‡ä»¥ä¸‹ API è®¾ç½®ç›‘æ§ç´¢å¼•ä¿ç•™å¤©æ•°ã€‚ 1234567PUT _cluster/settings{ \"persistent\": { \"xpack.monitoring.history.duration\": \"1d\" }}# éœ€è¦ä¿ç•™çš„å¤©æ•°æŒ‰ç…§æ‚¨çš„éœ€æ±‚è€Œå®šï¼Œæœ€å°‘ä¿ç•™ä¸€å¤©ã€‚ 2ã€è®¾ç½®éœ€è¦é‡‡é›†ç›‘æ§çš„ç´¢å¼•ã€‚ å¯ä»¥é€šè¿‡ API è®¾ç½®ï¼Œå“ªäº›ç´¢å¼•éœ€è¦ç›‘æ§åŠå“ªäº›ç´¢å¼•ä¸éœ€è¦ç›‘æ§ã€‚ä»¥å‡å°‘.monitoring-es-6-*ç´¢å¼•å ç”¨ç£ç›˜ç©ºé—´ï¼Œæœ¬æ–‡ä»¥ç¦æ‰é‡‡é›†ç³»ç»Ÿç´¢å¼•ä¸ºä¾‹ã€‚ 1234567PUT _cluster/settings{ \"persistent\": { \"xpack.monitoring.collection.indices\": \"+*,-.*\" }}# ç¦æ‰çš„ç´¢å¼•ç›‘æ§ä¿¡æ¯å°†ä¸ä¼šåœ¨Kibanaé¡µé¢ä¸­Montioringæ¨¡å—ä¸­çœ‹åˆ°ï¼Œæ¯”å¦‚åœ¨ç´¢å¼•åˆ—è¡¨åŠç´¢å¼•ç›‘æ§ä¿¡æ¯é¡µé¢ï¼Œéƒ½çœ‹ä¸åˆ°ç¦æ‰çš„ç´¢å¼•ä¿¡æ¯ã€‚å°±ä¼šå‡ºç°_cat/indicesè·å–çš„ç´¢å¼•åˆ—è¡¨ï¼Œè·Ÿåœ¨Kibanaé¡µé¢ä¸­Montioringæ¨¡å—ä¸­çœ‹åˆ°çš„ç´¢å¼•åˆ—è¡¨ä¸åŒçš„æƒ…å†µã€‚ å…·ä½“è®¾ç½®å¯å‚è€ƒï¼šmonitoring-collection-settings é€šè¿‡ç›‘æ§å‘ç°ï¼Œå…·ä½“æ‰§è¡Œæ¸…ç†çš„æ—¶é—´ä¸ºä¸Šåˆ8ï¼š00 å‚è€ƒï¼šhttps://help.aliyun.com/document_detail/68017.html https://www.elastic.co/guide/en/cloud/saas-release/ec-add-user-settings.html https://www.elastic.co/guide/en/elasticsearch/reference/6.4/cluster-get-settings.html#cluster-get-settings .watcher-history* çš„æ¸…ç† 123456PUT _cluster/settings{ \"persistent\": { \"xpack.watcher.history.cleaner_service.enabled\": true }} å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/notification-settings.html https://help.aliyun.com/document_detail/74927.html","link":"/2018/09/04/elasticsearch/elastic%E9%97%AE%E9%A2%98/elasticsearch%E7%9B%91%E6%8E%A7%E6%97%A5%E5%BF%97/"},{"title":"æ„å»ºæˆåŠŸåå‘é€QQæ¶ˆæ¯","text":"å®‰è£…æ’ä»¶Post-Build Script Plug-inè¯¥æ’ä»¶ä½œç”¨æ˜¯ï¼Œæ”¯æŒæ„å»ºæˆåŠŸåï¼Œæ‰§è¡Œshellè„šæœ¬ï¼ˆç”¨äºè§¦å‘QQæ¶ˆæ¯é€šçŸ¥ï¼‰ã€‚ç›®å‰å®˜æ–¹å·²ç»åœæ­¢è¯¥æ’ä»¶çš„ä¸‹è½½ã€‚å¯é€šè¿‡Post-Build Scriptä¸‹è½½ã€‚å®‰è£…æ–¹æ³•ï¼š ç³»ç»Ÿç®¡ç†&gt;ç®¡ç†æ’ä»¶&gt;é«˜çº§&gt;ä¸Šä¼ æ’ä»¶ å®‰è£…å®Œä¾¿ä¼šæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š è¿™é‡Œä½¿ç”¨Mojo-Webqqå®ŒæˆQQæ¶ˆæ¯å‘é€ä½¿ç”¨æ–¹æ³•ï¼šMojo-Webqqæ„å»ºæˆåŠŸåæ‰§è¡Œshellè„šæœ¬ï¼Œä½¿ç”¨curlæ¨¡æ‹Ÿå‘é€postè¯·æ±‚ 12message=&quot;æ„å»ºæˆåŠŸ&quot;curl -d &quot;id=4112877221&amp;content=$message&quot; &quot;http://192.168.1.101:5000/openqq/send_group_message&quot; | iconv -f utf-8 -t utf-8 ä½¿ç”¨Mojo-Webqqé€šè¿‡QQå·æˆ–ç¾¤ç»„å·å‘é€æ—¶ï¼Œå› ä¸ºè…¾è®¯å±è”½å¯èƒ½å‘é€ä¸æˆåŠŸã€‚å¯é€šè¿‡ /openqq/get_friend_info è·å–å¥½å‹æ•°æ® /openqq/get_group_info è·å–ç¾¤ç»„æ•°æ® /openqq/get_discuss_info è·å–è®¨è®ºç»„æ•°æ® /openqq/stop_client ç»ˆæ­¢ç¨‹åºè¿è¡Œè·å–ç›¸åº”çš„idåé€šè¿‡idè¿›è¡Œå‘é€ ç¤ºä¾‹ï¼šhttp://192.168.1.101:5000/openqq/send_friend_message?id=1069850124&amp;content=æ¶ˆæ¯http://127.0.0.1:5000/openqq/send_group_message?id=4112877221&amp;content=æ¶ˆæ¯ å‚è€ƒï¼šhttps://blog.csdn.net/YLSHELLO/article/details/76026737https://github.com/sjdy521/Mojo-StrawberryPerlhttps://github.com/sjdy521/Mojo-Webqq","link":"/2018/04/24/Jenkins/%E6%8F%92%E4%BB%B6/%E6%9E%84%E5%BB%BA%E6%88%90%E5%8A%9F%E5%90%8E%E5%8F%91%E9%80%81QQ%E6%B6%88%E6%81%AF/"},{"title":"elasticsearchç´¢å¼•åˆ†ç‰‡indexåªè¯»read-onlyå¤„ç†","text":"Eleastisearch åœ¨æ›´æ–°ç´¢å¼•æ•°æ®çš„æ—¶å€™æŠ¥äº†ä¸€ä¸ªé”™è¯¯ ClusterBlockException[blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];] è¿™æ˜¯ç”±äºæœåŠ¡å™¨ç£ç›˜ç©ºé—´å‰©ä½™é‡è¶…è¿‡äº†è­¦æˆ’é˜ˆå€¼ã€‚æ­¤æ—¶ESé›†ç¾¤ä¸ºäº†ä¿æŠ¤æ•°æ®ï¼Œä¼šè‡ªåŠ¨æŠŠç´¢å¼•åˆ†ç‰‡indexç½®ä¸ºåªè¯»read-onlyã€‚ è§£å†³æ­¥éª¤ï¼š 1ã€æä¾›è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ã€‚ï¼ˆæ¸…ç†ç£ç›˜ã€ç£ç›˜æ‰©å®¹ã€æ¸…ç†elasticsearchç›‘æ§æ—¥å¿— å¯å‚è€ƒï¼‰ 2ã€æ”¾å¼€ç´¢å¼•åªè¯»è®¾ç½®ã€‚ 1234PUT /_all/_settings{ \"index.blocks.read_only_allow_delete\": null} å¯å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/disk-allocator.html","link":"/2018/09/05/elasticsearch/elastic%E9%97%AE%E9%A2%98/elasticsearch%E7%B4%A2%E5%BC%95%E5%88%86%E7%89%87index%E5%8F%AA%E8%AF%BBread-only%E5%A4%84%E7%90%86/"},{"title":"StingJoinerå¯å˜å­—ç¬¦ä¸²æ‹¼æ¥","text":"StringJoineræ˜¯Java 8ä¸­æä¾›çš„å¯å˜å­—ç¬¦ä¸²ç±»ï¼Œå¯ä»¥ç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥ã€‚æ˜¯java.utilåŒ…ä¸­çš„ä¸€ä¸ªç±»ã€‚ 123456789101112public static void testStringJoiner() { StringJoiner sj = new StringJoiner(\":\", \"[\", \"]\"); sj.add(\"George\").add(\"Sally\").add(\"Fred\"); String desiredString = sj.toString(); System.out.println(desiredString); //[George:Sally:Fred] List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4); String commaSeparatedNumbers = numbers.stream() .map(i -&gt; i.toString()) .collect(Collectors.joining(\", \")); System.out.println(commaSeparatedNumbers); //1, 2, 3, 4 } StringJoineræ˜¯é€šè¿‡StringBuilderå®ç°çš„ï¼Œæ‰€ä»¥å®ƒçš„æ€§èƒ½å’ŒStringBuilderå·®ä¸å¤šï¼Œå®ƒä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ å¦‚æœæ—¥å¸¸å¼€å‘ä¸­ä¸­ï¼Œéœ€è¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ 1ã€å¦‚æœåªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€ƒè™‘ç›´æ¥ä½¿ç”¨â€+â€å³å¯ã€‚ 2ã€å¦‚æœæ˜¯åœ¨forå¾ªç¯ä¸­è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€ƒè™‘ä½¿ç”¨StringBuilderå’ŒStringBufferã€‚ 3ã€å¦‚æœæ˜¯é€šè¿‡ä¸€ä¸ªé›†åˆï¼ˆå¦‚Listï¼‰è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨StringJoinerã€‚ 4ã€å¦‚æœæ˜¯å¯¹ä¸€ç»„æ•°æ®è¿›è¡Œæ‹¼æ¥ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶è½¬æ¢æˆStreamï¼Œå¹¶ä½¿ç”¨StringJoinerå¤„ç†ã€‚","link":"/2019/11/15/java/Java8InAction/StringJoiner/"},{"title":"Java8InAction","text":"Lambdaè¡¨è¾¾å¼æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šå‚æ•°åˆ—è¡¨ï¼Œç®­å¤´ã€Lambdaä¸»ä½“ã€‚ å‡½æ•°å¼æ¥å£ï¼šåªå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ã€‚ Predicateã€Consumerã€Function&lt;T, R&gt; é¿å…å¯¹åŸå§‹ç±»å‹è¿›è¡Œè£…ç®±æ“ä½œ IntPredicateã€DoublePredicateã€IntConsumerã€LongBinaryOperatorã€IntFunctionã€‚ å‡½æ•°å¼æ¥å£ å‡½æ•°æè¿°ç¬¦ åŸå§‹ç±»å‹è½¬åŒ– Predicate T-&gt;boolean IntPredicateã€LongPredicateã€DoublePredicate Consumer T-&gt;void IntConsumerã€LongConsumerã€DoubleConsumer Function&lt;T,R&gt; T-&gt;R IntFunctionã€IntToDoubleFunctionã€LongToIntFunctionâ€¦ Supplier ()-&gt;T BooleanSupplierã€IntSupplierã€LongSupplierã€DoubleSupplier UnaryOperator T-&gt;T IntUnaryOperatorã€LongUnaryOperatorã€DoubleUnaryOperator BinaryOperator (T,T)-&gt;T IntBinaryOperatorã€LongBinaryOperatorã€DoubleBinaryOperator æ–¹æ³•å¼•ç”¨ ç›®æ ‡å¼•ç”¨æ”¾åœ¨åˆ†éš”ç¬¦::å‰ï¼Œæ–¹æ³•çš„åç§°æ”¾åœ¨åé¢ï¼Œæ–¹æ³•å¼•ç”¨å°±æ˜¯Lambdaè¡¨è¾¾å¼çš„å¿«æ·å†™æ³•ã€‚ 123inventory.sort((Apple a1, Apple a2) &gt; a1.getWeight().compareTo(a2.getWeight()));//æœ€åˆinventory.sort(Comparator.comparing((Apple a) -&gt; a.getWeight()));//ä½¿ç”¨lambdaè¡¨è¾¾å¼inventory.sort(Comparator.comparing(Apple::getWeight)); //ä½¿ç”¨äº†æ–¹æ³•å¼•ç”¨ //ç¤ºä¾‹ 12345List&lt;SpAggreCnt&gt; recordPlanStats = mongoDao.aggregate(planAggre, SpAggreCnt.class);recordPlanStats = new ArrayList&lt;&gt;(recordPlanStats);//ç”±äºjava.lang.UnsupportedOperationExceptionï¼Œæ‰€ä»¥æŠŠlisté‡æ–°æ„é€ äº†ä¸€é recordPlanStats.sort(Comparator.comparing(SpAggreCnt::getId, (s1, s2) -&gt; { return String.valueOf(s1).compareTo(String.valueOf(s2)); }));//SpAggreCntçš„Idä¸ºObjectç±»å‹ å¤åˆlambdaè¡¨è¾¾å¼ 1ã€æ¯”è¾ƒå™¨ç¬¦åˆ(Comparator) 12inventory.sort(comparing(Apple::getWeight).reversed()); //é€†åºinventory.sort(comparing(Apple::getWeight).reversed().thenComparing(Apple::getCountry)); //æ¯”è¾ƒå™¨é“¾ï¼ˆæŒ‰é‡é‡é€’å‡æ’åºï¼Œè‹¥é‡é‡ç›¸åŒæ—¶ï¼Œå†æŒ‰åŸäº§åœ°æ’åºï¼‰ 2ã€è°“è¯å¤åˆï¼ˆPredicateï¼‰ è°“è¯æ¥å£åŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•ï¼šnegateã€andå’Œor 123Predicate&lt;Apple&gt; notRedApple = redApple.negate(); //negate: äº§ç”Ÿç°æœ‰Predicate å¯¹è±¡redAppleçš„éPredicate&lt;Apple&gt; redAndHeavyApple = redApple.and(a -&gt; a.getWeight() &gt; 150); //and:æ—¢æ˜¯çº¢è‰²åˆæ¯”è¾ƒé‡çš„Predicate&lt;Apple&gt; redAndHeavyAppleOrGreen = redApple.and(a -&gt; a.getWeight() &gt; 150).or(a -&gt; \"green\".equals(a.getColor())); //or: è¦ä¹ˆæ˜¯é‡ï¼ˆ150å…‹ä»¥ä¸Šï¼‰çš„çº¢è‹¹æœï¼Œè¦ä¹ˆæ˜¯ç»¿è‹¹æœï¼š 3ã€å‡½æ•°å¤åˆ ï¼ˆFunctionï¼‰ andThenå’Œcomposeä¸¤ä¸ªé»˜è®¤æ–¹æ³•ï¼Œæ³¨æ„ä¸¤è€…çš„åŒºåˆ«ã€‚ 12345Function&lt;Integer, Integer&gt; f = x -&gt; x + 1; Function&lt;Integer, Integer&gt; g = x -&gt; x * 2; Function&lt;Integer, Integer&gt; h = f.andThen(g); //å…ˆç»™æ•°å­—åŠ 1ï¼Œå†ç»™ç»“æœä¹˜2Function&lt;Integer, Integer&gt; h = f.compose(g); //å…ˆç»™æ•°å­—ä¹˜2ï¼Œå†ç»™ç»“æœåŠ 1int result = h.apply(1);","link":"/2019/10/15/java/Java8InAction/lambda/"},{"title":"Java8InAction","text":"Stream ä¸­é—´æµæ“ä½œï¼šfilter ã€limit ã€skipã€sorted ã€distinct ã€map ã€flatmap ç»ˆç«¯æµæ“ä½œï¼šforEach ã€count ã€collectã€anyMatchã€allMatchã€noneMatch ç­›é€‰ã€åˆ‡ç‰‡ filterã€distinctã€limitã€skip æ˜ å°„ mapã€flatMap(æŠŠæ‰€æœ‰çš„æµè¿æ¥ èµ·æ¥æˆä¸ºä¸€ä¸ªæµ) æŸ¥æ‰¾å’ŒåŒ¹é… anyMatch(æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ èƒ½åŒ¹é…ç»™å®šçš„è°“è¯)ã€allMatch(æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ )ã€noneMatch ã€findAny(è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ )ã€findFirst(æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ) å½’çº¦ reduce æ„å»ºæµ æ”¶é›†å™¨-collect Collectors.counting 12long howManyDishes = menu.stream().collect(Collectors.counting()); long howManyDishes = menu.stream().count(); Collectors.maxByã€Collectors.minByï¼šè®¡ç®—æµä¸­çš„å¤§æˆ–å°å€¼ 1Optional&lt;Dish&gt; mostCalorieDish = menu.stream().collect(maxBy( Comparator.comparingInt(Dish::getCalories))); Collectors.summingInt: æ±‚å’Œ 1int totalCalories = menu.stream().collect(summingInt(Dish::getCalories)); Collectors.averagingInt: æ±‚å¹³å‡æ•° 1double avgCalories = menu.stream().collect(averagingInt(Dish::getCalories)); Collectors.summarizing: è¿”å›æ€»å’Œã€å¹³å‡å€¼ã€æœ€å¤§å€¼å’Œæœ€å°å€¼ 12IntSummaryStatistics menuStatistics = menu.stream().collect(summarizingInt(Dish::getCalories)); IntSummaryStatistics{count=9, sum=4300, min=120, average=477.777778, max=800} Collectors.joiningï¼šè¿æ¥å­—ç¬¦ä¸² 1String shortMenu = menu.stream().map(Dish::getName).collect(joining(\", \")); Collectors.reducing: å¹¿ä¹‰çš„å½’çº¦æ±‡æ€» (æ‰€æœ‰æ”¶é›†å™¨ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨reducingå·¥å‚æ–¹æ³•å®šä¹‰çš„å½’çº¦è¿‡ç¨‹ çš„ç‰¹æ®Šæƒ…å†µè€Œå·²) 1int totalCalories = menu.stream().collect(reducing(0, Dish::getCalories, (i, j) -&gt; i + j)); Collectors.groupingByï¼šåˆ†ç»„ 12Map&lt;Dish.Type, List&lt;Dish&gt;&gt; dishesByType = menu.stream().collect(groupingBy(Dish::getType)); Map&lt;Dish.Type, Long&gt; typesCount = menu.stream().collect(groupingBy(Dish::getType, counting())); Collectors.collectingAndThen: æŠŠæ”¶é›†å™¨è¿”å›çš„ç»“æœè½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ 1Map&lt;Dish.Type, Dish&gt; mostCaloricByType = menu.stream().collect(Collectors.groupingBy(Dish::getType, Collectors.collectingAndThen(Collectors.maxBy(Comparator.comparing(Dish::getCalories)), Optional::get))); Collectors.mapping 123456789Map&lt;Dish.Type, Set&lt;CaloricLevel&gt;&gt; caloricLevelsByType = menu.stream().collect(Collectors.groupingBy(Dish::getType, Collectors.mapping(dish -&gt; { if(dish.getCalories()&lt;=400) { return CaloricLevel.DIET; }else if(dish.getCalories()&lt;=700) { return CaloricLevel.NORMAL; }else { return CaloricLevel.FAT; } }, Collectors.toSet()))); åˆ†åŒº partitioningBy 123Map&lt;Boolean, Map&lt;Dish.Type, List&lt;Dish&gt;&gt;&gt; vegetarianDishesByType = menu.stream().collect( Collectors.partitioningBy(Dish::isVegetarian, Collectors.groupingBy(Dish::getType)));","link":"/2019/12/01/java/Java8InAction/stream/"},{"title":"Spring-bootè‡ªå®šä¹‰é”™è¯¯é¡µé¢","text":"spring bootä¸­é…ç½®é”™è¯¯é¡µé¢ é¦–å…ˆåœ¨ src/main/resourcesä¸‹æ–°å»ºresourcesæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å†å»ºä¸€ä¸ª error çš„æ–‡ä»¶å¤¹ã€‚åœ¨error æ–‡ä»¶å¤¹é‡Œ æ–°å»ºä¸€ä¸ª404.htmlé¡µé¢ï¼Œè¿™æ˜¯ springboot é»˜è®¤çš„ é”™è¯¯å¤„ç†é¡µé¢ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å»ºç«‹500 é¡µé¢ã€‚ 404.htmlé¡µé¢è‡ªå®šä¹‰å†…å®¹ï¼š 1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;404&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;404&lt;/h1&gt; &lt;p&gt;å¯¹ä¸èµ·ï¼Œæ‚¨è¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨&lt;/p&gt; &lt;/body&gt;&lt;/html&gt; ä¹‹åè®¿é—®é¡¹ç›®404é¡µé¢ä¾¿ä¼šæ˜¾ç¤ºæ­¤é¡µé¢ã€‚","link":"/2018/12/06/java/Spring-Boot/Spring-boot%E5%AE%9A%E4%B9%89404%E9%A1%B5%E9%9D%A2/"},{"title":"Spring-bootå¯¹åº”serveletä¸­web.xmlé…ç½®","text":"åˆšå¼€å§‹ä½¿ç”¨åŸç”Ÿservletï¼ˆä¸ä½¿ç”¨webæ¡†æ¶ï¼‰ï¼Œweb.xmlå°±æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªé…ç½®ï¼Œæ— è®ºæ˜¯servletã€filterã€listeneréƒ½éœ€è¦åœ¨web.xmlé‡Œé¢é…ç½®ä¸‹ã€‚ ä½†æ˜¯åœ¨servlet3.0é‡Œï¼Œè¿™ä¸ªé…ç½®å¾—åˆ°äº†ç®€åŒ–ã€‚å¯ä»¥é€šè¿‡javaé…ç½®ï¼ˆæ³¨è§£ç­‰ï¼‰çœå»web.xmlé…ç½®ã€‚ ä¸€ã€servlet 123456789&lt;servlet&gt; &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;com.jit.servlet.UIASLoginServlet&lt;/servlet-class&gt; &lt;!--&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;--&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/uias_login.do&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; springbootä¸­é…ç½® 1234567@Beanpublic ServletRegistrationBean&lt;UIASLoginServlet&gt; uiasLoginServletRegistration() {ServletRegistrationBean&lt;UIASLoginServlet&gt; registration = new ServletRegistrationBean&lt;UIASLoginServlet&gt;(new UIASLoginServlet(), \"/uias_login.do\");//registration.setLoadOnStartup(1);registration.setOrder(Ordered.HIGHEST_PRECEDENCE); return registration;} è¯´æ˜ï¼š load-on-startupæ ‡è®°å®¹å™¨æ˜¯å¦åœ¨å¯åŠ¨çš„æ—¶å€™å®ä¾‹åŒ–å¹¶è°ƒç”¨å…¶init()æ–¹æ³•çš„ä¼˜å…ˆçº§ã€‚ å½“å€¼ä¸º0æˆ–è€…å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå®¹å™¨åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åŠ è½½å¹¶åˆå§‹åŒ–è¿™ä¸ªservletã€‚ äºŒã€context-param ä¾‹å¦‚, æœ‰å¦‚ä¸‹web.xmlé…ç½® 123456&lt;web-app xmlns=\"http://java.sun.com/xml/ns/javaee\" version=\"2.5\"&gt; &lt;context-param&gt; &lt;param-name&gt;backgroundColor&lt;/param-name&gt; &lt;param-value&gt;red&lt;/param-value&gt; &lt;/context-param&gt;&lt;/web-app&gt; springbootä¸­æœ‰ä¸‰ç§æ–¹æ³•è¿›è¡Œé…ç½® 1ã€application.properties 1server.context_parameters.backgroundColor=red 2ã€é€šè¿‡ServletContextInitializer bean SpringBootWebApplication.java 123456789101112131415161718192021222324252627import javax.servlet.ServletContext;import javax.servlet.ServletException;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.boot.web.servlet.ServletContextInitializer;import org.springframework.context.annotation.Bean;@SpringBootApplicationpublic class SpringBootWebApplication { public static void main(String[] args) { SpringApplication.run(SpringBootWebApplication.class, args); } @Bean public ServletContextInitializer initializer() { return new ServletContextInitializer() { @Override public void onStartup(ServletContext servletContext) throws ServletException { servletContext.setInitParameter(\"backgroundColor\", \"red\"); } }; }} 3ã€é€šè¿‡InitParameterConfiguringServletContextInitializer bean 1234567891011121314151617181920212223import java.util.HashMap;import java.util.Map;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.boot.context.embedded.InitParameterConfiguringServletContextInitializer;import org.springframework.context.annotation.Bean;@SpringBootApplicationpublic class SpringBootWebApplication { public static void main(String[] args) { SpringApplication.run(SpringBootWebApplication.class, args); } @Bean public InitParameterConfiguringServletContextInitializer initParamsInitializer() { Map&lt;String, String&gt; contextParams = new HashMap&lt;&gt;(); contextParams.put(\"backgroundColor\", \"red\"); return new InitParameterConfiguringServletContextInitializer(contextParams); }} å‚è€ƒï¼šhttps://www.cnblogs.com/wangxiaomei/p/8885470.html https://bytenota.com/java-set-a-context-param-in-spring-boot/","link":"/2018/09/11/java/Spring-Boot/Spring-boot%E5%AF%B9%E5%BA%94servelet%E4%B8%ADweb.xml%E9%85%8D%E7%BD%AE/"},{"title":"Spring-bootè®¿é—®æ—¥å¿—","text":"springbootè®¿é—®æ—¥å¿—åœ¨spring bootçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ server.tomcat.accesslogé…ç½®tomcatçš„accessæ—¥å¿— 12345678910server.tomcat.accesslog.buffered=true ï¼ƒæ˜¯å¦ç¼“å†²è¾“å‡ºä»¥ä½¿å…¶ä»…å®šæœŸåˆ·æ–°ã€‚server.tomcat.accesslog.directory=logsï¼ƒåˆ›å»ºæ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚å¯ä»¥æ˜¯ç»å¯¹çš„æˆ–ç›¸å¯¹äºTomcatåŸºç¡€ç›®å½•ã€‚server.tomcat.accesslog.enabled=false ï¼ƒå¯ç”¨è®¿é—®æ—¥å¿—ã€‚server.tomcat.accesslog.file-date-format=.yyyy-MM-dd ï¼ƒè¦æ”¾åœ¨æ—¥å¿—æ–‡ä»¶åä¸­çš„æ—¥æœŸæ ¼å¼ã€‚server.tomcat.accesslog.pattern=common ï¼ƒè®¿é—®æ—¥å¿—çš„æ ¼å¼æ¨¡å¼ã€‚server.tomcat.accesslog.prefix=access_log ï¼ƒæ—¥å¿—æ–‡ä»¶åå‰ç¼€ã€‚server.tomcat.accesslog.rename-on-rotate=false ï¼ƒæ˜¯å¦å»¶è¿Ÿåœ¨æ–‡ä»¶åä¸­åŒ…å«æ—¥æœŸæˆ³ï¼Œç›´åˆ°æ—‹è½¬æ—¶é—´ã€‚server.tomcat.accesslog.request-attributes-enabled=falseï¼ƒè®¾ç½®è¯·æ±‚çš„IPåœ°å€ï¼Œä¸»æœºåï¼Œåè®®å’Œç«¯å£çš„è¯·æ±‚å±æ€§ã€‚server.tomcat.accesslog.rotate=true ï¼ƒæ˜¯å¦å¯ç”¨è®¿é—®æ—¥å¿—è½®æ¢ã€‚server.tomcat.accesslog.suffix=.log ï¼ƒæ—¥å¿—æ–‡ä»¶ååç¼€ã€‚ å¸¸ç”¨çš„é…ç½®ï¼š 1234server.tomcat.accesslog.directory=logsï¼ƒåˆ›å»ºæ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚server.tomcat.accesslog.enabled=false ï¼ƒæ˜¯å¦å¯ç”¨è®¿é—®æ—¥å¿—ã€‚server.tomcat.accesslog.pattern=%t %a \"%r\" %s %S (%D ms) ï¼ƒè®¿é—®æ—¥å¿—çš„æ ¼å¼æ¨¡å¼ã€‚server.tomcat.accesslog.rotate=true ï¼ƒæ˜¯å¦å¯ç”¨è®¿é—®æ—¥å¿—è½®è½¬ã€‚é»˜è®¤ä¸ºtrueã€‚è¿™ä¸ªå‚æ•°å†³å®šæ˜¯å¦éœ€è¦åˆ‡å‰²æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœè®¾ç½®æˆfalseï¼Œåˆ™æ—¥å¿—æ–‡ä»¶ä¸ä¼šåˆ‡æ¢ï¼Œå³æ‰€æœ‰çš„æ–‡ä»¶æ‰“å°åˆ°åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚ æ—¥å¿—çš„æ ¼å¼æ¨¡å¼ ï¼…a - è¿œç¨‹IPåœ°å€ï¼Œæ³¨æ„ä¸ä¸€å®šæ˜¯åŸå§‹ipåœ°å€ï¼Œä¸­é—´å¯èƒ½ç»è¿‡nginxç­‰çš„è½¬å‘ ï¼…A - æœ¬åœ°IPåœ°å€ ï¼…b - å‘é€çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬HTTPæ ‡å¤´ï¼Œå¦‚æœä¸ºé›¶åˆ™ä¸ºâ€œ - â€ ï¼…B - å‘é€çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬HTTPæ ‡å¤´ ï¼…h - è¿œç¨‹ä¸»æœºåï¼ˆæˆ–enableLookupsè¿æ¥å™¨çš„IPåœ°å€ ä¸ºfalseï¼‰ ï¼…H - è¯·æ±‚åè®® ï¼…l - æ¥è‡ªidentdçš„è¿œç¨‹é€»è¾‘ç”¨æˆ·åï¼ˆå§‹ç»ˆè¿”å›â€™ - â€˜ï¼‰ ï¼…m - è¯·æ±‚æ–¹æ³•ï¼ˆGETï¼ŒPOSTç­‰ï¼‰ ï¼…p - æ”¶åˆ°æ­¤è¯·æ±‚çš„æœ¬åœ°ç«¯å£ã€‚å¦è§%{xxx}pä¸‹æ–‡ã€‚ ï¼…q - æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆå‰ç¼€ä¸ºâ€™ï¼Ÿâ€™ï¼Œå¦‚æœå­˜åœ¨ï¼‰ ï¼…r - è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼ˆæ–¹æ³•å’Œè¯·æ±‚URIï¼‰ ï¼…s - å“åº”çš„HTTPçŠ¶æ€ä»£ç  ï¼…S - ç”¨æˆ·ä¼šè¯ID ï¼…t - æ—¥æœŸå’Œæ—¶é—´ï¼Œé‡‡ç”¨é€šç”¨æ—¥å¿—æ ¼å¼ ï¼…u - ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹ç”¨æˆ·ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¦åˆ™ä¸ºâ€œ - â€ ï¼…U - è¯·æ±‚çš„URLè·¯å¾„ ï¼…v - æœ¬åœ°æœåŠ¡å™¨åç§° ï¼…D - ä»¥æ¯«ç§’ä¸ºå•ä½å¤„ç†è¯·æ±‚æ‰€ç”¨çš„æ—¶é—´ ï¼…T - å¤„ç†è¯·æ±‚æ‰€ç”¨çš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ ï¼…F - æäº¤å“åº”æ‰€ç”¨çš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ ï¼…I - å½“å‰è¯·æ±‚çº¿ç¨‹åç§°ï¼ˆç¨åå¯ä»¥ä¸stacktracesè¿›è¡Œæ¯”è¾ƒï¼‰ ï¼…X - å“åº”å®Œæˆæ—¶çš„è¿æ¥çŠ¶æ€ï¼š Access log ä¹Ÿæ”¯æŒå°†cookieã€headerã€sessionæˆ–è€…å…¶ä»–åœ¨ServletRequestä¸­çš„å¯¹è±¡ä¿¡æ¯æ‰“å°åˆ°æ—¥å¿—ä¸­ï¼Œå…¶é…ç½®éµå¾ªApacheé…ç½®çš„æ ¼å¼ï¼ˆ{xxx}æŒ‡å€¼çš„åç§°ï¼‰ï¼š %{xxx}i ç”¨åç§°ä¼ å…¥headersï¼Œrequest headeçš„å€¼ xxx %{xxx}o ç”¨åç§°ä¼ å‡ºresponse headersï¼Œresponse headerçš„å€¼ xxx %{xxx}c ç”¨åå­—å†™ä¸‹cookieçš„å€¼ xxx %{xxx}r ç”¨åç§°å†™ServletRequestå±æ€§çš„å€¼ xxx %{xxx}s ç”¨åç§°å†™å…¥HttpSessionå±æ€§çš„å€¼ xxx %{xxx}på†™æœ¬åœ°ï¼ˆæœåŠ¡å™¨ï¼‰ç«¯å£ï¼ˆxxx==localï¼‰æˆ–è¿œç¨‹ï¼ˆå®¢æˆ·ç«¯ï¼‰ç«¯å£ï¼ˆxxx=remoteï¼‰ %{xxx}t åœ¨ä½¿ç”¨å¢å¼ºçš„SimpleDateFormatæ¨¡å¼æ ¼å¼åŒ–çš„è¯·æ±‚ç»“æŸæ—¶å†™å…¥æ—¶é—´æˆ³ xxx å¯å‚è€ƒï¼šAccess_Logging å¸¸ç”¨çš„é…ç½®æœ‰ï¼š %t %a &quot;%r&quot; %s %S (%D ms)ï¼Œæ—¥æœŸå’Œæ—¶é—´ï¼Œè¯·æ±‚æ¥è‡ªçš„IPï¼ˆä¸ä¸€å®šæ˜¯åŸå§‹IPï¼‰ï¼Œè¯·æ±‚ç¬¬ä¸€è¡Œï¼Œresponse codeï¼Œç”¨æˆ·ä¼šè¯IDï¼Œå“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ ·ä¾‹ï¼š[30/Oct/2018:20:10:25 +0800] 185.53.91.51 â€œGET / HTTP/1.1â€ 200 - (7 ms)ï¼Œè¿™é‡Œè¯·æ±‚æ¥è‡ªIPå°±æ˜¯ç»è¿‡æœ¬æœºçš„nginxè½¬å‘çš„ã€‚ %t %{X-Forwarded-For}i %a &quot;%r&quot; %s %S (%D ms) ,æ—¥æœŸå’Œæ—¶é—´ï¼ŒåŸå§‹IPï¼Œè¯·æ±‚æ¥è‡ªçš„IPï¼ˆä¸ä¸€å®šæ˜¯åŸå§‹IPï¼‰ï¼Œè¯·æ±‚ç¬¬ä¸€è¡Œï¼Œresponse codeï¼Œç”¨æˆ·ä¼šè¯IDï¼Œå“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰,æ ·ä¾‹ï¼š[01/Nov/2018:11:47:38 +0800] 106.38.223.102 127.0.0.1 â€œGET /logout HTTP/1.0â€ 200 - (10 ms) nginxé…ç½®æ–‡ä»¶æ·»åŠ ï¼š 1234proxy_set_header REMOTE_ADDR $remote_addr;proxy_set_header Host $host;proxy_set_header X-Real-IP $remote_addr;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; å‚è€ƒï¼šhttps://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#howto-configure-accesslogs server.use-forward-headers å¾…æµ‹è¯•","link":"/2018/11/01/java/Spring-Boot/Spring-boot%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97/"},{"title":"Spring-bootéƒ¨ç½²","text":"spring-bootæ‰“åŒ…jaræ–‡ä»¶ ä½¿ç”¨nohupå‘½ä»¤ä½¿å…¶åå°è¿è¡Œ1$ nohup /usr/local/java/bin/java -jar /opt/bootapp/spring-boot-1.0-SNAPSHOT.jar &gt; log.file 2&gt;&amp;1 &amp; ä½œä¸ºç³»ç»Ÿinit.dæœåŠ¡å®‰è£…å‚è€ƒï¼šdeployment-initd-service ä½œä¸ºç³»ç»ŸsystemdæœåŠ¡å®‰è£…systemdæ˜¯System V initç³»ç»Ÿçš„åç»§è€…ï¼Œç°åœ¨è®¸å¤šç°ä»£Linuxå‘è¡Œç‰ˆéƒ½åœ¨ä½¿ç”¨å®ƒã€‚è™½ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨init.dè„šæœ¬ systemdï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨systemd â€œæœåŠ¡â€è„šæœ¬å¯åŠ¨Spring Bootåº”ç”¨ç¨‹åºã€‚ åˆ›å»ºSystemd serviceæ–‡ä»¶åœ¨/etc/systemd/systemç›®å½•ä¸­æ–°å»ºbootapp.service (bootappå¯ä»»æ„) æ–‡ä»¶ã€‚ 123456789101112[Unit]Description=myapp-cpnspAfter=syslog.target[Service]WorkingDirectory=/opt/bootappExecStart=/opt/java/jdk1.8.0_101/bin/java -jar /opt/bootapp/cpnsp-api-1.0.0-SNAPSHOT.jarExecStop=/bin/kill $MAINPIDSuccessExitStatus=143[Install]WantedBy=multi-user.target ExecStartå¯ä»¥å†™æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å†™è„šæœ¬æ‰€åœ¨è·¯å¾„ã€‚ å¯è¿›ä¸€æ­¥ä¸°å¯Œæ­¤é…ç½®ï¼Œå¯å¢åŠ  Groupã€Userã€Restart ç­‰é…ç½® jar åŒ…çš„æ‰§è¡Œç”¨æˆ·ç»„ã€‚ æ³¨æ„ï¼Œä¸ä½œä¸ºinit.dæœåŠ¡è¿è¡Œæ—¶ä¸åŒï¼Œè¿è¡Œåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ï¼ŒPIDæ–‡ä»¶å’Œæ§åˆ¶å°æ—¥å¿—æ–‡ä»¶ç”±å…¶systemdè‡ªèº«ç®¡ç†ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨â€œæœåŠ¡â€è„šæœ¬ä¸­çš„ç›¸åº”å­—æ®µè¿›è¡Œé…ç½®ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… æœåŠ¡å•å…ƒé…ç½®æ‰‹å†Œé¡µã€‚ æ•´åˆåˆ°systemctl æ·»åŠ åˆ°systemctl 12$ systemctl enable bootapp.serviceCreated symlink /etc/systemd/system/multi-user.target.wants/bootapp.service â†’ /etc/systemd/system/bootapp.service. å¯åŠ¨ 1$ systemctl start bootapp.service å…¶å®ƒå¯ç”¨å‘½ä»¤ï¼šstatusã€stop ç­‰ï¼Œå…·ä½“å¯å‚è§ Systemd æ–‡æ¡£ é‡æ–°åŠ è½½bootapp.serviceæ–‡ä»¶ (ä¿®æ”¹bootapp.serviceåæ‰§è¡Œ) 1$ systemctl daemon-reload æŸ¥çœ‹é¡¹ç›®æ—¥å¿—ï¼š 12$ journalctl -u bootapp$ journalctl -u bootapp service å‚è€ƒï¼šdeployment-service systemd.serviceã€spring-boot jaråŒ…çš„è¿è¡Œæ–¹å¼","link":"/2018/08/29/java/Spring-Boot/Spring-boot%E9%83%A8%E7%BD%B2/"},{"title":"å°†spring-bootå®‰è£…ä¸ºsystemdæœåŠ¡","text":"springbooté¡¹ç›®ä½¿ç”¨mavenæ‰“æˆçš„jaræ–‡ä»¶ï¼Œä½¿ç”¨systemdå®‰è£…ä¸ºæœåŠ¡è¿›è¡Œç®¡ç†ã€‚ 1ã€æ–°å»ºé¡¹ç›®çš„systemdç®¡ç†æ–‡ä»¶boot_cpnspcms.service vim /etc/systemd/system/boot_cpnspcms.service 123456789101112[Unit]Description=spring-boot-cpnspcmsAfter=syslog.target[Service]WorkingDirectory=/ssdb1/bootserver/boot8100/cpnspcmsExecStart=/usr/local/java/jdk1.8.0_231/bin/java -jar /ssdb1/bootserver/boot8100/cpnspcms/cpnsp-api-1.0.0-SNAPSHOT.jar --server.port=8100 --name=cpnspcms_boxExecStop=/bin/kill $MAINPIDSuccessExitStatus=143[Install]WantedBy=multi-user.target 2ã€ç®¡ç† 123$ systemctl daemon-reload$ systemctl enable boot_cpnspcms.service$ systemctl start boot_cpnspcms.service 3ã€æŸ¥çœ‹çŠ¶æ€ 1$ systemctl status boot_cpnspcms.service 4ã€æŸ¥çœ‹æœåŠ¡æ—¥å¿— 1$ vim /var/log/syslog å‚è€ƒï¼šå°†spring bootå®‰è£…ä¸ºsystemdæœåŠ¡ åŠä¹‹å‰çš„ä¸€ç¯‡è®°å½•ï¼šhttps://myqzf.github.io/2018/08/29/java/Spring-Boot/Spring-boot%E9%83%A8%E7%BD%B2/","link":"/2019/11/27/java/Spring-Boot/%E5%B0%86springboot%E5%AE%89%E8%A3%85%E4%B8%BAsystemd%20%E6%9C%8D%E5%8A%A1/"},{"title":"HttpCilent(ä¸€)","text":"HttpCilent è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰æ˜¯å½“ä»ŠInternetä¸Šä½¿ç”¨çš„æœ€é‡è¦çš„åè®®ä¹‹ä¸€ã€‚å°½ç®¡java.netåŒ…æä¾›äº†é€šè¿‡HTTPè®¿é—®èµ„æºçš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†å®ƒå¹¶æœªæä¾›è®¸å¤šåº”ç”¨ç¨‹åºæ‰€éœ€çš„å®Œå…¨çµæ´»æ€§æˆ–åŠŸèƒ½ã€‚HttpClientæä¾›äº†ä¸€ä¸ªé«˜æ•ˆï¼Œä¸”åŠŸèƒ½ä¸°å¯Œçš„åŒ…ã€‚ è¯·æ±‚æ‰§è¡Œhttpè¯·æ±‚HttpClientçš„æ”¯æŒäº†åœ¨HTTP/1.1è§„èŒƒä¸­å®šä¹‰çš„æ‰€æœ‰HTTPæ–¹æ³•ï¼šGETï¼ŒHEADï¼Œ POSTï¼ŒPUTï¼ŒDELETEï¼Œ TRACEå’ŒOPTIONSã€‚æ¯ä¸ªæ–¹æ³•ç±»å‹å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„ç±»HttpGetï¼Œ HttpHeadï¼ŒHttpPostï¼Œ HttpPutï¼ŒHttpDeleteï¼Œ HttpTraceï¼Œå’ŒHttpOptionsã€‚ 12HttpGet httpget = new HttpGet( \"http://www.google.com/search?hl=en&amp;q=httpclient&amp;btnG=Google+Search&amp;aq=f&amp;oq=\"); HttpClientæä¾›äº†URIBuilderå®ç”¨ç¨‹åºç±»æ¥ç®€åŒ–è¯·æ±‚URIçš„åˆ›å»ºå’Œä¿®æ”¹ã€‚ 1234567891011URI uri = new URIBuilder() .setScheme(\"http\") .setHost(\"www.google.com\") .setPath(\"/search\") .setParameter(\"q\", \"httpclient\") .setParameter(\"btnG\", \"Google Search\") .setParameter(\"aq\", \"f\") .setParameter(\"oq\", \"\") .build();HttpGet httpget = new HttpGet(uri);System.out.println(httpget.getURI()); stdout &gt; 1http://www.google.com/search?q=httpclient&amp;btnG=Google+Search&amp;aq=f&amp;oq= HTTPå“åº”HTTPå“åº”æ˜¯æœåŠ¡å™¨åœ¨æ¥æ”¶å¹¶è§£é‡Šè¯·æ±‚æ¶ˆæ¯åå‘é€å›å®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬åè®®ç‰ˆæœ¬ï¼Œåè·Ÿæ•°å­—çŠ¶æ€ä»£ç åŠå…¶ç›¸å…³çš„æ–‡æœ¬çŸ­è¯­ã€‚ 1234567HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_OK, \"OK\");System.out.println(response.getProtocolVersion());System.out.println(response.getStatusLine().getStatusCode());System.out.println(response.getStatusLine().getReasonPhrase());System.out.println(response.getStatusLine().toString()); stdout &gt; 1234HTTP/1.1200OKHTTP/1.1 200 OK HTTP message headersHTTPæ¶ˆæ¯å¯ä»¥åŒ…å«è®¸å¤šæè¿°æ¶ˆæ¯å±æ€§çš„æ ‡é¢˜ï¼Œä¾‹å¦‚å†…å®¹é•¿åº¦ï¼Œå†…å®¹ç±»å‹ç­‰ã€‚HttpClientæä¾›äº†æ£€ç´¢ï¼Œæ·»åŠ ï¼Œåˆ é™¤å’Œæšä¸¾æ ‡å¤´çš„æ–¹æ³•ã€‚ 123456789101112HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_OK, \"OK\");response.addHeader(\"Set-Cookie\", \"c1=a; path=/; domain=localhost\");response.addHeader(\"Set-Cookie\", \"c2=b; path=\\\"/\\\", c3=c; domain=\\\"localhost\\\"\");Header h1 = response.getFirstHeader(\"Set-Cookie\");System.out.println(h1);Header h2 = response.getLastHeader(\"Set-Cookie\");System.out.println(h2);Header[] hs = response.getHeaders(\"Set-Cookie\");System.out.println(hs.length); stdout &gt; 123Set-Cookie: c1=a; path=/; domain=localhostSet-Cookie: c2=b; path=\"/\", c3=c; domain=\"localhost\"2 è·å–ç»™å®šç±»å‹çš„æ‰€æœ‰æ ‡å¤´çš„æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯ä½¿ç”¨HeaderIteratoræ¥å£ã€‚ 123456789HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_OK, \"OK\");response.addHeader(\"Set-Cookie\", \"c1=a; path=/; domain=localhost\");response.addHeader(\"Set-Cookie\", \"c2=b; path=\\\"/\\\", c3=c; domain=\\\"localhost\\\"\");HeaderIterator it = response.headerIterator(\"Set-Cookie\");while (it.hasNext()) { System.out.println(it.next());} stdout &gt; 12Set-Cookie: c1=a; path=/; domain=localhostSet-Cookie: c2=b; path=\"/\", c3=c; domain=\"localhost\" HeaderIteratorè¿˜æä¾›äº†å°†HTTPæ¶ˆæ¯è§£æä¸ºå•ä¸ªå¤´å…ƒç´ çš„ä¾¿æ·æ–¹æ³•ã€‚ 123456789101112131415HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_OK, \"OK\");response.addHeader(\"Set-Cookie\", \"c1=a; path=/; domain=localhost\");response.addHeader(\"Set-Cookie\", \"c2=b; path=\\\"/\\\", c3=c; domain=\\\"localhost\\\"\");HeaderElementIterator it = new BasicHeaderElementIterator( response.headerIterator(\"Set-Cookie\"));while (it.hasNext()) { HeaderElement elem = it.nextElement(); System.out.println(elem.getName() + \" = \" + elem.getValue()); NameValuePair[] params = elem.getParameters(); for (int i = 0; i &lt; params.length; i++) { System.out.println(\" \" + params[i]); }} stdout &gt; 1234567c1 = apath=/domain=localhostc2 = bpath=/c3 = cdomain=localhost HTTP entityHTTPæ¶ˆæ¯å¯ä»¥æºå¸¦ä¸è¯·æ±‚æˆ–å“åº”ç›¸å…³è”çš„å†…å®¹å®ä½“ã€‚å®ä½“å¯ä»¥åœ¨æŸäº›è¯·æ±‚å’ŒæŸäº›å“åº”ä¸­æ‰¾åˆ°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¯é€‰çš„ã€‚ä½¿ç”¨å®ä½“çš„è¯·æ±‚ç§°ä¸ºåŒ…å«å®ä½“çš„è¯·æ±‚ã€‚HTTPè§„èŒƒå®šä¹‰äº†ä¸¤ä¸ªå°é—­è¯·æ±‚æ–¹æ³•çš„å®ä½“ï¼šPOSTå’Œ PUTã€‚é€šå¸¸httpå“åº”ä¼šåŒ…å«ä¸€ä¸ªå†…å®¹å®ä½“ã€‚å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼Œå¦‚åº”å¯¹ HEADæ–¹æ³•204 No Contentï¼Œ 304 Not Modifiedï¼Œ205 Reset Content å“åº”ã€‚ HttpClientæ ¹æ®æ¥æºçš„ä¸åŒï¼Œåˆ’åˆ†äº†ä¸‰ç§ä¸åŒçš„Httpå®ä½“å†…å®¹ã€‚ streamed: å†…å®¹ä»æµä¸­æ¥æ”¶ï¼Œæˆ–åœ¨è¿è¡Œä¸­ç”Ÿæˆï¼ŒåŒ…æ‹¬ä»HTTPå“åº”æ¥æ”¶çš„å®ä½“ã€‚streamedå®ä½“é€šå¸¸ä¸å¯é‡å¤ã€‚ self-contained: å†…å®¹åœ¨å†…å­˜ä¸­æˆ–é€šè¿‡ç‹¬ç«‹äºè¿æ¥æˆ–å…¶ä»–å®ä½“çš„æ–¹å¼è·å¾—ã€‚è‡ªåŒ…å«å®ä½“é€šå¸¸æ˜¯å¯é‡å¤çš„ã€‚è¿™ç§ç±»å‹çš„å®ä½“ä¸»è¦æ˜¯å°è£…HTTPè¯·æ±‚çš„å®ä½“ã€‚ wrapping: å†…å®¹ä»å¦ä¸€ä¸ªå®ä½“è·å¾—ã€‚ å¯é‡å¤çš„å®ä½“å®ä½“å¯ä»¥æ˜¯å¯é‡å¤çš„ï¼Œè¿™æ„å‘³ç€å…¶å†…å®¹å¯ä»¥è¢«å¤šæ¬¡è¯»å–ã€‚è¿™ä»…é€‚ç”¨äºè‡ªåŒ…å«çš„å®ä½“ï¼ˆå¦‚ ByteArrayEntityæˆ– StringEntityï¼‰ã€‚ ä½¿ç”¨HTTPå®ä½“å¦‚æœè¦ä»Httpå®ä½“ä¸­è¯»å–å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨HttpEntityç±»çš„getContentæ–¹æ³•æ¥è·å–å®ä½“çš„è¾“å…¥æµï¼ˆjava.io.InputStream)ï¼Œæˆ–è€…åˆ©ç”¨HttpEntityç±»çš„writeTo(OutputStream)æ–¹æ³•æ¥è·å–è¾“å‡ºæµï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠæ‰€æœ‰çš„å†…å®¹å†™å…¥åˆ°ç»™å®šçš„æµä¸­ã€‚ å–Content-Typeå’ŒContent-Lengthä¸¤ä¸ªå¤´æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ç”±äºContent-TypeåŒ…å«mime-typesçš„å­—ç¬¦ç¼–ç ï¼Œæ¯”å¦‚text/plainæˆ–è€…text/html,HttpEntityç±»çš„getContentEncoding()æ–¹æ³•å°±æ˜¯è¯»å–è¿™ä¸ªç¼–ç çš„ã€‚å¦‚æœå¤´ä¿¡æ¯ä¸å­˜åœ¨ï¼ŒgetContentLengthï¼ˆï¼‰ä¼šè¿”å›-1,getContentType()ä¼šè¿”å›NULLã€‚å¦‚æœContent-Typeä¿¡æ¯å­˜åœ¨ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªHeaderç±»ã€‚ 1234567StringEntity myEntity = new StringEntity(\"important message\", ContentType.create(\"text/plain\", \"UTF-8\"));System.out.println(myEntity.getContentType());System.out.println(myEntity.getContentLength());System.out.println(EntityUtils.toString(myEntity));System.out.println(EntityUtils.toByteArray(myEntity).length); stdout &gt; 1234Content-Type: text/plain; charset=utf-817important message17 ç¡®ä¿åº•å±‚çš„èµ„æºè¿æ¥è¢«é‡Šæ”¾ä¸ºäº†ç¡®ä¿æ­£ç¡®é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œå¿…é¡»å…³é—­ä¸å®ä½“å…³è”çš„å†…å®¹æµæˆ–å“åº”æœ¬èº«. 1234567891011121314151617CloseableHttpClient httpclient = HttpClients.createDefault();HttpGet httpget = new HttpGet(\"http://localhost/\");CloseableHttpResponse response = httpclient.execute(httpget);try { HttpEntity entity = response.getEntity(); if(entity != null) { InputStream instream = entity.getContent(); try { //do something useful }finally { instream.close(); } }}finally { response.close();} å…³é—­å†…å®¹æµå’Œå…³é—­å“åº”ä¹‹é—´çš„åŒºåˆ«åœ¨äºå‰è€…å°†å°è¯•é€šè¿‡ä½¿ç”¨å®ä½“å†…å®¹æ¥ä¿æŒåº•å±‚è¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè€Œåè€…ç«‹å³å…³é—­å¹¶ä¸¢å¼ƒè¿æ¥ã€‚ ä½¿ç”¨å®ä½“å†…å®¹HttpClientæ¨èä½¿ç”¨HttpEntityçš„getConent()æ–¹æ³•æˆ–è€…HttpEntityçš„writeTo(OutputStream)æ–¹æ³•æ¥æ¶ˆè€—æ‰Httpå®ä½“å†…å®¹ã€‚HttpClientä¹Ÿæä¾›äº†EntityUtilsè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»æä¾›ä¸€äº›é™æ€æ–¹æ³•å¯ä»¥æ›´å®¹æ˜“åœ°è¯»å–Httpå®ä½“çš„å†…å®¹å’Œä¿¡æ¯ã€‚å’Œä»¥java.io.InputStreamæµè¯»å–å†…å®¹çš„æ–¹å¼ç›¸æ¯”ï¼ŒEntityUtilsæä¾›çš„æ–¹æ³•å¯ä»¥ä»¥å­—ç¬¦ä¸²æˆ–è€…å­—èŠ‚æ•°ç»„çš„å½¢å¼è¯»å–Httpå®ä½“ã€‚ä½†æ˜¯ï¼Œå¼ºçƒˆä¸æ¨èä½¿ç”¨EntityUtilsè¿™ä¸ªç±»ï¼Œé™¤éç›®æ ‡æœåŠ¡å™¨å‘å‡ºçš„å“åº”æ˜¯å¯ä¿¡ä»»çš„ï¼Œå¹¶ä¸”httpå“åº”å®ä½“çš„é•¿åº¦ä¸ä¼šè¿‡å¤§ã€‚ 12345678910111213141516CloseableHttpClient httpclient = HttpClients.createDefault();HttpGet httpget = new HttpGet(\"http://localhost/\");CloseableHttpResponse response = httpclient.execute(httpget);try { HttpEntity entity = response.getEntity(); if (entity != null) { long len = entity.getContentLength(); if (len != -1 &amp;&amp; len &lt; 2048) { System.out.println(EntityUtils.toString(entity)); } else { // Stream content out } }} finally { response.close();} åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦èƒ½å¤Ÿå¤šæ¬¡è¯»å–å®ä½“å†…å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ä½“å†…å®¹å¿…é¡»ä»¥æŸç§æ–¹å¼ç¼“å†²ï¼Œæ— è®ºæ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸Šã€‚å®ç°è¿™ä¸€ç›®æ ‡çš„æœ€ç®€å•æ–¹æ³•æ˜¯å°†åŸå§‹å®ä½“ä¸BufferedHttpEntityç±»åŒ…è£…åœ¨ä¸€èµ·ã€‚è¿™å°†å¯¼è‡´åŸå§‹å®ä½“çš„å†…å®¹è¢«è¯»å…¥å†…å­˜ç¼“å†²åŒºã€‚ 12345CloseableHttpResponse response = &lt;...&gt; HttpEntity entity = response.getEntityï¼ˆï¼‰; ifï¼ˆentityï¼= nullï¼‰{ entity = new BufferedHttpEntityï¼ˆentityï¼‰; } åˆ›å»ºHTTPå®ä½“å†…å®¹HttpClientæä¾›äº†å‡ ä¸ªæœ€å¸¸è§çš„æ•°æ®çš„å®¹å™¨ç±»ï¼Œè¿™äº›ç±»å¯ä»¥é€šè¿‡httpè¿æ¥é«˜æ•ˆåœ°è¾“å‡ºHttpå®ä½“å†…å®¹ã€‚å¦‚å­—ç¬¦ä¸²ï¼Œå­—èŠ‚æ•°ç»„ï¼Œè¾“å…¥æµï¼Œå’Œæ–‡ä»¶ï¼šStringEntityï¼Œ ByteArrayEntityï¼Œ InputStreamEntityï¼Œå’Œ FileEntityã€‚ 1234File file = new File(\"somefile.txt\");FileEntity entity = new FileEntity(file, ContentType.create(\"text/plain\", Consts.UTF_8));HttpPost httppost = new HttpPost(\"http://localhost/action.do\");httppost.setEntity(entity); æ³¨æ„ :InputStreamEntityä¸å¯é‡å¤ï¼Œå› ä¸ºå®ƒåªèƒ½ä»åŸºç¡€æ•°æ®æµä¸­è¯»å–ä¸€æ¬¡ã€‚å»ºè®®ï¼Œå®é€šè¿‡ç»§æ‰¿HttpEntityè¿™ä¸ªè‡ªåŒ…å«çš„ç±»æ¥è‡ªå®šä¹‰HttpEntityç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨InputStreamEntityè¿™ä¸ªç±»ã€‚FileEntityå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼ˆFileEntityå°±æ˜¯ç»§æ‰¿çš„HttpEntityï¼‰ã€‚ HTMLè¡¨å•è®¸å¤šåº”ç”¨ç¨‹åºéœ€è¦æ¨¡æ‹Ÿæäº¤HTMLè¡¨å•çš„è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼Œç™»å½•åˆ°Webåº”ç”¨ç¨‹åºæˆ–æäº¤è¾“å…¥æ•°æ®ã€‚HttpClientæä¾›å®ä½“ç±» UrlEncodedFormEntityæ¥å®ç°è¯¥è¿‡ç¨‹ã€‚ 123456List&lt;NameValuePair&gt; formparams = new ArrayList&lt;NameValuePair&gt;();formparams.add(new BasicNameValuePair(\"param1\", \"value1\"));formparams.add(new BasicNameValuePair(\"param2\", \"value2\"));UrlEncodedFormEntity entity = new UrlEncodedFormEntity(formparams, Consts.UTF_8);HttpPost httppost = new HttpPost(\"http://localhost/handler.do\");httppost.setEntity(entity); è¯¥UrlEncodedFormEntityå®ä¾‹å°†ä½¿ç”¨æ‰€è°“çš„URLç¼–ç æ¥ç¼–ç å‚æ•°å¹¶ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š 1param1=value1&amp;param2=value2 å†…å®¹åˆ†å—ä¸€èˆ¬æ¥è¯´ï¼Œæ¨èè®©HttpClientè‡ªå·±æ ¹æ®Httpæ¶ˆæ¯ä¼ é€’çš„ç‰¹å¾æ¥é€‰æ‹©æœ€åˆé€‚çš„ä¼ è¾“ç¼–ç ã€‚å½“ç„¶ï¼Œå¦‚æœéè¦æ‰‹åŠ¨æ§åˆ¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®HttpEntityçš„setChunked()ä¸ºtrueã€‚è¯·æ³¨æ„ï¼šHttpClientä»…ä¼šå°†è¿™ä¸ªå‚æ•°çœ‹æˆæ˜¯ä¸€ä¸ªå»ºè®®ã€‚å¦‚æœHttpçš„ç‰ˆæœ¬ï¼ˆå¦‚http 1.0)ä¸æ”¯æŒå†…å®¹åˆ†å—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°å°±ä¼šè¢«å¿½ç•¥ã€‚ 1234StringEntity entity = new StringEntity(\"important message\", ContentType.create(\"text/plain\", Consts.UTF_8));entity.setChunked(true);HttpPost httppost = new HttpPost(\"http://localhost/action.do\");httppost.setEntity(entity); å“åº”å¤„ç†æœ€æ–¹ä¾¿çš„å¤„ç†httpå“åº”çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ResponseHandleræ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸­æœ‰handleResponse(HttpResponse response)æ–¹æ³•ã€‚ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç”¨æˆ·å®Œå…¨ä¸ç”¨å…³å¿ƒhttpè¿æ¥ç®¡ç†å™¨ã€‚å½“ä½¿ç”¨ResponseHandleræ—¶ï¼ŒHttpClientä¼šè‡ªåŠ¨åœ°å°†Httpè¿æ¥é‡Šæ”¾ç»™Httpç®¡ç†å™¨ï¼Œå³ä½¿httpè¯·æ±‚å¤±è´¥äº†æˆ–è€…æŠ›å‡ºäº†å¼‚å¸¸ã€‚ 123456789101112131415161718192021222324252627CloseableHttpClient httpclient = HttpClients.createDefault();HttpGet httpget = new HttpGet(\"http://localhost/json\");ResponseHandler&lt;MyJsonObject&gt; rh = new ResponseHandler&lt;MyJsonObject&gt;() { @Override public JsonObject handleResponse( final HttpResponse response) throws IOException { StatusLine statusLine = response.getStatusLine(); HttpEntity entity = response.getEntity(); if (statusLine.getStatusCode() &gt;= 300) { throw new HttpResponseException( statusLine.getStatusCode(), statusLine.getReasonPhrase()); } if (entity == null) { throw new ClientProtocolException(\"Response contains no content\"); } Gson gson = new GsonBuilder().create(); ContentType contentType = ContentType.getOrDefault(entity); Charset charset = contentType.getCharset(); Reader reader = new InputStreamReader(entity.getContent(), charset); return gson.fromJson(reader, MyJsonObject.class); }};//è®¾ç½®responseHandlerï¼Œå½“æ‰§è¡Œhttpæ–¹æ³•æ—¶ï¼Œå°±ä¼šè¿”å›MyJsonObjectå¯¹è±¡ã€‚MyJsonObject myjson = client.execute(httpget, rh); HttpClient æ¥å£å¯¹äºHttpè¯·æ±‚æ‰§è¡Œè¿‡ç¨‹æ¥è¯´ï¼ŒHttpClientçš„æ¥å£æœ‰ç€å¿…ä¸å¯å°‘çš„ä½œç”¨ã€‚HttpClientæ¥å£æ²¡æœ‰å¯¹Httpè¯·æ±‚çš„è¿‡ç¨‹åšç‰¹åˆ«çš„é™åˆ¶å’Œè¯¦ç»†çš„è§„å®šï¼Œè¿æ¥ç®¡ç†ã€çŠ¶æ€ç®¡ç†ã€æˆæƒä¿¡æ¯å’Œé‡å®šå‘å¤„ç†è¿™äº›åŠŸèƒ½éƒ½å•ç‹¬å®ç°ã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥æ›´ç®€å•åœ°æ‹“å±•æ¥å£çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚ç¼“å­˜å“åº”å†…å®¹ï¼‰ã€‚ ä¸€èˆ¬è¯´æ¥ï¼ŒHttpClientå®é™…ä¸Šå°±æ˜¯ä¸€ç³»åˆ—ç‰¹æ®Šçš„handleræˆ–è€…è¯´ç­–ç•¥æ¥å£çš„å®ç°ï¼Œè¿™äº›handlerè´Ÿè´£å¤„ç†Httpåè®®çš„æŸä¸€æ–¹é¢ï¼Œæ¯”å¦‚é‡å®šå‘ã€è®¤è¯å¤„ç†ã€æœ‰å…³è¿æ¥æŒä¹…æ€§å’Œkeep aliveæŒç»­æ—¶é—´çš„å†³ç­–ã€‚è¿™æ ·å°±å…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå®šä¹‰çš„å‚æ•°æ¥ä»£æ›¿é»˜è®¤é…ç½®ï¼Œå®ç°ä¸ªæ€§åŒ–çš„åŠŸèƒ½ã€‚ 12345678910111213ConnectionKeepAliveStrategy keepAliveStrat = new DefaultConnectionKeepAliveStrategy() { @Override public long getKeepAliveDuration(HttpResponse response, HttpContext context) { long keepAlive = super.getKeepAliveDuration(response, context); if(keepAlive == -1) { //å¦‚æœæœåŠ¡å™¨æ²¡æœ‰è®¾ç½®keep-aliveè¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒè®¾ç½®æˆ5ç§’ keepAlive = 5000; } return keepAlive; }};//è‡ªå®šä¹‰httpclientCloseableHttpClient httpclient = HttpClients.custom().setKeepAliveStrategy(keepAliveStrat).build(); HttpClientçº¿ç¨‹å®‰å…¨æ€§HttpClientå·²ç»å®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚æ‰€ä»¥å»ºè®®åœ¨å®ä¾‹åŒ–HttpClientåï¼Œå¯ä»¥é‡ç”¨äºå¤šä¸ªè¯·æ±‚ä½¿ç”¨ã€‚ HttpClientèµ„æºé‡Šæ”¾å½“ä¸€ä¸ªCloseableHttpClientçš„å®ä¾‹ä¸å†è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”å®ƒçš„ä½œç”¨èŒƒå›´å³å°†å¤±æ•ˆï¼Œå’Œå®ƒç›¸å…³çš„è¿æ¥å¿…é¡»è¢«å…³é—­ï¼Œå…³é—­æ–¹æ³•å¯ä»¥è°ƒç”¨CloseableHttpClientçš„close()æ–¹æ³•ã€‚ 123456CloseableHttpClient httpclient = HttpClients.createDefault();try { &lt;...&gt;} finally { httpclient.close();} 1.3 Httpæ‰§è¡Œä¸Šä¸‹æ–‡æœ€åˆï¼ŒHTTPè¢«è®¾è®¡ä¸ºæ— çŠ¶æ€ï¼Œé¢å‘å“åº”è¯·æ±‚çš„åè®®ã€‚ä½†æ˜¯ï¼Œç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦èƒ½å¤Ÿé€šè¿‡å‡ ä¸ªé€»è¾‘ä¸Šç›¸å…³çš„è¯·æ±‚ - å“åº”äº¤æ¢æ¥æŒä¹…ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚ä¸ºäº†ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿç»´æŒå¤„ç†çŠ¶æ€ï¼ŒHttpClientå…è®¸åœ¨ç‰¹å®šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œç§°ä¸ºHTTPä¸Šä¸‹æ–‡ã€‚å¦‚æœåœ¨è¿ç»­è¯·æ±‚ä¹‹é—´é‡ç”¨ç›¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œåˆ™å¤šä¸ªé€»è¾‘ç›¸å…³çš„è¯·æ±‚å¯ä»¥å‚ä¸é€»è¾‘ä¼šè¯ã€‚HTTPä¸Šä¸‹æ–‡å°±å’Œä¸€ä¸ªjava.util.Map&lt;String, Object&gt;åŠŸèƒ½ç±»ä¼¼ã€‚å®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä»»æ„å‘½åçš„å€¼çš„é›†åˆã€‚åº”ç”¨ç¨‹åºå¯ä»¥åœ¨Httpè¯·æ±‚æ‰§è¡Œå‰å¡«å……ä¸Šä¸‹æ–‡çš„å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚æ‰§è¡Œå®Œæ¯•åæ£€æŸ¥ä¸Šä¸‹æ–‡ã€‚ HttpContextå¯ä»¥åŒ…å«ä»»æ„å¯¹è±¡ï¼Œå› æ­¤åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«å¯èƒ½ä¸å®‰å…¨ã€‚å»ºè®®æ¯ä¸ªæ‰§è¡Œçº¿ç¨‹ç»´æŠ¤è‡ªå·±çš„ä¸Šä¸‹æ–‡ã€‚ åœ¨Httpè¯·æ±‚æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒHttpClientä¼šè‡ªåŠ¨æ·»åŠ ä¸‹é¢çš„å±æ€§åˆ°Httpä¸Šä¸‹æ–‡ä¸­ï¼š HttpConnection è¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ã€‚ HttpHost è¡¨ç¤ºè¿æ¥ç›®æ ‡çš„å®ä¾‹ã€‚ HttpRoute è¡¨ç¤ºå…¨éƒ¨çš„è¿æ¥è·¯ç”±ã€‚ HttpRequestè¡¨ç¤ºå®é™…HTTPè¯·æ±‚çš„å®ä¾‹ã€‚åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œæœ€ç»ˆçš„HttpRequestå¯¹è±¡ä¼šä»£è¡¨httpæ¶ˆæ¯çš„çŠ¶æ€ã€‚Http/1.0å’ŒHttp/1.1éƒ½é»˜è®¤ä½¿ç”¨ç›¸å¯¹çš„uriã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨äº†ééš§é“æ¨¡å¼çš„ä»£ç†æœåŠ¡å™¨ï¼Œå°±ä¼šä½¿ç”¨ç»å¯¹è·¯å¾„çš„uriã€‚ HttpResponse è¡¨ç¤ºå®é™…HTTPå“åº”çš„å®ä¾‹ã€‚ java.lang.Boolean è¡¨ç¤ºæ˜¯å¦è¯·æ±‚è¢«æˆåŠŸçš„å‘é€ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚ RequestConfig è¡¨ç¤ºhttp requestçš„é…ç½®ä¿¡æ¯ã€‚ java.util.List&lt;URI&gt; è¡¨ç¤ºHttpå“åº”ä¸­çš„æ‰€æœ‰é‡å®šå‘åœ°å€ã€‚ å¯ä»¥ä½¿ç”¨HttpClientContexté€‚é…å™¨ç±»æ¥ç®€åŒ–ä¸ä¸Šä¸‹æ–‡çŠ¶æ€çš„äº¤äº’ã€‚ 123456HttpContext context = &lt;...&gt;HttpClientContext clientContext = HttpClientContext.adapt(context);HttpHost target = clientContext.getTargetHost();HttpRequest request = clientContext.getRequest();HttpResponse response = clientContext.getResponse();RequestConfig config = clientContext.getRequestConfig(); åŒä¸€ä¸ªé€»è¾‘ä¼šè¯ä¸­çš„å¤šä¸ªHttpè¯·æ±‚ï¼Œåº”è¯¥ä½¿ç”¨ç›¸åŒçš„Httpä¸Šä¸‹æ–‡æ¥æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨åœ°åœ¨httpè¯·æ±‚ä¸­ä¼ é€’ä¼šè¯ä¸Šä¸‹æ–‡å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨å¼€å¤´è®¾ç½®çš„å‚æ•°ï¼Œä¼šè¢«ä¿å­˜åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶ä¸”ä¼šåº”ç”¨åˆ°åç»­çš„httpè¯·æ±‚ä¸­ã€‚ 123456789101112131415161718192021CloseableHttpClient httpclient = HttpClients.createDefault();RequestConfig requestConfig = RequestConfig.custom() .setSocketTimeout(1000) .setConnectTimeout(1000) .build();HttpGet httpget1 = new HttpGet(\"http://localhost/1\");httpget1.setConfig(requestConfig);CloseableHttpResponse response1 = httpclient.execute(httpget1, context);try { HttpEntity entity1 = response1.getEntity();} finally { response1.close();}HttpGet httpget2 = new HttpGet(\"http://localhost/2\");CloseableHttpResponse response2 = httpclient.execute(httpget2, context);try { HttpEntity entity2 = response2.getEntity();} finally { response2.close();} Http åè®®æ‹¦æˆªå™¨HTTPåè®®æ‹¦æˆªå™¨æ˜¯ä¸€ç§å®ç°ä¸€ä¸ªç‰¹å®šçš„æ–¹é¢çš„HTTPåè®®çš„ä»£ç ç¨‹åºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåè®®æ‹¦æˆªå™¨ä¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå¤´æ¶ˆæ¯åŠ å…¥åˆ°æ¥å—æˆ–è€…å‘é€çš„æ¶ˆæ¯ä¸­ã€‚åè®®æ‹¦æˆªå™¨ä¹Ÿå¯ä»¥æ“ä½œæ¶ˆæ¯çš„å†…å®¹å®ä½“â€”æ¶ˆæ¯å†…å®¹çš„å‹ç¼©/è§£å‹ç¼©å°±æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨â€œè£…é¥°â€å¼€å‘æ¨¡å¼ï¼Œä¸€ä¸ªåŒ…è£…å®ä½“ç±»ç”¨äºè£…é¥°åŸæ¥çš„å®ä½“æ¥å®ç°ã€‚ä¸€ä¸ªæ‹¦æˆªå™¨å¯ä»¥åˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘å•å…ƒã€‚ åè®®æ‹¦æˆªå™¨å¯ä»¥é€šè¿‡å…±äº«ä¿¡æ¯åä½œâ€”â€”æ¯”å¦‚å¤„ç†çŠ¶æ€â€”â€”é€šè¿‡HTTPæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åè®®æ‹¦æˆªå™¨å¯ä»¥ä½¿ç”¨Httpä¸Šä¸‹æ–‡å­˜å‚¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿ç»­è¯·æ±‚çš„å¤„ç†çŠ¶æ€ã€‚ é€šå¸¸ï¼Œåªè¦æ‹¦æˆªå™¨ä¸ä¾èµ–äºä¸€ä¸ªç‰¹å®šçŠ¶æ€çš„httpä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆæ‹¦æˆªæ‰§è¡Œçš„é¡ºåºå°±æ— æ‰€è°“ã€‚å¦‚æœåè®®æ‹¦æˆªå™¨æœ‰ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¿…é¡»ä»¥ç‰¹å®šçš„é¡ºåºæ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒä»¬åº”è¯¥æŒ‰ç…§ç‰¹å®šçš„é¡ºåºåŠ å…¥åˆ°åè®®å¤„ç†å™¨ä¸­ã€‚ åè®®å¤„ç†å™¨å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç±»ä¼¼äºservletsï¼Œåè®®æ‹¦æˆªå™¨ä¸åº”è¯¥ä½¿ç”¨å˜é‡å®ä½“ï¼Œé™¤éè®¿é—®è¿™äº›å˜é‡æ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸ªä¾‹å­ï¼Œè®²è¿°äº†æœ¬åœ°çš„ä¸Šä¸‹æ–‡æ—¶å¦‚ä½•åœ¨è¿ç»­è¯·æ±‚ä¸­è®°å½•å¤„ç†çŠ¶æ€çš„ï¼š 12345678910111213141516171819202122CloseableHttpClient httpclient = HttpClients.custom().addInterceptorLast(new HttpRequestInterceptor() { @Override public void process(HttpRequest request, HttpContext context) throws HttpException, IOException { AtomicInteger count = (AtomicInteger)context.getAttribute(\"count\"); request.addHeader(\"Count\", Integer.toString(count.getAndIncrement())); }}).build();AtomicInteger count = new AtomicInteger(1);HttpClientContext localContext = HttpClientContext.create();localContext.setAttribute(\"count\", count);HttpGet httpget = new HttpGet(\"http://localhost\");for(int i = 0; i&lt;10; i++) { CloseableHttpResponse response = httpclient.execute(httpget, localContext); try { HttpEntity entity = response.getEntity(); }finally { response.close(); } } ä¸Šé¢ä»£ç åœ¨å‘é€httpè¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ Countè¿™ä¸ªheaderï¼Œå¯ä»¥ä½¿ç”¨wiresharkæŠ“åŒ…æŸ¥çœ‹ã€‚ å¼‚å¸¸å¤„ç†HttpClientä¼šè¢«æŠ›å‡ºä¸¤ç§ç±»å‹çš„å¼‚å¸¸ï¼Œä¸€ç§æ˜¯java.io.IOExceptionï¼Œå½“é‡åˆ°I/Oå¼‚å¸¸æ—¶æŠ›å‡ºï¼ˆsocketè¶…æ—¶ï¼Œæˆ–è€…socketè¢«é‡ç½®ï¼‰;å¦ä¸€ç§æ˜¯HttpException,è¡¨ç¤ºHttpå¤±è´¥ï¼Œå¦‚Httpåè®®ä½¿ç”¨ä¸æ­£ç¡®ã€‚é€šå¸¸è®¤ä¸ºï¼ŒI/Oé”™è¯¯æ—¶ä¸è‡´å‘½ã€å¯ä¿®å¤çš„ï¼Œè€ŒHttpåè®®é”™è¯¯æ˜¯è‡´å‘½äº†ï¼Œä¸èƒ½è‡ªåŠ¨ä¿®å¤çš„é”™è¯¯ã€‚æ³¨æ„ï¼ŒHttpClientå®ç°é‡æ–°æŠ›å‡ºHttpException å¦‚ClientProtocolExceptionï¼Œå®ƒæ˜¯java.io.IOExceptionçš„å­ç±»ã€‚è¿™ä½¿ç¨‹åºèƒ½å¤Ÿä»å•ä¸ªcatchå­å¥å¤„ç†I / Oé”™è¯¯å’Œåè®®è¿è§„ã€‚ HTTPä¼ è¾“å®‰å…¨Httpåè®®ä¸èƒ½æ»¡è¶³æ‰€æœ‰ç±»å‹çš„åº”ç”¨ç¨‹åºï¼ŒHTTPæ˜¯ä¸€ç§ç®€å•çš„é¢å‘è¯·æ±‚/å“åº”çš„åè®®ï¼Œæœ€åˆè®¾è®¡ç”¨äºæ”¯æŒé™æ€æˆ–åŠ¨æ€ç”Ÿæˆçš„å†…å®¹æ£€ç´¢ã€‚å®ƒä»æœªæ‰“ç®—æ”¯æŒäº‹åŠ¡æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœHTTPæœåŠ¡å™¨æˆåŠŸæ¥æ”¶å’Œå¤„ç†è¯·æ±‚ï¼Œç”Ÿæˆå“åº”å¹¶å°†çŠ¶æ€ä»£ç å‘é€å›å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯Httpåè®®åº”è¯¥ä¿è¯çš„ã€‚å¦‚æœå®¢æˆ·ç«¯ç”±äºè¯»å–è¶…æ—¶ï¼Œè¯·æ±‚å–æ¶ˆæˆ–ç³»ç»Ÿå´©æºƒè€Œæœªèƒ½å®Œå…¨æ¥æ”¶å“åº”ï¼Œåˆ™æœåŠ¡å™¨å°†ä¸ä¼šå°è¯•å›æ»šäº‹åŠ¡ã€‚å¦‚æœå®¢æˆ·ç«¯å†³å®šé‡è¯•ç›¸åŒçš„è¯·æ±‚ï¼Œåˆ™æœåŠ¡å™¨å°†ä¸å¯é¿å…åœ°å¤šæ¬¡æ‰§è¡ŒåŒä¸€äº‹åŠ¡ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºæ•°æ®æŸåæˆ–åº”ç”¨ç¨‹åºçŠ¶æ€ä¸ä¸€è‡´ã€‚ å°½ç®¡HTTPä»æœªè¢«è®¾è®¡ä¸ºæ”¯æŒäº‹åŠ¡å¤„ç†ï¼Œä½†å¦‚æœæ»¡è¶³æŸäº›æ¡ä»¶ï¼Œå®ƒä»å¯ç”¨ä½œå…³é”®ä»»åŠ¡åº”ç”¨ç¨‹åºçš„ä¼ è¾“åè®®ã€‚ä¸ºç¡®ä¿HTTPä¼ è¾“å±‚å®‰å…¨ï¼Œç³»ç»Ÿå¿…é¡»ç¡®ä¿åº”ç”¨å±‚ä¸ŠHTTPæ–¹æ³•çš„å¹‚ç­‰æ€§ã€‚ æ–¹æ³•çš„å¹‚ç­‰æ€§åº”ç”¨ç¨‹åºéœ€è¦æ­£ç¡®åœ°å¤„ç†åŒä¸€æ–¹æ³•å¤šæ¬¡æ‰§è¡Œé€ æˆçš„å½±å“ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ä»¥é€šè¿‡æä¾›å”¯ä¸€çš„äº‹åŠ¡idå’Œé€šè¿‡é¿å…æ‰§è¡Œç›¸åŒé€»è¾‘æ“ä½œçš„å…¶ä»–æ‰‹æ®µæ¥å®ç°ã€‚ æ³¨æ„ï¼šè¿™ä¸ªé—®é¢˜ä¸åªæ˜¯HttpClientæ‰ä¼šæœ‰ï¼ŒåŸºäºæµè§ˆå™¨çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šé‡åˆ°Httpæ–¹æ³•ä¸å¹‚ç­‰çš„é—®é¢˜ã€‚ HttpClienté»˜è®¤æŠŠéå®ä½“æ–¹æ³•getã€headæ–¹æ³•çœ‹åšå¹‚ç­‰æ–¹æ³•ï¼ŒæŠŠå®ä½“æ–¹æ³•postã€putæ–¹æ³•çœ‹åšéå¹‚ç­‰æ–¹æ³•ã€‚ å¼‚å¸¸è‡ªåŠ¨ä¿®å¤é»˜è®¤æƒ…å†µä¸‹ï¼ŒHttpClientä¼šå°è¯•è‡ªåŠ¨ä¿®å¤I/Oå¼‚å¸¸ã€‚é»˜è®¤çš„è‡ªåŠ¨æ¢å¤æœºåˆ¶ä»…é™äºä¸€äº›å·²çŸ¥å®‰å…¨çš„å¼‚å¸¸æƒ…å†µã€‚ HttpClientä¸ä¼šå°è¯•ä¿®å¤ä»»ä½•é€»è¾‘æˆ–è€…httpåè®®é”™è¯¯ï¼ˆå³ä»HttpExceptionè¡ç”Ÿå‡ºæ¥çš„å¼‚å¸¸ï¼‰ã€‚ HttpClientå°†è‡ªåŠ¨é‡è¯•é‚£äº›è¢«è®¤ä¸ºæ˜¯å¹‚ç­‰çš„æ–¹æ³•ã€‚ ä¼šè‡ªåŠ¨å†æ¬¡å‘é€é‡åˆ°transportå¼‚å¸¸çš„æ–¹æ³•ï¼Œå‰ææ˜¯Httpè¯·æ±‚ä»æ—§ä¿æŒç€è¿æ¥ï¼ˆå³è¯·æ±‚å°šæœªå®Œå…¨ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼‰ï¼ŒHttpClientå°†è‡ªåŠ¨é‡è¯•é‚£äº›å› ä¼ è¾“å¼‚å¸¸è€Œå¤±è´¥çš„æ–¹æ³•ã€‚ è¯·æ±‚é‡è¯•HANDLERå¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦å®ç°HttpRequestRetryHandleræ¥å£ã€‚ 12345678910111213141516171819202122232425262728293031323334353637HttpRequestRetryHandler retryHandler = new HttpRequestRetryHandler() { @Override public boolean retryRequest(IOException exception, int executionCount, HttpContext context) { if(executionCount &gt;= 5) { //è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•° return false; } if(exception instanceof InterruptedIOException) { //è¶…æ—¶ return false; } if(exception instanceof UnknownHostException) { //ç›®æ ‡æœåŠ¡ä¸å¯è¾¾ return false; } if(exception instanceof ConnectTimeoutException) { //è¿æ¥è¢«æ‹’ç» return false; } if(exception instanceof SSLException) { //sslæ¡æ‰‹å¼‚å¸¸ return false; } HttpClientContext clientContext = HttpClientContext.adapt(context); HttpRequest request = clientContext.getRequest(); boolean idempotent = !(request instanceof HttpEntityEnclosingRequest); if(idempotent) { //å¦‚æœè¯·æ±‚æ—¶å¹‚ç­‰çš„ï¼Œå°±å†æ¬¡å°è¯• return false; } return false; }}; CloseableHttpClient httpclient = HttpClients.custom() .setRetryHandler(retryHandler) .build(); ç»ˆæ­¢è¯·æ±‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºç›®æ ‡æœåŠ¡å™¨ä¸Šçš„é«˜è´Ÿè½½æˆ–å®¢æˆ·ç«¯ä¸Šå‘å‡ºçš„å¹¶å‘è¯·æ±‚å¤ªå¤šï¼ŒHTTPè¯·æ±‚æ‰§è¡Œæ— æ³•åœ¨é¢„æœŸçš„æ—¶é—´èŒƒå›´å†…å®Œæˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æå‰ç»ˆæ­¢è¯·æ±‚å¹¶å–æ¶ˆé˜»æ­¢åœ¨I / Oæ“ä½œä¸­é˜»å¡çš„æ‰§è¡Œçº¿ç¨‹ã€‚å¯ä»¥åœ¨æ‰§è¡Œçš„ä»»ä½•é˜¶æ®µé€šè¿‡è°ƒç”¨HttpUriRequest#abort()æ–¹æ³•ä¸­æ­¢ç”±HttpClientæ‰§è¡Œçš„HTTPè¯·æ±‚ ã€‚æ­¤æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ä»ä»»ä½•çº¿ç¨‹è°ƒç”¨ã€‚å½“HTTPè¯·æ±‚ä¸­æ­¢æ—¶ï¼Œå…¶æ‰§è¡Œçº¿ç¨‹ - å³ä½¿å½“å‰åœ¨I / Oæ“ä½œä¸­è¢«é˜»å¡ - ä¹Ÿå¯ä»¥é€šè¿‡æŠ›å‡ºä¸€ä¸ªInterruptedIOExceptionæ¥è§£é™¤é˜»å¡ ï¼Œé‡Šæ”¾èµ„æºã€‚ é‡å®šå‘å¤„ç†HttpClientä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰ç±»å‹çš„é‡å®šå‘ï¼Œé™¤äº†é‚£äº›Httpè§„èŒƒæ˜ç¡®ç¦æ­¢çš„é‡å®šå‘ã€‚See Other (status code 303) redirects on POST and PUT requests are converted to GET requests as required by the HTTP specification. å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„é‡å®šå‘ç­–ç•¥æ¥æ”¾æ¾Httpè§„èŒƒå¯¹Postæ–¹æ³•é‡å®šå‘çš„é™åˆ¶ã€‚ 12345////LaxRedirectStrategyå¯ä»¥è‡ªåŠ¨é‡å®šå‘æ‰€æœ‰çš„HEADï¼ŒGETï¼ŒPOSTè¯·æ±‚ï¼Œè§£é™¤äº†httpè§„èŒƒå¯¹postè¯·æ±‚é‡å®šå‘çš„é™åˆ¶ã€‚LaxRedirectStrategy redirectStrategy = new LaxRedirectStrategy(); CloseableHttpClient httpclient = HttpClients.custom() .setRedirectStrategy(redirectStrategy) .build(); HttpClienté€šå¸¸å¿…é¡»åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡å†™è¯·æ±‚æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP / 1.0å’ŒHTTP / 1.1é€šå¸¸ä½¿ç”¨ç›¸å¯¹è¯·æ±‚URIã€‚åŒæ ·ï¼ŒåŸå§‹è¯·æ±‚å¯èƒ½ä¼šå¤šæ¬¡ä»ä¸€ä¸ªä½ç½®é‡å®šå‘åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚å¯ä»¥ä½¿ç”¨åŸå§‹è¯·æ±‚å’Œä¸Šä¸‹æ–‡æ„å»ºæœ€ç»ˆè§£é‡Šçš„ç»å¯¹HTTPè·¯å¾„ã€‚URIUtils ç±»çš„ resolve`æ–¹æ³•å¯ç”¨äºæ„å»ºç”¨äºç”Ÿæˆæœ€ç»ˆè¯·æ±‚çš„ç»å¯¹URIã€‚æ­¤æ–¹æ³•åŒ…æ‹¬é‡å®šå‘è¯·æ±‚æˆ–åŸå§‹è¯·æ±‚ä¸­çš„æœ€åä¸€ä¸ªç‰‡æ®µæ ‡è¯†ç¬¦ã€‚ 12345678910111213CloseableHttpClient httpclient = HttpClients.createDefault();HttpClientContext context = HttpClientContext.create();HttpGet httpget = new HttpGet(\"http://localhost:8080/\");CloseableHttpResponse response = httpclient.execute(httpget, context);try { HttpHost target = context.getTargetHost(); List&lt;URI&gt; redirctLocations = context.getRedirectLocations(); URI location = URIUtils.resolve(httpget.getURI(), target, redirctLocations); System.out.println(\"Final HTTP location: \"+ location.toASCIIString()); // ä¸€èˆ¬ä¼šå–å¾—ä¸€ä¸ªç»å¯¹è·¯å¾„çš„uri}finally { response.close();} å‚è€ƒï¼šhttp://hc.apache.org/httpcomponents-client-4.5.x/ https://www.yeetrack.com/?p=773","link":"/2018/09/27/java/httpclient/HttpClient%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"HttpClientï¼ˆäºŒï¼‰- è¿æ¥ç®¡ç†","text":"HttpCilentè¿æ¥ç®¡ç† 2.1ã€æŒä¹…è¿æ¥ä»ä¸€ä¸ªä¸»æœºåˆ°å¦ä¸€ä¸ªä¸»æœºå»ºç«‹è¿æ¥çš„è¿‡ç¨‹éå¸¸å¤æ‚ï¼Œæ¶‰åŠä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´çš„å¤šä¸ªåˆ†ç»„äº¤æ¢ï¼Œè¿™å¯èƒ½éå¸¸è€—æ—¶ã€‚è¿æ¥æ¡æ‰‹çš„å¼€é”€å¯èƒ½å¾ˆå¤§ï¼Œå°¤å…¶æ˜¯å¯¹äºæ¯”è¾ƒå°çš„HTTPæ¶ˆæ¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å·²ç»å»ºç«‹å¥½çš„httpè¿æ¥æ¥æ‰§è¡Œå¤šä¸ªè¯·æ±‚ï¼Œåˆ™å¯ä»¥å®ç°æ›´é«˜çš„æ•°æ®ååé‡ã€‚ HTTP/1.1é»˜è®¤å°±æ”¯æŒHttpè¿æ¥å¤ç”¨ã€‚å…¼å®¹HTTP/1.0çš„ç»ˆç«¯ä¹Ÿå¯ä»¥é€šè¿‡å£°æ˜æ¥ä¿æŒè¿æ¥ï¼Œå®ç°è¿æ¥å¤ç”¨ã€‚HTTPä»£ç†ä¹Ÿå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…ä¿æŒè¿æ¥ä¸é‡Šæ”¾ï¼Œæ–¹ä¾¿åç»­å‘è¿™ä¸ªä¸»æœºå‘é€httpè¯·æ±‚ã€‚è¿™ç§ä¿æŒè¿æ¥ä¸é‡Šæ”¾çš„æƒ…å†µå®é™…ä¸Šæ˜¯å»ºç«‹çš„æŒä¹…è¿æ¥ã€‚HttpClientä¹Ÿæ”¯æŒæŒä¹…è¿æ¥ã€‚ 2.2ã€HTTPè¿æ¥è·¯ç”±HttpClientæ—¢å¯ä»¥ç›´æ¥ã€åˆå¯ä»¥é€šè¿‡å¤šä¸ªä¸­è½¬è·¯ç”±ï¼ˆhopsï¼‰å’Œç›®æ ‡æœåŠ¡å™¨å»ºç«‹è¿æ¥ - ä¹Ÿæˆä¸ºè·³ ã€‚HttpClientæŠŠè·¯ç”±åˆ†ä¸ºä¸‰ç§plainï¼ˆæ˜æ–‡ ï¼‰ï¼Œtunneledï¼ˆéš§é“ï¼‰å’Œlayeredï¼ˆåˆ†å±‚ï¼‰ã€‚éš§é“è¿æ¥ä¸­ä½¿ç”¨çš„å¤šä¸ªä¸­é—´ä»£ç†è¢«ç§°ä½œä»£ç†é“¾ã€‚ å®¢æˆ·ç«¯ç›´æ¥è¿æ¥åˆ°ç›®æ ‡ä¸»æœºæˆ–è€…åªé€šè¿‡äº†ä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œè¿™ç§å°±æ˜¯Plainè·¯ç”±ã€‚å®¢æˆ·ç«¯é€šè¿‡ç¬¬ä¸€ä¸ªä»£ç†å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ä»£ç†é“¾tunnellingï¼Œè¿™ç§æƒ…å†µå°±æ˜¯Tunneledè·¯ç”±ã€‚ä¸é€šè¿‡ä¸­é—´ä»£ç†çš„è·¯ç”±ä¸å¯èƒ½æ—¶tunneledè·¯ç”±ã€‚å®¢æˆ·ç«¯åœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„è¿æ¥ä¸Šè¿›è¡Œåè®®åˆ†å±‚ï¼Œè¿™æ ·å»ºç«‹èµ·æ¥çš„è·¯ç”±å°±æ˜¯layeredè·¯ç”±ã€‚åè®®åªèƒ½åœ¨éš§é“â€”&gt;ç›®æ ‡ä¸»æœºï¼Œæˆ–è€…ç›´æ¥è¿æ¥ï¼ˆæ²¡æœ‰ä»£ç†ï¼‰ï¼Œè¿™ä¸¤ç§é“¾è·¯ä¸Šè¿›è¡Œåˆ†å±‚ã€‚ 2.2.1ã€è·¯ç”±è®¡ç®— RouteInfoæ¥å£åŒ…å«äº†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ä¸»æœºè¿‡ç¨‹ä¸­ï¼Œç»è¿‡çš„è·¯ç”±ä¿¡æ¯ã€‚HttpRouteç±»ç»§æ‰¿äº†RouteInfoæ¥å£ï¼Œæ˜¯RouteInfoçš„å…·ä½“å®ç°ï¼Œè¿™ä¸ªç±»æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ã€‚HttpTrackerç±»ä¹Ÿå®ç°äº†RouteInfoæ¥å£ï¼Œå®ƒæ˜¯å¯å˜çš„ï¼ŒHttpClientä¼šåœ¨å†…éƒ¨ä½¿ç”¨è¿™ä¸ªç±»æ¥æ¢æµ‹åˆ°ç›®æ ‡ä¸»æœºçš„å‰©ä½™è·¯ç”±ã€‚HttpRouteDirectoræ˜¯ä¸ªè¾…åŠ©ç±»ï¼Œå¯ä»¥å¸®åŠ©è®¡ç®—æ•°æ®åŒ…çš„ä¸‹ä¸€æ­¥è·¯ç”±ä¿¡æ¯ã€‚è¿™ä¸ªç±»ä¹Ÿæ˜¯åœ¨HttpClientå†…éƒ¨ä½¿ç”¨çš„ã€‚ HttpRoutePlanneræ¥å£å¯ä»¥ç”¨æ¥è¡¨ç¤ºåŸºäºhttpä¸Šä¸‹æ–‡è®¡ç®—å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„å®Œæ•´è·¯ç”±ç­–ç•¥ã€‚HttpClientæœ‰ä¸¤ä¸ªHttpRoutePlannerçš„å®ç°ç±»ã€‚SystemDefaultRoutePlannerè¿™ä¸ªç±»åŸºäºjava.net.ProxySelectorï¼Œå®ƒé»˜è®¤ä½¿ç”¨jvmçš„ä»£ç†é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªé…ç½®ä¿¡æ¯ä¸€èˆ¬æ¥è‡ªç³»ç»Ÿé…ç½®æˆ–è€…æµè§ˆå™¨é…ç½®ã€‚DefaultProxyRoutePlannerè¿™ä¸ªç±»æ—¢ä¸ä½¿ç”¨javaæœ¬èº«çš„é…ç½®ï¼Œä¹Ÿä¸ä½¿ç”¨ç³»ç»Ÿæˆ–è€…æµè§ˆå™¨çš„é…ç½®ã€‚å®ƒé€šå¸¸é€šè¿‡é»˜è®¤ä»£ç†æ¥è®¡ç®—è·¯ç”±ä¿¡æ¯ã€‚ 2.2.2.ã€å®‰å…¨çš„HTTPè¿æ¥ å¦‚æœæœªç»æˆæƒçš„ç¬¬ä¸‰æ–¹æ— æ³•è¯»å–æˆ–ç¯¡æ”¹ä¸¤ä¸ªè¿æ¥ç«¯ç‚¹ä¹‹é—´ä¼ è¾“çš„ä¿¡æ¯ï¼Œåˆ™å¯ä»¥è®¤ä¸ºHTTPè¿æ¥æ˜¯å®‰å…¨çš„ã€‚SSL / TLSåè®®æ˜¯ç¡®ä¿HTTPä¼ è¾“å®‰å…¨æ€§çš„æœ€å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–åŠ å¯†æŠ€æœ¯ã€‚é€šå¸¸ï¼ŒHTTPä¼ è¾“é€šè¿‡SSL / TLSåŠ å¯†è¿æ¥åˆ†å±‚ã€‚ 2.3ã€HTTPè¿æ¥ç®¡ç†å™¨2.3.1. ç®¡ç†è¿æ¥å’Œè¿æ¥ç®¡ç†å™¨ HTTPè¿æ¥æ˜¯å¤æ‚çš„ï¼Œæœ‰çŠ¶æ€çš„ï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„å¯¹è±¡ï¼Œéœ€è¦æ­£ç¡®ç®¡ç†æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚HTTPè¿æ¥åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½ç”±ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ä½¿ç”¨ã€‚HttpClientä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šå®ä½“æ¥ç®¡ç†å¯¹HTTPè¿æ¥çš„è®¿é—®ï¼Œç§°ä¸ºHTTPè¿æ¥ç®¡ç†å™¨ï¼Œå¹¶ç”±HttpClientConnectionManageræ¥å£è¡¨ç¤º ã€‚ HTTPè¿æ¥ç®¡ç†å™¨çš„ç›®çš„æ˜¯å……å½“æ–°HTTPè¿æ¥çš„å·¥å‚ï¼Œç®¡ç†æŒä¹…è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠåŒæ­¥å¯¹æŒä¹…è¿æ¥çš„è®¿é—®ï¼Œç¡®ä¿åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¿æ¥ã€‚å†…éƒ¨HTTPè¿æ¥ç®¡ç†å™¨ä½¿ç”¨çš„å®ä¾‹ManagedHttpClientConnectionå……å½“ç®¡ç†è¿æ¥çŠ¶æ€çš„å®é™…è¿æ¥çš„ä»£ç†å¹¶æ§åˆ¶I / Oæ“ä½œçš„æ‰§è¡Œï¼Œå¦‚æœHttpè¿æ¥è¢«é‡Šæ”¾æˆ–ç”±å…¶ä½¿ç”¨è€…æ˜¾å¼å…³é—­,ï¼Œåˆ™åº•å±‚è¿æ¥å°†ä»å…¶ä»£ç†ä¸­åˆ†ç¦»å¹¶è¿”å›ç»™ç®¡ç†å™¨ã€‚å³ä½¿æœåŠ¡ä½¿ç”¨è€…ä»ç„¶æ‹¥æœ‰å¯¹ä»£ç†å®ä¾‹çš„å¼•ç”¨ï¼Œå®ƒä¹Ÿä¸èƒ½å†æ‰§è¡Œä»»ä½•I / Oæ“ä½œæˆ–æ›´æ”¹è¿æ¥çš„çŠ¶æ€ã€‚ ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä»è¿æ¥ç®¡ç†å™¨ä¸­å–å¾—ä¸€ä¸ªhttpè¿æ¥ï¼š 1234567891011121314151617HttpClientContext context = HttpClientContext.create();HttpClientConnectionManager connMrg = new BasicHttpClientConnectionManager();HttpRoute route = new HttpRoute(new HttpHost(\"www.baidu.com\", 80));// è·å–æ–°çš„è¿æ¥. è¿™é‡Œå¯èƒ½è€—è´¹å¾ˆå¤šæ—¶é—´ConnectionRequest connRequest =connMrg.requestConnection(route, null);//ç­‰å¾…10ç§’ è¶…æ—¶HttpClientConnection conn = connRequest.get(10, TimeUnit.SECONDS);try { // å¦‚æœåˆ›å»ºè¿æ¥å¤±è´¥ if(!conn.isOpen()) { connMrg.connect(conn, route, 1000, context); connMrg.routeComplete(conn, route, context); } // è¿›è¡Œè‡ªå·±çš„æ“ä½œ...}finally { connMrg.releaseConnection(conn, null, 1, TimeUnit.MINUTES);} å¦‚æœè¦ç»ˆæ­¢è¿æ¥ï¼Œå¯ä»¥è°ƒç”¨ConnectionRequestçš„cancel()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè§£é™¤è¢«ConnectionRequestç±»get()æ–¹æ³•é˜»å¡çš„çº¿ç¨‹ã€‚ 2.3.2.ç®€å•è¿æ¥ç®¡ç†å™¨ BasicHttpClientConnectionManageræ˜¯ä¸ªç®€å•çš„è¿æ¥ç®¡ç†å™¨ï¼Œå®ƒä¸€æ¬¡åªèƒ½ç»´æŠ¤ä¸€ä¸ªè¿æ¥ã€‚å°½ç®¡è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒåœ¨åŒä¸€æ—¶é—´ä¹Ÿåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚BasicHttpClientConnectionManagerä¼šå°½é‡é‡ç”¨æ—§çš„è¿æ¥æ¥å‘é€åç»­çš„è¯·æ±‚ï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸åŒçš„è·¯ç”±ã€‚å¦‚æœåç»­è¯·æ±‚çš„è·¯ç”±å’Œæ—§è¿æ¥ä¸­çš„è·¯ç”±ä¸åŒ¹é…ï¼ŒBasicHttpClientConnectionManagerå°±ä¼šå…³é—­å½“å‰è¿æ¥ï¼Œä½¿ç”¨è¯·æ±‚ä¸­çš„è·¯ç”±é‡æ–°å»ºç«‹è¿æ¥ã€‚å¦‚æœå½“å‰çš„è¿æ¥æ­£åœ¨è¢«å ç”¨ï¼Œä¼šæŠ›å‡ºjava.lang.IllegalStateExceptionå¼‚å¸¸ã€‚ 2.3.3ã€è¿æ¥æ± ç®¡ç†å™¨ PoolingHttpClientConnectionManageræ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„å®ç°ï¼Œå®ƒç®¡ç†å®¢æˆ·ç«¯è¿æ¥æ± ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸ºæ¥è‡ªå¤šä¸ªæ‰§è¡Œçº¿ç¨‹çš„è¿æ¥è¯·æ±‚æä¾›æœåŠ¡ã€‚è¿æ¥ä»¥æ¯ä¸ªè·¯ç”±ä¸ºåŸºç¡€è¿›è¡Œæ± åŒ–ã€‚ç®¡ç†å‘˜å·²ç»åœ¨æ± ä¸­æä¾›æŒä¹…è¿æ¥çš„è·¯ç”±è¯·æ±‚å°†é€šè¿‡ä»æ± ç§Ÿç”¨è¿æ¥è€Œä¸æ˜¯åˆ›å»ºå…¨æ–°è¿æ¥æ¥è¿›è¡ŒæœåŠ¡ã€‚ PoolingHttpClientConnectionManagerç»´æŠ¤çš„è¿æ¥æ•°åœ¨æ¯ä¸ªè·¯ç”±åŸºç¡€å’Œæ€»æ•°ä¸Šéƒ½æœ‰é™åˆ¶ã€‚é»˜è®¤ï¼Œæ¯ä¸ªè·¯ç”±åŸºç¡€ä¸Šçš„è¿æ¥ä¸è¶…è¿‡2ä¸ªï¼Œæ€»è¿æ¥æ•°ä¸èƒ½è¶…è¿‡20ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªé™åˆ¶å¯èƒ½ä¼šå¤ªå°äº†ï¼Œå°¤å…¶æ˜¯å½“æœåŠ¡ä¹Ÿä½¿ç”¨Httpåè®®æ—¶ã€‚ æ­¤ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•è°ƒæ•´è¿æ¥æ± å‚æ•°ï¼š 12345678910111213PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();//å°†æœ€å¤§æ€»è¿æ¥æ•°å¢åŠ åˆ°200cm.setMaxTotal(200);//å°†æ¯æ¡è·¯ç”±çš„é»˜è®¤æœ€å¤§è¿æ¥æ•°å¢åŠ åˆ°20 cm.setDefaultMaxPerRoute(20);//å°†ç›®æ ‡ä¸»æœºçš„æœ€å¤§è¿æ¥æ•°å¢åŠ åˆ°50HttpHost localhost = new HttpHost(\"localhost\", 80);cm.setMaxPerRoute(new HttpRoute(localhost), 50);CloseableHttpClient httpclient = HttpClients.custom().setConnectionManager(cm).build();} 2.3.4.å…³é—­è¿æ¥ç®¡ç†å™¨ å½“ä¸€ä¸ªHttpClientçš„å®ä¾‹ä¸åœ¨ä½¿ç”¨ï¼Œæˆ–è€…å·²ç»è„±ç¦»å®ƒçš„ä½œç”¨èŒƒå›´ï¼Œæˆ‘ä»¬éœ€è¦å…³æ‰å®ƒçš„è¿æ¥ç®¡ç†å™¨ï¼Œæ¥å…³é—­æ‰æ‰€æœ‰çš„è¿æ¥ï¼Œé‡Šæ”¾æ‰è¿™äº›è¿æ¥å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚ 12CloseableHttpClient httpClient = &lt;...&gt;httpClient.close(); 2.4ã€å¤šçº¿ç¨‹è¯·æ±‚æ‰§è¡Œå½“ä½¿ç”¨äº†è¯·æ±‚è¿æ¥æ± ç®¡ç†å™¨ï¼ˆæ¯”å¦‚PoolingClientConnectionManagerï¼‰åï¼ŒHttpClientå°±å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„è¯·æ±‚äº†ã€‚ PoolingClientConnectionManagerä¼šæ ¹æ®å®ƒçš„é…ç½®æ¥åˆ†é…è¯·æ±‚è¿æ¥ã€‚å¦‚æœè¿æ¥æ± ä¸­çš„æ‰€æœ‰è¿æ¥éƒ½è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆåç»­çš„è¯·æ±‚å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰è¿æ¥è¢«é‡Šæ”¾å›è¿æ¥æ± ä¸­ã€‚ä¸ºäº†é˜²æ­¢æ°¸è¿œé˜»å¡çš„æƒ…å†µå‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥æŠŠhttp.conn-manager.timeoutçš„å€¼è®¾ç½®æˆä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œæ²¡æœ‰å¯ç”¨è¿æ¥ï¼Œå°±ä¼šæŠ›å‡ºConnectionPoolTimeoutExceptionå¼‚å¸¸ã€‚ 1234567891011121314151617181920212223242526PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();CloseableHttpClient httpClient = HttpClients.custom() .setConnectionManager(cm) .build();//è¦æ‰§è¡ŒGETçš„URIString[] uriToGet = { \"http://www.baidu.com/\", \"http://www.qq.com/\", \"http://www.sohu.com/\", \"http://www.sina.com.cn/\"};//ä¸ºæ¯ä¸ªurlåˆ›å»ºä¸€ä¸ªçº¿ç¨‹GetThread[] threads = new GetThread[uriToGet.length];for(int i = 0; i&lt;threads.length; i++) { HttpGet httpget = new HttpGet(uriToGet[i]); threads[i] = new GetThread(httpClient, httpget);}//å¯åŠ¨çº¿ç¨‹for(int j = 0; j&lt;threads.length;j++) { threads[j].start();}for (int j = 0; j &lt; threads.length; j++) { threads[j].join();} è™½ç„¶HttpClientå®ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªæ‰§è¡Œçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œä½†å¼ºçƒˆå»ºè®®æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤è‡ªå·±çš„ä¸“ç”¨å®ä¾‹HttpContextã€‚ 12345678910111213141516171819202122232425262728public class GetThread extends Thread { private final CloseableHttpClient httpClient; private final HttpContext context; private final HttpGet httpget; public GetThread(CloseableHttpClient httpClient, HttpGet httpget) { this.httpClient = httpClient; this.context = HttpClientContext.create(); this.httpget = httpget; } @Override public void run() { try { CloseableHttpResponse response = httpClient.execute(httpget, context); try { HttpEntity entity = response.getEntity(); //EntityUtils.consume(entity); }finally { response.close(); } }catch(ClientProtocolException ex) { // Handle protocol errors }catch(IOException e) { // Handle I/O errors } }} 2.5ã€è¿æ¥å›æ”¶ç­–ç•¥ç»å…¸é˜»å¡I / Oæ¨¡å‹çš„ä¸»è¦ç¼ºç‚¹ä¹‹ä¸€æ˜¯ç½‘ç»œå¥—æ¥å­—åªæœ‰åœ¨I / Oæ“ä½œä¸­è¢«é˜»å¡æ—¶æ‰èƒ½å¯¹I / Oäº‹ä»¶ä½œå‡ºååº”ã€‚å½“è¿æ¥é‡Šæ”¾å›ç®¡ç†å™¨æ—¶ï¼Œå®ƒå¯ä»¥ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œä½†å®ƒæ— æ³•ç›‘è§†å¥—æ¥å­—çš„çŠ¶æ€å¹¶å¯¹ä»»ä½•I / Oäº‹ä»¶åšå‡ºååº”ã€‚å¦‚æœè¿æ¥åœ¨æœåŠ¡å™¨ç«¯å…³é—­ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¹Ÿæ— æ³•æ£€æµ‹åˆ°è¿æ¥çŠ¶æ€çš„å˜åŒ–ï¼ˆä¹Ÿå°±æ— æ³•æ ¹æ®è¿æ¥çŠ¶æ€çš„å˜åŒ–ï¼Œå…³é—­æœ¬åœ°çš„socketï¼‰ã€‚ HttpClientä¸ºäº†ç¼“è§£æ­¤é—®é¢˜å¸¦æ¥çš„å½±å“ï¼Œä¼šåœ¨ä½¿ç”¨æŸä¸ªè¿æ¥å‰ï¼Œç›‘æµ‹è¿™ä¸ªè¿æ¥æ˜¯å¦å·²ç»è¿‡æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯å…³é—­äº†è¿æ¥ï¼Œé‚£ä¹ˆè¿æ¥å°±ä¼šå¤±æ•ˆã€‚è¿™ç§è¿‡æ—¶æ£€æŸ¥å¹¶ä¸æ˜¯100%æœ‰æ•ˆï¼Œå¹¶ä¸”ä¼šç»™æ¯ä¸ªè¯·æ±‚å¢åŠ 10åˆ°30æ¯«ç§’é¢å¤–å¼€é”€ã€‚å”¯ä¸€å¯è¡Œçš„åŠæ³•æ˜¯å»ºç«‹ä¸€ä¸ªç›‘æ§çº¿ç¨‹ï¼Œæ¥ä¸“é—¨å›æ”¶ç”±äºé•¿æ—¶é—´ä¸æ´»åŠ¨è€Œè¢«åˆ¤å®šä¸ºå¤±æ•ˆçš„è¿æ¥ã€‚è¿™ä¸ªç›‘æ§çº¿ç¨‹å¯ä»¥å‘¨æœŸæ€§çš„è°ƒç”¨ClientConnectionManagerç±»çš„closeExpiredConnections()æ–¹æ³•æ¥å…³é—­è¿‡æœŸçš„è¿æ¥ï¼Œå›æ”¶è¿æ¥æ± ä¸­è¢«å…³é—­çš„è¿æ¥ã€‚å®ƒä¹Ÿå¯ä»¥é€‰æ‹©æ€§çš„è°ƒç”¨ClientConnectionManagerç±»çš„closeIdleConnections()æ–¹æ³•æ¥å…³é—­ä¸€æ®µæ—¶é—´å†…ä¸æ´»åŠ¨çš„è¿æ¥ã€‚ 1234567891011121314151617181920212223242526272829303132public class IdleConnectionMonitorThread extends Thread { private final HttpClientConnectionManager connMgr; private volatile boolean shutdown; public IdleConnectionMonitorThread(HttpClientConnectionManager connMgr) { super(); this.connMgr = connMgr; } public void run() { try { while(!shutdown) { synchronized (this) { wait(5000); //å…³é—­è¿‡æœŸçš„è¿æ¥ connMgr.closeExpiredConnections(); //å¯é€‰çš„ï¼Œå…³é—­é—²ç½®æ—¶é—´è¶…è¿‡30ç§’çš„è¿æ¥ connMgr.closeIdleConnections(30, TimeUnit.SECONDS); } } }catch(InterruptedException ex) { } } public void shutdown() { shutdown = true; synchronized (this) { notifyAll(); } }} 2.6ã€è¿æ¥å­˜æ´»ç­–ç•¥Httpè§„èŒƒæ²¡æœ‰è§„å®šä¸€ä¸ªæŒä¹…è¿æ¥åº”è¯¥ä¿æŒå¤šé•¿æ—¶é—´ã€‚æœ‰äº›HttpæœåŠ¡å™¨ä½¿ç”¨éæ ‡å‡†çš„Keep-Aliveå¤´æ¶ˆæ¯å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œé€šçŸ¥æœåŠ¡å™¨ç«¯æ‰“ç®—ä¿æŒè¿æ¥çš„æ—¶é—´æ®µã€‚å¦‚æœå¯ç”¨ï¼ŒHttpClientä¼šåˆ©ç”¨è¿™ä¸ªå¤´æ¶ˆæ¯ã€‚å¦‚æœæœåŠ¡å™¨è¿”å›çš„å“åº”ä¸­æ²¡æœ‰åŒ…å«Keep-Aliveå¤´æ¶ˆæ¯ï¼ŒHttpClientä¼šè®¤ä¸ºè¿™ä¸ªè¿æ¥å¯ä»¥æ°¸è¿œä¿æŒã€‚ç„¶è€Œï¼Œå¾ˆå¤šæœåŠ¡å™¨éƒ½ä¼šåœ¨ä¸é€šçŸ¥å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œå…³é—­ä¸€å®šæ—¶é—´å†…ä¸æ´»åŠ¨çš„è¿æ¥ï¼Œæ¥èŠ‚çœæœåŠ¡å™¨èµ„æºã€‚åœ¨æŸäº›æƒ…å†µä¸‹é»˜è®¤çš„ç­–ç•¥æ˜¾å¾—å¤ªä¹è§‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå®šä¹‰è¿æ¥å­˜æ´»ç­–ç•¥ã€‚ 12345678910111213141516171819202122232425262728ConnectionKeepAliveStrategy mystrategy = new ConnectionKeepAliveStrategy() { @Override public long getKeepAliveDuration(HttpResponse response, HttpContext context) { HeaderElementIterator it = new BasicHeaderElementIterator(response.headerIterator(HTTP.CONN_KEEP_ALIVE)); while(it.hasNext()) { HeaderElement he = it.nextElement(); String param = he.getName(); String value = he.getValue(); if(value!=null &amp;&amp; param.equalsIgnoreCase(\"timeout\")) { try { return Long.parseLong(value) * 1000; }catch(NumberFormatException ignore) { } } } HttpHost target = (HttpHost) context.getAttribute(HttpClientContext.HTTP_TARGET_HOST); if(\"www.naught-server.com\".equalsIgnoreCase(target.getHostName())){ return 5 * 1000; }else { return 30 * 1000; } }};CloseableHttpClient client = HttpClients.custom() .setKeepAliveStrategy(mystrategy) .build(); 2.7ã€è¿æ¥å¥—æ¥å­—å·¥å‚HTTPè¿æ¥ä½¿ç”¨java.net.Socketå¯¹è±¡æ¥å¤„ç†é€šè¿‡çº¿è·¯çš„æ•°æ®ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¾èµ–äºConnectionSocketFactoryæ¥å£æ¥åˆ›å»ºï¼Œåˆå§‹åŒ–å’Œè¿æ¥å¥—æ¥å­—ã€‚è¿™ä½¿HttpClientçš„ç”¨æˆ·èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æä¾›ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å¥—æ¥å­—åˆå§‹åŒ–ä»£ç ã€‚PlainConnectionSocketFactoryæ˜¯åˆ›å»ºå’Œåˆå§‹åŒ–æ™®é€šï¼ˆæœªåŠ å¯†ï¼‰å¥—æ¥å­—çš„é»˜è®¤å·¥å‚ã€‚ åˆ›å»ºsocketå’Œä½¿ç”¨socketè¿æ¥åˆ°ç›®æ ‡ä¸»æœºè¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿æ¥å‘ç”Ÿé˜»å¡æ—¶ï¼Œå…³é—­socketè¿æ¥ã€‚ 1234567HttpClientContext cleintContext = HttpClientContext.create();PlainConnectionSocketFactory sf = PlainConnectionSocketFactory.getSocketFactory();Socket socket = sf.createSocket(cleintContext);int timout = 1000;HttpHost target = new HttpHost(\"localhost\");InetSocketAddress remoteAddress = new InetSocketAddress(InetAddress.getByAddress(new byte[] {127,0,0,1}), 80);sf.connectSocket(timout, socket, target, remoteAddress, null, cleintContext); 2.7.1.å®‰å…¨SOCKETåˆ†å±‚ LayeredConnectionSocketFactoryæ˜¯ConnectionSocketFactoryçš„æ‹“å±•æ¥å£ã€‚åˆ†å±‚å¥—æ¥å­—å·¥å‚èƒ½å¤Ÿåœ¨ç°æœ‰çš„æ™®é€šå¥—æ¥å­—ä¸Šåˆ›å»ºåˆ†å±‚çš„å¥—æ¥å­—ã€‚å¥—æ¥å­—åˆ†å±‚ä¸»è¦ç”¨äºé€šè¿‡ä»£ç†åˆ›å»ºå®‰å…¨å¥—æ¥å­—ã€‚HttpClienté™„å¸¦äº†SSLSocketFactoryå®ç°SSL / TLSåˆ†å±‚çš„åŠŸèƒ½ã€‚è¯·æ³¨æ„ï¼ŒHttpClientä¸ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰åŠ å¯†åŠŸèƒ½ã€‚å®ƒå®Œå…¨ä¾èµ–äºæ ‡å‡†JavaåŠ å¯†ï¼ˆJCEï¼‰å’Œå®‰å…¨å¥—æ¥å­—ï¼ˆJSEEï¼‰æ‰©å±•ã€‚ 2.7.2.ä¸è¿æ¥ç®¡ç†å™¨é›†æˆ è‡ªå®šä¹‰çš„socketå·¥å‚ç±»å¯ä»¥å’ŒæŒ‡å®šçš„åè®®ï¼ˆHttpã€Httpsï¼‰è”ç³»èµ·æ¥ï¼Œç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰çš„è¿æ¥ç®¡ç†å™¨ã€‚ 1234567891011PlainConnectionSocketFactory plainsf = &lt;...&gt; LayeredConnectionSocketFactory layersf = &lt;...&gt; Registry&lt;ConnectionSocketFactory&gt; r = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create() .register(\"http\", plainsf) .register(\"https\", layersf) .build();HttpClientConnectionManager cm = new PoolingHttpClientConnectionManager(r);HttpClients.custom() .setConnectionManager(cm) .build(); 2.7.3.SSL/TLSå®šåˆ¶ HttpClientä½¿ç”¨SSLSocketFactoryæ¥åˆ›å»ºsslè¿æ¥ã€‚SSLSocketFactoryå…è®¸ç”¨æˆ·é«˜åº¦å®šåˆ¶ã€‚å®ƒå¯ä»¥æ¥å—javax.net.ssl.SSLContextè¿™ä¸ªç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°ï¼Œæ¥åˆ›å»ºè‡ªå®šä¹‰çš„sslè¿æ¥ã€‚ 12345HttpClientContext clientContext = HttpClientContext.create();KeyStore keystore = KeyStore.getInstance(\"jks\");SSLContext sslContext = SSLContexts.custom() .loadTrustMaterial(keystore, new TrustSelfSignedStrategy()) .build(); 2.7.4.ä¸»æœºåéªŒè¯ é™¤äº†åœ¨SSL / TLSåè®®å±‚ä¸Šæ‰§è¡Œçš„ä¿¡ä»»éªŒè¯å’Œå®¢æˆ·ç«¯èº«ä»½éªŒè¯ä¹‹å¤–ï¼Œä¸€æ—¦å»ºç«‹è¿æ¥ï¼ŒHttpClientå¯ä»¥é€‰æ‹©æ€§åœ°éªŒè¯ç›®æ ‡ä¸»æœºåæ˜¯å¦ä¸å­˜å‚¨åœ¨æœåŠ¡å™¨çš„X.509è¯ä¹¦ä¸­çš„åç§°åŒ¹é…ã€‚æ­¤éªŒè¯å¯ä»¥ä¸ºæœåŠ¡å™¨ä¿¡ä»»æä¾›é¢å¤–ä¿è¯ã€‚javax.net.ssl.HostnameVerifieræ¥å£ä»£è¡¨ä¸»æœºåéªŒè¯çš„ç­–ç•¥ã€‚HttpClienté™„å¸¦ä¸¤ä¸ª javax.net.ssl.HostnameVerifierå®ç°ã€‚é‡è¦æç¤ºï¼šä¸åº”å°†ä¸»æœºåéªŒè¯ä¸SSLä¿¡ä»»éªŒè¯æ··æ·†ã€‚ DefaultHostnameVerifierï¼šHttpClientä½¿ç”¨çš„é»˜è®¤å®ç°ï¼Œä¸»æœºåå¿…é¡»ä¸è¯ä¹¦æŒ‡å®šçš„ä»»ä½•æ›¿ä»£åç§°åŒ¹é…ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰æ›¿ä»£åç§°ï¼Œåˆ™ä¸ºè¯ä¹¦ä¸»é¢˜çš„æœ€å…·ä½“CNã€‚é€šé…ç¬¦å¯ä»¥å‡ºç°åœ¨CNå’Œä»»ä½•ä¸»é¢˜ä¸­ã€‚ NoopHostnameVerifierï¼šæ­¤ä¸»æœºåéªŒè¯ç¨‹åºå®è´¨ä¸Šå…³é—­ä¸»æœºåéªŒè¯ã€‚å®ƒæ¥å—ä»»ä½•SSLä¼šè¯ä½œä¸ºæœ‰æ•ˆå¹¶åŒ¹é…ç›®æ ‡ä¸»æœºã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒHttpClientä½¿ç”¨è¯¥DefaultHostnameVerifier å®ç°ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥æŒ‡å®šä¸åŒçš„ä¸»æœºåéªŒè¯å™¨å®ç°ã€‚ 1234SSLContext sslContext = SSLContexts.createSystemDefault();SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory( sslContext, NoopHostnameVerifier.INSTANCE); ä»ç‰ˆæœ¬4.4å¼€å§‹ï¼ŒHttpClientä½¿ç”¨ç”±Mozilla Foundationå‹å¥½ç»´æŠ¤çš„å…¬å…±åç¼€åˆ—è¡¨ï¼Œä»¥ç¡®ä¿SSLè¯ä¹¦ä¸­çš„é€šé…ç¬¦ä¸ä¼šè¢«æ»¥ç”¨ä»¥åº”ç”¨äºå…·æœ‰å…¬å…±é¡¶çº§åŸŸçš„å¤šä¸ªåŸŸã€‚HttpClienté™„å¸¦äº†åœ¨å‘å¸ƒæ—¶æ£€ç´¢çš„åˆ—è¡¨çš„å‰¯æœ¬ã€‚è¯¥åˆ—è¡¨çš„æœ€æ–°ç‰ˆæœ¬å¯åœ¨https://publicsuffix.org/list/æ‰¾åˆ° ã€‚å»ºè®®æ¯å¤©ä¸‹è½½ä¸€æ¬¡åˆ—è¡¨åˆ°æœ¬åœ°å‰¯æœ¬ã€‚ 123PublicSuffixMatcher publicSuffixMatcher = PublicSuffixMatcherLoader.load( PublicSuffixMatcher.class.getResource(\"my-copy-effective_tld_names.dat\"));DefaultHostnameVerifier hostnameVerifier = new DefaultHostnameVerifier(publicSuffixMatcher); å¯ä»¥ä½¿ç”¨nullç¦ç”¨å¯¹å…¬å…±æœåŠ¡åˆ—è¡¨çš„éªŒè¯ ã€‚ 1DefaultHostnameVerifier hostnameVerifier = new DefaultHostnameVerifier(publicSuffixMatcher); 2.8ã€HttpClientä»£ç†é…ç½®å°½ç®¡HttpClientçŸ¥é“å¤æ‚çš„è·¯ç”±æ–¹æ¡ˆå’Œä»£ç†é“¾ï¼Œå®ƒä¹Ÿæ”¯æŒå¼€ç®±å³ç”¨çš„ç®€å•ç›´æ¥æˆ–ä¸€è·³ä»£ç†è¿æ¥ã€‚ ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ï¼ŒæŒ‡å®šä¸€ä¸ªé»˜è®¤çš„proxyå‚æ•°ã€‚ 12345HttpHost proxy = new HttpHost(\"someproxy\", 8080);DefaultProxyRoutePlanner routePlanner = new DefaultProxyRoutePlanner(proxy);CloseableHttpClient httpClient = HttpClients.custom() .setRoutePlanner(routePlanner) .build(); è¿˜å¯ä»¥æŒ‡ç¤ºHttpClientä½¿ç”¨æ ‡å‡†JREä»£ç†é€‰æ‹©å™¨æ¥è·å–ä»£ç†ä¿¡æ¯ï¼š 12345SystemDefaultRoutePlanner routePlanner = new SystemDefaultRoutePlanner( ProxySelector.getDefault());CloseableHttpClient httpClient = HttpClients.custom() .setRoutePlanner(routePlanner) .build(); æˆ–è€…ï¼Œå¯ä»¥æä¾›è‡ªå®šä¹‰RoutePlanner å®ç°ï¼Œä»¥ä¾¿å®Œå…¨æ§åˆ¶HTTPè·¯ç”±è®¡ç®—çš„è¿‡ç¨‹ï¼š 1234567891011HttpRoutePlanner routePlanner = new HttpRoutePlanner() { @Override public HttpRoute determineRoute(HttpHost target, HttpRequest request, HttpContext context) throws HttpException { return new HttpRoute(target, null, new HttpHost(\"someproxy\", 8080), \"https\".equalsIgnoreCase(target.getSchemeName())); }};CloseableHttpClient httpClient = HttpClients.custom() .setRoutePlanner(routePlanner) .build(); å‚è€ƒï¼šhttp://hc.apache.org/httpcomponents-client-4.5.x/tutorial/html/connmgmt.html#d5e405","link":"/2018/10/19/java/httpclient/HttpClient%EF%BC%88%E4%BA%8C%EF%BC%89-%20%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86/"},{"title":"HttpClientï¼ˆä¸‰ï¼‰- HTTPçŠ¶æ€ç®¡ç†","text":"HTTPçŠ¶æ€ç®¡ç† æœ€åˆï¼ŒHTTPè¢«è®¾è®¡ä¸ºä¸€ç§æ— çŠ¶æ€çš„ï¼Œé¢å‘è¯·æ±‚/å“åº”çš„åè®®ï¼Œå®ƒæ²¡æœ‰å¯¹è·¨è¶Šå‡ ä¸ªé€»è¾‘ç›¸å…³çš„è¯·æ±‚/å“åº”äº¤æ¢çš„æœ‰çŠ¶æ€ä¼šè¯åšå‡ºç‰¹æ®Šè§„å®šã€‚éšç€HTTPåè®®çš„æ™®åŠå’Œé‡‡ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿå¼€å§‹å°†å…¶ç”¨äºåº”ç”¨ç¨‹åºï¼Œå®ƒä»æœªæ‰“ç®—ç”¨äºä¾‹å¦‚ç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºçš„ä¼ è¾“ã€‚å› æ­¤ï¼Œå¯¹çŠ¶æ€ç®¡ç†çš„æ”¯æŒæˆä¸ºå¿…è¦ã€‚ Netscape Communicationså½“æ—¶æ˜¯Webå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è½¯ä»¶çš„é¢†å…ˆå¼€å‘å•†ï¼Œå®ƒåŸºäºä¸“æœ‰è§„èŒƒåœ¨å…¶äº§å“ä¸­å®ç°äº†å¯¹HTTPçŠ¶æ€ç®¡ç†çš„æ”¯æŒã€‚åæ¥ï¼ŒNetscapeå°è¯•é€šè¿‡å‘å¸ƒè§„èŒƒè‰æ¡ˆæ¥æ ‡å‡†åŒ–è¯¥æœºåˆ¶ã€‚è¿™äº›åŠªåŠ›ä¿ƒæˆäº†é€šè¿‡RFCæ ‡å‡†è½¨é“å®šä¹‰çš„æ­£å¼è§„èŒƒã€‚ä½†æ˜¯ï¼Œå¤§é‡åº”ç”¨ç¨‹åºä¸­çš„çŠ¶æ€ç®¡ç†ä»ç„¶ä¸»è¦åŸºäºNetscapeè‰æ¡ˆï¼Œå¹¶ä¸”ä¸å®˜æ–¹è§„èŒƒä¸å…¼å®¹ã€‚Webæµè§ˆå™¨çš„æ‰€æœ‰ä¸»è¦å¼€å‘äººå‘˜éƒ½è¢«è¿«å…¼å®¹è¿™ä¸¤ç§åè®®ï¼Œè¿™æå¤§åœ°ä¿ƒæˆäº†æ ‡å‡†åˆè§„æ€§çš„ç¢ç‰‡åŒ–ã€‚ 3.1ã€HTTP cookieHTTP cookieæ˜¯HTTPä»£ç†å’Œç›®æ ‡æœåŠ¡å™¨å¯ä»¥äº¤æ¢ä»¥ç»´æŒä¼šè¯çš„ä»¤ç‰Œæˆ–çŸ­çŠ¶æ€ä¿¡æ¯åŒ…ã€‚Netscapeçš„å·¥ç¨‹å¸ˆè¿‡å»å¸¸æŠŠå®ƒç§°ä¸ºâ€œmagic cookieâ€ã€‚ HttpClientä½¿ç”¨Cookieæ¥å£æ¥è¡¨ç¤ºæŠ½è±¡cookieã€‚åœ¨å…¶æœ€ç®€å•çš„å½¢å¼ä¸­ï¼ŒHTTP cookieä»…ä»…æ˜¯åç§°/å€¼å¯¹ã€‚é€šå¸¸ï¼ŒHTTP cookieè¿˜åŒ…å«è®¸å¤šå±æ€§ï¼Œä¾‹å¦‚æœ‰æ•ˆçš„åŸŸï¼Œç‰ˆæœ¬å·ï¼Œä¸€ä¸ªæŒ‡å®šæ­¤cookieé€‚ç”¨çš„æºæœåŠ¡å™¨ä¸Šçš„URLå­é›†çš„è·¯å¾„ï¼Œä»¥åŠcookieæœ‰æ•ˆæœŸã€‚ SetCookieæ¥å£è¡¨ç¤ºç”±æœåŠ¡å™¨å‘ç»™HTTPä»£ç†çš„ä¸€ä¸ªSet-Cookieå“åº”å¤´ï¼Œä»¥ç»´æŒä¸€ä¸ªä¼šè¯çŠ¶æ€ã€‚SetCookie2æ¥å£å¯¹SetCookieæ¥å£è¿›è¡Œäº†æ‹“å±•ï¼Œæ·»åŠ äº†Set-Cookie2æ–¹æ³•ã€‚ ClientCookieæ¥å£ç»§æ‰¿äº†Cookieæ¥å£ï¼Œå¹¶è¿›è¡Œäº†åŠŸèƒ½æ‰©å±•ï¼Œä¾‹å¦‚èƒ½å¤Ÿå–å‡ºæœåŠ¡å™¨å‘é€æ¥çš„åŸå§‹cookieå±æ€§ã€‚è¿™å¯¹äºç”ŸæˆCookie æ ‡å¤´å¾ˆé‡è¦ï¼Œå› ä¸ºæŸäº›cookieè§„èŒƒè¦æ±‚ Cookie è¢«æŒ‡å®šä¸ºSet-Cookieæ—¶æ‰åº”åŒ…å«æŸäº›ç‰¹å®šçš„å±æ€§ ã€‚ 1234567BasicClientCookie cookie = new BasicClientCookie(\"name\", \"value\");//è®¾ç½®æœ‰æ•ˆçš„åŸŸå’Œè·¯å¾„å±æ€§cookie.setDomain(\".mycompany.com\");cookie.setPath(\"/\");//è®¾ç½®æœåŠ¡å™¨å‘é€çš„å±æ€§cookie.setAttribute(ClientCookie.PATH_ATTR, \"/\");cookie.setAttribute(ClientCookie.DOMAIN_ATTR, \".mycompany.com\"); 3.2ã€Cookieè§„èŒƒCookieSpecæ¥å£ä»£è¡¨äº†Cookieç®¡ç†è§„èŒƒã€‚Cookieç®¡ç†è§„èŒƒè§„å®šäº†ï¼š è§£æSet-Cookieæ ‡å¤´çš„è§„åˆ™ã€‚ è§£æcookieçš„éªŒè¯è§„åˆ™ã€‚ å°†ç»™å®šä¸»æœºåï¼Œç«¯å£å’ŒåŸå§‹è·¯å¾„æ ¼å¼åŒ–æˆCookie`çš„æ ‡å¤´ã€‚ HttpClienté™„å¸¦äº†å‡ ä¸ªCookieSpec å®ç°ï¼š Standard strictï¼šçŠ¶æ€ç®¡ç†ç­–ç•¥ï¼Œç¬¦åˆRFC 6265ç¬¬4èŠ‚å®šä¹‰çš„è‰¯å¥½è¡Œä¸ºçš„é…ç½®æ–‡ä»¶çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚ Standardï¼šçŠ¶æ€ç®¡ç†ç­–ç•¥ï¼Œç¬¦åˆRFC 6265å®šä¹‰çš„æ›´å®½æ¾çš„é…ç½®æ–‡ä»¶ï¼Œç¬¬4èŠ‚æ—¨åœ¨ä¸ä¸ç¬¦åˆè‰¯å¥½è¡Œä¸ºçš„é…ç½®æ–‡ä»¶çš„ç°æœ‰æœåŠ¡å™¨è¿›è¡Œäº’æ“ä½œã€‚ Netscape draft (obsolete)ï¼šæ­¤æ”¿ç­–ç¬¦åˆNetscape Communicationså‘å¸ƒçš„åŸå§‹è‰æ¡ˆè§„èŒƒã€‚é™¤éç»å¯¹æœ‰å¿…è¦ä¸é—ç•™ä»£ç å…¼å®¹ï¼Œå¦åˆ™åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚ RFC 2965 (obsolete)ï¼šç¬¦åˆRFC 2965 å®šä¹‰çš„è¿‡æ—¶çŠ¶æ€ç®¡ç†è§„èŒƒçš„çŠ¶æ€ç®¡ç†ç­–ç•¥ã€‚è¯·å‹¿åœ¨æ–°åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ RFC 2109 (obsolete)ï¼šç¬¦åˆRFC 2109å®šä¹‰çš„è¿‡æ—¶çŠ¶æ€ç®¡ç†è§„èŒƒçš„çŠ¶æ€ç®¡ç†ç­–ç•¥ã€‚è¯·å‹¿åœ¨æ–°åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ Browser compatibility (obsolete)ï¼š æ­¤ç­–ç•¥è‡´åŠ›äºä¸¥å¯†æ¨¡ä»¿æ—§ç‰ˆæµè§ˆå™¨åº”ç”¨ç¨‹åºï¼ˆå¦‚IEå’ŒFireFoxï¼‰çš„ï¼ˆé”™è¯¯ï¼‰è¡Œä¸ºã€‚è¯·ä¸è¦åœ¨æ–°çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ Defaultï¼šé»˜è®¤cookieç­–ç•¥æ˜¯ä¸€ç§ç»¼åˆç­–ç•¥ï¼Œå®ƒæ ¹æ®ä¸HTTPå“åº”ä¸€èµ·å‘é€çš„cookieçš„å±æ€§ï¼ˆä¾‹å¦‚ç‰ˆæœ¬å±æ€§ï¼Œç°åœ¨å·²è¿‡æ—¶ï¼‰é€‰æ‹©RFC 2965ï¼ŒRFC 2109æˆ–Netscapeè‰æ¡ˆå…¼å®¹å®ç°ã€‚åœ¨HttpClientçš„ä¸‹ä¸€ä¸ªæ¬¡è¦ç‰ˆæœ¬ä¸­ï¼Œå°†å¼ƒç”¨æ­¤ç­–ç•¥ä»¥æ”¯æŒæ ‡å‡†ï¼ˆç¬¦åˆRFC 6265ï¼‰å®ç°ã€‚ Ignore cookiesï¼šå¿½ç•¥ æ‰€æœ‰cookieã€‚ å¼ºçƒˆå»ºè®®åœ¨æ–°åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªStandardæˆ– Standard strictç­–ç•¥ã€‚ 3.3ã€é€‰æ‹©Cookieç­–ç•¥å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨HTTPå®¢æˆ·ç«¯è®¾ç½®Cookieç­–ç•¥ï¼Œä¹Ÿå¯åœ¨HTTPè¯·æ±‚æ˜¯è¦†ç›–æŒ‡å®šã€‚ 1234567891011RequestConfig globalConfig = RequestConfig.custom() .setCookieSpec(CookieSpecs.DEFAULT) .build();CloseableHttpClient httpclient = HttpClients.custom() .setDefaultRequestConfig(globalConfig) .build();RequestConfig localConfig = RequestConfig.custom() .setCookieSpec(CookieSpecs.STANDARD_STRICT) .build();HttpGet httpGet = new HttpGet(\"/\");httpGet.setConfig(localConfig); 3.4ã€è‡ªå®šä¹‰Cookieç­–ç•¥å¦‚æœè¦åˆ›å»ºè‡ªå®šä¹‰cookieç­–ç•¥ï¼Œå°±è¦è‡ªå·±å®ç°CookieSpecæ¥å£ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªCookieSpecProvideræ¥å£æ¥æ–°å»ºã€åˆå§‹åŒ–è‡ªå®šä¹‰CookieSpecæ¥å£ï¼Œæœ€åæŠŠCookieSpecProvideræ³¨å†Œåˆ°HttpClientä¸­ã€‚ä¸€æ—¦æˆ‘ä»¬æ³¨å†Œäº†è‡ªå®šä¹‰ç­–ç•¥ï¼Œå°±å¯ä»¥åƒå…¶ä»–æ ‡å‡†ç­–ç•¥ä¸€æ ·ä½¿ç”¨äº†ã€‚ 1234567891011PublicSuffixMatcher publicSuffixMatcher = PublicSuffixMatcherLoader.getDefault();Registry&lt;CookieSpecProvider&gt; r = RegistryBuilder.&lt;CookieSpecProvider&gt;create() .register(CookieSpecs.DEFAULT, new DefaultCookieSpecProvider(publicSuffixMatcher)) .register(CookieSpecs.STANDARD, new RFC6265CookieSpecProvider(publicSuffixMatcher)) .register(\"easy\", new EasySpecProvider()) .build();RequestConfig requestConfig = RequestConfig.custom().setCookieSpec(\"easy\").build();CloseableHttpClient httpClient = HttpClients.custom() .setDefaultCookieSpecRegistry(r) .setDefaultRequestConfig(requestConfig) .build(); 3.5ã€CookieæŒä¹…åŒ–HttpClientå¯ä»¥ä½¿ç”¨ä»»ä½•å­˜å‚¨æ–¹å¼çš„cookie storeï¼Œåªè¦è¿™ä¸ªcookie storeå®ç°äº†CookieStoreæ¥å£ã€‚é»˜è®¤çš„CookieStoreé€šè¿‡java.util.ArrayListç®€å•å®ç°äº†BasicCookieStoreã€‚å­˜åœ¨åœ¨BasicCookieStoreä¸­çš„Cookieï¼Œå½“è½½ä½“å¯¹è±¡è¢«å½“åšåƒåœ¾å›æ”¶æ‰åï¼Œå°±ä¼šä¸¢å¤±ã€‚å¦‚æœå¿…è¦ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±å®ç°æ›´ä¸ºå¤æ‚çš„æ–¹å¼ã€‚ 12345678CookieStore cookieStore = new BasicCookieStore();BasicClientCookie cookie = new BasicClientCookie(\"name\", \"value\");cookie.setDomain(\".mycompany.com\");cookie.setPath(\"/\");cookieStore.addCookie(cookie);CloseableHttpClient httpclient = HttpClients.custom() .setDefaultCookieStore(cookieStore) .build(); 3.6ã€ HTTPçŠ¶æ€ç®¡ç†å’Œæ‰§è¡Œä¸Šä¸‹æ–‡åœ¨Httpè¯·æ±‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒHttpClientä¼šè‡ªåŠ¨å‘æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ·»åŠ ä¸‹é¢çš„çŠ¶æ€ç®¡ç†å¯¹è±¡ï¼š Lookupï¼šè¡¨ç¤ºå®é™…cookieè§„èŒƒregistryçš„å®ä¾‹ï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„è¿™ä¸ªå€¼ä¼˜å…ˆäºé»˜è®¤å€¼ã€‚ CookieSpecï¼šä»£è¡¨å®é™…çš„Cookieè§„èŒƒçš„å®ä¾‹ã€‚ CookieOriginï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„å®é™…origin serverè¯¦ç»†ä¿¡æ¯çš„å®ä¾‹ã€‚ CookieStoreï¼šè¡¨ç¤ºå®é™…cookieå­˜å‚¨çš„å®ä¾‹ã€‚åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­è®¾ç½®çš„æ­¤å±æ€§çš„å€¼ä¼˜å…ˆäºé»˜è®¤å€¼ã€‚ æœ¬åœ°HttpContextå¯¹è±¡å¯ç”¨äºåœ¨è¯·æ±‚æ‰§è¡Œä¹‹å‰è‡ªå®šä¹‰HTTPçŠ¶æ€ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œæˆ–åœ¨è¯·æ±‚æ‰§è¡Œåæ£€æŸ¥å…¶çŠ¶æ€ã€‚è¿˜å¯ä»¥ä½¿ç”¨å•ç‹¬çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ¥å®ç°æ¯ä¸ªç”¨æˆ·ï¼ˆæˆ–æ¯ä¸ªçº¿ç¨‹ï¼‰çŠ¶æ€ç®¡ç†ã€‚åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„cookieè§„èŒƒregistryå’Œcookie storeå°†ä¼˜å…ˆäºåœ¨HTTPå®¢æˆ·ç«¯çº§åˆ«è®¾ç½®çš„é»˜è®¤å€¼. 123456789101112131415CloseableHttpClient httpClient = HttpClients.custom().build(); Lookup&lt;CookieSpecProvider&gt; cookieSpecReg = &lt;...&gt;;CookieStore cookieStore = &lt;...&gt;;HttpClientContext context = HttpClientContext.create();context.setCookieSpecRegistry(cookieSpecReg);context.setCookieStore(cookieStore);HttpGet httpget = new HttpGet(\"http://somehost/\");CloseableHttpResponse response = httpClient.execute(httpget, context);//cookie origin CookieOrigin cookieOrigin = context.getCookieOrigin();//Cookie specCookieSpec cookieSpec = context.getCookieSpec(); å‚è€ƒï¼šhttp://hc.apache.org/httpcomponents-client-4.5.x/tutorial/html/statemgmt.html","link":"/2018/11/19/java/httpclient/HttpClient%EF%BC%88%E4%B8%89%EF%BC%89-%20HTTP%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/"},{"title":"é€šè¿‡HttpClientå‘é€httpsè¯·æ±‚","text":"é€šè¿‡HttpClientå‘é€httpsè¯·æ±‚å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š å‚è€ƒï¼šhttps://stackoverflow.com/questions/1201048/allowing-java-to-use-an-untrusted-certificate-for-ssl-https-connection https://blog.csdn.net/guicaizhou/article/details/70214065","link":"/2018/11/01/java/httpclient/%E9%80%9A%E8%BF%87HttpClient%E5%8F%91%E9%80%81https%E8%AF%B7%E6%B1%82/"},{"title":"Jackson-ç®€ä»‹","text":"ç®€ä»‹Jackson æ˜¯å½“å‰ç”¨çš„æ¯”è¾ƒå¹¿æ³›çš„ï¼Œç”¨æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON çš„ Java çš„å¼€æºæ¡†æ¶ã€‚Jackson æ˜¯æœ€æµè¡Œçš„ JSON è§£æå™¨ä¹‹ä¸€ ã€‚ Spring MVCã€SpringBoot çš„é»˜è®¤ JSON è§£æå™¨ä¾¿æ˜¯ Jacksonã€‚ Jackson ä¼˜ç‚¹å¾ˆå¤šã€‚ Jackson æ‰€ä¾èµ–çš„ jar åŒ…è¾ƒå°‘ ï¼Œç®€å•æ˜“ç”¨ã€‚ä¸å…¶ä»– Java çš„ JSON çš„æ¡†æ¶ Gson ç­‰ç›¸æ¯”ï¼Œ Jackson è§£æå¤§çš„ JSON æ–‡ä»¶é€Ÿåº¦æ¯”è¾ƒå¿«ï¼›Jackson è¿è¡Œæ—¶å ç”¨å†…å­˜æ¯”è¾ƒä½ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼›Jackson æœ‰çµæ´»çš„ APIï¼Œå¯ä»¥å¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚ Jackson çš„æ ¸å¿ƒæ¨¡å—ç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚ jackson-coreï¼Œæ ¸å¿ƒåŒ…ï¼Œæä¾›åŸºäºâ€æµæ¨¡å¼â€è§£æçš„ç›¸å…³ APIï¼Œå®ƒåŒ…æ‹¬ JsonPaser (è¯»å–æ•°æ®)å’Œ JsonGenerator(å†™å…¥æ•°æ®)ã€‚ Jackson å†…éƒ¨å®ç°æ­£æ˜¯é€šè¿‡é«˜æ€§èƒ½çš„æµæ¨¡å¼ API çš„ JsonGenerator å’Œ JsonParser æ¥ç”Ÿæˆå’Œè§£æ JSONã€‚ jackson-annotationsï¼Œæ³¨è§£åŒ…ï¼Œæä¾›æ ‡å‡†æ³¨è§£åŠŸèƒ½ï¼› jackson-databind ï¼Œæ•°æ®ç»‘å®šåŒ…ï¼Œ æä¾›åŸºäºâ€å¯¹è±¡ç»‘å®šâ€ è§£æçš„ç›¸å…³ API ï¼ˆ ObjectMapper ï¼‰ å’Œâ€æ ‘æ¨¡å‹â€ è§£æçš„ç›¸å…³ API ï¼ˆJsonNodeï¼‰ï¼›åŸºäºâ€å¯¹è±¡ç»‘å®šâ€ è§£æçš„ API å’Œâ€æ ‘æ¨¡å‹â€è§£æçš„ API ä¾èµ–åŸºäºâ€æµæ¨¡å¼â€è§£æçš„ APIã€‚ 1ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–â€“ä½¿ç”¨ç¤ºä¾‹ï¼š 1234567ObjectMapper mapper = new ObjectMapper();Person person = new Person();person.setId(1);person.setName(\"Bob\");mapper.writerWithDefaultPrettyPrinter().writeValue(System.out, person);String json = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(person);//åºåˆ—åŒ–Person deserializedPerson = mapper.readValue(json, Person.class);//ååºåˆ—åŒ– JacksonFeatureså¯¹ObjectMapperï¼ŒObjectWriterå¹¶ObjectReaderè¿›è¡ŒåŠŸèƒ½é…ç½®ï¼Œåˆ†ä¸ºä¸¤å¤§ç±»ï¼šjackson-databindç›´æ¥å½±å“ç»„ä»¶çš„é«˜çº§è®¾ç½®ï¼›å’Œå½±å“Streaming APIè¡Œä¸ºï¼ˆJsonParserï¼ŒJsonGeneratorï¼‰è¡Œä¸ºçš„ä½çº§è®¾ç½®ã€‚ å…·ä½“å¯å‚è€ƒï¼šJacksonFeatures 2ã€é…ç½®ä¿¡æ¯Featureâ€“ä½¿ç”¨ç¤ºä¾‹ï¼š 1234567mapper.configure(SerializationFeature.INDENT_OUTPUT, true); //ç¾åŒ–è¾“å‡ºmapper.configure(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS, true);//åºåˆ—åŒ–Mapæ—¶æŒ‰è‡ªç„¶é¡ºåºå¯¹keyæ’åºmapper.configure(SerializationFeature.WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS, true);//åºåˆ—åŒ–char[]æ—¶ä»¥jsonæ•°ç»„è¾“å‡ºï¼Œé»˜è®¤falseã€‚mapper.configure(SerializationFeature.WRITE_BIGDECIMAL_AS_PLAIN,false);//åºåˆ—åŒ–BigDecimalæ—¶æ˜¯åŸå§‹è¾“å‡ºè¿˜æ˜¯ç§‘å­¦è®¡æ•°æ–¹å¼è¾“å‡ºã€‚é»˜è®¤false.mapper.setSerializationInclusion(Include.NON_EMPTY);//åœ¨åºåˆ—åŒ–æ—¶å¿½ç•¥ç©ºçš„å±æ€§mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);//ååºåˆ—åŒ–æ—¶ç¦ç”¨æ˜ å°„å™¨é‡åˆ°æœªçŸ¥å±æ€§æ—¶å¯¼è‡´æ–­å¼€çš„åŠŸèƒ½ï¼Œå°†å¿½ç•¥beanä¸­ä¸å­˜åœ¨çš„å±æ€§ã€‚ å­¦ä¹ å‚è€ƒï¼šhttp://www.studytrails.com/java/json/java-jackson-introduction/ https://github.com/FasterXML/jackson-docs","link":"/2018/12/22/java/json/Jackson-%E7%AE%80%E4%BB%8B/"},{"title":"Jackson-æ³¨è§£","text":"@JsonAutoDetectè®¾ç½®å±æ€§çš„è‡ªåŠ¨å‘ç°è§„åˆ™ã€‚ï¼ˆä½œç”¨åœ¨ç±»ä¸Šï¼‰ Jacksoné»˜è®¤çš„å±æ€§å‘ç°è§„åˆ™ï¼Œä¼šæŸ¥æ‰¾åˆ°å¦‚ä¸‹æ‰€è¿°çš„å±æ€§: æ‰€æœ‰è¢«publicä¿®é¥°çš„å­—æ®µï¼ˆæˆå‘˜å˜é‡ï¼‰ æ‰€æœ‰è¢«publicä¿®é¥°çš„getterï¼ˆå³å½¢å¦‚â€œgetXxx()â€çš„æ–¹æ³•ï¼‰ï¼› æ‰€æœ‰è¢«publicä¿®é¥°çš„setterï¼ˆå³å½¢å¦‚â€œsetXxx(value)â€çš„æ–¹æ³•ï¼‰ï¼Œä¸ç®¡å¯è§æˆ–ä¸å¯è§ã€‚ è®¾ç½®ç±»å±æ€§çš„è‡ªåŠ¨å‘ç°è§„åˆ™ï¼š 123456789101112131415161718192021//jason: {\"id\":111,\"name\":\"myName\"}@JsonAutoDetect(fieldVisibility = Visibility.NONE, getterVisibility = Visibility.PUBLIC_ONLY, setterVisibility = Visibility.PUBLIC_ONLY)public class Person { protected int id; public String name; public int getId(){ return id; } public void setId(int id){ this.id = id; } protected String getName(){ return name; } protected void setName(String name){ this.name = name; }}//mapper.readValue(\"{\\\"id\\\":111,\\\"name\\\":\\\"myName\\\"}\",Peson.class)//è¿™æ ·åªæœ‰idå¯ä»¥è¢«æ£€æµ‹åˆ°ï¼Œnameçš„å€¼ä¼šæ˜¯null fieldVisibilityï¼›å­—æ®µçš„å¯è§çº§åˆ« ï¼ŒgetterVisibilityï¼šgetteræ–¹æ³•æ£€æµ‹çº§åˆ«ï¼Œâ€¦ ANY:ä»»ä½•çº§åˆ«çš„å­—æ®µéƒ½å¯ä»¥è‡ªåŠ¨è¯†åˆ«ã€‚ NONE:æ‰€æœ‰å­—æ®µéƒ½ä¸å¯ä»¥è‡ªåŠ¨è¯†åˆ« ã€‚ NON_PRIVATE:éprivateä¿®é¥°çš„å­—æ®µå¯ä»¥è‡ªåŠ¨è¯†åˆ«ã€‚ PROTECTED_AND_PUBLIC:è¢«protectedå’Œpublicä¿®é¥°çš„å­—æ®µå¯ä»¥è¢«è‡ªåŠ¨è¯†åˆ«ã€‚ PUBLIC_ONLY:åªæœ‰è¢«publicä¿®é¥°çš„å­—æ®µæ‰å¯ä»¥è¢«è‡ªåŠ¨è¯†åˆ«ã€‚ @JsonIgnoreå¿½ç•¥è¢«æ³¨è§£çš„å­—æ®µå’Œæ–¹æ³•å¯¹åº”çš„å±æ€§ï¼ˆä½œç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼‰ ä¸ç®¡æ³¨è§£åœ¨gettersä¸Šè¿˜æ˜¯settersä¸Šéƒ½ä¼šå¿½ç•¥å¯¹åº”çš„å±æ€§ã€‚ @JsonProperty / @JsonProperty(â€œfirstNameâ€)ç”¨æ¥å¯¹å±æ€§çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œå¯ä»¥ç”¨æ¥é¿å…é—æ¼å±æ€§ï¼ŒåŒæ—¶æä¾›å¯¹å±æ€§åç§°é‡å‘½åã€‚ ï¼ˆä½œç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼‰ 1234567891011121314151617181920212223//json: {\"id\":111,\"first_name\":\"myName\"}public class Person { @JsonProperty //æ³¨æ„è¿™é‡Œå¿…é¡»è¦æœ‰è¯¥æ³¨è§£ï¼Œå› ä¸ºæ²¡æœ‰æä¾›å¯¹åº”çš„getIdå’ŒsetIdå‡½æ•°ï¼Œè€Œæ˜¯å…¶ä»–çš„getterå’Œsetterï¼Œé˜²æ­¢é—æ¼è¯¥å±æ€§ private int id; @JsonProperty(\"firstName\") private String first_name; public int getPersonId(){ return id; } public void setPersonId(int personId){ this.id = personId; } public String getFirstName(){ return first_name; } public void setFirstName(String firstName){ this.first_name = firstName; } } @JsonIgnoreProperties / @JsonIgnoreProperties(â€œtagsâ€)ç”¨æ¥è¯´æ˜æœ‰äº›å±æ€§åœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶éœ€è¦å¿½ç•¥æ‰ã€‚ï¼ˆä½œç”¨åœ¨ç±»ä¸Šï¼‰ å¯ä»¥å°†å®ƒçœ‹åšæ˜¯@JsonIgnoreçš„æ‰¹é‡æ“ä½œã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½æ˜¯ä½œç”¨åœ¨ååºåˆ—åŒ–æ—¶è§£æå­—æ®µæ—¶è¿‡æ»¤ä¸€äº›æœªçŸ¥çš„å±æ€§ã€‚å¦åˆ™é€šå¸¸æƒ…å†µä¸‹è§£æåˆ°æˆ‘ä»¬å®šä¹‰çš„ç±»ä¸è®¤è¯†çš„å±æ€§ä¾¿ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ å¯ä»¥æ³¨æ˜æ˜¯æƒ³è¦å¿½ç•¥çš„å±æ€§åˆ—è¡¨å¦‚@JsonIgnoreProperties({â€œnameâ€,â€ageâ€,â€tagsâ€})ï¼Œ ä¹Ÿå¯ä»¥æ³¨æ˜è¿‡æ»¤æ‰æœªçŸ¥çš„å±æ€§å¦‚@JsonIgnoreProperties(ignoreUnknown=true) @JsonAnySetteråœ¨ååºåˆ—åŒ–æ—¶ç”¨æ¥å¤„ç†é‡åˆ°æœªçŸ¥çš„å±æ€§çš„æ—¶å€™è°ƒç”¨ã€‚ï¼ˆä½œç”¨åœ¨æ–¹æ³•ä¸Šï¼‰ æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡æ³¨è§£@JsonIgnoreProperties(ignoreUnknown = true)æ¥è¿‡æ»¤æœªçŸ¥çš„å±æ€§ï¼Œä½†æ˜¯å¦‚æœéœ€è¦è¿™äº›æœªçŸ¥çš„å±æ€§è¯¥å¦‚ä½•æ˜¯å¥½?é‚£ä¹ˆ@JsonAnySetterå°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ï¼Œåœ¨ç±»ä¸Šå¢åŠ ä¸€ä¸ªMap K/Vçš„setteræ–¹æ³•, ç„¶ååœ¨è¿™ä¸ªsetteræ–¹æ³•åŠ ä¸Š@JsonAnySetteræ³¨è§£ï¼Œååºåˆ—åŒ–æ—¶å°±ä¼šæŠŠæœªçŸ¥çš„å±æ€§ä¿å­˜åˆ°mapä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233// json: {\"id\":111,\"name\":\"myName\",\"age\":23}@JsonIgnoreProperties(ignoreUnknown = true)public class Person { private int id; private String name; private Map&lt;String, Object&gt; otherProperties = new HsahMap&lt;&gt;(); public int getId(){ return id; } public void setId(int id){ this.id = id; } public String getName(){ return name; } public void setName(String name){ this.name = name; } public Map&lt;String, Object&gt; getOtherProperties() { return otherProperties; } @JsonAnySetter public void setOther(String name, Object value) { otherProperties.put(name, value); } @JsonAnyGetter public Map&lt;String, Object&gt; any(){ return otherProperties; } } è¿™æ ·å°±å¯ä»¥é€šè¿‡peson.getOtherProperties.get(â€œageâ€)ï¼Œè·å–åˆ°è¢«å¿½ç•¥æ‰çš„ageå±æ€§äº†ã€‚ @JsonAnyGetterä¸@JsonAnySetterå¯¹åº”ï¼Œåœ¨åºåˆ—åŒ–æ—¶ï¼Œå°†ç±»ä¸­çš„Map K/Vå±æ€§åºåˆ—åŒ–åˆ°jsonä¸­ã€‚ ï¼ˆä½œç”¨åœ¨æ–¹æ³•ä¸Šï¼‰ åœ¨ç±»ä¸Šå¢åŠ ä¸€ä¸ª @JsonAnyGetter æ–¹æ³•, è¯¥æ–¹æ³•ç›´æ¥è¿”å›KV mapã€‚ @JsonCreatoré€šå¸¸ç”¨æ¥æ ‡æ³¨åœ¨æ„é€ æ–¹æ³•æˆ–é™æ€å·¥å‚æ–¹æ³•ä¸Šï¼Œä½¿ç”¨è¯¥æ–¹æ³•æ¥æ„å»ºå®ä¾‹ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨æ— å‚çš„æ„é€ æ–¹æ³•ã€‚ å¦‚æœ Pojo ç±»å®šä¹‰äº†æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•, ä½†æ²¡æœ‰æä¾›æ— å‚æ„é€ æ–¹æ³•æ—¶, åœ¨ååºåˆ—åŒ–æ—¶æ˜¯ä¼šæŠ¥é”™ï¼Œæœ‰ä¸‹é¢ä¸¤ä¸ªåŠæ³•: å¢åŠ ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ã€‚ ä¸ºè¿™ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•, åŠ ä¸Š @JsonCreator æ³¨è§£, åŒæ—¶å‚æ•°éœ€è¦åŠ ä¸Š @JsonProperty æ³¨è§£. 1234567891011public class Person { private int id; private String name; @JsonCreator public Person(@JsonProperty(\"id\") int id, @JsonProperty(\"name\") String name) { this.id = id; this.name = name; }} å¤šæ€ç±»å‹å¤„ç†ï¼š@JsonTypeInfoç”¨æ¥å¤„ç†å¤šæ€ç±»å‹çš„åºåˆ—åŒ–åŠååºåˆ—åŒ–ï¼Œï¼ˆä½œç”¨äºç±»æˆ–æ¥å£ï¼‰ æ³¨è§£å±æ€§ï¼š useï¼šå®šä¹‰ä½¿ç”¨å“ªä¸€ç§ç±»å‹è¯†åˆ«ç ï¼Œå®ƒæœ‰ä¸‹é¢å‡ ä¸ªå¯é€‰å€¼ JsonTypeInfo.Id.CLASSï¼šä½¿ç”¨å®Œå…¨é™å®šç±»ååšè¯†åˆ«ã€‚ JsonTypeInfo.Id.MINIMAL_CLASSï¼šè‹¥åŸºç±»å’Œå­ç±»åœ¨åŒä¸€åŒ…ç±»ï¼Œä½¿ç”¨ç±»å(å¿½ç•¥åŒ…å)ä½œä¸ºè¯†åˆ«ã€‚ JsonTypeInfo.Id.NAMEï¼šä¸€ä¸ªåˆä¹é€»è¾‘çš„æŒ‡å®šåç§°ã€‚ JsonTypeInfo.Id.CUSTOMï¼šè‡ªå®šä¹‰è¯†åˆ«ç ï¼Œç”±@JsonTypeIdResolverå¯¹åº”ã€‚ JsonTypeInfo.Id.NONEï¼šä¸ä½¿ç”¨è¯†åˆ«ç ã€‚ include(å¯é€‰)ï¼šæŒ‡å®šè¯†åˆ«ç æ˜¯å¦‚ä½•è¢«åŒ…å«è¿›å»çš„ï¼Œå®ƒæœ‰ä¸‹é¢å‡ ä¸ªå¯é€‰å€¼ï¼š JsonTypeInfo.As.PROPERTYï¼šä½œä¸ºæ•°æ®çš„å…„å¼Ÿå±æ€§ã€‚ JsonTypeInfo.As.EXISTING_PROPERTYï¼šä½œä¸ºPOJOä¸­å·²ç»å­˜åœ¨çš„å±æ€§ã€‚ JsonTypeInfo.As.EXTERNAL_PROPERTYï¼šä½œä¸ºæ‰©å±•å±æ€§ã€‚ JsonTypeInfo.As.WRAPPER_OBJECTï¼šä½œä¸ºä¸€ä¸ªåŒ…è£…çš„å¯¹è±¡ã€‚ JsonTypeInfo.As.WRAPPER_ARRAYï¼šä½œä¸ºä¸€ä¸ªåŒ…è£…çš„æ•°ç»„ã€‚ property(å¯é€‰):åˆ¶å®šè¯†åˆ«ç çš„å±æ€§åç§°ï¼š æ­¤å±æ€§åªæœ‰å½“useä¸ºJsonTypeInfo.Id.CLASSï¼ˆè‹¥ä¸æŒ‡å®špropertyåˆ™é»˜è®¤ä¸º@classï¼‰ã€JsonTypeInfo.Id.MINIMAL_CLASS(è‹¥ä¸æŒ‡å®špropertyåˆ™é»˜è®¤ä¸º@c)ã€JsonTypeInfo.Id.NAME(è‹¥ä¸æŒ‡å®špropertyé»˜è®¤ä¸º@type)ï¼Œincludeä¸ºJsonTypeInfo.As.PROPERTYã€JsonTypeInfo.As.EXISTING_PROPERTYã€JsonTypeInfo.As.EXTERNAL_PROPERTYæ—¶æ‰æœ‰æ•ˆã€‚ defaultImpl(å¯é€‰)ï¼š å¦‚æœç±»å‹è¯†åˆ«ç ä¸å­˜åœ¨æˆ–è€…æ— æ•ˆï¼Œå¯ä»¥ä½¿ç”¨è¯¥å±æ€§æ¥åˆ¶å®šååºåˆ—åŒ–æ—¶ä½¿ç”¨çš„é»˜è®¤ç±»å‹ã€‚ visible(å¯é€‰)ï¼šæ˜¯å¦å¯è§ å®šä¹‰äº†ç±»å‹æ ‡è¯†ç¬¦çš„å€¼æ˜¯å¦ä¼šé€šè¿‡JSONæµæˆä¸ºååºåˆ—åŒ–å™¨çš„ä¸€éƒ¨åˆ†ï¼Œé»˜è®¤ä¸ºfale,ä¹Ÿå°±æ˜¯è¯´,jacksonä¼šä»JSONå†…å®¹ä¸­å¤„ç†å’Œåˆ é™¤ç±»å‹æ ‡è¯†ç¬¦å†ä¼ é€’ç»™JsonDeserializerã€‚ @JsonSubTypesç”¨æ¥åˆ—å‡ºç»™å®šç±»çš„å­ç±»ï¼Œåªæœ‰å½“å­ç±»ç±»å‹æ— æ³•è¢«æ£€æµ‹åˆ°æ—¶æ‰ä¼šä½¿ç”¨å®ƒï¼Œä¸€èˆ¬æ˜¯é…åˆ@JsonTypeInfoåœ¨åŸºç±»ä¸Šä½¿ç”¨ã€‚ï¼ˆä½œç”¨åœ¨ç±»æˆ–æ¥å£ä¸Šï¼‰ @JsonSubTypesçš„å€¼æ˜¯ä¸€ä¸ª@JsonSubTypes.Type[]æ•°ç»„ï¼Œé‡Œé¢æšä¸¾äº†å¤šæ€ç±»å‹(valueå¯¹åº”ç±»)å’Œç±»å‹çš„æ ‡è¯†ç¬¦å€¼(nameå¯¹åº”@JsonTypeInfoä¸­çš„propertyæ ‡è¯†åç§°çš„å€¼ï¼Œæ­¤ä¸ºå¯é€‰å€¼ï¼Œè‹¥ä¸åˆ¶å®šéœ€ç”±@JsonTypeNameåœ¨å­ç±»ä¸Šåˆ¶å®š) 1234567@JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, include = As.PROPERTY, property = \"@class\")@JsonSubTypes({@Type(value = Lion.class, name = \"lion\"),@Type(value = Elephant.class, name = \"elephant\")})public abstract class Animal { @JsonProperty(\"name\") String name;} å‚è§ï¼šJackson -Jsonå¤šæ€ç±»å‹ ç”Ÿæˆçš„zoo.jsonå¦‚ä¸‹ï¼š 123456789101112131415161718{ \"@class\" : \".Zoo\", \"name\" : \"Samba Wild Park\", \"city\" : \"Paz\", \"animals\" : [ { \"@class\" : \"com.qzf.jackson.model.Lion\", \"name\" : \"Simba\", \"sound\" : \"Roar\", \"type\" : \"carnviorous\", \"endangered\" : true }, { \"@class\" : \"com.qzf.jackson.model.Elephant\", \"name\" : \"Manny\", \"sound\" : \"trumpet\", \"type\" : \"herbivorous\", \"endangered\" : false } ]} @JsonFormat å®šä¹‰æ—¥æœŸç±»å‹å­—æ®µæ ¼å¼ã€‚ï¼ˆä½œç”¨åœ¨å­—æ®µä¸Šæˆ–getteræ–¹æ³•ä¸Šï¼‰ å¯¹äºæ—¥æœŸç±»å‹ä¸º Java.util.Calendar,Java.util.GregorianCalendar,Java.sql.Date,Java.util.Date,Java.sql.Timestampçš„å­—æ®µè‹¥ä¸æŒ‡å®šæ ¼å¼ï¼Œ jacksoné»˜è®¤åºåˆ—åŒ–ä¸º long ç±»å‹çš„æ•°æ®ã€‚ jacksonæœ‰ä»¥ä¸‹æ–¹å¼è½¬æ¢æ—¥æœŸæ ¼å¼ï¼š ä½¿ç”¨@JsonFormatæ³¨è§£ã€‚ 123456789101112public class Person { @JsonFormat(pattern=\"yyyy-MM-dd HH:mm:ss\",timezone=\"GMT+8\") private Date updateTimeï¼› // æˆ–è€… @JsonFormat(pattern=\"yyyy-MM-dd HH:mm:ss\",timezone=\"GMT+8\") public Date getUpdateTime() { return updateTime; } public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; }} è°ƒç”¨ObjectMapperçš„setDateFormat()æ–¹æ³•ã€‚ 123ObjectMapper mapper = new ObjectMapper();SimpleDateFormat outputFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");mapper.setDateFormat(outputFormat); //è®¾ç½®æ—¥æœŸæ ¼å¼ å¯å‚è€ƒï¼šhttps://www.baeldung.com/jackson-annotations","link":"/2018/12/21/java/json/Jackson-%E6%B3%A8%E8%A7%A3/"},{"title":"Jacksonååºåˆ—åŒ–å¤„ç†å¸¦æ³›å‹","text":"é€šè¿‡Jacksonè¿›è¡Œååºåˆ—åŒ–æ—¶é€šå¸¸å¯ä»¥ä½¿ç”¨TypeReference 1234567public public &lt;T&gt; List&lt;T&gt; transJsonArryStrToList(String jsonString, Class&lt;T&gt; beanClass) { ObjectMapper mapper = new ObjectMapper(); mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); // List&lt;T&gt; student = mapper.readValue(jsonString, new TypeReference&lt;List&lt;T&gt;&gt;(){}); List&lt;Student&gt; student = mapper.readValue(jsonString, new TypeReference&lt;List&lt;Student&gt;&gt;(){});} å…¶ä¸­new TypeReference&lt;List&lt;Student&gt;&gt;()ä¸­çš„List&lt;Student&gt;ç±»å‹éœ€è¦æ˜ç¡®æŒ‡å®šï¼Œä¸èƒ½æŒ‡å®šä¸ºæ³›å‹ï¼Œå¦åˆ™ååºåˆ—åŒ–åListä¸­çš„å¯¹è±¡ä¸æ˜¯Studentï¼Œè€Œæ˜¯LinkedHashMapï¼Œæ¥ä¸‹æ¥å†å¤„ç†listæ—¶å°±ä¼šæŠ¥java.lang.ClassCastException: java.util.LinkedHashMap cannot be cast to com.pojo.Studentå¼‚å¸¸ã€‚ å¦‚æœè¦é€šè¿‡æ³›å‹è¿›è¡Œååºåˆ—åŒ–æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®ç° 12345public &lt;T&gt; List&lt;T&gt; transJsonArryStrToList(String jsonArryStr, Class&lt;T&gt; beanClass) throws Exception{ ObjectMapper mapper = new ObjectMapper(); List&lt;T&gt; list = mapper.readValue(jsonArryStr, mapper.getTypeFactory().constructParametricType(List.class, beanClass)); return list;} å‚è€ƒï¼šhttps://blog.csdn.net/u013466972/article/details/83029854","link":"/2019/01/15/java/json/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%84%E7%90%86%E5%B8%A6%E6%B3%9B%E5%9E%8B/"},{"title":"Json-lib","text":"ç®€ä»‹json-libæ˜¯æœ€å¼€å§‹çš„ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„jsonè§£æå·¥å…·ï¼Œjson-lib ä¾èµ–äºå¾ˆå¤šç¬¬ä¸‰æ–¹åŒ…ï¼Œ ä¾èµ–çš„jar: commons-lang 2.5 commons-beanutils 1.8.0 commons-collections 3.2.1 commons-logging 1.1.1 ezmorph 1.0.6 å¯¹äºå¤æ‚ç±»å‹çš„è½¬æ¢ï¼Œjson-libå¯¹äºjsonè½¬æ¢æˆbeanè¿˜æœ‰ç¼ºé™·ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»é‡Œé¢ä¼šå‡ºç°å¦ä¸€ä¸ªç±»çš„listæˆ–è€…mapé›†åˆï¼Œjson-libä»jsonåˆ°beançš„è½¬æ¢å°±ä¼šå‡ºç°é—®é¢˜ã€‚json-libåœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šé¢éƒ½å·²ä¸èƒ½æ»¡è¶³ç°åœ¨äº’è”ç½‘åŒ–çš„éœ€æ±‚ã€‚ ä½†ä¹Ÿæ˜¯æœ‰å¿…è¦äº†è§£çš„ã€‚ æè¿°Json-libæ˜¯ä¸€ä¸ªç”¨äºè½¬æ¢beansã€mapsã€collectionsã€java arraysã€XMLæˆJSONå¯¹è±¡ä»¥åŠåä¹‹è½¬åŒ–æˆbenaså’ŒDynaBeansçš„javaåº“ã€‚Json-libå»ºç«‹åœ¨Douglas Crockfordçš„å·¥ä½œåŸºç¡€ä¹‹ä¸Šã€‚ ä½¿ç”¨å¼•å…¥Mavenä¾èµ–ï¼š 123456&lt;dependency&gt; &lt;groupId&gt;net.sf.json-lib&lt;/groupId&gt; &lt;artifactId&gt;json-lib&lt;/artifactId&gt; &lt;version&gt;2.4&lt;/version&gt; &lt;classifier&gt;jdk15&lt;/classifier&gt;&lt;/dependency&gt; JSONObjectJSONObjectæ˜¯ä¸€ä¸ªæ— åºçš„name/valueå¯¹é›†åˆã€‚å®ƒçš„å¤–éƒ¨å½¢å¼æ˜¯ä¸€ä¸ªç”±èŠ±æ‹¬å·â€œ{}â€æ‹¬èµ·çš„å­—ç¬¦ä¸²ï¼Œåœ¨nameå’Œvalueä¹‹é—´ä½¿ç”¨å†’å·â€œ:â€éš”å¼€ï¼Œåœ¨names/valuesä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚å®ƒçš„å†…éƒ¨çš„å½¢å¼æ˜¯ä¸€ä¸ªç”±getå’Œoptæ–¹æ³•æ¥æ ¹æ®nameè®¿é—®valueã€‚åŠaccumulateã€putæ–¹æ³•æ¥æ ¹æ®nameå¢åŠ æˆ–æ›¿æ¢valueçš„å¯¹è±¡ã€‚å€¼valueå¯ä»¥æ˜¯ä»¥ä¸‹ç±»å‹ï¼šBoolean, Double, Integer, JSONArray, JSONObject, Long, String, æˆ–è€… JSONNull å¯¹è±¡ã€‚ JSONObjectç±»å‹çš„æ„é€ å™¨å¯ä»¥ç”¨äºè½¬æ¢å¤–éƒ¨å½¢å¼çš„JSON textæˆä¸€ç§å¯ä»¥ç”±getå’Œoptæ–¹æ³•è®¿é—®çš„å†…éƒ¨å½¢å¼ï¼Œæˆ–è€…ä½¿ç”¨elementæ–¹æ³•å’ŒtoStringæ–¹æ³•æŠŠå€¼è½¬æ¢æˆä¸ºJSON textã€‚ JSONArrayJSONArrayæ˜¯ä¸€ä¸ªæœ‰åºçš„å€¼å¾—åºåˆ—ã€‚å®ƒçš„å¤–éƒ¨å½¢å¼æ˜¯åŒ…æ‹¬åœ¨æ–¹æ‹¬å·[]å†…çš„å­—ç¬¦ä¸²ï¼Œç”±é€—å·åˆ†éš”å€¼ã€‚å†…éƒ¨çš„å½¢å¼æ˜¯ä¸€ä¸ªæ‹¥æœ‰getå’Œoptæ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®ç´¢å¼•è®¿é—®å€¼ï¼Œelementæ–¹æ³•å¯ä»¥ç”¨æ¥æ·»åŠ å’Œæ›¿æ¢å€¼ï¼Œadd()æ–¹æ³•ï¼Œä¸JSONObjectçš„put()æ–¹æ³•ç±»ä¼¼ï¼Œåœ¨jsonæ•°ç»„æœ«å°¾è¿½åŠ å…ƒç´ ï¼Œä¹Ÿå¯ä»¥åœ¨æŒ‡å®šä½ç½®è¿½åŠ ã€‚ JSONObject ä¸JSONArray åŸºæœ¬æ–¹æ³•ï¼šfromObject(Object object) ï¼ŒJSONObjectå’ŒJSONArrayç±»éƒ½æœ‰ä¸€ä¸ªfromObject(Object object)çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥ä»å‚æ•°objectä¸­æ„é€ jsonå¯¹è±¡æˆ–æ•°ç»„ ã€‚ â‘  JSONObject.fromObject(Object object)ä¸­ï¼Œå‚æ•°å¯ä»¥æ˜¯Stringã€Mapã€beansç­‰ï¼Œä¸å¯ä»¥æ˜¯collectionã€arraysç­‰ â‘¡JSONArray.fromObject(Object object)ä¸­ï¼Œå‚æ•°å¯ä»¥æ˜¯Stringã€Mapã€Colliectionã€arraysç­‰ get()æ–¹æ³•ï¼Œæ ¹æ®nameè®¿é—®valueï¼Œå¦‚æœnameå­˜åœ¨ï¼Œåˆ™è¿”å›å¯¹åº”çš„å€¼ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸JSONExceptionã€‚ opt()æ–¹æ³•ï¼Œæ ¹æ®nameè®¿é—®valueï¼Œå¦‚æœnameä¸å­˜åœ¨ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼è€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ put()æ–¹æ³•ï¼Œå‘jsonå¯¹è±¡ä¸­åŠ å…¥å­—æ®µå’Œç›¸åº”å€¼ï¼Œä¼šè¦†ç›–åŸæ¥çš„å€¼ã€‚ accumulate()æ–¹æ³•ï¼Œå‘jsonå¯¹è±¡å’Œæ•°ç»„ä¸­çš„æŸå­—æ®µè¿½åŠ ç›¸åº”å€¼ï¼Œå½¢æˆä¸€ä¸ªJSONArrayå¯¹è±¡ï¼Œä¸æ–­è¿½åŠ æ–°çš„Value ã€‚ä¸ä¼šè¦†ç›–åŸæ¥çš„å€¼ã€‚ element()æ–¹æ³• ï¼Œä¸put() ç±»ä¼¼ï¼Œå‘jsonå¯¹è±¡ä¸­åŠ å…¥å­—æ®µå’Œç›¸åº”å€¼ï¼Œä¼šè¦†ç›–åŸæ¥çš„å€¼ã€‚å¯ä»¥ä½¿ç”¨é“¾å¼å­˜å‚¨çš„æ–¹å¼ 12JSONObject json = new JSONObject();json.element(\"1\", 1).element(\"2\", 2); replace(Object Object)ï¼Œæ ¹æ®keyæ›¿æ¢åŸæ¥çš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œä¸ä¼šæ·»åŠ ã€‚ isEmpy()ï¼Œåˆ¤æ–­JSONObjectå¯¹è±¡ä¸­æ˜¯å¦ä¸åŒ…å«ä»»ä½•name/valueå¯¹æ˜ å°„ ã€‚ isNullObject()ï¼Œåˆ¤æ–­JSONObjectå¯¹è±¡æ˜¯å¦æ˜¯nullã€‚ containsKey(Object key)ï¼Œåˆ¤æ–­JSONObjectä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„keyã€‚ has(String key), åŒcontainKeyæ–¹æ³•ï¼Œåˆ¤æ–­JSONObjectä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„keyã€‚ containValue(Object value)ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šçš„valueã€‚ equals(Object obj)ï¼Œåˆ¤æ–­ä¸¤ä¸ªJSONObjectå¯¹è±¡åŒ…å«ç›¸åŒçš„é”®é›†åˆï¼ŒåŒæ—¶æ¯ä¸ªé”®å¯¹åº”çš„å€¼ä¹Ÿç›¸ç­‰ ã€‚ isArray()ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯JSONArrayå¯¹è±¡ã€‚ éå†ï¼š1234567891011121314151617public static void test9() { JSONObject jsonObject = new JSONObject(); jsonObject.element(\"name\", \"zhangsan\").element(\"age\", 12).element(\"sex\", \"ç”·\"); for(Object str : jsonObject.keySet()) { String key = (String)str; System.out.println(key); } Set&lt;Object&gt; entrys = jsonObject.entrySet(); for(Object entry : entrys) { System.out.println(entry); } Collection&lt;Object&gt; col = jsonObject.values(); Iterator&lt;Object&gt; it = col.iterator(); while(it.hasNext()) { System.out.println(it.next()); }} JSONSerializerä½¿ç”¨ JSONSerializer çš„ toJSON æ–¹æ³•å°±å¯ä»¥è½¬æ¢ä»»æ„çš„ Java Object ä¸º JSON å¯¹è±¡äº†ï¼Œå†è°ƒç”¨ JSON å¯¹è±¡çš„ toString æ–¹æ³•å¯ä»¥å¾—åˆ°è½¬æ¢åçš„å­—ç¬¦ä¸²ã€‚ 1234567891011121314import net.sf.json.JSONSerializer;public static void test10() { String str = \"[\\\"zhangsan\\\",\\\"lisi\\\"]\"; List&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add(\"zhangsan\"); list.add(\"lisi\"); JSON json1 = JSONSerializer.toJSON(str); JSON json2 = JSONSerializer.toJSON(list); System.out.println(json1); System.out.println(json2.toString());}//[\"zhangsan\",\"lisi\"]//[\"zhangsan\",\"lisi\"] ç­›é€‰Java bean å±æ€§JSONSerializer æä¾›äº†ä¸€ä¸ª toJSON çš„é‡è½½æ–¹æ³•ï¼Œå¢åŠ ä¸€ä¸ªå‚æ•° JsonConfigï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°å¯¹ Json-lib çš„ç¼ºçœæ–¹å¼åšè‡ªå®šä¹‰çš„é…ç½®ã€‚ JSONObject.fromObject()ï¼ŒJSONArray.fromObject()ä¸­ä¹Ÿå¯ä¼ å…¥JsonConfigè¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚ 12345678910111213141516171819public static void test7() { String json = \"{\\\"data\\\":[{\\\"birthday\\\":\\\"2018-12-14\\\",\\\"certNum\\\":\\\"100101\\\",\\\"id\\\":1,\\\"occuOrient\\\":\\\"è½¦å·¥\\\"}]}\"; JsonConfig jsonConfig = new JsonConfig(); jsonConfig.setJsonPropertyFilter(new PropertyFilter() { // å®šä¹‰å±æ€§è¿‡æ»¤å™¨ @Override public boolean apply(Object source, String name, Object value) { if(value != null &amp;&amp; Number.class.isAssignableFrom(value.getClass())) { return true; // è¿”å› true, è¡¨ç¤ºè¿™ä¸ªå±æ€§å°†è¢«è¿‡æ»¤æ‰ } if(\"birthday\".equals(name) || \"certNum\".equals(name)) { return true; } return false; } }); //JSON json1 = JSONSerializer.toJSON(json,jsonConfig); JSONObject jsonObject = JSONObject.fromObject(json, jsonConfig); // æ³¨å†Œå±æ€§è¿‡æ»¤å™¨ System.out.println(jsonObject);} ä¹Ÿå¯ä½¿ç”¨æ³¨è§£å¯¹å±æ€§è¿›è¡Œç­›é€‰ï¼Œå¯å‚è€ƒï¼šä½¿ç”¨ annotation ç­›é€‰ JavaBean å±æ€§ JavaIdentifierTransformerå¦å¤–å¯ä»¥ä½¿ç”¨jsonConfig.setJavaIdentifierTransformer(),å¯¹Beanå±æ€§å­—ç¬¦è¿›è¡Œå¤„ç†ã€‚ Json-libå®šä¹‰äº†ä¸€ç»„JavaIdentifierTransformerç±»å‹çš„å¸®åŠ©ç¨‹åºï¼Œå®ƒä»¬å°†å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š JavaIdentifierTransformer.NOOP - ä¸æ‰§è¡Œä»»ä½•è½¬æ¢ã€‚ JavaIdentifierTransformer.STRICT - å¦‚æœæ‰¾åˆ°éJavaIdentifierå­—ç¬¦ï¼Œå°†æŠ›å‡ºJSONExceptionã€‚ JavaIdentifierTransformer.CAMEL_CASE - å°†ä½¿ç”¨éJavaIdentifierå’Œç©ºæ ¼å­—ç¬¦ä½œä¸ºå•è¯è¾¹ç•Œï¼Œå°†æ–°å•è¯çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™ã€‚ JavaIdentifierTransformer.WHITESPACE - å°†ä»è¾“å…¥å­—ç¬¦ä¸²ä¸­ä¿®å‰ªæ‰€æœ‰ç©ºæ ¼å’ŒéJavaIdentifierå­—ç¬¦ã€‚ JavaIdentifierTransformer.UNDERSCORE - å°†æ‰€æœ‰ç©ºæ ¼å’ŒéJavaIdentifierå­—ç¬¦è½¬æ¢ä¸ºâ€™_â€™ã€‚ æˆ–è€…è‡ªå®šä¹‰JavaIdentifierTransformers ï¼Œå¯å‚è€ƒï¼šJavaä¸­Jsonè½¬æ¢Beanå¯¹è±¡å¹¶å¿½ç•¥å¤§å°å†™ ã€‚ å‚è€ƒï¼šhttp://json-lib.sourceforge.net/usage.html https://www.ibm.com/developerworks/cn/java/j-lo-jsonlib/index.html https://blog.csdn.net/lk142500/article/details/82499387","link":"/2018/12/17/java/json/Json-lib/"},{"title":"JsonObjectè½¬ä¸ºJsonArray","text":"æŠŠJsonObjectç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºJsonArrayç±»å‹çš„å­—ç¬¦ä¸² é€šè¿‡Jacksonå®ç° 123456789101112131415161718192021222324252627/** * è½¬æ¢Jsonå­—ç¬¦ä¸²ä¸ºJsonArryå­—ç¬¦ä¸² * @param jsonString {\"xx\":\"xx\"} / [{\"xx\":\"xx\"}] * @return [{\"xx\":\"xx\"}] */public static String tranferJsonToJsonArryString(ObjectMapper mapper, String jsonString) { String jsonArray = \"\"; if(StringUtils.isBlank(jsonString)) return jsonArray; JsonFactory factory = mapper.getFactory(); try { JsonParser parser = factory.createParser(jsonString); JsonToken token = parser.nextToken(); if(JsonToken.START_OBJECT.equals(token)) { JsonNode jsonNode = mapper.readTree(jsonString); ArrayNode arrayNode = mapper.createArrayNode(); arrayNode.add(jsonNode); return mapper.writeValueAsString(arrayNode); }else if(JsonToken.START_ARRAY.equals(token)) { return jsonString; } } catch (Exception e) { e.printStackTrace(); } return jsonArray;} é€šè¿‡Json-libå®ç° 12345678910111213public static String tranferJsonToJsonArryString(String jsonString) { JSONArray jsonArry = null; Object json = new JSONTokener(jsonString).nextValue(); if(json instanceof JSONObject) { JSONObject jsonObject = JSONObject.fromObject(jsonString); jsonArry = JSONArray.fromObject(jsonObject); }else if (json instanceof JSONArray){ jsonArry = JSONArray.fromObject(jsonString); }else { return \"\"; } return jsonArry.toString(); }","link":"/2018/12/24/java/json/JsonObject%E8%BD%AC%E4%B8%BAJsonArray/"},{"title":"SoapUI SSLè®¾ç½®","text":"åœ¨SoapUI ä¸­SSLé…ç½®keystoreå’ŒkeyStorePasswordã€trustStoreå’ŒtrustStorePasswordã€‚ Fileâ€“&gt;Preferencesâ€“&gt;SSL Setting ç„¶åå°±å¯ä»¥è°ƒç”¨HTTPSåè®®çš„WebServiceã€‚","link":"/2018/10/11/java/webservice/SoapUI%20SSL%E8%AE%BE%E7%BD%AE/"},{"title":"webserviceä¹‹WSDL","text":"WSDLç®€ä»‹ WSDLï¼ˆç½‘ç»œæœåŠ¡æè¿°è¯­è¨€ï¼ŒWeb Services Description Languageï¼‰æ˜¯ä¸€é—¨åŸºäºXMLçš„è¯­è¨€ï¼Œç”¨äºæè¿°WebServiceä»¥åŠå¦‚ä½•å¯¹å®ƒä»¬è¿›è¡Œè®¿é—®ã€‚ WSDLå°†WebæœåŠ¡æè¿°å®šä¹‰ä¸ºä¸€ç»„æœåŠ¡è®¿é—®ç‚¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™äº›æœåŠ¡è®¿é—®ç‚¹å¯¹åŒ…å«é¢å‘æ–‡æ¡£ä¿¡æ¯æˆ–é¢å‘è¿‡ç¨‹è°ƒç”¨çš„æœåŠ¡è¿›è¡Œè®¿é—®ã€‚WSDLé¦–å…ˆå¯¹è®¿é—®çš„æ“ä½œå’Œè®¿é—®æ—¶ä½¿ç”¨çš„è¯·æ±‚/å“åº”æ¶ˆæ¯è¿›è¡ŒæŠ½è±¡æè¿°ï¼Œç„¶åå°†å…¶ç»‘å®šåˆ°å…·ä½“çš„ä¼ è¾“åè®®å’Œæ¶ˆæ¯æ ¼å¼ä¸Šä»¥æœ€ç»ˆå®šä¹‰å…·ä½“éƒ¨ç½²çš„æœåŠ¡è®¿é—®ç‚¹ã€‚ WSDLæ˜¯ä¸€ä¸ªç”¨äºç²¾ç¡®æè¿°WebæœåŠ¡çš„æ–‡æ¡£ï¼ŒWSDLæ–‡æ¡£æ˜¯ä¸€ä¸ªéµå¾ªWSDL XMLæ¨¡å¼çš„XMLæ–‡æ¡£ã€‚WSDLæ–‡æ¡£å°†WebæœåŠ¡å®šä¹‰ä¸ºæœåŠ¡è®¿é—®ç‚¹æˆ–ç«¯å£çš„é›†åˆã€‚åœ¨WSDLä¸­ï¼Œç”±äºæœåŠ¡è®¿é—®ç‚¹å’Œæ¶ˆæ¯çš„æŠ½è±¡å®šä¹‰å·²ä»å…·ä½“çš„æœåŠ¡éƒ¨ç½²æˆ–æ•°æ®æ ¼å¼ç»‘å®šä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥å¯¹æŠ½è±¡å®šä¹‰è¿›è¡Œå†æ¬¡ä½¿ç”¨ï¼šæ¶ˆæ¯ï¼ŒæŒ‡å¯¹äº¤æ¢æ•°æ®çš„æŠ½è±¡æè¿°ï¼›è€Œç«¯å£ç±»å‹ï¼ŒæŒ‡æ“ä½œçš„æŠ½è±¡é›†åˆã€‚ç”¨äºç‰¹å®šç«¯å£ç±»å‹çš„å…·ä½“åè®®å’Œæ•°æ®æ ¼å¼è§„èŒƒæ„æˆäº†å¯ä»¥å†æ¬¡ä½¿ç”¨çš„ç»‘å®šã€‚å°†Webè®¿é—®åœ°å€ä¸å¯å†æ¬¡ä½¿ç”¨çš„ç»‘å®šç›¸å…³è”ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªç«¯å£ï¼Œè€Œç«¯å£çš„é›†åˆåˆ™å®šä¹‰ä¸ºæœåŠ¡ã€‚ WSDLå…ƒç´  WSDLæ–‡æ¡£é€šå¸¸åŒ…å«7ä¸ªé‡è¦çš„å…ƒç´ ï¼Œå³typesã€importã€messageã€portTypeã€operationã€bindingã€serviceå…ƒç´ ã€‚æ‰€æœ‰å…ƒç´ åµŒå¥—åœ¨definitionså…ƒç´ ä¸­ï¼Œdefinitionsæ˜¯WSDLæ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚ definitions - å®ƒæ˜¯æ‰€æœ‰WSDLæ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚å®ƒå®šä¹‰WebæœåŠ¡çš„åç§°ï¼Œå£°æ˜åœ¨æ•´ä¸ªæ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨çš„å¤šä¸ªåç§°ç©ºé—´ï¼Œå¹¶åŒ…å«æ­¤å¤„æè¿°çš„æ‰€æœ‰æœåŠ¡å…ƒç´ ã€‚ Types - æ•°æ®ç±»å‹å®šä¹‰çš„å®¹å™¨ï¼Œé‡‡ç”¨XMLæ¨¡å¼çš„å½¢å¼ã€‚ Message - é€šä¿¡æ¶ˆæ¯çš„æ•°æ®ç»“æ„çš„æŠ½è±¡ç±»å‹åŒ–å®šä¹‰ã€‚ä½¿ç”¨Typesæ‰€å®šä¹‰çš„ç±»å‹æ¥å®šä¹‰æ•´ä¸ªæ¶ˆæ¯çš„æ•°æ®ç»“æ„ã€‚ Operation - å¯¹æœåŠ¡ä¸­æ‰€æ”¯æŒçš„æ“ä½œçš„æŠ½è±¡æè¿°ï¼Œä¸€èˆ¬å•ä¸ªOperationæè¿°äº†ä¸€ä¸ªè®¿é—®å…¥å£çš„è¯·æ±‚/å“åº”æ¶ˆæ¯å¯¹ã€‚ PortType - å¯¹äºæŸä¸ªè®¿é—®å…¥å£ç‚¹ç±»å‹æ‰€æ”¯æŒçš„æ“ä½œçš„æŠ½è±¡é›†åˆï¼Œè¿™äº›æ“ä½œå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡è®¿é—®ç‚¹æ¥æ”¯æŒã€‚ Binding - ç‰¹å®šç«¯å£ç±»å‹çš„å…·ä½“åè®®å’Œæ•°æ®æ ¼å¼è§„èŒƒçš„ç»‘å®šã€‚ Port - å®šä¹‰ä¸ºåè®®/æ•°æ®æ ¼å¼ç»‘å®šä¸å…·ä½“Webè®¿é—®åœ°å€ç»„åˆçš„å•ä¸ªæœåŠ¡è®¿é—®ç‚¹ã€‚ Service- ç›¸å…³æœåŠ¡è®¿é—®ç‚¹çš„é›†åˆã€‚ é™¤äº†è¿™äº›ä¸»è¦å…ƒç´ ä¹‹å¤–ï¼ŒWSDLè§„èŒƒè¿˜å®šä¹‰äº†ä»¥ä¸‹å…ƒç´  - Documentation âˆ’ æ­¤å…ƒç´ ç”¨äºæä¾›å¯è¯»çš„æ–‡æ¡£ï¼Œå¯ä»¥åŒ…å«åœ¨ä»»ä½•å…¶ä»–WSDLå…ƒç´ ä¸­ã€‚ Import âˆ’ æ­¤å…ƒç´ ç”¨äºå¯¼å…¥å…¶ä»–WSDLæ–‡æ¡£æˆ–XMLæ¶æ„ã€‚ WSDLæ–‡æ¡£ç»“æ„ 1234567891011121314151617181920212223&lt;definitions&gt; &lt;types&gt; definition of types........ &lt;/types&gt; &lt;message&gt; definition of a message.... &lt;/message&gt; &lt;portType&gt; &lt;operation&gt; definition of a operation....... &lt;/operation&gt; &lt;/portType&gt; &lt;binding&gt; definition of a binding.... &lt;/binding&gt; &lt;service&gt; definition of a service.... &lt;/service&gt;&lt;/definitions&gt; WSDLæ–‡æ¡£é˜…è¯» WSDLæ–‡æ¡£çš„é˜…è¯»é¡ºåºä»ä¸‹å¾€ä¸Šè¯»ã€‚ æ¯ä¸ªWSDLæœ‰ä¸”åªæœ‰ä¸€ä¸ªServiceèŠ‚ç‚¹ã€‚ aã€å…ˆæ‰¾ServiceèŠ‚ç‚¹ bã€ServiceèŠ‚ç‚¹ä¸­æ‰¾portèŠ‚ç‚¹ã€‚æ ¹æ®poryä¸­çš„bindingçš„åç§°æ‰¾bindingã€‚ cã€æ ¹æ®bindingèŠ‚ç‚¹ä¸­çš„typeçš„åç§°æ‰¾portTypeã€‚ dã€PortTypeä¸­æœ‰operation èŠ‚ç‚¹å°±æ˜¯æœåŠ¡çš„æ–¹æ³•ã€‚ eã€operation ä¸­æœ‰Inputï¼ˆå‚æ•°ï¼‰å’Œoutputï¼ˆè¿”å›å€¼ï¼‰ã€‚ fã€Inputï¼ˆå‚æ•°ï¼‰å’Œoutputï¼ˆè¿”å›å€¼ï¼‰å¯¹åº”messageèŠ‚ç‚¹ã€‚ gã€Messageå¯¹åº”elementèŠ‚ç‚¹ã€‚ElementèŠ‚ç‚¹å¯¹åº”complexTypeèŠ‚ç‚¹æè¿°äº†å‚æ•°åŠè¿”å›å€¼çš„æ•°æ®ç±»å‹ã€‚ WSDLæ–‡æ¡£è§£æ wsdlæ–‡æ¡£ç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;&lt;wsdl:definitions targetNamespace=\"http://com.liuxiang.xfireDemo/HelloService\" xmlns:tns=\"http://com.liuxiang.xfireDemo/HelloService\" xmlns:wsdlsoap=\"http://schemas.xmlsoap.org/wsdl/soap/\" xmlns:soap12=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenc11=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:soapenc12=\"http://www.w3.org/2003/05/soap-encoding\" xmlns:soap11=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:wsdl=\"http://schemas.xmlsoap.org/wsdl/\"&gt; &lt;wsdl:types&gt; &lt;xs:schema elementFormDefault=\"unqualified\" targetNamespace=\"http://webservice.testenroll.com/\" version=\"1.0\"&gt; &lt;xsd:element name=\"sayHello\"&gt; &lt;xsd:complexType&gt; &lt;xsd:sequence&gt; &lt;xsd:element maxOccurs=\"1\" minOccurs=\"1\" name=\"name\" nillable=\"true\" type=\"xsd:string\" /&gt; &lt;/xsd:sequence&gt; &lt;/xsd:complexType&gt; &lt;/xsd:element&gt; &lt;xsd:element name=\"sayHelloResponse\"&gt; &lt;xsd:complexType&gt; &lt;xsd:sequence&gt; &lt;xsd:element maxOccurs=\"1\" minOccurs=\"1\" name=\"out\" nillable=\"true\" type=\"xsd:string\" /&gt; &lt;/xsd:sequence&gt; &lt;/xsd:complexType&gt; &lt;/xsd:element&gt; &lt;/xsd:schema&gt; &lt;/wsdl:types&gt; &lt;wsdl:message name=\"sayHelloResponse\"&gt; &lt;wsdl:part name=\"parameters\" element=\"tns:sayHelloResponse\" /&gt; &lt;/wsdl:message&gt; &lt;wsdl:message name=\"sayHelloRequest\"&gt; &lt;wsdl:part name=\"parameters\" element=\"tns:sayHello\" /&gt; &lt;/wsdl:message&gt; &lt;wsdl:portType name=\"HelloServicePortType\"&gt; &lt;wsdl:operation name=\"sayHello\"&gt; &lt;wsdl:input name=\"sayHelloRequest\" message=\"tns:sayHelloRequest\" /&gt; &lt;wsdl:output name=\"sayHelloResponse\" message=\"tns:sayHelloResponse\" /&gt; &lt;/wsdl:operation&gt; &lt;/wsdl:portType&gt; &lt;wsdl:binding name=\"HelloServiceHttpBinding\" type=\"tns:HelloServicePortType\"&gt; &lt;wsdlsoap:binding style=\"document\" transport=\"http://schemas.xmlsoap.org/soap/http\" /&gt; &lt;wsdl:operation name=\"sayHello\"&gt; &lt;wsdlsoap:operation soapAction=\"\" /&gt; &lt;wsdl:input name=\"sayHelloRequest\"&gt; &lt;wsdlsoap:body use=\"literal\" /&gt; &lt;/wsdl:input&gt; &lt;wsdl:output name=\"sayHelloResponse\"&gt; &lt;wsdlsoap:body use=\"literal\" /&gt; &lt;/wsdl:output&gt; &lt;/wsdl:operation&gt; &lt;/wsdl:binding&gt; &lt;wsdl:service name=\"HelloService\"&gt; &lt;wsdl:port name=\"HelloServiceHttpPort\" binding=\"tns:HelloServiceHttpBinding\"&gt; &lt;wsdlsoap:address location=\"http://localhost:8080/services/HelloService\" /&gt; &lt;/wsdl:port&gt; &lt;/wsdl:service&gt;&lt;/wsdl:definitions&gt; æœåŠ¡æ”¯æŒåä¸ºsayHelloçš„å”¯ä¸€æ“ä½œï¼ŒsayHelloæ“ä½œé€šè¿‡åœ¨httpä¸Šè¿è¡ŒSOAPåè®®æ¥å®ç°çš„ã€‚è¯·æ±‚æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²nameï¼Œç»è¿‡å¤„ç†åè¿”å›ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚1ã€definitionså…ƒç´  æ‰€æœ‰çš„WSDLæ–‡æ¡£çš„æ ¹å…ƒç´ å‡æ˜¯definitionså…ƒç´ ã€‚definitionså…ƒç´ å°è£…äº†æ•´ä¸ªæ–‡æ¡£ï¼ŒåŒæ—¶é€šè¿‡å…¶nameæä¾›äº†ä¸€ä¸ªWSDLæ–‡æ¡£ã€‚é™¤äº†æä¾›ä¸€ä¸ªå‘½åç©ºé—´å¤–ï¼Œdefinitionså…ƒç´ æ²¡æœ‰å…¶ä»–ä½œç”¨ã€‚ 2ã€typeså…ƒç´  WSDLé‡‡ç”¨äº†W3C XMLæ¨¡å¼å†…ç½®ç±»å‹ä½œä¸ºå…¶åŸºæœ¬ç±»å‹ç³»ç»Ÿã€‚typeså…ƒç´ ç”¨ä½œä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºå®šä¹‰XMLæ¨¡å¼å†…ç½®ç±»å‹ä¸­æ²¡æœ‰æè¿°çš„å„ç§æ•°æ®ç±»å‹ã€‚å½“å£°æ˜æ¶ˆæ¯éƒ¨åˆ†çš„æœ‰æ•ˆè´Ÿè½½æ—¶ï¼Œæ¶ˆæ¯å®šä¹‰ä½¿ç”¨äº†åœ¨typeså…ƒç´ ä¸­å®šä¹‰çš„æ•°æ®ç±»å‹å’Œå…ƒç´ ã€‚åœ¨æœ¬æ–‡çš„WSDLæ–‡æ¡£ä¸­çš„typeså®šä¹‰ï¼š1234567891011121314151617181920&lt;wsdl:types&gt; &lt;xs:schema elementFormDefault=\"unqualified\" targetNamespace=\"http://webservice.testenroll.com/\" version=\"1.0\"&gt; &lt;xsd:element name=\"sayHello\"&gt; &lt;xsd:complexType&gt; &lt;xsd:sequence&gt; &lt;xsd:element maxOccurs=\"1\" minOccurs=\"1\" name=\"name\" nillable=\"true\" type=\"xsd:string\" /&gt; &lt;/xsd:sequence&gt; &lt;/xsd:complexType&gt; &lt;/xsd:element&gt; &lt;xsd:element name=\"sayHelloResponse\"&gt; &lt;xsd:complexType&gt; &lt;xsd:sequence&gt; &lt;xsd:element maxOccurs=\"1\" minOccurs=\"1\" name=\"out\" nillable=\"true\" type=\"xsd:string\" /&gt; &lt;/xsd:sequence&gt; &lt;/xsd:complexType&gt; &lt;/xsd:element&gt; &lt;/xsd:schema&gt; &lt;/wsdl:types&gt; æ•°æ®å®šä¹‰éƒ¨åˆ†å®šä¹‰äº†ä¸¤ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæ˜¯sayHelloï¼Œä¸€ä¸ªæ˜¯sayHelloResponseï¼š sayHelloï¼šå®šä¹‰äº†ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œä»…ä»…åŒ…å«ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œå°†æ¥ç”¨æ¥æè¿°æ“ä½œçš„å‚å…¥ä¼ å…¥éƒ¨åˆ†ï¼› sayHelloResponseï¼šå®šä¹‰äº†ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œä»…ä»…åŒ…å«ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œå°†æ¥ç”¨æ¥æè¿°æ“ä½œçš„è¿”å›å€¼ã€‚3ã€importå…ƒç´  importå…ƒç´ ä½¿å¾—å¯ä»¥åœ¨å½“å‰çš„WSDLæ–‡æ¡£ä¸­ä½¿ç”¨å…¶ä»–WSDLæ–‡æ¡£ä¸­æŒ‡å®šçš„å‘½åç©ºé—´ä¸­çš„å®šä¹‰å…ƒç´ ã€‚æœ¬ä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨importå…ƒç´ ã€‚é€šå¸¸åœ¨ç”¨æˆ·å¸Œæœ›æ¨¡å—åŒ–WSDLæ–‡æ¡£çš„æ—¶å€™ï¼ŒimportåŠŸèƒ½æ˜¯éå¸¸æœ‰æ•ˆæœçš„ã€‚ importçš„æ ¼å¼å¦‚ä¸‹ï¼š1&lt;wsdl:import namespace=\"http://xxx.xxx.xxx/xxx/xxx\" location=\"http://xxx.xxx.xxx/xxx/xxx.wsdl\"/&gt; å¿…é¡»æœ‰namespaceå±æ€§å’Œlocationå±æ€§ï¼š namespaceå±æ€§ï¼šå€¼å¿…é¡»ä¸æ­£å¯¼å…¥çš„WSDLæ–‡æ¡£ä¸­å£°æ˜çš„targetNamespaceç›¸åŒ¹é…ï¼› locationå±æ€§ï¼šå¿…é¡»æŒ‡å‘ä¸€ä¸ªå®é™…çš„WSDLæ–‡æ¡£ï¼Œå¹¶ä¸”è¯¥æ–‡æ¡£ä¸èƒ½ä¸ºç©ºã€‚4ã€messageå…ƒç´  messageå…ƒç´ æè¿°äº†WebæœåŠ¡ä½¿ç”¨æ¶ˆæ¯çš„æœ‰æ•ˆè´Ÿè½½ã€‚messageå…ƒç´ å¯ä»¥æè¿°è¾“å‡ºæˆ–è€…æ¥å—æ¶ˆæ¯çš„æœ‰æ•ˆè´Ÿè½½ï¼›è¿˜å¯ä»¥æè¿°SOAPæ–‡ä»¶å¤´å’Œé”™è¯¯detailå…ƒç´ çš„å†…å®¹ã€‚å®šä¹‰messageå…ƒç´ çš„æ–¹å¼å–å†³äºä½¿ç”¨RPCæ ·å¼è¿˜æ˜¯æ–‡æ¡£æ ·å¼çš„æ¶ˆæ¯ä¼ é€’ã€‚åœ¨æœ¬æ–‡ä¸­çš„messageå…ƒç´ çš„å®šä¹‰ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨äº†é‡‡ç”¨æ–‡æ¡£æ ·å¼çš„æ¶ˆæ¯ä¼ é€’ï¼š123456&lt;wsdl:message name=\"sayHelloResponse\"&gt; &lt;wsdl:part name=\"parameters\" element=\"tns:sayHelloResponse\" /&gt; &lt;/wsdl:message&gt; &lt;wsdl:message name=\"sayHelloRequest\"&gt; &lt;wsdl:part name=\"parameters\" element=\"tns:sayHello\" /&gt;&lt;/wsdl:message&gt; æ¶ˆæ¯æ ¼å¼çš„æŠ½è±¡å®šä¹‰ï¼šå®šä¹‰äº†ä¸¤ä¸ªæ¶ˆæ¯sayHelloResponseå’ŒsayHelloRequestï¼š sayHelloRequestï¼šsayHelloæ“ä½œçš„è¯·æ±‚æ¶ˆæ¯æ ¼å¼ï¼Œç”±ä¸€ä¸ªæ¶ˆæ¯ç‰‡æ–­ç»„æˆï¼Œåå­—ä¸ºparameters,å…ƒç´ æ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„typesä¸­çš„å…ƒç´ ï¼› sayHelloResponseï¼šsayHelloæ“ä½œçš„å“åº”æ¶ˆæ¯æ ¼å¼ï¼Œç”±ä¸€ä¸ªæ¶ˆæ¯ç‰‡æ–­ç»„æˆï¼Œåå­—ä¸ºparameters,å…ƒç´ æ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„typesä¸­çš„å…ƒç´ ï¼› å¦‚æœé‡‡ç”¨RPCæ ·å¼çš„æ¶ˆæ¯ä¼ é€’ï¼Œåªéœ€è¦å°†æ–‡æ¡£ä¸­çš„elementå…ƒç´ åº”ä»¥ä¿®æ”¹ä¸ºtypeå³å¯ã€‚5ã€portTypeå…ƒç´  portTypeå…ƒç´ å®šä¹‰äº†WebæœåŠ¡çš„æŠ½è±¡æ¥å£ã€‚è¯¥æ¥å£æœ‰ç‚¹ç±»ä¼¼Javaçš„æ¥å£ï¼Œéƒ½æ˜¯å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»å‹å’Œæ–¹æ³•ï¼Œæ²¡æœ‰å®šä¹‰å®ç°ã€‚åœ¨WSDLä¸­ï¼ŒportTypeå…ƒç´ æ˜¯ç”±bindingå’Œserviceå…ƒç´ æ¥å®ç°çš„ï¼Œè¿™ä¸¤ä¸ªå…ƒç´ ç”¨æ¥è¯´æ˜WebæœåŠ¡å®ç°ä½¿ç”¨çš„Internetåè®®ã€ç¼–ç æ–¹æ¡ˆä»¥åŠInternetåœ°å€ã€‚ä¸€ä¸ªportTypeä¸­å¯ä»¥å®šä¹‰å¤šä¸ªoperationï¼Œä¸€ä¸ªoperationå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæœ¬æ–‡ä¸­WSDLæ–‡æ¡£çš„å®šä¹‰ 12345678&lt;wsdl:portType name=\"HelloServicePortType\"&gt; &lt;wsdl:operation name=\"sayHello\"&gt; &lt;wsdl:input name=\"sayHelloRequest\" message=\"tns:sayHelloRequest\" /&gt; &lt;wsdl:output name=\"sayHelloResponse\" message=\"tns:sayHelloResponse\" /&gt; &lt;/wsdl:operation&gt;&lt;/wsdl:portType&gt; portTypeå®šä¹‰äº†æœåŠ¡çš„è°ƒç”¨æ¨¡å¼çš„ç±»å‹ï¼ŒåŒ…å«ä¸€ä¸ªæ“ä½œsayHelloæ–¹æ³•ï¼ŒåŒæ—¶åŒ…å«inputå’Œoutputè¡¨æ˜è¯¥æ“ä½œæ˜¯ä¸€ä¸ªè¯·æ±‚ï¼å“åº”æ¨¡å¼ï¼Œè¯·æ±‚æ¶ˆæ¯æ˜¯å‰é¢å®šä¹‰çš„sayHelloRequestï¼Œå“åº”æ¶ˆæ¯æ˜¯å‰é¢å®šä¹‰çš„sayHelloResponseã€‚inputè¡¨ç¤ºä¼ é€’åˆ°WebæœåŠ¡çš„æœ‰æ•ˆè´Ÿè½½ï¼Œoutputæ¶ˆæ¯è¡¨ç¤ºä¼ é€’ç»™å®¢æˆ·çš„æœ‰æ•ˆè´Ÿè½½ã€‚6ã€bindingå…ƒç´  bindingå…ƒç´ å°†ä¸€ä¸ªæŠ½è±¡portTypeæ˜ å°„åˆ°ä¸€ç»„å…·ä½“åè®®(SOAOå’ŒHTTP)ã€æ¶ˆæ¯ä¼ é€’æ ·å¼ã€ç¼–ç æ ·å¼ã€‚é€šå¸¸bindingå…ƒç´ ä¸åè®®ä¸“æœ‰çš„å…ƒç´ å’Œåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæœ¬æ–‡ä¸­çš„ä¾‹å­ï¼š1234567891011121314&lt;wsdl:binding name=\"HelloServiceHttpBinding\" type=\"tns:HelloServicePortType\"&gt; &lt;wsdlsoap:binding style=\"document\" transport=\"http://schemas.xmlsoap.org/soap/http\" /&gt; &lt;wsdl:operation name=\"sayHello\"&gt; &lt;wsdlsoap:operation soapAction=\"\" /&gt; &lt;wsdl:input name=\"sayHelloRequest\"&gt; &lt;wsdlsoap:body use=\"literal\" /&gt; &lt;/wsdl:input&gt; &lt;wsdl:output name=\"sayHelloResponse\"&gt; &lt;wsdlsoap:body use=\"literal\" /&gt; &lt;/wsdl:output&gt; &lt;/wsdl:operation&gt;&lt;/wsdl:binding&gt; bindingå…ƒç´ å°†æœåŠ¡è®¿é—®ç‚¹çš„æŠ½è±¡å®šä¹‰ä¸SOAP HTTPç»‘å®šï¼Œæè¿°å¦‚ä½•é€šè¿‡SOAP/HTTPæ¥è®¿é—®æŒ‰ç…§å‰é¢æè¿°çš„è®¿é—®å…¥å£ç‚¹ç±»å‹éƒ¨ç½²çš„è®¿é—®å…¥å£ã€‚å…¶ä¸­è§„å®šäº†åœ¨å…·ä½“SOAPè°ƒç”¨æ—¶ï¼Œåº”å½“ä½¿ç”¨çš„soapActionæ˜¯&quot;&quot;ã€‚7ã€serviceå…ƒç´ å’Œportå…ƒç´  serviceå…ƒç´ åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªportå…ƒç´ ï¼Œå…¶ä¸­æ¯ä¸ªportå…ƒç´ è¡¨ç¤ºä¸€ä¸ªä¸åŒçš„WebæœåŠ¡ã€‚portå…ƒç´ å°†URLèµ‹ç»™ä¸€ä¸ªç‰¹å®šçš„bindingï¼Œç”šè‡³å¯ä»¥ä½¿ä¸¤ä¸ªæˆ–è€…å¤šä¸ªportå…ƒç´ å°†ä¸åŒçš„URLèµ‹å€¼ç»™ç›¸åŒçš„bindingã€‚æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼š1234567&lt;wsdl:service name=\"HelloService\"&gt; &lt;wsdl:port name=\"HelloServiceHttpPort\" binding=\"tns:HelloServiceHttpBinding\"&gt; &lt;wsdlsoap:address location=\"http://localhost:8080/services/HelloService\" /&gt; &lt;/wsdl:port&gt;&lt;/wsdl:service&gt; è¿™éƒ¨åˆ†æ˜¯å…·ä½“çš„WebæœåŠ¡çš„å®šä¹‰ï¼Œåœ¨è¿™ä¸ªåä¸ºHelloServiceçš„WebæœåŠ¡ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªæœåŠ¡è®¿é—®å…¥å£ï¼Œè®¿é—®åœ°å€æ˜¯http://localhost:8080/xfire/services/HelloServiceï¼Œä½¿ç”¨çš„æ¶ˆæ¯æ¨¡å¼æ˜¯ç”±å‰é¢çš„bindingæ‰€å®šä¹‰çš„ã€‚å‚è€ƒï¼šhttp://blog.51cto.com/9291927/1914044 https://www.tutorialspoint.com/wsdl/wsdl_elements.htm","link":"/2018/10/18/java/webservice/webservice%E4%B9%8Bwsdl%EF%BC%88%E4%B8%89%EF%BC%89/"},{"title":"webserviceæ¡†æ¶","text":"webserviceæ¡†æ¶ 1ã€JWS JWSæ˜¯Javaè¯­è¨€å¯¹WebServiceæœåŠ¡çš„ä¸€ç§å®ç°ï¼Œç”¨æ¥å¼€å‘å’Œå‘å¸ƒæœåŠ¡ã€‚è€Œä»æœåŠ¡æœ¬èº«çš„è§’åº¦æ¥çœ‹JWSæœåŠ¡æ˜¯æ²¡æœ‰è¯­è¨€ç•Œé™çš„ã€‚ä½†æ˜¯Javaè¯­è¨€ä¸ºJavaå¼€å‘è€…æä¾›ä¾¿æ·å‘å¸ƒå’Œè°ƒç”¨WebServiceæœåŠ¡çš„ä¸€ç§é€”å¾„ã€‚ 2ã€Axis2 3ã€XFire XFireæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„WebServiceæ¡†æ¶ï¼Œåœ¨Java6ä¹‹å‰ï¼Œå®ƒçš„çŸ¥ååº¦ç”šè‡³è¶…è¿‡äº†Apacheçš„Axis2ï¼ŒXFireçš„ä¼˜ç‚¹æ˜¯å¼€å‘æ–¹ä¾¿ï¼Œä¸ç°æœ‰çš„Webæ•´åˆå¾ˆå¥½ï¼Œå¯ä»¥èä¸ºä¸€ä½“ï¼Œå¹¶ä¸”å¼€å‘ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯å¯¹Javaä¹‹å¤–çš„è¯­è¨€ï¼Œæ²¡æœ‰æä¾›ç›¸å…³çš„ä»£ç å·¥å…·ã€‚XFireåæ¥è¢«Apacheæ”¶è´­äº†ï¼ŒåŸå› æ˜¯å®ƒå¤ªä¼˜ç§€äº†ï¼Œæ”¶è´­åï¼Œéšç€Java6 JWSçš„å…´èµ·ï¼Œå¼€æºçš„WebServiceå¼•æ“å·²ç»ä¸å†è¢«çœ‹å¥½ï¼Œæ¸æ¸çš„éƒ½è´¥è½äº†ã€‚ 4ã€CXF å‡ ç§æ¡†æ¶çš„æ€»ç»“ï¼š aï¼šç›®å‰å¼€å‘Web Serviceçš„å‡ ä¸ªæ¡†æ¶ï¼Œåˆ†åˆ«ä¸ºAxisï¼Œaxis2ï¼ŒXfireï¼ŒCXFä»¥åŠJWS(ä¹Ÿå°±æ˜¯å‰é¢æ‰€è¿°çš„JAX-WSï¼Œè¿™æ˜¯Java6å‘å¸ƒæ‰€æä¾›çš„å¯¹Web ServiceæœåŠ¡çš„ä¸€ç§å®ç°ã€‚) bï¼šAxisä¸XFireå·²éšç€æŠ€æœ¯ä¸æ–­çš„æ›´æ›¿æ…¢æ…¢è½å¹•ï¼Œéƒ½å·²ä¸å†æ›´æ–°ã€‚ cï¼šä»¥axis2ä¸cxfæ‰€æœ€ä¸ºå¸¸ç”¨ï¼Œç›®å‰ä¹Ÿåªæœ‰axis2å’Œcxfå®˜æ–¹æœ‰æ›´æ–°ã€‚ dï¼šä»ä½¿ç”¨åœºæ™¯æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦å¤šè¯­è¨€çš„æ”¯æŒï¼Œä½ åº”è¯¥é€‰æ‹©AXIS2ã€‚å¦‚æœä½ éœ€è¦æŠŠä½ çš„å®ç°ä¾§é‡JAVAå¹¶å¸Œæœ›å’ŒSpringé›†æˆï¼ŒCXFå°±æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ å‚è€ƒï¼šhttps://www.cnblogs.com/domi22/p/8060330.html","link":"/2018/10/18/java/webservice/webservice%E6%A1%86%E6%9E%B6/"},{"title":"webserviceä¹‹SAOP","text":"SAOPåè®® SOAPï¼ˆSimple Object Accrss Protocolï¼Œç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯ä¸€ç§ç®€å•çš„åŸºäºXMLå’ŒHTTPçš„åè®®ï¼Œå¯ä»¥ä½¿åº”ç”¨ç¨‹åºåœ¨åˆ†æ•£æˆ–åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­é€šè¿‡HTTPæ¥äº¤æ¢ä¿¡æ¯ã€‚ SOAPæ˜¯Web Serviceçš„é€šä¿¡åè®®ã€‚å½“ç”¨æˆ·é€šè¿‡UDDIæ‰¾åˆ°ä½ çš„WSDLæè¿°æ–‡æ¡£åï¼Œä»–é€šè¿‡å¯ä»¥SOAPè°ƒç”¨ä½ å»ºç«‹çš„WebæœåŠ¡ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œã€‚SOAPæ˜¯XMLæ–‡æ¡£å½¢å¼çš„è°ƒç”¨æ–¹æ³•çš„è§„èŒƒï¼Œå¯ä»¥æ”¯æŒä¸åŒçš„åº•å±‚æ¥å£ï¼ŒåƒHTTP(S)æˆ–è€…SMTPã€‚ SOAPæ¶ˆæ¯åŸºæœ¬ä¸Šæ˜¯ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„å•å‘ä¼ è¾“ï¼Œå¸¸å¸¸ç»“åˆèµ·æ¥æ‰§è¡Œç±»ä¼¼äºè¯·æ±‚/åº”ç­”çš„æ¨¡å¼ã€‚ä¸éœ€è¦æŠŠSOAPæ¶ˆæ¯ç»‘å®šåˆ°ç‰¹å®šçš„åè®®ï¼ŒSOAPå¯ä»¥è¿è¡Œåœ¨ä»»ä½•å…¶ä»–ä¼ è¾“åè®®ï¼ˆHTTPã€SMTPã€FTPç­‰ï¼‰ä¸Šã€‚å¦å¤–ï¼ŒSOAPæä¾›äº†æ ‡å‡†çš„RPCæ–¹æ³•æ¥è°ƒç”¨Web Serviceä»¥è¯·æ±‚/å“åº”æ¨¡å¼è¿è¡Œã€‚ SOAPæ¶ˆæ¯ç»„æˆ æ‰€æœ‰çš„SOAPæ¶ˆæ¯éƒ½ä½¿ç”¨XMLç¼–ç ï¼Œä¸€æ¡SOAPæ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„XMLæ–‡æ¡£ï¼Œæ–‡æ¡£åŒ…æ‹¬ä¸‹åˆ—å…ƒç´ ï¼š Envelopeï¼ˆä¿¡å°ï¼‰å…ƒç´ ï¼Œå¿…é€‰ï¼Œå¯æŠŠæ­¤XMLæ–‡æ¡£æ ‡è¯†ä¸ºä¸€æ¡SOAPæ¶ˆæ¯ã€‚å®šä¹‰æ¶ˆæ¯çš„å¼€å¤´å’Œç»“å°¾ã€‚ Headerï¼ˆæŠ¥å¤´ï¼‰å…ƒç´ ï¼Œå¯é€‰ï¼ŒåŒ…å«å¤´éƒ¨ä¿¡æ¯ï¼ˆåŒ…å«äº†ä½¿æ¶ˆæ¯åœ¨åˆ°è¾¾æœ€ç»ˆç›®çš„åœ°ä¹‹å‰ï¼Œèƒ½å¤Ÿè¢«è·¯ç”±åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸­é—´èŠ‚ç‚¹çš„ä¿¡æ¯ï¼‰ã€‚ Body(ä¸»ä½“)å…ƒç´ ï¼Œå¿…é€‰ï¼ŒåŒ…å«æ‰€æœ‰çš„è°ƒç”¨å’Œå“åº”ä¿¡æ¯ã€‚ Faultå…ƒç´ ï¼Œä½äºBodyå†…ï¼Œå¯é€‰ï¼Œæä¾›æœ‰å…³å¤„ç†æ­¤æ¶ˆæ¯æ‰€å‘ç”Ÿé”™è¯¯çš„ä¿¡æ¯ã€‚ Attachmentï¼ˆé™„ä»¶ï¼‰å…ƒç´ ï¼Œå¯é€‰ï¼Œå¯é€šè¿‡æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªé™„ä»¶æ‰©å±•SOAPæ¶ˆæ¯ã€‚ SOAPåŸºæœ¬æ¶ˆæ¯ç»“æ„ 1234567891011121314151617181920&lt;?xml version=\"1.0\"?&gt;&lt;soap:Envelopexmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;soap:Header&gt; ... ...&lt;/soap:Header&gt; &lt;soap:Body&gt; ... ... &lt;soap:Fault&gt; ... ... &lt;/soap:Fault&gt;&lt;/soap:Body&gt; &lt;/soap:Envelope&gt; SOAP Envelopeå…ƒç´  SOAP Envelope æ˜¯SOAPæ¶ˆæ¯ç»“æ„çš„ä¸»è¦å®¹å™¨ï¼Œä¹Ÿæ˜¯SOAPæ¶ˆæ¯çš„æ ¹å…ƒç´ ï¼Œå¿…é¡»å‡ºç°åœ¨æ¯ä¸ªSOAPæ¶ˆæ¯ä¸­ï¼Œç”¨äºæŠŠæ­¤XMLæ–‡æ¡£æ ‡ç¤ºä¸ºä¸€æ¡SOAPæ¶ˆæ¯ã€‚ Aã€å‘½åç©ºé—´ åœ¨SOAPä¸­ï¼Œä½¿ç”¨XMLå‘½åç©ºé—´å°†SOAPæ ‡ç¤ºç¬¦ä¸åº”ç”¨ç¨‹åºç‰¹å®šçš„æ ‡ç¤ºç¬¦åŒºåˆ†å¼€ï¼Œå°†SOAPæ¶ˆæ¯çš„å…ƒç´ çš„ä½œç”¨åŸŸé™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šçš„é¢†åŸŸã€‚å¦‚æœä½¿ç”¨äº†ä¸åŒçš„å‘½åç©ºé—´ï¼Œåº”ç”¨ç¨‹åºä¼šå‘ç”Ÿé”™è¯¯ï¼Œå¹¶æŠ›å¼ƒæ­¤æ¶ˆæ¯ã€‚ SOAPæ¶ˆæ¯å¿…é¡»æ‹¥æœ‰ä¸å‘½åç©ºé—´ç›¸å…³è”çš„ä¸€ä¸ªEnvelopeå…ƒç´ ï¼ŒSOAPæ¶ˆæ¯ä¸­æ‰€æœ‰å…ƒç´ å¿…é¡»ç”±ç¬¬ä¸€ä¸ªå‘½åç©ºé—´è¿›è¡Œé™å®šã€‚SOAP 1.1è§„èŒƒå¦‚ä¸‹ï¼š 123&lt;soap-env:Envelope xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;&lt;/soap-env:Envelope&gt; SOAP 1.2è§„èŒƒå¦‚ä¸‹ï¼š 123&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"&gt; &lt;/soap:Envelope&gt; Bã€encodingStyleå±æ€§ SOAPçš„encodingStyleå±æ€§ç”¨äºå®šä¹‰åœ¨æ–‡æ¡£ä¸­ä½¿ç”¨çš„ç¼–ç è§„åˆ™ï¼ŒencodingStyleå±æ€§å¯å‡ºç°åœ¨ä»»ä½•SOAPå…ƒç´ ä¸­ï¼Œå¹¶ä¼šè¢«åº”ç”¨åˆ°å…ƒç´ çš„å†…å®¹åŠå…ƒç´ çš„æ‰€æœ‰å­å…ƒç´ ä¸Šã€‚SOAPæ¶ˆæ¯æ²¡æœ‰é»˜è®¤çš„ç¼–ç æ–¹å¼ã€‚SOAP 1.1è§„èŒƒå¦‚ä¸‹ï¼š 1234&lt;soap-env:Envelope xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"Soap-env:encodingStyle =â€œhttp://schemas.xmlsoap.org/soap/encoding/â€&gt; &lt;/ soap-env:Envelope&gt; SOAP 1.2è§„èŒƒå¦‚ä¸‹ï¼š 1234&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt;&lt;/soap:Envelope&gt; SOAP Headerå…ƒç´  SOAP Headerå…ƒç´ åº”å½“ä½œä¸ºSOAP Envelopeçš„ç¬¬ä¸€ä¸ªç›´æ¥å­å…ƒç´ ï¼Œå¿…é¡»ä½¿ç”¨æœ‰æ•ˆçš„å‘½åç©ºé—´ã€‚Headerè¿˜å¯ä»¥åŒ…å«0ä¸ªæˆ–å¤šä¸ªå¯é€‰çš„å­å…ƒç´ ï¼Œå­å…ƒç´ ç§°ä¸ºHeaderé¡¹ï¼Œæ‰€æœ‰çš„Headeré¡¹éƒ½å¿…é¡»æ˜¯å®Œæ•´ä¿®é¥°çš„ï¼Œå³å¿…é¡»ç”±ä¸€ä¸ªå‘½åç©ºé—´URIå’Œå±€éƒ¨åç»„æˆï¼Œä¸å…è®¸æ²¡æœ‰å‘½åç©ºé—´ä¿®é¥°çš„Headeré¡¹å­˜åœ¨ã€‚ Headerå…ƒç´ ç”¨äºä¸æ¶ˆæ¯ä¸€èµ·ä¼ è¾“é™„åŠ æ¶ˆæ¯ï¼Œå¦‚èº«ä»½éªŒè¯æˆ–äº‹åŠ¡ä¿¡æ¯ã€‚Headerå…ƒç´ ä¹Ÿå¯ä»¥åŒ…å«æŸäº›å±æ€§ã€‚SOAPåœ¨é»˜è®¤çš„å‘½åç©ºé—´ä¸­å®šä¹‰äº†ä¸‰ä¸ªå±æ€§ï¼šactorï¼ŒmustUnderstandä»¥åŠencodingStyleã€‚è¿™äº›è¢«å®šä¹‰åœ¨SOAPå¤´éƒ¨çš„å±æ€§å¯é€šçŸ¥å®¹å™¨å¦‚ä½•å¯¹SOAPæ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚12345678910111213&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV = \" http://www.w3.org/2001/12/soap-envelope\" SOAP-ENV:encodingStyle = \" http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;SOAP-ENV:Header&gt; &lt;t:Transaction xmlns:t = \"http://www.tutorialspoint.com/transaction/\" SOAP-ENV:mustUnderstand = \"true\"&gt;5 &lt;/t:Transaction&gt; &lt;/SOAP-ENV:Header&gt; ... ...&lt;/SOAP-ENV:Envelope&gt; Cã€actorå±æ€§ SOAPæ¶ˆæ¯å¯èƒ½é€šè¿‡æ²¿æ¶ˆæ¯è·¯å¾„ä¼ é€’ä¸€ç»„SOAPä¸­ä»‹ï¼Œä»å‡ºå‘åœ°ä¼ æ’­åˆ°æœ€ç»ˆç›®çš„åœ°ã€‚SOAPä¸­ä»‹æ˜¯ä¸€ç§èƒ½å¤Ÿæ¥æ”¶å’Œè½¬å‘SOAPæ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚SOAP actorå…¨å±€å±æ€§å¯ç”¨äºæŒ‡ç¤ºæ ‡å¤´å…ƒç´ çš„æ¥æ”¶è€…ã€‚SOAP actorå±æ€§çš„å€¼æ˜¯URIã€‚ SOAPçš„actorå±æ€§å¯è¢«ç”¨äºå°†Headerå…ƒç´ å¯»å€åˆ°ä¸€ä¸ªç‰¹å®šçš„ç«¯ç‚¹ã€‚ 1234567891011121314151617&lt;?xml version=\"1.0\"?&gt;&lt;soap:Envelopexmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;soap:Header&gt;&lt;m:Transxmlns:m=\"http://www.w3school.com.cn/transaction/\"soap:actor=\"http://www.w3school.com.cn/appml/\"&gt;234&lt;/m:Trans&gt;&lt;/soap:Header&gt; ...... &lt;/soap:Envelope&gt; Dã€mustUnderstandå±æ€§ SOAPçš„mustUnderstandå±æ€§å¯ç”¨äºæ ‡è¯†æ ‡é¢˜é¡¹å¯¹äºè¦å¯¹å…¶è¿›è¡Œå¤„ç†çš„æ¥æ”¶è€…æ¥è¯´æ˜¯å¼ºåˆ¶çš„è¿˜æ˜¯å¯é€‰çš„ã€‚ å‡å¦‚å‘Headerå…ƒç´ çš„æŸä¸ªå­å…ƒç´ æ·»åŠ äº†&quot;mustUnderstand=&quot;1&quot;ï¼Œåˆ™å®ƒå¯æŒ‡ç¤ºå¤„ç†æ­¤å¤´éƒ¨çš„æ¥æ”¶è€…å¿…é¡»è®¤å¯æ­¤å…ƒç´ ã€‚å‡å¦‚æ­¤æ¥æ”¶è€…æ— æ³•è®¤å¯æ­¤å…ƒç´ ï¼Œåˆ™åœ¨å¤„ç†æ­¤å¤´éƒ¨æ—¶å¿…é¡»å¤±æ•ˆã€‚1234567891011121314151617&lt;?xml version=\"1.0\"?&gt;&lt;soap:Envelopexmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;soap:Header&gt;&lt;m:Transxmlns:m=\"http://www.w3school.com.cn/transaction/\"soap:mustUnderstand=\"1\"&gt;234&lt;/m:Trans&gt;&lt;/soap:Header&gt; ...... &lt;/soap:Envelope&gt; Eã€SOAP Bodyå…ƒç´  SOAPçš„bodyæ˜¯å¿…éœ€å…ƒç´ ï¼ŒåŒ…å«åœ¨SOAPæ¶ˆæ¯ä¸­äº¤æ¢çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„XMLæ•°æ®ã€‚ SOAPæ¶ˆæ¯çš„Bodyå—å¯ä»¥åŒ…å«ä»¥ä¸‹ä»»ä½•å…ƒç´ ï¼š RPCæ–¹æ³•åŠå…¶å‚æ•° ç›®æ ‡åº”ç”¨ç¨‹åºï¼ˆæ¶ˆæ¯æ¥æ”¶è€…ï¼‰ä¸“ç”¨æ•°æ® æŠ¥å‘Šæ•…éšœå’ŒçŠ¶æ€æ¶ˆæ¯çš„SOAP Fault SOAP Bodyå…ƒç´ çš„ç›´æ¥å­å…ƒç´ å¯ä»¥æ˜¯åˆæ ¼çš„å‘½åç©ºé—´ã€‚SOAPåœ¨é»˜è®¤çš„å‘½åç©ºé—´ä¸­(â€œhttp://www.w3.org/2001/12/soap-envelope&quot;)å®šä¹‰äº†Bodyå…ƒç´ å†…éƒ¨çš„ä¸€ä¸ªå…ƒç´ ã€‚å³SOAPçš„Faultå…ƒç´ ï¼Œç”¨äºæŒ‡ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚ 123456789101112&lt;?xml version=\"1.0\"?&gt;&lt;soap:Envelopexmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;soap:Body&gt; &lt;m:GetPrice xmlns:m=\"http://www.w3school.com.cn/prices\"&gt; &lt;m:Item&gt;Apples&lt;/m:Item&gt; &lt;/m:GetPrice&gt;&lt;/soap:Body&gt; &lt;/soap:Envelope&gt; ä¸Šé¢çš„ä¾‹å­è¯·æ±‚è‹¹æœçš„ä»·æ ¼ã€‚m:GetPriceå’ŒItemå…ƒç´ æ˜¯åº”ç”¨ç¨‹åºä¸“ç”¨çš„å…ƒç´ ï¼Œå¹¶ä¸æ˜¯SOAPæ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚è€Œä¸€ä¸ªSOAPå“åº”åº”è¯¥ç±»ä¼¼è¿™æ ·ï¼š 123456789101112&lt;?xml version=\"1.0\"?&gt;&lt;soap:Envelopexmlns:soap=\"http://www.w3.org/2001/12/soap-envelope\"soap:encodingStyle=\"http://www.w3.org/2001/12/soap-encoding\"&gt; &lt;soap:Body&gt; &lt;m:GetPriceResponse xmlns:m=\"http://www.w3school.com.cn/prices\"&gt; &lt;m:Price&gt;1.90&lt;/m:Price&gt; &lt;/m:GetPriceResponse&gt;&lt;/soap:Body&gt; &lt;/soap:Envelope&gt; Fã€SOAP Faultå…ƒç´  SOAP Faultå…ƒç´ ç”¨äºåœ¨SOAPæ¶ˆæ¯ä¸­ä¼ è¾“é”™è¯¯åŠçŠ¶æ€ä¿¡æ¯ã€‚å¦‚æœSOAPæ¶ˆæ¯éœ€è¦åŒ…æ‹¬SOAP Faultå…ƒç´ ï¼ŒSOAP Faultå…ƒç´ å¿…é¡»ä½œä¸ºä¸€ä¸ªBodyé¡¹å‡ºç°ï¼Œè€Œä¸”è‡³å¤šå‡ºç°ä¸€æ¬¡ã€‚SOAP FaultåŒ…æ‹¬ä»¥ä¸‹å­å…ƒç´ ï¼šfaultcodeã€faultstringã€faultactorã€detailã€‚ å­å…ƒç´  æè¿° ç”¨äºæŒ‡ç¤ºä¸€ç±»é”™è¯¯çš„æ–‡æœ¬ä»£ç ã€‚ è§£é‡Šé”™è¯¯çš„è¯´æ˜ã€‚ å¼•å‘æ•…éšœçš„èŠ‚ç‚¹ä¿¡æ¯ã€‚ ç”¨äºæºå¸¦ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„é”™è¯¯æ¶ˆæ¯çš„å…ƒç´ ã€‚ åœ¨ä¸‹é¢å®šä¹‰çš„ faultcode å€¼å¿…é¡»ç”¨äºæè¿°é”™è¯¯æ—¶çš„ faultcode å…ƒç´ ä¸­ï¼š å…ƒç´  é”™è¯¯å’Œæè¿° SOAP-ENV:VersionMismatch å‘ç°SOAP Envelopeå…ƒç´ çš„æ— æ•ˆå‘½åç©ºé—´ã€‚ SOAP-ENV:MustUnderstand Headerå…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼ˆmustUnderstandå±æ€§è®¾ç½®ä¸ºâ€œ1â€ï¼‰æœªè¢«ç†è§£ã€‚ SOAP-ENV:Client æ¶ˆæ¯è¢«ä¸æ­£ç¡®åœ°æ„æˆï¼Œæˆ–åŒ…å«äº†ä¸æ­£ç¡®çš„ä¿¡æ¯ã€‚ SOAP-ENV:Server æœåŠ¡å™¨æœ‰é—®é¢˜ï¼Œå› æ­¤æ— æ³•å¤„ç†è¿›è¡Œä¸‹å»ã€‚ ç¤ºä¾‹ï¼šå®¢æˆ·ç«¯å·²è¯·æ±‚åä¸ºValidateCreditCardçš„æ–¹æ³•ï¼Œä½†è¯¥æœåŠ¡ä¸æ”¯æŒæ­¤ç±»æ–¹æ³•ã€‚è¿™è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯ï¼ŒæœåŠ¡å™¨è¿”å›ä»¥ä¸‹SOAPå“åº” - 12345678910111213141516&lt;?xml version = '1.0' encoding = 'UTF-8'?&gt;&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV = \"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi = \"http://www.w3.org/1999/XMLSchema-instance\" xmlns:xsd = \"http://www.w3.org/1999/XMLSchema\"&gt; &lt;SOAP-ENV:Body&gt; &lt;SOAP-ENV:Fault&gt; &lt;faultcode xsi:type = \"xsd:string\"&gt;SOAP-ENV:Client&lt;/faultcode&gt; &lt;faultstring xsi:type = \"xsd:string\"&gt; Failed to locate method (ValidateCreditCard) in class (examplesCreditCard) at /usr/local/ActivePerl-5.6/lib/site_perl/5.6.0/SOAP/Lite.pm line 1555. &lt;/faultstring&gt; &lt;/SOAP-ENV:Fault&gt; &lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt; Gã€SOAPé™„ä»¶ æŒ‰ç…§SOAP1.1è§„èŒƒçš„è§„å®šï¼ŒSOAPæ¶ˆæ¯å¯ä»¥åŒ…å«XMLæ ¼å¼çš„ä¸»SOAPä¿¡å°ï¼Œä»¥åŠåŒ…å«ASCIIæˆ–äºŒè¿›åˆ¶ç­‰ä»»ä½•æ•°æ®æ ¼å¼çš„SOAPé™„ä»¶ã€‚å¦‚æœSOAPæ¶ˆæ¯åŒ…å«é™„ä»¶ï¼Œé‚£ä¹ˆSOAPæ¶ˆæ¯å°†æ˜¯ä¸€ä¸ªMIMEç¼–ç çš„æ¶ˆæ¯ï¼ŒåŒ…å«SOAPå†…å®¹å’Œä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–ç±»å‹çš„é™„ä»¶ã€‚å› æ­¤SOAPæ¶ˆæ¯å®é™…ä¸Šåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ç±»å‹ï¼š ä»…åŒ…å«XMLå†…å®¹çš„æ¶ˆæ¯ MIMEç¼–ç çš„æ¶ˆæ¯ï¼ŒåŒ…å«åˆå§‹çš„XMLæœ‰æ•ˆå†…å®¹ä»¥åŠä»»ä½•æ•°é‡çš„é™„ä»¶ã€‚é™„ä»¶å¯ä»¥æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ•°æ®ã€‚ ã€MIMEï¼šMulti-purpose Internet Mail Extensionså¤šç”¨é€”Interneté‚®ä»¶æ‰©å±•ï¼Œæ˜¯ä¸€ç»„æŠ€æœ¯è§„èŒƒï¼Œå…¶ç›®çš„æ˜¯ä½¿ç”¨ä¸åŒå­—ç¬¦é›†æ¥ä¼ é€’æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥åœ¨è®¡ç®—æœºä¹‹é—´ä¼ é€’å„ç§å„æ ·çš„å¤šåª’ä½“æ•°æ®ã€‘ å‚è€ƒï¼š SOAP 1.2ã€SOAP 1.1 http://blog.51cto.com/9291927/1914041 https://www.tutorialspoint.com/soap/soap_standards.htm https://juejin.im/post/5aadae4bf265da238a303917#heading-17","link":"/2018/10/16/java/webservice/webservice%E4%B9%8Bsaop%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"WebService","text":"webserviceç®€ä»‹ SOA å…ˆç»™å‡ºä¸€ä¸ªæ¦‚å¿µ SOAï¼Œå³Service-Oriented Architectureï¼Œä¸­æ–‡æ„æ€æ˜¯ä¸­æ–‡é¢å‘æœåŠ¡ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸€ç§æ–¹æ³•è®ºï¼Œä¸€ç§åˆ†å¸ƒå¼çš„æœåŠ¡æ¶æ„ã€‚ SOA ä¸­çš„æœåŠ¡æ˜¯æ„å»ºåœ¨ä¸€äº›åˆ—åŸºäºå¼€æ”¾æ ‡å‡†çš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œ Web æœåŠ¡å®šä¹‰äº†å¦‚ä½•åœ¨å¼‚æ„ç³»ç»Ÿä¹‹é—´å®ç°é€šä¿¡çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œ ä»è€Œå°±ä½¿å¾— Web æœåŠ¡å¯ä»¥è·¨è¶Šè¿è¡Œå¹³å°å’Œå®ç°è¯­è¨€ï¼Œ åŒæ—¶ä¹Ÿä½¿å¾— Web æœåŠ¡æˆä¸ºäº†å®ç° SOA ä¸­æœåŠ¡çš„ä¸»è¦æŠ€æœ¯ã€‚ å…³äºSOAå‚è€ƒå…¶å®ƒèµ„æ–™ï¼šhttps://www.cnblogs.com/renzhitian/p/6853289.html WebServiceç®€ä»‹ Web Serviceå³XML Web Service WebServiceï¼Œæ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶ä»Internetæˆ–è€…Intranetä¸Šçš„å…¶å®ƒç³»ç»Ÿä¸­ä¼ é€’è¿‡æ¥çš„è¯·æ±‚ï¼Œè½»é‡çº§çš„ç‹¬ç«‹çš„é€šè®¯æŠ€æœ¯ã€‚é€šè¿‡SOAPåœ¨Webä¸Šæä¾›çš„è½¯ä»¶æœåŠ¡ï¼Œä½¿ç”¨WSDLæ–‡æ¡£è¿›è¡Œè¯´æ˜ï¼Œå¹¶é€šè¿‡UDDIè¿›è¡Œæ³¨å†Œã€‚ WebServicesç‰¹ç‚¹ WebServices æä¾›ä¸€ä¸ªå»ºç«‹åˆ†å¸ƒå¼åº”ç”¨çš„å¹³å°ï¼Œä½¿å¾—è¿è¡Œåœ¨ä¸åŒæ“ä½œç³»ç»Ÿå’Œä¸åŒè®¾å¤‡ä¸Šçš„è½¯ä»¶ï¼Œæˆ–è€…æ˜¯ç”¨ä¸åŒçš„ç¨‹åºè¯­è¨€å’Œä¸åŒå‚å•†çš„è½¯ä»¶å¼€å‘å·¥å…·å¼€å‘çš„è½¯ä»¶ï¼Œæ‰€æœ‰å¯èƒ½çš„å·²å¼€å‘å’Œéƒ¨ç½²çš„è½¯ä»¶ï¼Œèƒ½å¤Ÿåˆ©ç”¨è¿™ä¸€å¹³å°å®ç°åˆ†å¸ƒå¼è®¡ç®—çš„ç›®çš„ã€‚WebServicesçš„æ€æƒ³æ˜¯ï¼šä½¿å¾—åº”ç”¨ç¨‹åºä¹Ÿå…·æœ‰ Web åˆ†å¸ƒå¼ç¼–ç¨‹æ¨¡å‹çš„æ¾æ•£è€¦åˆæ€§ã€‚WebServiceæ˜¯ä¸€ç§è·¨ç¼–ç¨‹è¯­è¨€å’Œè·¨æ“ä½œç³»ç»Ÿå¹³å°çš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯ã€‚ webserviceä½“ç³»ç»“æ„ åœ¨ Web æœåŠ¡çš„ä½“ç³»ç»“æ„ä¸­ï¼Œæ¶‰åŠåˆ°ä¸‰ä¸ªè§’è‰²ï¼šWeb æœåŠ¡æä¾›è€…ã€Web æœåŠ¡ä¸­ä»‹è€…ã€ Web æœåŠ¡è¯·æ±‚è€…ã€‚åŒæ—¶è¿˜æ¶‰åŠåˆ°ä¸‰ç±»åŠ¨ä½œï¼Œå³å‘å¸ƒï¼ŒæŸ¥æ‰¾ï¼Œç»‘å®šã€‚ Web æœåŠ¡æä¾›è€…ï¼š å¯ä»¥å‘å¸ƒ Web æœåŠ¡ï¼Œå¹¶ä¸”å¯¹ä½¿ç”¨è‡ªèº«æœåŠ¡çš„è¯·æ±‚è¿›è¡Œå“åº”ï¼Œ Web æœåŠ¡çš„æ‹¥æœ‰è€…ï¼Œå®ƒä¼šç­‰å¾…å…¶ä»–çš„æœåŠ¡æˆ–è€…æ˜¯åº”ç”¨ç¨‹åºè®¿é—®è‡ªå·±ã€‚ Web æœåŠ¡è¯·æ±‚è€…ï¼š ä¹Ÿå°±æ˜¯ Web æœåŠ¡åŠŸèƒ½çš„ä½¿ç”¨è€…ï¼Œå®ƒé€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒä¹Ÿå°±æ˜¯ Web æœåŠ¡ä¸­ä»‹è€…æŸ¥æ‰¾åˆ°æ‰€éœ€è¦çš„æœåŠ¡ï¼Œ å†åˆ©ç”¨ SOAP æ¶ˆæ¯å‘ Web æœåŠ¡æä¾›è€…å‘é€è¯·æ±‚ä»¥è·å¾—æœåŠ¡ã€‚ Web æœåŠ¡ä¸­ä»‹è€…ï¼š ä¹Ÿç§°ä¸ºæœåŠ¡ä»£ç†ï¼Œç”¨æ¥æ³¨å†Œå·²ç»å‘å¸ƒçš„ Web æœåŠ¡æä¾›è€…ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼ŒåŒæ—¶æä¾›æœç´¢æœåŠ¡ï¼Œ ç®€å•æ¥è¯´çš„è¯ï¼ŒWeb æœåŠ¡ä¸­ä»‹è€…çš„ä½œç”¨å°±æ˜¯æŠŠä¸€ä¸ª Web æœåŠ¡è¯·æ±‚è€…å’Œåˆé€‚çš„ Web æœåŠ¡æä¾›è€…è”ç³»åœ¨ä¸€èµ·ï¼Œ å……å½“ä¸€ä¸ªç®¡ç†è€…çš„è§’è‰²ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ UDDI æ¥å®ç°ã€‚ å‘å¸ƒï¼š é€šè¿‡å‘å¸ƒæ“ä½œï¼Œå¯ä»¥ä½¿ Web æœåŠ¡æä¾›è€…å‘ Web æœåŠ¡ä¸­ä»‹è€…æ³¨å†Œè‡ªå·±çš„åŠŸèƒ½ä»¥åŠè®¿é—®çš„æ¥å£ã€‚ å‘ç°ï¼ˆæŸ¥æ‰¾ï¼‰ï¼š ä½¿å¾— Web æœåŠ¡è¯·æ±‚è€…å¯ä»¥é€šè¿‡ Web æœåŠ¡ä¸­ä»‹è€…æ¥æŸ¥æ‰¾åˆ°ç‰¹ç‚¹çš„ç§ç±»çš„ Web æœåŠ¡ã€‚ ç»‘å®šï¼š è¿™é‡Œå°±æ˜¯å®ç°è®©æœåŠ¡è¯·æ±‚è€…èƒ½å¤Ÿä½¿ç”¨æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡äº†ã€‚ webserviceä¸‰ç§åŸºæœ¬ç»„ä»¶ *SOAP * å³ Simple Object Access Protocol ä¹Ÿå°±æ˜¯ç®€å•å¯¹è±¡è®¿é—®åè®®ã€‚æ˜¯ä¸€ç§ç”¨äºè®¿é—® Web æœåŠ¡çš„åè®®ã€‚ SOAP æ˜¯ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§é€šä¿¡åè®®ã€‚ SOAP åŸºäº XML å’Œ HTTP ï¼Œå…¶é€šè¿‡ XML æ¥å®ç°æ¶ˆæ¯æè¿°ï¼Œç„¶åå†é€šè¿‡ HTTP å®ç°æ¶ˆæ¯ä¼ è¾“ã€‚ WebServiceé€šè¿‡HTTPåè®®å‘é€è¯·æ±‚å’Œæ¥æ”¶ç»“æœæ—¶ï¼Œå‘é€çš„è¯·æ±‚å†…å®¹å’Œç»“æœå†…å®¹éƒ½é‡‡ç”¨XMLæ ¼å¼å°è£…ï¼Œå¹¶å¢åŠ äº†ä¸€äº›ç‰¹å®šçš„HTTPæ¶ˆæ¯å¤´ï¼Œä»¥è¯´æ˜ HTTPæ¶ˆæ¯çš„å†…å®¹æ ¼å¼ï¼Œè¿™äº›ç‰¹å®šçš„HTTPæ¶ˆæ¯å¤´å’ŒXMLå†…å®¹æ ¼å¼å°±æ˜¯SOAPåè®®ã€‚SOAPæä¾›äº†æ ‡å‡†çš„RPCæ–¹æ³•æ¥è°ƒç”¨Web Serviceã€‚ WSDL å³ Web Services Description Language ä¹Ÿå°±æ˜¯ Web æœåŠ¡æè¿°è¯­è¨€ã€‚æ˜¯åŸºäº XML çš„ç”¨äºæè¿° Web æœåŠ¡ä»¥åŠå¦‚ä½•è®¿é—® Web æœåŠ¡çš„è¯­è¨€ã€‚ æœåŠ¡æä¾›è€…é€šè¿‡æœåŠ¡æè¿°å°†æ‰€æœ‰ç”¨äºè®¿é—® Web æœåŠ¡çš„è§„èŒƒä¼ é€ç»™æœåŠ¡è¯·æ±‚è€…ï¼Œ WSDLæ˜¯ä¸€ç§XMLæ–‡æ¡£ï¼Œè¯¦ç»†å®šä¹‰å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ ¼å¼ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„å‚æ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„é”™è¯¯ã€‚ UDDI å³ Universal Descriptionï¼ŒDiscovery and Integrationï¼Œä¹Ÿå°±æ˜¯é€šç”¨çš„æè¿°ï¼Œå‘ç°ä»¥åŠæ•´åˆã€‚ UDDI æ˜¯ä¸€ä¸ªè·¨äº§ä¸šï¼Œè·¨å¹³å°çš„å¼€æ”¾æ€§æ¶æ„ï¼Œå¯ä»¥å¸®åŠ© Web æœåŠ¡æä¾›å•†åœ¨äº’è”ç½‘ä¸Šå‘å¸ƒ Web æœåŠ¡çš„ä¿¡æ¯ã€‚ UDDI æ˜¯ä¸€ç§ç›®å½•æœåŠ¡ï¼Œä¼ä¸šå¯ä»¥é€šè¿‡ UDDI æ¥æ³¨å†Œå’Œæœç´¢ Web æœåŠ¡ã€‚ ç®€å•æ¥æ—¶å€™è¯ï¼ŒUDDI å°±æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåªä¸è¿‡åœ¨è¿™ä¸ªç›®å½•ä¸­å­˜æ”¾çš„æ˜¯ä¸€äº›å…³äº Web æœåŠ¡çš„ä¿¡æ¯è€Œå·²ã€‚ ä½¿ç”¨WebServiceå¹¶ä¸æ˜¯å¿…é¡»ä½¿ç”¨UDDIï¼Œå› ä¸ºç”¨æˆ·é€šè¿‡WSDLçŸ¥é“äº†WebServiceçš„åœ°å€ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡WSDLè°ƒç”¨WebServiceã€‚ ç½‘ç»œæä¾›çš„ä¸€äº›å…è´¹çš„webserviceæœåŠ¡æµ‹è¯•åœ°å€,:https://my.oschina.net/CraneHe/blog/183471 https://www.cnblogs.com/garfieldcgf/p/5966317.html å‚è€ƒï¼šhttps://www.cnblogs.com/BoyXiao/archive/2010/05/22/1741325.html https://www.tutorialspoint.com/webservices/web_services_components.htm http://blog.51cto.com/9291927/1912758","link":"/2018/10/11/java/webservice/webservice%E7%AE%80%E4%BB%8B%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"jmeter-websocket","text":"jmeter ä¸‹è½½åœ°å€ Jmeteræœ¬èº«ä¸æ”¯æŒwebsocketåè®®çš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹çš„æ’ä»¶ åœ°å€ï¼šhttps://bitbucket.org/pjtr/jmeter-websocket-samplers æŠŠä¸‹è½½åçš„ JMeterWebSocketSamplers-1.2.jar æ”¾åˆ°Jmeterç›®å½•çš„\\lib\\ext\\ç›®å½•ä¸‹ï¼Œé‡æ–°å¯åŠ¨jmeter ã€‚ åœ¨samplerä¸­å¯ä»¥çœ‹åˆ°æœ‰å…­ä¸ªwebsocketçš„é‡‡æ ·å™¨ã€‚ request-response samplerã€‚ ping-pong samplerã€‚ close connection samplerã€‚ single-read samplerã€‚ single-write samplerã€‚ open connection samplerã€‚ å…·ä½“çš„ä½¿ç”¨è¿˜æœªææ˜ç™½ã€‚","link":"/2018/08/15/java/websocket/jmeter-websocket/"},{"title":"é€šè¿‡HttpClientæºå¸¦pfxå’Œjksè¯ä¹¦è°ƒç”¨HTTPSåè®®çš„WebService","text":"å’Œç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œå¯¹æ¥æ—¶ï¼Œä»–ä»¬æä¾›äº†ä¸€ä¸ªWebServiceåœ°å€ï¼ŒåŠä¸¤ä¸ªè¯ä¹¦æ–‡ä»¶ï¼ˆåç¼€ä¸ºpfxçš„keyStorefå’Œåç¼€ä¸º jksçš„trustStoreï¼‰ï¼Œç»™å‡ºçš„è¯·æ±‚ç¤ºä¾‹æ˜¯é€šè¿‡ axisè°ƒç”¨çš„ã€‚å…¶ä¸­é‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œæš‚ä¸”ä¸è®°ã€‚ æœ¬æ–‡ä¸»è¦æ˜¯é€šè¿‡HttpClientè¿›è¡Œè°ƒç”¨ã€‚ 1ã€æ„å»ºHttpClient è¿æ¥ï¼Œå¹¶è¿›è¡ŒSSLè®¾ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import java.io.File;import java.io.FileInputStream;import java.security.KeyStore;import javax.net.ssl.SSLContext;import org.apache.http.conn.ssl.NoopHostnameVerifier;import org.apache.http.conn.ssl.SSLConnectionSocketFactory;import org.apache.http.conn.ssl.TrustSelfSignedStrategy;import org.apache.http.impl.client.CloseableHttpClient;import org.apache.http.impl.client.HttpClients;import org.apache.http.ssl.SSLContexts;public class HttpClientUtil { private final static String keyStoreFile = \"F:/test/jks/oaut.pfx\"; private final static String keyStorePwd = \"111111\"; private final static String trustStoreFile = \"F:/test/jks/127.0.0.1.jks\"; private final static String trustStorePass = \"11111111\"; public static CloseableHttpClient createCustomSSlClient() throws Exception{ KeyStore keyStore = KeyStore.getInstance(\"pkcs12\"); FileInputStream instream = new FileInputStream(new File(keyStoreFile)); keyStore.load(instream,keyStorePwd.toCharArray()); instream.close(); KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType()); FileInputStream instream1= new FileInputStream(new File(trustStoreFile)); trustStore.load(instream1,trustStorePass.toCharArray()); instream1.close(); SSLContext sslcontext= SSLContexts.custom() .loadKeyMaterial(keyStore,keyStorePwd.toCharArray()) .loadTrustMaterial(trustStore,new TrustSelfSignedStrategy()) .build(); // SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(// sslcontext,// new String[] { \"TLSv1\", \"TLSv1.1\", \"TLSv1.2\" },// null,// SSLConnectionSocketFactory.getDefaultHostnameVerifier()); SSLConnectionSocketFactory sslsf1 = new SSLConnectionSocketFactory( sslcontext, NoopHostnameVerifier.INSTANCE); CloseableHttpClient httpclient = HttpClients.custom() .setSSLSocketFactory(sslsf1) .build(); return httpclient; }} 2ã€å‘é€soapè¯·æ±‚ 1234567891011121314151617181920212223242526272829303132333435public String sendRequestSoap(CloseableHttpClient httpclient, String postUrl, String soapXml) { HttpPost httpPost = new HttpPost(postUrl); RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(30000).setConnectTimeout(30000).build(); httpPost.setConfig(requestConfig); httpPost.setHeader(\"Content-Type\", \"text/xml;charset=UTF-8\"); httpPost.setHeader(\"SOAPAction\", \"\"); StringEntity e = new StringEntity(soapXml, Charset.forName(\"UTF-8\")); httpPost.setEntity(e); ResponseHandler&lt;String&gt; responseHandler = new ResponseHandler&lt;String&gt;() { @Override public String handleResponse(HttpResponse response) throws ClientProtocolException, IOException { StatusLine statusLine = response.getStatusLine(); HttpEntity entity = response.getEntity(); if(statusLine.getStatusCode() &gt;= 300) { throw new HttpResponseException(statusLine.getStatusCode(), statusLine.getReasonPhrase()); } if(entity == null) { throw new ClientProtocolException(\"Response contains no content\"); } return EntityUtils.toString(entity, Consts.UTF_8); } }; try { String responseBody = httpclient.execute(httpPost, responseHandler); return responseBody; }catch(Exception e1) { e1.printStackTrace(); return null; }} 3ã€mainæ–¹æ³• 123456public static void main(String[] args) { String soapXml = \"&lt;soapenv:Envelope xmlns:soapenv=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\" xmlns:ns1=\\\"http://www.sksk.com/mobileServices/\\\"&gt;&lt;soapenv:Header/&gt;&lt;soapenv:Body&gt;&lt;ns1:queryDailyFtpPictureReq&gt;&lt;ns1:DevID&gt;%s&lt;/ns1:DevID&gt;&lt;ns1:StartTime&gt;%s&lt;/ns1:StartTime&gt;&lt;ns1:EndTime&gt;%s&lt;/ns1:EndTime&gt;&lt;/ns1:queryDailyFtpPictureReq&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\"; String postUrl = \"https://localhost:9000/cxf/MobileService\"; String str = sendRequestSoap(HttpClientUtil.createCustomSSlClient(), postUrl, String.format(soapXml, new Object[]{\"81160301384\", \"2018-03-20 08:00:00\", \"2018-03-20 12:00:00\"})); System.out.println(str); } å…¶ä¸­soapXmlå¯ä»¥é€šè¿‡SoapUIä¸­è·å¾—ã€‚ å…¶å®ƒï¼š æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¥ä¸»æœºåéªŒè¯é”™è¯¯ è§£å†³æ–¹æ³•ï¼šå°† 12345SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory( sslcontext, new String[] { \"TLSv1\", \"TLSv1.1\", \"TLSv1.2\" }, null, SSLConnectionSocketFactory.getDefaultHostnameVerifier()); ä¿®æ”¹ä¸ºï¼š 12SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory( sslcontext, NoopHostnameVerifier.INSTANCE); å…·ä½“å‚è€ƒ: SSL/TLS customization è¯ä¹¦çš„ç±»å‹pfxã€jksã€cerã€crtä¹‹é—´çš„å…³ç³»åŠè½¬æ¢ï¼ˆkeytool å·¥å…·ï¼‰ã€‚ WebService æ¡†æ¶ Axisä¸CXFã€‚ è°ƒç”¨æ–¹å¼cxfä¸AxisåŠhttpclientï¼Œå¯¹å— httpclientæ€æ ·ç”¨crtçš„è¯ä¹¦è¯·æ±‚ã€‚ webservice ä¸soapæœ‰ä»€ä¹ˆå…³ç³»ã€‚ Xmlçš„è§£æ å››ç§æ–¹å¼ï¼šDOM4Jã€SAXã€JDOMå’ŒDOM æ‰©å±•å‚è€ƒé“¾æ¥ï¼š å¦‚ä½•ç”Ÿæˆæœ¬åœ°SSLï¼Œå¹¶å¼€å‘SSLä¸‹çš„socket Spring Bootå’ŒApache CXF - å¦‚ä½•åœ¨2016å¹´ä½¿ç”¨SOAP Java and SOAP pkix path building failed and unable to find valid certification path to requested target unable to find valid certification path to requested target Configuring JSSE System Properties è°ƒè¯•SSL / TLSè¿æ¥ Spring Boot SSL [https] Example Client HTTP Transport (including SSL support) å‚è€ƒï¼šhttps://blog.csdn.net/wanglha/article/details/49272551 https://segmentfault.com/a/1190000008604160 https://www.cnblogs.com/xusweeter/p/7659762.html https://stackoverflow.com/questions/44493040/apache-httpclient-pfx-file","link":"/2018/10/11/java/webservice/%E9%80%9A%E8%BF%87HttpClient%E6%90%BA%E5%B8%A6pfx%E5%92%8Cjks%E8%AF%81%E4%B9%A6%E8%B0%83%E7%94%A8HTTPS%E5%8D%8F%E8%AE%AE%E7%9A%84WebService%20-%20%E5%89%AF%E6%9C%AC%20-%20%E5%89%AF%E6%9C%AC/"},{"title":"websocket-stompå‘æŒ‡å®šç”¨æˆ·å‘é€","text":"websocket-stompå‘æŒ‡å®šç”¨æˆ·å‘é€ 1ã€Controller 123456789101112@RequestMapping(value = \"/sendToUser\")public void sendToUser(@RequestParam String userName) { System.out.println(userName); this.messagingTemplate.convertAndSendToUser(userName, \"/queue/position-updates\", \"hello \" + userName);} @MessageMapping(\"/trade\") @SendToUser(\"/queue/position-updates\") public ResponseMessage executeTrade(Principal principal, RequestMessage message) { System.out.println(message.getMessage()); return new ResponseMessage(principal.getName()+\" è®¢é˜…æˆåŠŸ \"); } 2ã€js 123456789101112//å•ç‹¬è®¢é˜… function subscribeTrade() { var name = document.getElementById(\"name\").value; stompClient.send(\"/app/trade\", {}, JSON.stringify({//é€šè¿‡stompClient.sendå‘\"/trade\"ç›®æ ‡å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªåœ¨æ§åˆ¶å™¨çš„@MessageMappingä¸­å®šä¹‰çš„ã€‚ 'message': name })); stompClient.subscribe(\"/user/queue/position-updates\", function (msg) {//é€šè¿‡stopmClient.subscribeè®¢é˜…\"/queue/position-updates\"ç›®æ ‡å‘é€çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æ§åˆ¶å™¨çš„@SendToUserä¸­å®šä¹‰çš„ var msgDom = document.getElementById(\"msg\"); var html = msgDom.innerHTML; msgDom.innerHTML = html + \"\\n\" + msg.body; }); } /app/trade å…¶ä¸­appä¸ºwebsocketåº”ç”¨Destinationå‰ç¼€ï¼Œtradeä¸ºåœ¨Controllerä¸­çš„@MessageMappingä¸­å®šä¹‰çš„è·¯å¾„ã€‚ Springçš„STOMPæ”¯æŒå¯è¯†åˆ«&quot;/user/&quot;ä¸ºæ­¤ç›®çš„è€Œä½œä¸ºå‰ç¼€çš„ç›®æ ‡ï¼Œ/user/queue/position-updatesï¼Œè¯¥Destinationå°†ç”±è¯¥å¤„ç†UserDestinationMessageHandlerå¹¶ä¸”è½¬æ¢ä¸ºç”¨æˆ·ä¼šè¯å”¯ä¸€çš„Destinationï¼Œä¾‹å¦‚&quot;/queue/position-updates-user123&quot; ã€‚ åœ¨å‘é€ä¾§ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°Destination â€œ/user/{username}/queue/position-updatesâ€ï¼Œè¯¥ç›®çš„åœ° å°†ç”±UserDestinationMessageHandler`ç¿»è¯‘æˆä¸€ä¸ªæˆ–å¤šä¸ªDestinationï¼Œç”¨äºä¸ç”¨æˆ·æ¯ä¸ªä¼šè¯ç›¸å…³è”ã€‚å¯ä»¥é’ˆå¯¹ç‰¹å®šç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œè€Œä¸å¿…çŸ¥é“é™¤å…¶åç§°å’Œé€šç”¨ç›®æ ‡ä¹‹å¤–çš„ä»»ä½•å†…å®¹ ã€‚ Controllerä¸­sendToUseræ–¹æ³•ä¸­ï¼Œå‘é€æ¨¡æ¿é‡Œçš„ destination /queue/position-updates å°†è¢«UserDestinationMessageHandlerå¤„ç†æˆâ€/user/{username}/queue/position-updatesâ€ï¼Œå‘é€ç»™ç‰¹å®šç”¨æˆ· å‚è€ƒï¼šhttps://docs.spring.io/spring/docs/5.0.7.RELEASE/spring-framework-reference/web.html#websocket-stomp-user-destination","link":"/2018/08/15/java/websocket/websocket-stomp%E5%90%91%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E5%8F%91%E9%80%81/"},{"title":"stomp","text":"stomp WebSocketåè®®å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼Œæ–‡æœ¬å’ŒäºŒè¿›åˆ¶ï¼Œä½†å®ƒä»¬çš„å†…å®¹æ˜¯æœªå®šä¹‰çš„ ,stompæ˜¯æ›´é«˜çº§åˆ«çš„æ¶ˆæ¯ä¼ é€’åè®®ï¼Œå®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åå•†å­åè®®çš„æœºåˆ¶ - ï¼Œåœ¨WebSocketä¹‹ä¸Šä½¿ç”¨stompå®šä¹‰æ¯ä¸ªæ¶ˆæ¯å¯ä»¥å‘é€ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯çš„æ ¼å¼å’Œå†…å®¹æ˜¯ä»€ä¹ˆï¼Œç­‰ç­‰ ã€‚ ä»¥ä¸‹æ˜¯è®¢é˜…æ¥æ”¶è‚¡ç¥¨æŠ¥ä»·çš„å®¢æˆ·çš„ç¤ºä¾‹ï¼ŒæœåŠ¡å™¨å¯ä»¥ç”¨è®¡åˆ’ä»»åŠ¡é€šè¿‡ SimpMessagingTemplateå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ¥å‘¨æœŸæ€§åœ°å‘å‡ºæŠ¥ä»·ï¼š 12345SUBSCRIBEid:sub-1destination:/topic/price.stock.*^@ ä»¥ä¸‹æ˜¯å®¢æˆ·ç«¯å‘é€äº¤æ˜“è¯·æ±‚çš„ç¤ºä¾‹ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡@MessageMappingæ–¹æ³•å¤„ç†è¯¥äº¤æ˜“è¯·æ±‚ï¼Œä¹‹åï¼Œåœ¨æ‰§è¡Œä¹‹åï¼Œå‘å®¢æˆ·ç«¯å¹¿æ’­äº¤æ˜“ç¡®è®¤æ¶ˆæ¯å’Œè¯¦ç»†ä¿¡æ¯ï¼š 123456SENDdestination:/queue/tradecontent-type:application/jsoncontent-length:44{\"action\":\"BUY\",\"ticker\":\"MMM\",\"shares\",44}^@ åœ¨STOMPè§„èŒƒä¸­æ•…æ„å°†ç›®çš„åœ°(destination)çš„å«ä¹‰ä¿æŒä¸é€æ˜ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²ï¼Œå®Œå…¨å–å†³äºSTOMPæœåŠ¡å™¨ï¼Œä»¥å®šä¹‰å®ƒä»¬æ”¯æŒçš„ç›®æ ‡è¯­ä¹‰å’Œè¯­æ³•ã€‚ç„¶è€Œï¼Œå¾ˆå¸¸è§çš„æ˜¯ï¼Œç›®æ ‡æ˜¯ç±»ä¼¼è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­&quot;/topic/..&quot;æš—ç¤ºå‘å¸ƒ - è®¢é˜…ï¼ˆä¸€å¯¹å¤šï¼‰ã€&quot;/queue/&quot;æš—ç¤ºç‚¹å¯¹ç‚¹ï¼ˆä¸€å¯¹ä¸€ï¼‰æ¶ˆæ¯äº¤æ¢ã€‚ STOMPæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨MESSAGEå‘½ä»¤å‘æ‰€æœ‰è®¢æˆ·å¹¿æ’­æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯æœåŠ¡å™¨å‘è®¢é˜…å®¢æˆ·ç«¯å‘é€è‚¡ç¥¨æŠ¥ä»·çš„ç¤ºä¾‹ï¼š 123456MESSAGEmessage-id:nxahklf6-1subscription:sub-1destination:/topic/price.stock.MMM{\"ticker\":\"MMM\",\"price\":129.45}^@ å¯ç”¨STOMP123456789101112131415161718import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;import org.springframework.web.socket.config.annotation.StompEndpointRegistry;@Configuration@EnableWebSocketMessageBrokerpublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer { @Override public void registerStompEndpoints(StompEndpointRegistry registry) { registry.addEndpoint(\"/portfolio\").withSockJS(); } @Override public void configureMessageBroker(MessageBrokerRegistry config) { config.setApplicationDestinationPrefixes(\"/app\"); config.enableSimpleBroker(\"/topic\", \"/queue\"); }} 1ã€&quot;/portfolio&quot; æ˜¯WebSocketï¼ˆæˆ–SockJSï¼‰å®¢æˆ·ç«¯éœ€è¦è¿æ¥åˆ°çš„ç«¯ç‚¹çš„HTTP URLï¼Œä»¥è¿›è¡ŒWebSocketæ¡æ‰‹ã€‚ 2ã€ç›®æ ‡å¤´&quot;/app&quot;å¼€å¤´çš„STOMPæ¶ˆæ¯å°†è·¯ç”±åˆ° ç±»ä¸­çš„@MessageMappingæ–¹æ³•@Controller,å³è¯·æ±‚è·¯å¾„çš„å‰ç¼€ã€‚ 3ã€ä½¿ç”¨å†…ç½®çš„æ¶ˆæ¯ä»£ç†è¿›è¡Œè®¢é˜…å’Œå¹¿æ’­; å°†ç›®æ ‡æ ‡å¤´ä»¥â€œ/ topicâ€æˆ–â€œ/ queueâ€å¼€å¤´çš„é‚®ä»¶è·¯ç”±åˆ°å†…ç½®çš„ä»£ç†ã€‚ è¯´æ˜ï¼šå¯¹äºå†…ç½®çš„ç®€å•ä»£ç†ï¼Œâ€œ/ topicâ€å’Œâ€œ/ queueâ€å‰ç¼€æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰ã€‚å®ƒä»¬ä»…ä»…æ˜¯åŒºåˆ†pub-subå’Œç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’çš„æƒ¯ä¾‹ï¼ˆå³è®¸å¤šè®¢é˜…è€…ä¸ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰ã€‚ä½¿ç”¨å¤–éƒ¨ä»£ç†æ—¶ï¼Œè¯·å‚è€ƒä»£ç†çš„STOMPé¡µé¢ï¼Œä»¥äº†è§£å®ƒæ”¯æŒçš„STOMPç›®æ ‡å’Œå‰ç¼€ç±»å‹,å¦‚ rabbitmqå‚è€ƒ: http://www.rabbitmq.com/stomp.html#d å¦‚æœè¦ä»æµè§ˆå™¨è¿æ¥ï¼Œå¯¹äºSockJSï¼Œæ‚¨å¯ä»¥ä½¿ç”¨sockjs-client ã€‚å¯¹äºSTOMPï¼Œå¯ä»¥ä½¿ç”¨äº†jmesnil / stomp-websocketåº“ï¼ˆä¹Ÿç§°ä¸ºstomp.jsï¼‰ï¼Œè¯¥åº“åŠŸèƒ½é½å…¨ï¼Œå·²åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å¤šå¹´ï¼Œä½†ä¸å†ç»´æŠ¤ã€‚ç›®å‰ï¼Œ JSteunou / webstomp-clientæ˜¯è¯¥åº“ä¸­æœ€æ´»è·ƒçš„ç»´æŠ¤å’Œä¸æ–­å‘å±•çš„åç»§è€…ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»£ç åŸºäºå®ƒï¼š 12345var socket = new SockJS(\"/spring-websocket-portfolio/portfolio\");var stompClient = webstomp.over(socket);stompClient.connect({}, function(frame) {} æˆ–è€…å¦‚æœé€šè¿‡WebSocketè¿æ¥ï¼ˆæ²¡æœ‰SockJSï¼‰ï¼š 12345var socket = new WebSocket(\"/spring-websocket-portfolio/portfolio\");var stompClient = Stomp.over(socket);stompClient.connect({}, function(frame) {} æ¶ˆæ¯æµ é€šè¿‡@EnableWebSocketMessageBroker æ¥ç»„è£…æ¶ˆæ¯å·¥ä½œæµ ä¸Šå›¾ä¸­æœ‰3ä¸ªæ¶ˆæ¯é€šé“ï¼š &quot;clientInboundChannel&quot; - ç”¨äºä¼ é€’ä»WebSocketå®¢æˆ·ç«¯æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ &quot;clientOutboundChannel&quot; - ç”¨äºå‘WebSocketå®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨æ¶ˆæ¯ã€‚ &quot;brokerChannel&quot; - ç”¨äºä»æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºä»£ç å‘æ¶ˆæ¯ä»£ç†å‘é€æ¶ˆæ¯ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†é…ç½®å¤–éƒ¨ä»£ç†ï¼ˆä¾‹å¦‚RabbitMQï¼‰ä»¥ç®¡ç†è®¢é˜…å’Œå¹¿æ’­æ¶ˆæ¯æ—¶ä½¿ç”¨çš„ç»„ä»¶ ä¸Šå›¾ä¸­çš„ä¸»è¦åŒºåˆ«æ˜¯ä½¿ç”¨â€œä»£ç†ä¸­ç»§â€é€šè¿‡TCPå°†æ¶ˆæ¯ä¼ é€’åˆ°å¤–éƒ¨STOMPä»£ç†ï¼Œä»¥åŠå°†æ¶ˆæ¯ä»ä»£ç†ä¼ é€’åˆ°è®¢é˜…çš„å®¢æˆ·ç«¯ã€‚ åœ°å€æ˜ å°„çš„æ³¨è§£ä½¿ç”¨å¸¦æ³¨é‡Šçš„@Controllerç±»æ¥å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚è¿™äº›ç±»å¯ä»¥å£°æ˜@MessageMappingï¼Œ@SubscribeMappingå’Œ@ExceptionHandler æ–¹æ³• @MessageMapping æ³¨è§£@MessageMappingå¯æ˜ å°„åˆ°è¯¥åœ°å€çš„æ¶ˆæ¯è·¯ç”±åˆ°æ¬¡æ–¹æ³•ã€‚ æ–¹æ³•å‚æ•° æè¿° Message ç”¨äºè®¿é—®å®Œæ•´çš„æ¶ˆæ¯ã€‚ MessageHeaders ç”¨äºè®¿é—®å†…éƒ¨çš„æ ‡å¤´Messageã€‚ MessageHeaderAccessor, SimpMessageHeaderAccessor, StompHeaderAccessor ç”¨äºé€šè¿‡ç±»å‹åŒ–è®¿é—®å™¨æ–¹æ³•è®¿é—®æ ‡å¤´ã€‚ @Payload ç”¨äºè®¿é—®æ¶ˆæ¯çš„æœ‰æ•ˆè´Ÿè½½ï¼Œé€šè¿‡é…ç½®è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œä»JSONï¼‰MessageConverter ã€‚ä¸éœ€è¦è®¾ç½®æ­¤æ³¨é‡Šï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å…¶ä»–å‚æ•°åŒ¹é…ï¼Œåˆ™é»˜è®¤é‡‡ç”¨å®ƒã€‚ Payloadå‚æ•°å¯ä»¥ä½¿ç”¨@javax.validation.Validæˆ–Spring æ³¨é‡Šï¼Œ@Validated ä»¥ä¾¿è‡ªåŠ¨éªŒè¯ã€‚ @Header ç”¨äºè®¿é—®ç‰¹å®šæ ‡å¤´å€¼ä»¥åŠä½¿ç”¨ org.springframework.core.convert.converter.Converterå¿…è¦æ—¶çš„ç±»å‹è½¬æ¢ ã€‚ @Headers ç”¨äºè®¿é—®æ¶ˆæ¯ä¸­çš„æ‰€æœ‰æ ‡å¤´ã€‚æ­¤å‚æ•°å¿…é¡»å¯åˆ†é…ç»™ java.util.Map @DestinationVariable ç”¨äºè®¿é—®ä»æ¶ˆæ¯ç›®æ ‡ä¸­æå–çš„æ¨¡æ¿å˜é‡ã€‚å¿…è¦æ—¶ï¼Œå€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚ java.security.Principal WebSocket HTTPæ¡æ‰‹æ—¶ç™»å½•çš„ç”¨æˆ·ã€‚ å½“@MessageMappingæ–¹æ³•è¿”å›ä¸€ä¸ªå€¼æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼é€šè¿‡å·²é…ç½®çš„åºåˆ—åŒ–ä¸ºæœ‰æ•ˆè´Ÿè½½MessageConverterï¼Œç„¶åä½œä¸ºMessageå‘é€åˆ° &quot;brokerChannel&quot;å®ƒå‘è®¢é˜…è€…å¹¿æ’­çš„ä½ç½®ã€‚å‡ºç«™æ¶ˆæ¯çš„ç›®çš„åœ°ä¸å…¥ç«™æ¶ˆæ¯çš„ç›®çš„åœ°ç›¸åŒ ã€‚ å¯ä»¥ä½¿ç”¨@SendToæ–¹æ³•æ‰¹æ³¨æ¥è‡ªå®šä¹‰è¦å°†æœ‰æ•ˆè´Ÿè½½å‘é€åˆ°çš„ç›®æ ‡ã€‚@SendToä¹Ÿå¯ä»¥åœ¨ç±»çº§åˆ«ä½¿ç”¨ä»¥å…±äº«å‘é€æ¶ˆæ¯çš„é»˜è®¤ç›®æ ‡ç›®æ ‡ã€‚@SendToUseræ˜¯ä»…å‘ä¸æ¶ˆæ¯å…³è”çš„ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å˜ä½“ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç”¨æˆ·ç›®æ ‡ ã€‚ ä½œä¸ºä»@MessageMappingæ–¹æ³•è¿”å›æœ‰æ•ˆè´Ÿè½½çš„æ›¿ä»£æ–¹æ³•ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨SimpMessagingTemplateå‘é€æ¶ˆæ¯ï¼Œè¿™ä¹Ÿæ˜¯åœ¨å°é¢ä¸‹å¤„ç†è¿”å›å€¼çš„æ–¹å¼ã€‚è¯·å‚é˜…å‘é€æ¶ˆæ¯ã€‚ @SubscribeMapping@SubscribeMappingç±»ä¼¼äº@MessageMappingä½†ä»…å°†æ˜ å°„ç¼©å°åˆ°è®¢é˜…æ¶ˆæ¯ã€‚å®ƒæ”¯æŒä¸@MessageMappingç›¸åŒçš„ æ–¹æ³•å‚æ•°ã€‚ä½†æ˜¯å¯¹äºè¿”å›å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é€šè¿‡â€œclientOutboundChannelâ€ç›´æ¥å‘é€åˆ°å®¢æˆ·ç«¯ä»¥å“åº”è®¢é˜…ï¼Œè€Œä¸æ˜¯é€šè¿‡â€œbrokerChannelâ€ä½œä¸ºå¯¹åŒ¹é…è®¢é˜…çš„å¹¿æ’­å‘é€ç»™ä»£ç†ã€‚æ·»åŠ @SendToæˆ– @SendToUserè¦†ç›–æ­¤è¡Œä¸ºå¹¶å‘é€ç»™ä»£ç†ã€‚ @MessageExceptionHandlerå¯ä»¥ä½¿ç”¨@MessageExceptionHandleræ–¹æ³•æ¥å¤„ç†@MessageMappingæ–¹æ³•ä¸­çš„å¼‚å¸¸ ã€‚ @MessageExceptionHandleræ–¹æ³•æ”¯æŒçµæ´»çš„æ–¹æ³•ç­¾åï¼Œå¹¶æ”¯æŒä¸@MessageMappingç›¸åŒçš„æ–¹æ³•å‚æ•°ç±»å‹å’Œè¿”å›å€¼ã€‚ å¤–éƒ¨ä»£ç†å‚è€ƒé€‰æ‹©çš„æ¶ˆæ¯ä»£ç† çš„STOMPæ–‡æ¡£ ï¼Œï¼ˆä¾‹å¦‚ RabbitMQï¼Œ ActiveMQç­‰ï¼‰ ï¼Œå¹¶å¯ç”¨STOMPæ”¯æŒ ï¼Œç„¶ååœ¨Springé…ç½®ä¸­å¯ç”¨StompBrokerRelayä¸­ç»§è€Œä¸æ˜¯SimpleBrokerã€‚ 12345678910111213141516@Configuration@EnableWebSocketMessageBrokerpublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer { @Override public void registerStompEndpoints(StompEndpointRegistry registry) { registry.addEndpoint(\"/portfolio\").withSockJS(); } @Override public void configureMessageBroker(MessageBrokerRegistry registry) { registry.enableStompBrokerRelay(\"/topic\", \"/queue\"); registry.setApplicationDestinationPrefixes(\"/app\"); }} é…ç½®ä¸­â€œSTOMPä»£ç†ä¸­ç»§â€,å®ƒå»ºç«‹TCPè¿æ¥ ,å°†æ¶ˆæ¯è½¬å‘åˆ°å¤–éƒ¨æ¶ˆæ¯ä»£ç†æ¥å¤„ç†æ¶ˆæ¯ ,ç„¶åé€šè¿‡å…¶WebSocketä¼šè¯å°†ä»ä»£ç†æ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚ è¯´æ˜ï¼šéœ€è¦ä¸ºé¡¹ç›®æ·»åŠ io.projectreactor.ipc:reactor-nettyå’Œio.netty:netty-allä¾èµ–é¡¹ä»¥è¿›è¡ŒTCPè¿æ¥ç®¡ç†ã€‚ è·¯å¾„åˆ†éš”ç¬¦@MessageMappingæ–¹æ³• ï¼Œé»˜è®¤ä½¿ç”¨æ–œæ â€œ/â€ä½œä¸ºåˆ†éš”ç¬¦ ï¼Œå¦‚æœæ›´ä¹ æƒ¯äºæ¶ˆæ¯ä¼ é€’çº¦å®šï¼Œåˆ™å¯ä»¥åˆ‡æ¢åˆ°ä½¿ç”¨ç‚¹â€œ.â€ ä½œä¸ºåˆ†éš”ç¬¦ã€‚ 12345678910111213@Configuration@EnableWebSocketMessageBrokerpublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer { // ... @Override public void configureMessageBroker(MessageBrokerRegistry registry) { registry.setPathMatcher(new AntPathMatcher(\".\")); registry.enableStompBrokerRelay(\"/queue\", \"/topic\"); registry.setApplicationDestinationPrefixes(\"/app\"); }} ä¹‹åï¼Œæ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ç‚¹â€œã€‚â€ ä½œä¸º@MessageMappingæ–¹æ³•ä¸­çš„åˆ†éš”ç¬¦ï¼š 123456789@Controller@MessageMapping(\"foo\")public class FooController { @MessageMapping(\"bar.{baz}\") public void handleBaz(@DestinationVariable String baz) { // ... }} å®¢æˆ·ç«¯ç°åœ¨å¯ä»¥å‘å…¶å‘é€æ¶ˆæ¯&quot;/app/foo.bar.baz123&quot;ã€‚ èº«ä»½éªŒè¯æ— æ³•ä½¿ç”¨cookieçš„åº”ç”¨ç¨‹åºå¯èƒ½æ— æ³•åœ¨HTTPåè®®çº§åˆ«è¿›è¡Œèº«ä»½éªŒè¯ ï¼Œå¯ä»¥åœ¨STOMPæ¶ˆæ¯ä¼ é€’åè®®çº§åˆ«ä½¿ç”¨æ ‡å¤´è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨Cookieã€‚æœ‰ä¸¤ä¸ªç®€å•çš„æ­¥éª¤å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š ä½¿ç”¨STOMPå®¢æˆ·ç«¯åœ¨è¿æ¥æ—¶ä¼ é€’èº«ä»½éªŒè¯æ ‡å¤´ã€‚ ä½¿ç”¨ChannelInterceptorå¤„ç†èº«ä»½éªŒè¯æ ‡å¤´ã€‚ ä¸‹é¢æ˜¯æ³¨å†Œè‡ªå®šä¹‰èº«ä»½éªŒè¯æ‹¦æˆªå™¨çš„ç¤ºä¾‹æœåŠ¡å™¨ç«¯é…ç½®ã€‚è¯·æ³¨æ„ï¼Œæ‹¦æˆªå™¨åªéœ€è¦åœ¨CONNECTä¸Šè¿›è¡Œèº«ä»½éªŒè¯å¹¶è®¾ç½®ç”¨æˆ·å¤´Messageã€‚Springå°†è®°å½•å¹¶ä¿å­˜ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œå¹¶å°†å…¶ä¸åŒä¸€ä¼šè¯ä¸­çš„åç»­STOMPæ¶ˆæ¯ç›¸å…³è”ï¼š 1234567891011121314151617181920@Configuration@EnableWebSocketMessageBrokerpublic class MyConfig implements WebSocketMessageBrokerConfigurer { @Override public void configureClientInboundChannel(ChannelRegistration registration) { registration.setInterceptors(new ChannelInterceptorAdapter() { @Override public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) { StompHeaderAccessor accessor = MessageHeaderAccessor.getAccessor(message, StompHeaderAccessor.class); if (StompCommand.CONNECT.equals(accessor.getCommand())) { Authentication user = ... ; // access authentication header(s) accessor.setUser(user); } return message; } }); }} æ¶ˆæ¯é¡ºåºæ¥è‡ªä»£ç†çš„æ¶ˆæ¯å°†å‘å¸ƒåˆ°â€œclientOutboundChannelâ€ï¼Œä»é‚£é‡Œå°†å®ƒä»¬å†™å…¥WebSocketä¼šè¯ã€‚ç”±äºé€šé“ç”±ThreadPoolExecutoræ¶ˆæ¯æ”¯æŒï¼Œå› æ­¤åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¤„ç†æ¶ˆæ¯ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯æ¥æ”¶çš„ç»“æœåºåˆ—å¯èƒ½ä¸å‘å¸ƒçš„ç¡®åˆ‡é¡ºåºä¸åŒ¹é…ã€‚ å¯ä»¥å¯ç”¨ä»¥ä¸‹æ ‡å¿— 1234567891011@Configuration@EnableWebSocketMessageBrokerpublic class MyConfig implements WebSocketMessageBrokerConfigurer { @Override protected void configureMessageBroker(MessageBrokerRegistry registry) { // ... registry.setPreservePublishOrder(true); }} æ´»åŠ¨äº‹ä»¶å‡ ä¸ªApplicationContextäº‹ä»¶ï¼ˆå¦‚ä¸‹æ‰€åˆ—ï¼‰ï¼Œå¯ä»¥é€šè¿‡å®ç°Springçš„ApplicationListeneræ¥å£æ¥æ¥æ”¶ã€‚ BrokerAvailabilityEvent - è¡¨ç¤ºBrokerä½•æ—¶å¯ç”¨/ä¸å¯ç”¨ã€‚è™½ç„¶â€œSimpleBrokerâ€ä»£ç†åœ¨å¯åŠ¨æ—¶ç«‹å³å¯ç”¨ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä»ç„¶å¦‚æ­¤ï¼Œä½†STOMPâ€œä»£ç†ä¸­ç»§â€å¯èƒ½ä¼šä¸¢å¤±ä¸å…¨åŠŸèƒ½ä»£ç†çš„è¿æ¥ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä»£ç†é‡æ–°å¯åŠ¨ã€‚ä»£ç†ä¸­ç»§å…·æœ‰é‡æ–°è¿æ¥é€»è¾‘ï¼Œå¹¶åœ¨å®ƒè¿”å›æ—¶é‡æ–°å»ºç«‹ä¸ä»£ç†çš„â€œç³»ç»Ÿâ€è¿æ¥ï¼Œå› æ­¤åªè¦çŠ¶æ€ä»è¿æ¥å˜ä¸ºæ–­å¼€è¿æ¥ï¼Œåä¹‹äº¦ç„¶ï¼Œå°±ä¼šå‘å¸ƒæ­¤äº‹ä»¶ã€‚ä½¿ç”¨è¯¥ç»„ä»¶çš„ç»„ä»¶SimpMessagingTemplateåº”è®¢é˜…æ­¤äº‹ä»¶ï¼Œå¹¶é¿å…åœ¨ä»£ç†ä¸å¯ç”¨æ—¶å‘é€æ¶ˆæ¯ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œä»–ä»¬éƒ½åº”è¯¥å‡†å¤‡å¥½åœ¨MessageDeliveryException` å‘é€æ¶ˆæ¯æ—¶è¿›è¡Œå¤„ç†ã€‚ SessionConnectEvent - åœ¨æ”¶åˆ°æ–°çš„STOMP CONNECTæ—¶å‘å¸ƒï¼ŒæŒ‡ç¤ºæ–°å®¢æˆ·ç«¯ä¼šè¯çš„å¼€å§‹ã€‚è¯¥äº‹ä»¶åŒ…å«è¡¨ç¤ºè¿æ¥çš„æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¼šè¯IDï¼Œç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ä»¥åŠå®¢æˆ·ç«¯å¯èƒ½å·²å‘é€çš„ä»»ä½•è‡ªå®šä¹‰æ ‡å¤´ã€‚è¿™å¯¹äºè·Ÿè¸ªå®¢æˆ·ç«¯ä¼šè¯å¾ˆæœ‰ç”¨ã€‚è®¢é˜…æ­¤äº‹ä»¶çš„ç»„ä»¶å¯ä»¥ä½¿ç”¨SimpMessageHeaderAccessoræˆ– åŒ…è£…æ‰€åŒ…å«çš„æ¶ˆæ¯StompMessageHeaderAccessorã€‚ SessionConnectedEvent - SessionConnectEventåœ¨Brokerå‘é€STOMP CONNECTEDæ¡†æ¶ä»¥å“åº”CONNECT ä¹‹åä¸ä¹…å‘å¸ƒçš„ã€‚æ­¤æ—¶ï¼Œå¯ä»¥è®¤ä¸ºSTOMPä¼šè¯å·²å®Œå…¨å»ºç«‹ã€‚ SessionSubscribeEvent - åœ¨æ”¶åˆ°æ–°çš„STOMP SUBSCRIBEæ—¶å‘å¸ƒã€‚ SessionUnsubscribeEvent - æ”¶åˆ°æ–°çš„STOMP UNSUBSCRIBEæ—¶å‘å¸ƒã€‚ SessionDisconnectEvent - åœ¨STOMPä¼šè¯ç»“æŸæ—¶å‘å¸ƒã€‚DISCONNECTå¯èƒ½å·²ä»å®¢æˆ·ç«¯å‘é€ï¼Œä¹Ÿå¯èƒ½åœ¨WebSocketä¼šè¯å…³é—­æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯ä¸ªä¼šè¯å¯èƒ½ä¼šå¤šæ¬¡å‘å¸ƒæ­¤äº‹ä»¶ã€‚å¯¹äºå¤šä¸ªæ–­å¼€è¿æ¥äº‹ä»¶ï¼Œç»„ä»¶åº”è¯¥æ˜¯å¹‚ç­‰çš„ã€‚ æ‹¦æˆªå™¨ä¸Šé¢çš„äº‹ä»¶æä¾›STOMPè¿æ¥ç”Ÿå‘½å‘¨æœŸçš„é€šçŸ¥ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå®¢æˆ·ç«¯æ¶ˆæ¯çš„é€šçŸ¥ã€‚åº”ç”¨ç¨‹åºè¿˜å¯ä»¥æ³¨å†ŒChannelInterceptoræ¥æ‹¦æˆªä»»ä½•æ¶ˆæ¯ï¼Œä»¥åŠå¤„ç†é“¾çš„ä»»ä½•éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œæ‹¦æˆªæ¥è‡ªå®¢æˆ·ç«¯çš„å…¥ç«™æ¶ˆæ¯ï¼š 123456789@Configuration@EnableWebSocketMessageBrokerpublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer { @Override public void configureClientInboundChannel(ChannelRegistration registration) { registration.setInterceptors(new MyChannelInterceptor()); }} è‡ªå®šä¹‰ChannelInterceptorå¯ä»¥ä½¿ç”¨StompHeaderAccessoræˆ–SimpMessageHeaderAccessor è®¿é—®æœ‰å…³ä¼ é€’çš„ä¿¡æ¯ã€‚ 12345678910public class MyChannelInterceptor implements ChannelInterceptor { @Override public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) { StompHeaderAccessor accessor = StompHeaderAccessor.wrap(message); StompCommand command = accessor.getStompCommand(); // ... return message; }} è¿˜å¯ä»¥å®ç°ExecutorChannelInterceptorï¼Œå®ƒæ˜¯ChannelInterceptoråœ¨å¤„ç†æ¶ˆæ¯çš„çº¿ç¨‹ä¸­å…·æœ‰å›è°ƒçš„å­æ¥å£ã€‚è™½ç„¶ChannelInterceptorå¯¹äºå‘é€åˆ°é€šé“çš„æ¯ä¸ªæ¶ˆæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯æ¯ä¸ªæ¶ˆæ¯çš„ ExecutorChannelInterceptoré’©å­éƒ½MessageHandler ä»é€šé“è®¢é˜…äº†æ¶ˆæ¯ã€‚ å‚è€ƒï¼šhttps://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#websocket","link":"/2018/08/13/java/websocket/stomp/"},{"title":"Springbooté›†æˆwebsocketå¹¶ä½¿ç”¨RabbitMQåšä¸ºæ¶ˆæ¯ä»£ç†","text":"é¦–å…ˆRabbitMQå¯ç”¨rabbitmq_web_stompæ’ä»¶ RabbitMQå¯ç”¨rabbitmq_web_stompæ’ä»¶ 1$ rabbitmq-plugins enable rabbitmq_web_stomp é»˜è®¤ç«¯å£ä¸ºï¼š61613 Springbooté…ç½®1ã€pom.xml 12345678910111213&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.projectreactor.ipc&lt;/groupId&gt; &lt;artifactId&gt;reactor-netty&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;4.1.2.Final&lt;/version&gt; &lt;/dependency&gt; 2ã€WebSocketMessageBrokerConfigureré…ç½® é…ç½®å¤–éƒ¨Rabibitmqæ›¿ä»£Simple Brokeråšæ¶ˆæ¯ä»£ç† 123456789101112131415161718192021222324252627282930313233343536@Configuration@EnableWebSocketMessageBroker //å¼€å¯ä½¿ç”¨STOMPåè®®æ¥ä¼ è¾“åŸºäºä»£ç†ï¼ˆmessage brokerï¼‰çš„æ¶ˆæ¯//è¿™æ—¶æ§åˆ¶å™¨æ”¯æŒä½¿ç”¨@MessageMappingï¼Œå°±åƒä½¿ç”¨@RequestMappingä¸€æ ·public class WebSocketConfig implements WebSocketMessageBrokerConfigurer { private static final Logger logger = LoggerFactory.getLogger(WebSocketConfig.class); @Autowired private SessionCookieHelper sessionCookieHelper; /** * æ³¨å†Œ Stompçš„ç«¯ç‚¹ */ @Override public void registerStompEndpoints(StompEndpointRegistry registry) { registry.addEndpoint(\"/portfolio\")// æ·»åŠ STOMPåè®®çš„ç«¯ç‚¹ã€‚ .setAllowedOrigins(\"*\")// æ·»åŠ å…è®¸è·¨åŸŸè®¿é—® .addInterceptors(new WebSocketSessionHandshakeInterceptor()) //.setHandshakeHandler(new DefaultHandshakeHandler()) .withSockJS();//æŒ‡å®šä½¿ç”¨SockJSåè®® } /* * é…ç½®æ¶ˆæ¯ä»£ç†(message broker) */ @Override public void configureMessageBroker(MessageBrokerRegistry registry) { registry.setApplicationDestinationPrefixes(\"/app\") //.enableSimpleBroker(\"/topic\", \"/queue\");//ä½¿ç”¨å†…ç½®ä»£ç† .enableStompBrokerRelay(\"/exchange\",\"/topic\",\"/queue\",\"/amq/queue\")//å¤„ç†æ‰€æœ‰æ¶ˆæ¯å°†æ¶ˆæ¯å‘é€åˆ°å¤–éƒ¨çš„æ¶ˆæ¯ä»£ç† rabbitmq .setRelayHost(\"192.168.1.90\") .setRelayPort(61613) .setVirtualHost(\"/eyeshot\"); //.setUserDestinationBroadcast(destination) //registry.setUserDestinationPrefix(\"/user\");//æ¨é€ç”¨æˆ·å‰ç¼€ // registry.setPathMatcher(new AntPathMatcher(\".\")); //è®¾ç½®è·¯å¾„åˆ†éš”ç¬¦ } 3ã€è®¾ç½®æ¡æ‰‹æ‹¦æˆªå™¨ åªåœ¨è¿›è¡Œè¿æ¥çš„æ—¶å€™è¿›è¡Œæ‹¦æˆª 123456789101112131415161718192021222324252627282930313233343536373839404142public class WebSocketSessionHandshakeInterceptor extends HttpSessionHandshakeInterceptor { private static final Logger logger = LoggerFactory.getLogger(WebSocketSessionHandshakeInterceptor.class); @Override public boolean beforeHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes) throws Exception { if (getSession(request) != null) { ServletServerHttpRequest servletRequest = (ServletServerHttpRequest) request; HttpServletRequest httpServletRequest = servletRequest.getServletRequest();httpServletRequest.getUserPrincipal(); List&lt;String&gt; requestCookies = servletRequest.getHeaders().get(\"cookie\"); for (String string : requestCookies) { String[] cookies = string.split(\";\"); for (String cookie : cookies) { String[] item = cookie.split(\"=\"); if(item[0].equals(\"sessionToken\")) { System.out.println(item[1]); attributes.put(\"sessionToken\", item[1]); } } } HttpSession session = httpServletRequest.getSession(false); if (session != null) { attributes.put(\"sessionId\", session.getId()); } attributes.put(\"user\", session.getId()); } super.beforeHandshake(request, response, wsHandler, attributes); return true; } @Override public void afterHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception ex) { super.afterHandshake(request, response, wsHandler, ex); } private HttpSession getSession(ServerHttpRequest request) { if (request instanceof ServletServerHttpRequest) { ServletServerHttpRequest serverRequest = (ServletServerHttpRequest) request; return serverRequest.getServletRequest().getSession(); } return null; }} 4ã€è‡ªå®šä¹‰æ‹¦æˆªå™¨ å¯ä»¥å¯¹å®¢æˆ·ç«¯çš„ä»»ä½•æ¶ˆæ¯æ‹¦æˆª 123456789101112131415161718192021/** * æ³¨å†Œè‡ªå®šä¹‰èº«ä»½éªŒè¯æ‹¦æˆªå™¨ * æ‹¦æˆªå™¨åªéœ€è¦åœ¨CONNECTä¸Šè¿›è¡Œèº«ä»½éªŒè¯å¹¶è®¾ç½®ç”¨æˆ·å¤´Messageã€‚Springå°†è®°å½•å¹¶ä¿å­˜ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œå¹¶å°†å…¶ä¸åŒä¸€ä¼šè¯ä¸­çš„åç»­STOMPæ¶ˆæ¯ç›¸å…³è” */ @Override public void configureClientInboundChannel(ChannelRegistration registration) { registration.interceptors(new ChannelInterceptorAdapter() { @Override public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) { StompHeaderAccessor accessor = MessageHeaderAccessor.getAccessor(message, StompHeaderAccessor.class); accessor.getSessionAttributes().get(\"sessionToken\"); if (StompCommand.CONNECT.equals(accessor.getCommand())) { String nickName = accessor.getNativeHeader(\"nickName\") != null ? accessor.getNativeHeader(\"nickName\").get(0) : \"æ¸¸å®¢\"+accessor.getSessionId(); Principal user = new MyPrincipal(nickName) ; // access authentication header(s) accessor.setUser(user); } return message; } }); } 12345678910111213141516171819import java.security.Principal;public class MyPrincipal implements Principal { private String nickName; public MyPrincipal() { } public MyPrincipal(String nickName) { this.nickName = nickName; } @Override public String getName() { return nickName; }} ç„¶ååœ¨å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥æ—¶ï¼Œåœ¨headersä¸­æŠŠç”¨æˆ·çš„nickNameä¼ å…¥,åœ¨æ‹¦æˆªå™¨ä¸­åŠ å…¥è®¤è¯Principalï¼Œä½¿åç»­å¯¹ç”¨æˆ·çš„æ—¶é—´è¿›è¡Œç›‘å¬ã€‚ 1234567891011121314151617181920function connect() { var headers = { sessionId: '111', passcode: 'mypasscode', // additional header 'sessionId': 'my-client-id', 'nickName' : 'å¤§è™¾' }; var socket = new SockJS(\"/eyeshot/portfolio\");//è¿æ¥SockJSçš„endpointåç§°ä¸º\"/portfolio\" stompClient = Stomp.over(socket);//ä½¿ç”¨STOMPå­åè®®çš„WebSocketå®¢æˆ·ç«¯ stompClient.connect(headers, function (frame) {//è¿æ¥WebSocketæœåŠ¡ç«¯ stompClient.subscribe(\"/topic/response1\", function (msg) {//é€šè¿‡stopmClient.subscribeè®¢é˜…\"/topic/response\"ç›®æ ‡å‘é€çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æ§åˆ¶å™¨çš„@SendToä¸­å®šä¹‰çš„ //console.log(\"ack \" + msg.ack()); var msgDom = document.getElementById(\"msg\"); var html = msgDom.innerHTML; msgDom.innerHTML = html + \"\\n\" + msg.body; }); }); } 5ã€ç”¨æˆ·äº‹ä»¶ç›‘å¬ å¯¹ç”¨æˆ·çš„è¿æ¥ï¼Œè®¢é˜…ã€å–æ¶ˆè®¢é˜…ã€æ–­å¼€ç­‰äº‹ä»¶ç›‘å¬ã€‚ 1234567891011121314151617181920 @EventListenerpublic void onConnectEvent(SessionConnectEvent event) { logger.info(\"Client with username {} Connect\", event.getUser().getName());}@EventListenerpublic void onSubscribeEvent(SessionSubscribeEvent event) { logger.info(\"Client with username {} Subscribe\", event.getUser().getName());}@EventListenerpublic void onUnsubscribeEvent(SessionUnsubscribeEvent event) { logger.info(\"Client with username {} Unsubscribe\", event.getUser().getName());}@EventListenerpublic void onDisconnectEvent(SessionDisconnectEvent event) { //event.getUser() logger.info(\"Client with username {} disconnected\", event.getSessionId());} 6ã€Controller 123456789101112131415161718192021222324252627282930313233343536@RestControllerpublic class WebSocketController { private static final Logger logger = LoggerFactory.getLogger(WebSocketController.class); @Resource private SimpMessagingTemplate messagingTemplate;// springå®ç°çš„ä¸€ä¸ªå‘é€æ¨¡æ¿ç±» @Autowired private SimpUserRegistry userRegistry; // å¯è·å–è¿æ¥ç”¨æˆ· @RequestMapping(\"/index\") public String index() { return \"index\"; } @MessageMapping(\"/test\") public void toAppTest(RequestMessage message) { System.out.println(message.getMessage()); this.messagingTemplate.convertAndSend(\"/topic/response1\", message.getMessage()); } // å½“æµè§ˆå™¨å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œé€šè¿‡@MessageMappingæ˜ å°„çš„åœ°å€ï¼Œç±»ä¼¼äº@RequestMapping @MessageMapping(value = \"/message/test\") // å½“æœåŠ¡ç«¯æœ‰æ¶ˆæ¯æ—¶ï¼Œä¼šå¯¹è®¢é˜…äº†@SendToä¸­çš„è·¯å¾„çš„æµè§ˆå™¨å‘é€æ¶ˆæ¯ @SendTo(value = \"/topic/response1\") public ResponseMessage say(Principal principal, RequestMessage acceptor) { System.out.println(principal.getName() + \" : \" + acceptor.getMessage()); System.out.println(\"è¿æ¥äººæ•°: \" + userRegistry.getUserCount()); return new ResponseMessage(principal.getName() + \" : \" + acceptor.getMessage()); } @RequestMapping(value = \"/greetings\") public void greetings(@RequestParam String message) { System.out.println(message); this.messagingTemplate.convertAndSend(\"/topic/response1\", message); } 123456789101112131415public class RequestMessage { /*** * è¯·æ±‚æ¶ˆæ¯å®ä½“ */ private String message; public String getMessage() { return message; } public void setMessage(String message) { this.message = message; }} 7ã€htmlé¡µé¢ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;!DOCTYPE html&gt;&lt;html xmlns=\"http://www.thymeleaf.org\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"/&gt; &lt;title&gt;websocket&lt;/title&gt;&lt;/head&gt;&lt;body onload=\"disconnect()\"&gt;&lt;body&gt;&lt;div&gt; &lt;button onclick=\"connect()\" id=\"connect\"&gt;è¿æ¥&lt;/button&gt; &lt;button onclick=\"disconnect()\" id=\"disconnect\"&gt;æ–­å¼€&lt;/button&gt;&lt;/div&gt;&lt;div id=\"inputDiv\"&gt; &lt;input type=\"text\" id=\"name\"/&gt; &lt;button id=\"send\" onclick=\"send()\"&gt;å‘é€&lt;/button&gt; &lt;button id=\"appTest\" onclick=\"appTest()\"&gt;ç³»ç»Ÿæ¶ˆæ¯&lt;/button&gt;&lt;/div&gt;&lt;div id=\"msg\"&gt;&lt;/div&gt;&lt;script src=\"https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js\"&gt;&lt;/script&gt;&lt;script src=\"./stomp.min.js\"&gt;&lt;/script&gt;&lt;script&gt; var stompClient = null; //è®¾ç½®è¿æ¥çŠ¶æ€æ§åˆ¶æ˜¾ç¤ºéšè— function setConnected(connected) { document.getElementById(\"connect\").disabled=connected; document.getElementById(\"disconnect\").disabled=!connected; if(!connected) { document.getElementById(\"inputDiv\").style.display=\"none\"; }else{ document.getElementById(\"inputDiv\").style.display=\"\"; } document.getElementById(\"msg\").innerHTML = \"\"; } function connect() { var headers = { sessionId: '111', passcode: 'mypasscode', // additional header 'sessionId': 'my-client-id', 'nickName' : 'å¤§è™¾' }; var socket = new SockJS(\"/eyeshot/portfolio\");//è¿æ¥SockJSçš„endpointåç§°ä¸º\"/portfolio\" stompClient = Stomp.over(socket);//ä½¿ç”¨STOMPå­åè®®çš„WebSocketå®¢æˆ·ç«¯ stompClient.connect(headers, function (frame) {//è¿æ¥WebSocketæœåŠ¡ç«¯ setConnected(true); stompClient.subscribe(\"/topic/response1\", function (msg) {//é€šè¿‡stopmClient.subscribeè®¢é˜…\"/topic/response\"ç›®æ ‡å‘é€çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æ§åˆ¶å™¨çš„@SendToä¸­å®šä¹‰çš„ //console.log(\"ack \" + msg.ack()); var msgDom = document.getElementById(\"msg\"); var html = msgDom.innerHTML; msgDom.innerHTML = html + \"\\n\" + msg.body; }); }); } //æ–­å¼€è¿æ¥ function disconnect() { if(stompClient!=null){ stompClient.disconnect(); } setConnected(false); console.log(\"disconnected!\"); } //å‘é€åç§°åˆ°åå° function send() { var name = document.getElementById(\"name\").value; stompClient.send(\"/app/message/test\", {}, JSON.stringify({//é€šè¿‡stompClient.sendå‘\"/message/test\"ç›®æ ‡å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªåœ¨æ§åˆ¶å™¨çš„@MessageMappingä¸­å®šä¹‰çš„ã€‚ 'message': name })); } function appTest() { var name = document.getElementById(\"name\").value; stompClient.send(\"/app/test\", {}, JSON.stringify({//é€šè¿‡stompClient.sendå‘\"/message/test\"ç›®æ ‡å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªåœ¨æ§åˆ¶å™¨çš„@MessageMappingä¸­å®šä¹‰çš„ã€‚ 'message': name })); }&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å…³äºcontrolleræ˜ å°„è·¯å¾„å‚è€ƒï¼šhttp://www.rabbitmq.com/stomp.html#d https://juejin.im/post/5ac8d30151882548fe4a6143","link":"/2018/08/15/java/websocket/springboot%E9%9B%86%E6%88%90websocket%E4%BD%BF%E7%94%A8rabbitmq/"},{"title":"webscoket","text":"WebSocket WebSocket æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®,å®ƒå¯é€šè¿‡å•ä¸ªTCPè¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å…¨åŒå·¥åŒå‘é€šä¿¡é€šé“ã€‚å®ƒæ¥è‡ªHTTPçš„ä¸åŒTCPåè®®ï¼Œä½†è®¾è®¡ä¸ºä½¿ç”¨ç«¯å£80å’Œ443é€šè¿‡HTTPå·¥ä½œï¼Œå¹¶å…è®¸é‡ç”¨ç°æœ‰é˜²ç«å¢™è§„åˆ™ ã€‚ WebSocketäº¤äº’ä»¥HTTPè¯·æ±‚å¼€å§‹ï¼Œè¯¥HTTPè¯·æ±‚ä½¿ç”¨HTTP &quot;Upgrade&quot;æ ‡å¤´å‡çº§ ï¼Œåˆ‡æ¢åˆ°WebSocketåè®® ã€‚ 12345678GET /spring-websocket-portfolio/portfolio HTTP/1.1Host: localhost:8080Upgrade: websocketConnection: UpgradeSec-WebSocket-Key: Uc9l9TMkWGbHFD2qnFHltg==Sec-WebSocket-Protocol: v10.stomp, v11.stompSec-WebSocket-Version: 13Origin: http://localhost:8080 WebSocketæ”¯æŒçš„æœåŠ¡å™¨è¿”å› 12345HTTP/1.1 101 Switching ProtocolsUpgrade: websocketConnection: UpgradeSec-WebSocket-Accept: 1qVdfYHU9hPOl4JYYNXF623Gzn0=Sec-WebSocket-Protocol: v10.stomp æˆåŠŸæ¡æ‰‹åï¼ŒHTTPå‡çº§è¯·æ±‚ä¸‹çš„TCPå¥—æ¥å­—ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ç»§ç»­å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ æ³¨æ„ï¼šå¦‚æœWebSocketæœåŠ¡å™¨åœ¨WebæœåŠ¡å™¨ï¼ˆä¾‹å¦‚nginxï¼‰åé¢è¿è¡Œï¼Œæ‚¨å¯èƒ½éœ€è¦å°†å…¶é…ç½®ä¸ºå°†WebSocketå‡çº§è¯·æ±‚ä¼ é€’åˆ°WebSocketæœåŠ¡å™¨ã€‚","link":"/2018/08/13/java/websocket/websocket%E4%B8%80/"},{"title":"Linuxå‘½ä»¤ä¹‹awk","text":"åŒæ—¶åŒ¹é…bashå’Œubuntu: 1$ awk '/bash/&amp;&amp;/ubuntu/' /etc/passwd åŒ¹é…bashæˆ–ubuntuï¼š 1$ awk '/bash/||/ubuntu/' /etc/passwd åŒæ—¶åŒ¹é…bashå’Œubuntuå¹¶æ‰“å°ç”¨æˆ·ååŠshellï¼š 1$ awk -F ':' '/bash/&amp;&amp;/ubuntu/{print $1\"\\t\"$7}' /etc/passwd # ï¼ˆ\"\\t\"åˆ¶è¡¨ç¬¦ï¼‰ æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥é€—å·åˆ†å‰²,è€Œä¸”åœ¨æ‰€æœ‰è¡Œæ·»åŠ åˆ—åname,shell,åœ¨æœ€åä¸€è¡Œæ·»åŠ â€end,endâ€: 1$ awk -F ':' 'BEGIN {print \"name,shell\"} {print $1\",\"$7} END {print \"end,end\"}' /etc/passwd","link":"/2017/08/31/linux/%E5%91%BD%E4%BB%A4/Linux%E5%91%BD%E4%BB%A4%E4%B9%8Bawk/"},{"title":"Linuxå‘½ä»¤ä¹‹sed","text":"ç®€ä»‹sed æ˜¯ä¸€ç§åœ¨çº¿ç¼–è¾‘å™¨ï¼Œå®ƒä¸€æ¬¡å¤„ç†ä¸€è¡Œå†…å®¹ã€‚å¤„ç†æ—¶ï¼ŒæŠŠå½“å‰å¤„ç†çš„è¡Œå­˜å‚¨åœ¨ä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œç§°ä¸ºâ€œæ¨¡å¼ç©ºé—´â€ï¼ˆpattern spaceï¼‰ï¼Œæ¥ç€ç”¨sedå‘½ä»¤å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œå¤„ç†å®Œæˆåï¼ŒæŠŠç¼“å†²åŒºçš„å†…å®¹é€å¾€å±å¹•ã€‚æ¥ç€å¤„ç†ä¸‹ä¸€è¡Œï¼Œè¿™æ ·ä¸æ–­é‡å¤ï¼Œç›´åˆ°æ–‡ä»¶æœ«å°¾ã€‚æ–‡ä»¶å†…å®¹å¹¶æ²¡æœ‰æ”¹å˜ï¼Œé™¤éä½ ä½¿ç”¨é‡å®šå‘å­˜å‚¨è¾“å‡ºã€‚Sedä¸»è¦ç”¨æ¥è‡ªåŠ¨ç¼–è¾‘ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼›ç®€åŒ–å¯¹æ–‡ä»¶çš„åå¤æ“ä½œï¼›ç¼–å†™è½¬æ¢ç¨‹åºç­‰ã€‚ sedå‘½ä»¤æ ¼å¼ä¸ºï¼š sed [-nefri] â€˜commandâ€™ è¾“å…¥æ–‡æœ¬ é€‰é¡¹ï¼š 123456789101112 -e ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸Šè¿›è¡ŒsedåŠ¨ä½œç¼–è¾‘ï¼Œæ­¤ä¸ºé»˜è®¤é€‰é¡¹ã€‚ -n ï¼šåªæ‰“å°æ¨¡å¼åŒ¹é…çš„è¡Œ -fâˆ¶ ç›´æ¥å°† sed çš„åŠ¨ä½œå†™åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œ -f filename åˆ™å¯ä»¥æ‰§è¡Œ filename å†…çš„sed åŠ¨ä½œï¼› -râˆ¶sed çš„åŠ¨ä½œæ”¯æ´çš„æ˜¯å»¶ä¼¸å‹æ­£è§„è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(é¢„è®¾æ˜¯åŸºç¡€æ­£è§„è¡¨ç¤ºæ³•è¯­æ³•)ã€‚ -iâˆ¶ç›´æ¥ä¿®æ”¹è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ç”±å±å¹•è¾“å‡ºã€‚å¸¸ç”¨å‘½ä»¤ï¼š a âˆ¶æ–°å¢ï¼Œ a çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ã€‚ i âˆ¶æ’å…¥ï¼Œ i çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼› c âˆ¶å–ä»£ï¼Œ c çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼ d âˆ¶åˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åé¢é€šå¸¸ä¸æ¥ä»»ä½•å­—ç¬¦ï¼› p âˆ¶åˆ—å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„èµ„æ–™å°å‡ºã€‚é€šå¸¸ p ä¼šä¸å‚æ•° sed -n ä¸€èµ·è¿ä½œã€‚ s âˆ¶å–ä»£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ æŸ¥æ‰¾ï¼š åŒæ—¶åŒ¹é…redisã€mongoDB ï¼šsed -n â€˜/redis/{/mongoDB/p}â€™ fileName åŒæ—¶åŒ¹é…redisã€mongoDBã€tomcat : sed -n â€˜/redis/{/mongoDB/{/tomcat/p}}â€™ fileName åŒ¹é…redisæˆ–mongoDB : sed -n â€˜/redis|mongoDB/pâ€™ fileName åŒ¹é…redisæˆ–mongoDBæˆ–tomcat : 12sed -n '/redis\\|mongoDB\\|tomcat/p' fileNamesed -n '/\\(redis\\|mongoDB\\|tomcat\\)/p' fileName 1$ sed -n '1,$d' fileName #æ˜¾ç¤ºç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œ æ›¿æ¢ï¼šæ ¼å¼ï¼šsed â€˜s/è¦æ›¿æ¢çš„å­—ç¬¦ä¸²/æ–°çš„å­—ç¬¦ä¸²/gâ€™ æ–‡ä»¶å ï¼ˆè¦æ›¿æ¢çš„å­—ç¬¦ä¸²å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼‰ æŠŠæ–‡æ¡£ä¸­çš„redisæ›¿æ¢ä¸ºmongoDB : sed â€˜s/redis/mongoDB/gâ€™ fileName æŠŠæ–‡æ¡£ä¸­çš„http:\\www.bjcscn.comæ›¿æ¢ä¸ºhttp:\\192.168.1.101:8088 : sed -i â€˜s/http:\\/\\/www.bjcscn.com/http:\\/\\/192.168.1.101:8088/gâ€™ fileName åˆ é™¤1234$ sed '1d' fileName #åˆ é™¤ç¬¬ä¸€è¡Œ$ sed '$d' fileName #åˆ é™¤æœ€åä¸€è¡Œ$ sed '1,2d' fileName #åˆ é™¤ç¬¬ä¸€è¡Œåˆ°ç¬¬äºŒè¡Œ$ sed '2,$d' fileName #åˆ é™¤ç¬¬äºŒè¡Œåˆ°æœ€åä¸€è¡Œ æ·»åŠ 1234567$ sed '1a Hello World' fileName #åœ¨ç¬¬ä¸€è¡Œä¹‹åå¢åŠ Hello World$ sed '1i Hello World' fileName #åœ¨ç¬¬ä¸€è¡Œä¹‹å‰å¢åŠ Hello World$ sed '1,4a Hello World' fileName #åœ¨ç¬¬ä¸€è‡³å››è¡Œä¹‹åéƒ½å¢åŠ Hello World$ sed '1a Hello World\\nadmin' fileName #åœ¨ç¬¬ä¸€ä¹‹åå¢åŠ Hello WorldåŠadminè¡Œ(\\næ¢è¡Œ)$ sed '/Redis/a mongoDB' fileName #æŸ¥æ‰¾åˆ°Redisæ‰€åœ¨è¡Œï¼Œåœ¨å…¶åè¡Œæ·»åŠ mongoDBè¡Œ$ sed 's/^/%/g' fileName #åœ¨æ¯ä¸€è¡Œçš„å‰é¢æ·»åŠ \"%\", ^è¡¨ç¤ºè¡Œé¦–$ sed 's/$/---/g' fileName #åœ¨æ¯ä¸€è¡Œçš„è¡Œå°¾æ·»åŠ \"---\", $è¡¨ç¤ºè¡Œå°¾ å¾…è¡¥å……ã€‚ã€‚ã€‚","link":"/2017/08/30/linux/%E5%91%BD%E4%BB%A4/Linux%E5%91%BD%E4%BB%A4%E4%B9%8Bsed/"},{"title":"adduseræ–°å¢ç”¨æˆ·","text":"adduseræ–°å¢ç”¨æˆ· useraddæ–°å¢ç”¨æˆ·æ¯”è¾ƒå¤æ‚ï¼Œå¯ç”¨adduseræ–°å¢ç”¨æˆ·ã€‚ 1234567891011121314151617$ adduser elasticAdding user `elastic' ...Adding new group `elastic' (1000) ...Adding new user `elastic' (1000) with group `elastic' ...Creating home directory `/home/elastic' ...Copying files from `/etc/skel' ...Enter new UNIX password:Retype new UNIX password:passwd: password updated successfullyChanging the user information for elasticEnter the new value, or press ENTER for the default Full Name []: elasticsearch Room Number []: Work Phone []: Home Phone []: Other []:Is the information correct? [Y/n] y","link":"/2018/06/05/linux/%E5%91%BD%E4%BB%A4/adduser%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7/"},{"title":"dirname ä¸ basename","text":"dirnameå‘½ä»¤ç”¨äºå»é™¤æ–‡ä»¶åä¸­çš„éç›®å½•éƒ¨åˆ†ï¼Œç„¶åè¿”å›å‰©ä¸‹çš„è·¯å¾„ï¼ˆç›®å½•çš„éƒ¨åˆ†ï¼‰ã€‚æˆªå–pathä¸­çš„ç›®å½•è·¯å¾„è¿”å›ã€‚ ç”¨æ³•ï¼š 12$ dirname /opt/share/sysfile/readme.txt /opt/share/sysfile basenameå‘½ä»¤ç”¨äºæ‰“å°ç›®å½•æˆ–è€…æ–‡ä»¶çš„åŸºæœ¬åç§°.æˆªå–pathä¸­çš„å»ç›®å½•éƒ¨åˆ†çš„æœ€åçš„æ–‡ä»¶æˆ–è·¯å¾„åã€‚ ç”¨æ³•ï¼š 12$ basename /opt/share/sysfile/readme.txt readme.txt ç¤ºä¾‹ï¼š path dirname basename /usr/local/ /usr local /usr / usr usr . usr / / / . . . .. . .. shellè„šæœ¬ä¸­è·å–å½“å‰ç›®å½• 123#!/bin/bashbasepath = $(cd `dirname $0`; pwd)echo $bathpath","link":"/2018/05/30/linux/%E5%91%BD%E4%BB%A4/dirname%E4%B8%8Ebasename/"},{"title":"chatträ¸lsattr","text":"chatträ¸lsattr","link":"/2018/06/01/linux/%E5%91%BD%E4%BB%A4/chattr%E4%B8%8Elsattr/"},{"title":"entræ˜¯ä¸€ä¸ªç›‘å¬æ–‡ä»¶å˜æ›´çš„å·¥å…·","text":"entræ˜¯ä¸€ä¸ªç›‘å¬æ–‡ä»¶å˜æ›´çš„å·¥å…· ä½¿ç”¨è¯¥å‘½ä»¤é¦–å…ˆè¦å…ˆä¸‹è½½å®‰è£… 1$ wget http://entrproject.org/code/entr-3.9.tar.gz å®‰è£… 123./configuremake testmake install ç¤ºä¾‹ 1$ ls test.txt |entr echo test ç›‘å¬æ–‡ä»¶å˜åŒ–ç„¶åå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ å…·ä½“ä½¿ç”¨å‚è€ƒï¼š http://entrproject.org/ https://bitbucket.org/eradman/entr/","link":"/2018/01/23/linux/%E5%91%BD%E4%BB%A4/entr/"},{"title":"rc.localä¸æ‰§è¡Œ","text":"åœ¨/etc/rc.localå†™å…¥æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬ï¼Œå®ç°ç³»ç»Ÿå¼€æœºå¯åŠ¨åŠŸèƒ½ 1ã€æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯åŠ¨çº§åˆ« 12root@raspberrypi:~# runlevelN 5 2ã€è¿›å…¥ç›¸åº”å¯åŠ¨çº§åˆ«ç›®å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰rc.localè½¯è¿æ¥å¦‚æœæ²¡æœ‰å°±åœ¨/etc/init.d/ä¸‹æ–°å»ºä¸€ä¸ªrc.localæ–‡ä»¶vim /etc/init.d/rc.local 12345678910111213141516171819202122232425262728293031323334353637383940414243#! /bin/sh### BEGIN INIT INFO# Provides: rc.local# Required-Start: $all# Required-Stop:# Default-Start: 2 3 4 5# Default-Stop:# Short-Description: Run /etc/rc.local if it exist### END INIT INFOPATH=/sbin:/usr/sbin:/bin:/usr/bin. /lib/init/vars.sh. /lib/lsb/init-functionsdo_start() { if [ -x /etc/rc.local ]; then [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_begin_msg &quot;Running local boot scripts (/etc/rc.local)&quot; /etc/rc.local ES=$? [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_end_msg $ES return $ES fi}case &quot;$1&quot; in start) do_start ;; restart|reload|force-reload) echo &quot;Error: argument '$1' not supported&quot; &gt;&amp;2 exit 3 ;; stop|status) # No-op exit 0 ;; *) echo &quot;Usage: $0 start|stop&quot; &gt;&amp;2 exit 3 ;;esac ç„¶åè®¾ç½®æˆå¼€æœºè‡ªå¯æœåŠ¡ 1$ update-rc.d rc.local defaults ä¹‹å/etc/rc5.dä¸‹å°±ä¼šæœ‰rc.localè½¯è¿æ¥ã€‚4ã€ä¹‹ååœ¨/etc/rc.localæ–‡ä»¶é‡Œæ·»åŠ æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ 1234567891011121314151617#!/bin/sh -e## rc.local## This script is executed at the end of each multiuser runlevel.# Make sure that the script will &quot;exit 0&quot; on success or any other# value on error.## In order to enable or disable this script just change the execution# bits.## By default this script does nothing./usr/bin/screen -S keepmongo mongod -f /etc/mongodb.conf/usr/bin/screen -S keepngrok /opt/ngrok/ngrok -config=/opt/ngrok/config.yml start ssh mongo redis ssh mongo redis 111ssh 111redis zhpt mongo101exit 0 æ³¨æ„ï¼šæ‰§è¡Œçš„å‘½ä»¤è·¯å¾„éƒ½è¦å†™æˆç»å¯¹è·¯å¾„ã€‚ 5ã€é‡å¯éªŒè¯ å‚è€ƒï¼šhttps://blog.csdn.net/shm839218753/article/details/80213741","link":"/2018/05/09/linux/%E5%91%BD%E4%BB%A4/rc.local%E4%B8%8D%E6%89%A7%E8%A1%8C/"},{"title":"scpè¿œç¨‹å¤åˆ¶æ–‡ä»¶","text":"ä»å¦ä¸€å°/opt/backç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°/rootç›®å½•ä¸‹ 1$ scp -P 22 -r root@43.224.0.1:/opt/back /root å°†æœ¬åœ°/opt/backç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€å°/rootç›®å½•ä¸‹ 1$ scp -P 22 -r /opt/back root@123.152.2.3:/root å…å¯†ç ä¼ è¾“åœ¨éœ€è¦è¾“å…¥å¯†ç çš„æœºå™¨ä¸Šæ‰§è¡Œ 1$ ssh-keygen -t rsa ä¹‹å3æ¬¡å›è½¦æŠŠäº§ç”Ÿçš„id_rsa.pubæ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€å°çš„~/.sshä¸‹ï¼Œå¹¶æ”¹åä¸º authorized_keysï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œå°±æŠŠid_rsa.pubçš„å†…å®¹å¤åˆ¶åˆ°authorized_keysä¸‹ã€‚å³å¯ã€‚","link":"/2018/05/03/linux/%E5%91%BD%E4%BB%A4/scp/"},{"title":"å®æ—¶ç›‘æ§ç½‘ç»œæµé‡å’Œå¸¦å®½ä½¿ç”¨-nethogs","text":"Nethogs æ˜¯ä¸€ä¸ªç»ˆç«¯ä¸‹çš„ç½‘ç»œæµé‡ç›‘æ§å·¥å…·,å®ƒæ˜¾ç¤º æ¯ä¸ªè¿›ç¨‹ çš„å¸¦å®½å ç”¨æƒ…å†µã€‚ å®‰è£… 1$ apt-get install nethogs ä½¿ç”¨ï¼š 12$ nethogs eth0 # ç›‘è§†è®¾å¤‡(eth0)çš„ç½‘ç»œå¸¦å®½$ nethogs eth0 eth1 # ç›‘è§†è®¾å¤‡(eth0ã€eth1)çš„ç½‘ç»œå¸¦å®½ è®¾ç½®åˆ·æ–°é—´éš” (é»˜è®¤500ms) 1$ nethogs -d 5 # è®¾ç½®åˆ·æ–°é¢‘ç‡ä¸º5ç§’ NetHogsäº¤äº’æ§åˆ¶ï¼šï¼ˆä½¿ç”¨ä»¥ä¸‹æŒ‰é”®æ“ä½œï¼‰ m: æŒ‰mé”®ï¼Œåˆ‡æ¢å•ä½æˆ–æ˜¾ç¤ºå ç”¨é€Ÿåº¦ï¼›åˆ‡æ¢é¡ºåºæ˜¯ï¼ˆKB/secï¼ŒKBï¼ŒBï¼ŒMBï¼‰ r : æŒ‰ r é”®ï¼ŒæŒ‰æ¥æ”¶æµé‡æ’åº s : æŒ‰ s é”® ï¼ŒæŒ‰å‘é€æµé‡æ’åº q : æŒ‰ q é”®é€€å‡º æ›´å¤šå‚æ•°å‚è€ƒï¼šnethogs â€“help æˆ– man nethogs é¡¹ç›®åœ°å€ï¼šhttps://github.com/raboof/nethogs#readme","link":"/2018/09/20/linux/%E5%91%BD%E4%BB%A4/%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E5%92%8C%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8-nethogs/"},{"title":"å®æ—¶ç›‘æ§ç½‘ç»œæµé‡å’Œå¸¦å®½ä½¿ç”¨-nload","text":"nloadæ˜¯ä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œå¯å®æ—¶ç›‘æ§ç½‘ç»œæµé‡å’Œå¸¦å®½ä½¿ç”¨æƒ…å†µã€‚å®ƒä½¿ç”¨ä¸¤ä¸ªå›¾è¡¨å¯è§†åŒ–è¾“å…¥å’Œè¾“å‡ºæµé‡ï¼Œå¹¶æä¾›å…¶ä»–ä¿¡æ¯ï¼Œå¦‚ä¼ è¾“æ•°æ®æ€»é‡å’Œæœ€å°/æœ€å¤§ç½‘ç»œä½¿ç”¨é‡ã€‚ å®‰è£… 1$ apt-get install nload ä½¿ç”¨ï¼š 12$ nload$ nload eth0 å¯ä»¥æŒ‰é”®ç›˜ä¸Šçš„ â† â†’ æˆ–è€… Enter/Tab é”®åˆ‡æ¢è®¾å¤‡(ç½‘å¡)ã€‚ æŒ‰ F2 æ˜¾ç¤ºé€‰é¡¹çª—å£ã€‚ æŒ‰ F5 å°†å½“å‰è®¾ç½®ä¿å­˜åˆ°ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚ æŒ‰ F6 ä»é…ç½®æ–‡ä»¶é‡æ–°åŠ è½½è®¾ç½®ã€‚ æŒ‰ q æˆ–è€… Ctrl+C é€€å‡º nloadã€‚ è®¾ç½®åˆ·æ–°é—´éš” (é»˜è®¤500ms) 1$ nload -t 1000 æ›´å¤šå‚æ•°å‚è€ƒï¼šnload â€“help æˆ– man nload é¡¹ç›®åœ°å€ï¼šhttps://github.com/rolandriegel/nload","link":"/2018/09/18/linux/%E5%91%BD%E4%BB%A4/%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E5%92%8C%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8-nload/"},{"title":"æµé‡ç»Ÿè®¡å·¥å…·-vnstat","text":"vnstatæ˜¯ä¸€ä¸ªåŸºäºæ§åˆ¶å°çš„ç½‘ç»œæµé‡ç›‘è§†å™¨ ï¼Œå®ƒä¼šè®°å½•æŒ‡å®šç½‘å¡çš„æ¯å°æ—¶ï¼Œæ¯æ—¥å’Œæ¯æœˆç½‘ç»œæµé‡ ã€‚ å®ƒè¿˜è‡ªå¸¦äº† vnstati å‘½ä»¤,é€šè¿‡å®ƒå¯ä»¥ç›´æ¥å¯ä»¥è¾“å‡ºæµé‡ç»Ÿè®¡å›¾. å®‰è£…ä¸€ã€å®‰è£…vnstatä¸¤ç§æ–¹å¼ï¼š ï¼ˆ1ï¼‰åœ¨åŒ…ç®¡ç†ç¨‹åºä¸­å®‰è£…ï¼ˆubuntuï¼‰ 1$ sudo apt-get install vnstat vnstati ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…(å®‰è£…æœ€æ–°ç¨³å®šç‰ˆæœ¬) 1234$ wget https://humdi.net/vnstat/vnstat-1.18.tar.gz$ tar -zxvf vnstat-1.18.tar.gz$ cd vnstat-1.18$ make &amp;&amp; make install äºŒã€æŸ¥çœ‹ç½‘å¡ 1$ ifcongig -a ä¸‰ã€åˆå§‹åŒ–ç›¸åº”ç½‘å¡çš„æ•°æ®åº“ 1$ vnstat -u -i wnet å››ã€å¯åŠ¨ daemon è¿›ç¨‹ 1$ sudo /etc/init.d/vnstat start äº”ã€é»˜è®¤å¼€æœºå¯åŠ¨ 1$ sudo update-rc.d vnstat enable vnStatåŸºæœ¬åº”ç”¨1ã€æŒ‰å°æ—¶ç»Ÿè®¡ 1$ vnstat -i wnet -h -iï¼šæŒ‡å®šç½‘å¡ 2ã€æŒ‰å¤©ç»Ÿè®¡ 1$ vnstat -i wnet -d 3ã€æŒ‰å‘¨ç»Ÿè®¡ 1$ vnstat -i wnet -w 4ã€æŒ‰æœˆç»Ÿè®¡ 1$ vnstat -i wnet -m 5ã€ç»Ÿè®¡æ¶ˆè€—æµé‡æœ€å¤šçš„10å¤©çš„æƒ…å†µ 1$ vnstat -i wnet -t 6ã€å®æ—¶æµé‡æŸ¥çœ‹ 1$ vnstat -i wnet -l 7ã€è¾“å‡ºåˆ°å›¾å½¢ï¼šä½¿ç”¨ vnstati å‘½ä»¤ï¼Œæ›´å¤šè¯¦ç»†çš„å‚æ•°å¯ä»¥è¯· man vnstatiã€‚ 1$ vnstati -i wnet -m -o /tmp/month.png æ•ˆæœ å®˜æ–¹ä¸»é¡µï¼š http://humdi.net/vnstat å‚è€ƒï¼šhttp://www.vpswe.com/vps-jiaocheng/483.html","link":"/2018/09/01/linux/%E5%91%BD%E4%BB%A4/%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7-vnstat/"},{"title":"Letâ€™s Encryptç”³è¯·æ³›åŸŸåè¯ä¹¦","text":"ç”±äºacme.shéªŒè¯åªæ”¯æŒ dns éªŒè¯, ä¸æ”¯æŒ http éªŒè¯. æ‰€ä»¥è¯·ä½¿ç”¨ dns api æ¨¡å¼dns-apiæ¨¡å¼å‚è€ƒdns-api é€šè¿‡acme.sh ä» letsencrypt ç”Ÿæˆå…è´¹çš„è¯ä¹¦. ä»¥ä¸‹ä¸º Webrootæ¨¡å¼æ™®é€šå•ä¸ªåŸŸåç­¾å‘å®‰è£…acme.sh1curl https://get.acme.sh | sh å®‰è£…è¿‡ç¨‹è¿›è¡Œäº†ä»¥ä¸‹å‡ æ­¥: 1ã€æŠŠ acme.sh å®‰è£…åˆ°äº† home ç›®å½•ä¸‹ï¼ˆ~/.acme.sh/ï¼‰ã€‚ 2ã€ è‡ªåŠ¨åˆ›å»º cronjob, æ¯å¤© 0:00 ç‚¹è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰çš„è¯ä¹¦ã€‚(ç›®å‰60å¤©ä»¥åä¼šè‡ªåŠ¨æ›´æ–°) å…¶å®ƒå®‰è£…é€‰é¡¹å‚è€ƒï¼šå®‰è£…é€‰é¡¹ ç”Ÿæˆè¯ä¹¦ç”Ÿæˆè¯ä¹¦æœ‰å¤šç§æ–¹å¼ Webrootæ¨¡å¼ï¼š 1acme.sh --issue -d zyksdq.com -w /usr/share/nginx/html/kaoshibao/guanli -d www.zyksdq.com å¿…é¡»zyksdq.com ä¸www.zyksdq.com æŒ‡å‘ç›¸åŒçš„webæ ¹æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”nginxåšå¥½é…ç½®ï¼Œä½¿å…¶å¯ä»¥è¯·æ±‚åˆ°è¯¥ç›®å½•ã€‚å…¶å®ƒæ¨¡å¼å‚è€ƒï¼šé¢å‘è¯ä¹¦ å®‰è£…è¯ä¹¦ç”Ÿæˆè¯ä¹¦åè¦æŠŠcopy åˆ°çœŸæ­£éœ€è¦ç”¨å®ƒçš„åœ°æ–¹ã€‚é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦åœ¨~/.acme.sh/ç›®å½•ä¸‹ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¤åˆ¶åˆ°ç›¸åº”ä½ç½® 1234acme.sh --installcert -d &lt;domain&gt;.com \\ --key-file /etc/nginx/ssl/&lt;domain&gt;.key \\ --fullchain-file /etc/nginx/ssl/fullchain.cer \\ --reloadcmd &quot;service nginx force-reload&quot; æŒ‡å®šçš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«è‡ªåŠ¨è®°å½•ä¸‹æ¥, å¹¶åœ¨å°†æ¥è¯ä¹¦è‡ªåŠ¨æ›´æ–°ä»¥å, è¢«å†æ¬¡è‡ªåŠ¨è°ƒç”¨. æ›´æ–° acme.sh1acme.sh --upgrade å…·ä½“å‚è€ƒï¼šhttps://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E","link":"/2018/04/08/nginx/https/Let%E2%80%99s%20Encrypt%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/"},{"title":"æ··åˆå‘½ä»¤","text":"åˆ†ææ—¥å¿—è¯·æ±‚çŠ¶æ€ç  1234$ tail -10000 localhost_access_log.2018-02-09.txt |awk '{print $9}'|sort |uniq -c |sort -nr 3206 200 3 500 1 304 åˆ†æè¿æ¥æ•° 12345678$ netstat -ntal |awk '{print $6}'|sort |uniq -c |sort -nr 5243 ESTABLISHED 47 TIME_WAIT 46 LISTEN 12 CLOSE_WAIT 6 FIN_WAIT2 1 Foreign 1 established) æŸ¥çœ‹ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ã€è¿›ç¨‹ã€IOè¯»å†™ã€CPUæ´»åŠ¨ä¿¡æ¯å…·ä½“å‚æ•°å¯å‚è€ƒï¼šhttps://www.cnblogs.com/kerrycode/p/6208257.html 12345678$ vmstat -w 2 5 procs ---------------memory-------------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 0 4652792 1689100 296580 1643004 0 0 10 8 0 0 1 0 99 0 0 0 0 4652792 1689032 296580 1643004 0 0 0 2 680 1289 0 0 100 0 0 0 0 4652792 1689188 296580 1643004 0 0 0 8 740 1385 0 0 100 0 0 0 0 4652792 1689188 296580 1643004 0 0 0 16 679 1304 0 0 100 0 0 0 0 4652792 1688772 296580 1643004 0 0 0 2 691 1310 0 0 100 0 0 æŸ¥çœ‹ç³»ç»Ÿå†…å­˜ä½¿ç”¨ 12345$ free -m total used free shared buffers cached Mem: 16048 14652 1396 0 289 1604 -/+ buffers/cache: 12757 3290 Swap: 16383 4543 11840","link":"/2018/02/09/linux/%E5%91%BD%E4%BB%A4/%E6%B7%B7%E5%90%88%E5%91%BD%E4%BB%A4/"},{"title":"TrustAsiaè¯ä¹¦","text":"è¯ä¹¦ç”³è¯·åœ°å€ï¼šhttps://freessl.org/å¯ç”³è¯·TrustAsiaï¼ˆ1å¹´æœ‰æ•ˆæœŸï¼‰ä¸ Letâ€™s Encryptï¼ˆ3ä¸ªæœˆï¼‰å…è´¹è¯ä¹¦ã€‚ äº‘ç«¯è€ƒè¯•æœåŠ¡çš„æ•°æ®æ˜¯ä»å…¶å®ƒæœåŠ¡åœ¨Javaç¨‹åºä¸­é€šè¿‡HttpClientæ¨é€è¿‡æ¥ï¼Œå› äº‘ç«¯è€ƒè¯•æœåŠ¡æ˜¯HTTPSï¼Œæ¨é€ä¼šå› ä¸ºè¯ä¹¦é—®é¢˜ï¼Œæ¨é€æŠ¥é”™ã€‚éœ€è¦å†jdkä¸­æ·»åŠ ä¿¡ä»»æ­¤äº‘ç«¯è¯ä¹¦ã€‚å› Letâ€™s Encryptä¸º3ä¸ªæœˆéœ€è¦ä»æ–°ç­¾å‘ï¼Œç­¾å‘åè¦å†æ¬¡åœ¨jdkä¸­æ·»åŠ ä¿¡ä»»æ–°çš„äº‘ç«¯è¯ä¹¦ã€‚æ‰€ä»¥ç”³è¯·1å¹´æœ‰æ•ˆæœŸè¯ä¹¦ TrustAsia 1ã€ç”ŸæˆéªŒè¯æ–‡ä»¶è¯ä¹¦ç±»å‹é€‰æ‹©çš„RSAï¼ˆé˜¿é‡Œäº‘SLBéœ€ï¼‰ã€éªŒè¯ç±»å‹é€‰æ‹©çš„Fileã€CSRç”Ÿæˆé€‰æ‹©çš„æµè§ˆå™¨ç”Ÿæˆã€‚2ã€éªŒè¯æ–‡ä»¶nginxé…ç½®æ·»åŠ  123location /.well-known/pki-validation/{ root /usr/share/nginx/html/www/xxbcpnsp; } åœ¨/usr/share/nginx/html/www/xxbcpnspä¸‹æ–°å»º/.well-known/pki-validation/fileauth.txté…ç½®å®Œè¿›è¡Œæ•ˆéªŒã€‚ä¹‹åä¸‹è½½è¯ä¹¦ã€‚3ã€å®‰è£…è¯ä¹¦æŠŠä¸‹è½½çš„è¯ä¹¦ä¸Šä¼ åˆ°ä¸€ä¸ªç›®å½•nginx é…ç½® 123456789101112server { # ç›‘å¬ ssl 443 ç«¯å£ listen 443 ssl; server_name example.com; # å¼€å¯ ssl ssl on; # æŒ‡å®š ssl è¯ä¹¦è·¯å¾„ ssl_certificate /path/to/example.com.pem; # æŒ‡å®šç§é’¥æ–‡ä»¶è·¯å¾„ ssl_certificate_key /path/to/example.com.key;} 4ã€é‡æ–°åŠ è½½nginxé…ç½® 1$ service nginx force-reload å‚è€ƒï¼šhttps://blog.freessl.org/how-to-install-cert-in-nginx/","link":"/2017/12/08/nginx/https/TrustAsia%E8%AF%81%E4%B9%A6/"},{"title":"malloc(262144) failed  Cannot allocate memory","text":"malloc(262144) failed (12: Cannot allocate memory) é‡åº†æœåŠ¡å™¨18-02-09 çªç„¶ç½‘ç«™æ— æ³•è®¿é—® nginxæ—¥å¿—ä¿¡æ¯(ç±»ä¼¼) 1232018/02/09 01:47:56 [emerg] 26018#0:*177348 malloc(262144) failed (12: Cannot allocate memory) while reading client request line, client: xx.xx.xx.xx, server: yy.yy.yy.yy:802018/02/09 01:47:56 [emerg] 26018#0: *177350 malloc(262144) failed (12: Cannot allocate memory) while reading client request line, client: xx.xx.xx.x, server: yy.yy.yy.yy:802018/02/09 01:47:56 [emerg] 26018#0: *177351 malloc(262144) failed (12: Cannot allocate memory) while reading client request line, client: xx.xx.xx.xx, server: yy.yy.yy.yy:80 é€šè¿‡free -m æŸ¥çœ‹å†…å­˜ä¿¡æ¯ï¼Œå‘ç°ç³»ç»Ÿå†…å­˜è¿˜å®½è£•ã€‚ ä¿®æ”¹vim /etc/sysctl.conf 1vm.max_map_count=128000 #å¢åŠ  ç„¶åè¿è¡Œ 1$ sysctl -p å‚è€ƒï¼šhttp://www.cnblogs.com/jzssuanfa/p/6748531.html","link":"/2018/02/09/nginx/%E5%BE%85%E9%AA%8C%E8%AF%81%E8%A7%A3%E5%86%B3/malloc%20%20Cannot%20allocate%20memory/"},{"title":"HTTPSä¹‹Letâ€™s Encryptè¯ä¹¦","text":"ç¬¬ä¸€ç§1ã€è®¿é—®certBot é€‰æ‹©ç›¸åº”è½¯ä»¶åŠç³»ç»Ÿï¼Œè·å–å®‰è£…å¸®åŠ©ï¼ˆnginxã€ubuntu16ï¼‰ 12345$ sudo apt-get update$ sudo apt-get install software-properties-common$ sudo add-apt-repository ppa:certbot/certbot$ sudo apt-get update$ sudo apt-get install python-certbot-nginx 2ã€ å®‰è£…å¥½ä¹‹å, è¿è¡Œ (æ³¨æ„ç”¨â€“nginx-server-rootæŒ‡å®šnginx.confçš„è·¯å¾„ï¼Œå…·ä½“certbotå‚æ•°å‚è€ƒï¼š certbotå‚æ•°) 1$ sudo certbot --nginx --nginx-server-root=/usr/local/nginx/conf/ Certbot ä¼šè‡ªåŠ¨æ³¨å†Œè´¦æˆ·ï¼Œæ£€æµ‹ Nginx é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåï¼Œè¯¢é—®ä½ ä¸ºå“ªäº›åŸŸåç”Ÿæˆè¯ä¹¦ï¼Œæ˜¯å¦å°† Http é‡å®šå‘åˆ° Https ç­‰ç­‰ï¼Œæœ€åå¸®ä½ è‡ªåŠ¨ä¿®æ”¹ Nginx é…ç½®å¹¶é‡å¯ï¼Œè¿™æ—¶ä½ çš„ç½‘ç«™å·²ç»å˜æˆäº† Httpsã€‚ 3ã€ è‡ªåŠ¨æ›´æ–°è¯ä¹¦ è¯ä¹¦åªæœ‰ä¸‰ä¸ªæœˆçš„æœ‰é™æœŸï¼Œéœ€è¦å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨è¯ä¹¦è¿‡æœŸæ—¶è‡ªåŠ¨æ›´æ–°ã€‚ 1$ sudo certbot renew --dry-run 4ã€æŸ¥çœ‹è¯ä¹¦çŠ¶æ€ 12345678$ /usr/sbin/certbot certificatesSaving debug log to /var/log/letsencrypt/letsencrypt.logFound the following certs: Certificate Name: qinzufei.top Domains: qinzufei.top Expiry Date: 2017-11-20 07:58:00+00:00 (VALID: 89 days) Certificate Path: /etc/letsencrypt/live/qinzufei.top/fullchain.pem Private Key Path: /etc/letsencrypt/live/qinzufei.top/privkey.pem 5ã€éªŒè¯ç½‘ç«™ç­‰çº§ https://www.ssllabs.com/ssltest/analyze.html?d=qinzufei.top 6ã€ å¯èƒ½é‡åˆ°çš„é—®é¢˜ 123456789101112131415161718192021222324Which names would you like to activate HTTPS for?-------------------------------------------------------------------------------1: qinzufei.top-------------------------------------------------------------------------------Select the appropriate numbers separated by commas and/or spaces, or leave inputblank to select all options shown (Enter 'c' to cancel): 1Obtaining a new certificatePerforming the following challenges:tls-sni-01 challenge for qinzufei.topWaiting for verification...Cleaning up challengesFailed authorization procedure. qinzufei.top (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Connection refusedIMPORTANT NOTES: - The following errors were reported by the server: Domain: qinzufei.top Type: connection Detail: Connection refused To fix these errors, please make sure that your domain name was entered correctly and the DNS A/AAAA record(s) for that domain contain(s) the right IP address. Additionally, please check that your computer has a publicly routable IP address and that no firewalls are preventing the server from communicating with the client. If you're using the webroot plugin, you should also verify that you are serving files from the webroot path you provided. æ˜¯å› ä¸ºæ²¡å¼€å¯443ç«¯å£ã€‚ ç¬¬äºŒç§ï¼š1ã€è‡ªåŠ¨å®‰è£… 123$ wget https://dl.eff.org/certbot-auto$ chmod a+x certbot-auto$ ./certbot-auto 2ã€ç”Ÿæˆè¯ä¹¦ 12#ä½¿ç”¨-dè¿½åŠ å¤šä¸ªåŸŸå$ ./certbot-auto certonly --standalone --email qzf98763@163.com --agree-tos -d qinzufei.top -d www.qinzufei.top å¦‚è‹¥å‡ºç°å¦‚ä¸‹é”™è¯¯ 12345678910111213Creating virtual environment...Traceback (most recent call last): File \"/usr/lib/python3/dist-packages/virtualenv.py\", line 2363, in &lt;module&gt; main() File \"/usr/lib/python3/dist-packages/virtualenv.py\", line 719, in main symlink=options.symlink) File \"/usr/lib/python3/dist-packages/virtualenv.py\", line 988, in create_environment download=download, File \"/usr/lib/python3/dist-packages/virtualenv.py\", line 918, in install_wheel call_subprocess(cmd, show_stdout=False, extra_env=env, stdin=SCRIPT) File \"/usr/lib/python3/dist-packages/virtualenv.py\", line 812, in call_subprocess % (cmd_desc, proc.returncode))OSError: Command /root/.local/share/letsencrypt/bin/python2.7 - setuptools pkg_resources pip wheel failed with error code 2 åŸå› æ˜¯pythonæœ‰å¤šä¸ªç‰ˆæœ¬ è§£å†³ï¼š 123$ apt-get install python-pip$ pip install --upgrade pip$ pip -V å¦‚æœè¿˜æ˜¯ä¸è¡Œ 12$ apt-get purge python-virtualenv python3-virtualenv virtualenv$ pip install virtualenv 3ã€ æŸ¥çœ‹è¯ä¹¦ï¼šls /etc/letsencrypt/live/ 4ã€åœ¨nginxé…ç½®è¯ä¹¦ 1234567listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/qinzufei.top/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/qinzufei.top/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbotif ($scheme != \"https\") { return 301 https://$host$request_uri;} # managed by Certbot 5ã€ç”¨nginx -téªŒè¯ è‹¥æŠ¥sslæœªå¼€å¯é”™è¯¯æ—¶ã€‚ å°±é‡æ–°ç¼–è¯‘nginx,å¹¶å¼€å¯sslæ¨¡å—ã€‚ 12$ ./configure --prefix=/usr/local/nginx --with-http_ssl_module$ make 6ã€æŸ¥çœ‹è¯ä¹¦çš„çŠ¶æ€ï¼š 12345678$ /usr/local/certbot/certbot-auto certificatesSaving debug log to /var/log/letsencrypt/letsencrypt.logFound the following certs: Certificate Name: qinzufei.top Domains: qinzufei.top Expiry Date: 2017-11-20 23:56:00+00:00 (VALID: 89 days) Certificate Path: /etc/letsencrypt/live/qinzufei.top/fullchain.pem Private Key Path: /etc/letsencrypt/live/qinzufei.top/privkey.pem 7ã€å®ç°å®šæ—¶æ›´æ–°è¯ä¹¦ æ¨¡æ‹Ÿè¯ä¹¦æ›´æ–° 1$ /usr/local/certbot/certbot-auto renew --dry-run é—®é¢˜ 12Attempting to renew cert (dsbm.bjuri.com) from /etc/letsencrypt/renewal/dsbm.bjuri.com.conf produced an unexpected error: Problem binding to port 443: Could not bind to IPv4 or IPv6.. Skipping.All renewal attempts failed. The following certs could not be renewed: è§£å†³æ–¹æ³•ï¼š1ã€åœæ‰nginx 2ã€æ›´æ–°è¯ä¹¦ 3ã€å¯åŠ¨nginx ç¼–å†™æ›´æ–°è„šæœ¬ 12345678#!/bin/bash# åœæ­¢nginxservice nginx stop# ç»­ç­¾# --force-renew å¼ºåˆ¶æ›´æ–°/usr/local/nginx/certbot/certbot-auto renew --force-renew# å¯åŠ¨nginxservice nginx start æ·»åŠ åˆ°crontabå®šæ—¶ä»»åŠ¡ crontab -e 1230 2 1 * * /usr/local/nginx/certbot/renew-cert.sh &gt;&gt; /var/log/letsencrypt/le-renew.log#åœ¨æ¯ä¸ªæœˆçš„1å·2ç‚¹30åˆ†è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œåœ¨æ¯ä¸ªæœˆçš„1å·2ç‚¹35åˆ†é‡æ–°åŠ è½½nginx å…¶å®ƒï¼šï¼ˆéªŒè¯ä¼˜åŒ–ç»“æœï¼‰https://www.ssllabs.com/ssltest/analyze.html 1ã€ç¦ç”¨SSLv3ï¼šå‚è€ƒ 1ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 2ã€å¼±Diffie-Hellmanå’ŒLogjamæ”»å‡»;å‚è€ƒä½¿ç”¨OpenSSLç”Ÿæˆä¸€ä¸ªæ–°çš„2048ä½çš„Diffie-Hellmanç»„ 12$ cd /etc/letsencrypt$ openssl dhparam -out dhparams.pem 2048 nginxä¸­é…ç½®æ·»åŠ  1234ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';ssl_prefer_server_ciphers on;ssl_dhparam /etc/letsencrypt/dhparams.pem; 3ã€å…³äºsessionã€ç¼“å­˜çš„ 123ssl_session_cache shared:SSL:50m;ssl_session_timeout 1d;ssl_session_tickets on; NGINXå¼€å¯SSLæ¨¡å—1ã€æŸ¥çœ‹nginxåŸæœ‰çš„æ¨¡å— 1$ /usr/local/nginx/sbin/nginx -V 2ã€åˆ‡æ¢åˆ°nginxæºç ç›®å½• 1$ cd /opt/nginx 3ã€å¼€å¯SSLæ¨¡å— 12$ ./configure --prefix=/usr/local/nginx --with-http_ssl_module$ make è¿™é‡Œä¸è¦è¿›è¡Œmake installï¼Œå¦åˆ™å°±æ˜¯è¦†ç›–å®‰è£… 4ã€å¤‡ä»½åŸæœ‰å·²å®‰è£…å¥½çš„nginx 1$ cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak 5ã€ç„¶åå°†åˆšåˆšç¼–è¯‘å¥½çš„nginxè¦†ç›–æ‰åŸæœ‰çš„nginxï¼ˆè¿™ä¸ªæ—¶å€™nginxè¦åœæ­¢çŠ¶æ€ï¼‰ 1$ cp ./objs/nginx /usr/local/nginx/sbin/ 6ã€ç„¶åéªŒè¯ä¸‹ 1$ /usr/local/nginx/sbin/nginx -V","link":"/2017/08/22/nginx/https/HTTPS%E4%B9%8BLet%E2%80%99s%20Encrypt%E8%AF%81%E4%B9%A6/"},{"title":"nginxé…ç½®æ–‡ä»¶ä¸­ifå¤šé‡åˆ¤æ–­","text":"nginxé…ç½®æ–‡ä»¶ä¸­ifå¤šé‡åˆ¤æ–­ Nginxä¸æ”¯æŒ andã€orã€&amp;&amp;ã€|| è¿™ç±»è¯­æ³•ï¼›ä¸”ä¸æ”¯æŒifçš„å¤šé‡åµŒå¥—ã€‚ å®ç°æ–¹æ³•ä¸€æ¯ä¸ªåŸŸåé…ç½®å•ç‹¬çš„server{}ï¼Œè¿™æ ·é…ç½®æ¯”è¾ƒç®€æ˜ï¼›ä½†ç¼ºç‚¹æ˜¯é…ç½®æ–‡ä»¶ä¼šå†™å¾ˆé•¿ï¼Œè¦ä¿®æ”¹å¤šæ¬¡ã€‚ï¼ˆæ¯”è¾ƒå•°å—¦ï¼‰ã€‚ å®ç°æ–¹æ³•äºŒå…¨éƒ¨åŸŸåé…ç½®ä¸€ä¸ªserver{}ï¼Œè¿›è¡Œå¤šé‡åˆ¤æ–­ï¼›è¿™æ ·é…ç½®å¯èƒ½ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½†é…ç½®æ–‡ä»¶ä¸ä¼šé‚£ä¹ˆå•°å—¦ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849server{ listen 80; server_name xzjps.bjcscn.com hncszj.bjupi.com; root html/unitrecordO_zjps; index index.html; location = /{ set $flag 0; if ($host = \"hncszj.bjupi.com\"){ set $flag \"${flag}1\"; } if ($query_string !~* ^(.*)userGroup=(.*)$){ set $flag \"${flag}2\"; } if ($flag ~* \"012\"){ rewrite ^/(.*)$ http://hncszj.bjupi.com/?userGroup=41 break; } } # å¦‚æœæ»¡è¶³æ¡ä»¶ä¸€å¹¶åŒæ—¶ä¹Ÿæ»¡è¶³æ¡ä»¶äºŒ,å°±é‡å®šå‘åˆ°http://hncszj.bjupi.com/?userGroup=41 location = /index.html { add_header Cache-Control \"no-cache no-store\"; } location /{ try_files $uri $uri/ /index.html; } location /cpnsp/{ proxy_connect_timeout 3; proxy_send_timeout 300; proxy_read_timeout 300; proxy_pass http://urstrem3; proxy_set_header REMOTE_ADDR $remote_addr; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; }}","link":"/2020/03/29/nginx/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/nginx%E4%B8%ADif%E5%8F%8C%E9%87%8D%E5%88%A4%E6%96%AD/"},{"title":"è¯ä¹¦æ–‡ä»¶åç¼€ååŒºåˆ†","text":"å¹³æ—¶å¯èƒ½é‡åˆ°å„ç§åç¼€åçš„è¯ä¹¦ç›¸å…³æ–‡ä»¶ï¼š PEMã€DERã€CRTã€CERã€KEYã€CSRã€PFXã€JKSç­‰ã€‚ X.509æ˜¯ä¸€ç§è¯ä¹¦çš„æ ¼å¼æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†è¯ä¹¦ä¸­åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œå¹¶æè¿°äº†è¿™äº›ä¿¡æ¯æ˜¯å¦‚ä½•ç¼–ç çš„(å³æ•°æ®æ ¼å¼)ï¼Œå¯å‚è€ƒRFC5280ï¼ŒSSLä½¿ç”¨çš„å°±æ˜¯è¿™ç§è¯ä¹¦æ ‡å‡†ã€‚ä¸€èˆ¬ç”±ç”¨æˆ·å…¬å…±å¯†é’¥å’Œç”¨æˆ·æ ‡è¯†ç¬¦ç»„æˆï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬ç‰ˆæœ¬å·ã€è¯ä¹¦åºåˆ—å·ã€CA æ ‡è¯†ç¬¦ã€ç­¾åç®—æ³•æ ‡è¯†ã€ç­¾å‘è€…åç§°ã€è¯ä¹¦æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚ è¯ä¹¦çš„ç¼–ç æ ¼å¼1ã€PEM = æ‰©å±•åPEMç”¨äºASCII(Base64)ç¼–ç çš„å„ç§X.509 v3 è¯ä¹¦ã€‚ æ–‡ä»¶å¼€å¤´ç”±ä¸€è¡Œâ€â€”â€“BEGIN xxxâ€”â€“â€œå¼€å§‹ï¼Œå¹¶ä»¥ -----END XXX----- ç»“å°¾ï¼Œä¸­é—´ Body å†…å®¹ä¸º Base64 ç¼–ç è¿‡çš„æ•°æ®ã€‚ é€šè¿‡å¦‚ä¸‹ OpenSSL å‘½ä»¤å¯ä»¥æŸ¥çœ‹å…¶è¯ä¹¦å†…å®¹ï¼š 1$ openssl x509 -in xxx.pem -text -noout å®ƒä¹Ÿå¯ä»¥ç”¨æ¥ç¼–ç å­˜å‚¨å…¬é’¥ï¼ˆRSA PUBLIC KEYï¼‰ã€ç§é’¥ï¼ˆRSA PRIVATE KEYï¼‰ã€è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCERTIFICATE REQUESTï¼‰ç­‰æ•°æ®ã€‚ ä¸€èˆ¬ Apache å’Œ Nginx æœåŠ¡å™¨åº”ç”¨åå‘äºä½¿ç”¨ PEM è¿™ç§ç¼–ç æ ¼å¼ã€‚ 2ã€DER = æ‰©å±•åDERç”¨äºäºŒè¿›åˆ¶DERç¼–ç çš„è¯ä¹¦ï¼ˆæ— æ³•ç›´æ¥é¢„è§ˆï¼‰ã€‚ é€šè¿‡å¦‚ä¸‹ OpenSSL å‘½ä»¤æŸ¥çœ‹å…¶è¯ä¹¦å†…å®¹ï¼š 1$ openssl x509 -in xxx.der -inform der -text -noout ä¸€èˆ¬ Java å’Œ Windows æœåŠ¡å™¨åº”ç”¨åå‘äºä½¿ç”¨ DER è¿™ç§ç¼–ç æ ¼å¼ã€‚ è¯ä¹¦ç¼–ç çš„è½¬æ¢PEMè½¬ä¸ºDER ï¼š 1$ openssl x509 -in xxx.pem -outform der -out xxx.der DERè½¬ä¸ºPEM: 1$ openssl x509 -in xxx.der -inform der -outform pem -out xxx.pem (æç¤º:è¦è½¬æ¢KEYæ–‡ä»¶ä¹Ÿç±»ä¼¼,åªä¸è¿‡æŠŠx509æ¢æˆrsa,è¦è½¬CSRçš„è¯,æŠŠx509æ¢æˆreqâ€¦) è¯ä¹¦çš„æ‰©å±•åè™½ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“æœ‰PEMå’ŒDERè¿™ä¸¤ç§ç¼–ç æ ¼å¼,ä½†æ–‡ä»¶æ‰©å±•åå¹¶ä¸ä¸€å®šå°±å«â€PEMâ€æˆ–è€…â€DERâ€,å¸¸è§çš„æ‰©å±•åé™¤äº†PEMå’ŒDERè¿˜æœ‰ä»¥ä¸‹è¿™äº›,å®ƒä»¬é™¤äº†ç¼–ç æ ¼å¼å¯èƒ½ä¸åŒä¹‹å¤–,å†…å®¹ä¹Ÿæœ‰å·®åˆ«,ä½†å¤§å¤šæ•°éƒ½èƒ½ç›¸äº’è½¬æ¢ç¼–ç æ ¼å¼. CRT = å³ certificate çš„ç¼©å†™ï¼Œå¸¸è§äºç±» UNIX ç³»ç»Ÿã€‚è¯ä¹¦å¯ä»¥æ˜¯DERç¼–ç ï¼Œä¹Ÿå¯ä»¥æ˜¯PEMç¼–ç ã€‚ä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ­¤æ ¼å¼è¯ä¹¦éƒ½æ˜¯é‡‡ç”¨ PEM ç¼–ç ï¼Œæ‰©å±•åCERå’ŒCRTå‡ ä¹æ˜¯åŒä¹‰è¯ã€‚ CER = CRTè¯ä¹¦çš„å¾®è½¯å‹å¼ã€‚ä¹Ÿæ˜¯ certificate çš„ç¼©å†™ï¼Œå¸¸è§äº Windows ç³»ç»Ÿï¼Œè¯ä¹¦å¯èƒ½æ˜¯PEMç¼–ç ï¼Œä¹Ÿå¯èƒ½æ˜¯DERç¼–ç ã€‚ä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ­¤æ ¼å¼è¯ä¹¦éƒ½æ˜¯é‡‡ç”¨ DER ç¼–ç ã€‚ KEY = é€šå¸¸ç”¨æ¥å­˜æ”¾ä¸€ä¸ª RSA å…¬é’¥æˆ–è€…ç§é’¥ï¼Œå®ƒå¹¶é X.509 è¯ä¹¦æ ¼å¼PCSK#8ã€‚ç¼–ç å¯èƒ½æ˜¯PEM,ä¹Ÿå¯èƒ½æ˜¯DERã€‚ æŸ¥çœ‹æ–¹å¼ï¼š 12$ openssl rsa -in xxx.key -text -noout # PEMç¼–ç æ ¼å¼$ openssl rsa -in xxx.key -text -noout -inform der # DERç¼–ç æ ¼å¼ CSR = Certificate Signing Request,å³è¯ä¹¦ç­¾åè¯·æ±‚,è¿™ä¸ªå¹¶ä¸æ˜¯è¯ä¹¦,è€Œæ˜¯å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„è·å¾—ç­¾åè¯ä¹¦çš„ç”³è¯·,å…¶æ ¸å¿ƒå†…å®¹æ˜¯ä¸€ä¸ªå…¬é’¥(å½“ç„¶è¿˜é™„å¸¦äº†ä¸€äº›åˆ«çš„ä¿¡æ¯),åœ¨ç”Ÿæˆè¿™ä¸ªç”³è¯·çš„æ—¶å€™,åŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªç§é’¥ã€‚ PFX/P12 ï¼Œ PKCS #12ï¼Œæ˜¯å…¬é’¥åŠ å¯†æ ‡å‡†ï¼ˆPublic Key Cryptography Standardsï¼ŒPKCSï¼‰ç³»åˆ—çš„ä¸€ç§ã€‚å°†åŒ…å«äº†å…¬é’¥çš„ X.509 è¯ä¹¦å’Œè¯ä¹¦å¯¹åº”çš„ç§é’¥ä»¥åŠå…¶ä»–ç›¸å…³ä¿¡æ¯è¿›è¡Œäº†æ‰“åŒ…ã€‚å¯ä»¥ç®€å•ç†è§£ï¼š.p12 æ–‡ä»¶ = X.509 è¯ä¹¦+ç§é’¥ã€‚ å¯¹nginxæœåŠ¡å™¨æ¥è¯´,ä¸€èˆ¬CRTå’ŒKEYæ˜¯åˆ†å¼€å­˜æ”¾åœ¨ä¸åŒæ–‡ä»¶ä¸­çš„,ä½†Windowsçš„IISåˆ™å°†å®ƒä»¬å­˜åœ¨ä¸€ä¸ªPFXæ–‡ä»¶ä¸­,(å› æ­¤è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†è¯ä¹¦åŠç§é’¥)è¿™æ ·ä¼šä¸ä¼šä¸å®‰å…¨ï¼Ÿåº”è¯¥ä¸ä¼š,PFXé€šå¸¸ä¼šæœ‰ä¸€ä¸ªâ€æå–å¯†ç â€,ä½ æƒ³æŠŠé‡Œé¢çš„ä¸œè¥¿è¯»å–å‡ºæ¥çš„è¯,å®ƒå°±è¦æ±‚ä½ æä¾›æå–å¯†ç ,PFXä½¿ç”¨çš„æ˜¯DERç¼–ç ã€‚ ä»pfxå¯¼å‡ºcrtå’Œkeyï¼š 12$ openssl pkcs12 -in xxx.pfx -nocerts -nodes -out xxx.key$ openssl pkcs12 -in xxx.pfx -clcerts -nokeys -out xxx.crt å°†crtå’Œkeyåˆå¹¶å‡ºpfx:1$ openssl pkcs12 -export -in xxx.crt -inkey xxx.key -out xxx.pfx JKS - Java Key Storage, è¿™æ˜¯Javaçš„ä¸“åˆ©,è·ŸOpenSSLå…³ç³»ä¸å¤§,åˆ©ç”¨Javaçš„ä¸€ä¸ªå«â€keytoolâ€çš„å·¥å…·,å¯ä»¥å°†PFXè½¬ä¸ºJKS,å½“ç„¶äº†,keytoolä¹Ÿèƒ½ç›´æ¥ç”ŸæˆJKSã€‚å®ƒä¹ŸåŒæ—¶åŒ…å«è¯ä¹¦å’Œç§é’¥ã€‚å¸¸ç”¨äºTomcatã€‚ å‚è€ƒï¼šhttps://segmentfault.com/a/1190000011709784 https://kangzubin.com/certificate-format/","link":"/2018/10/15/nginx/https/%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D%E5%8C%BA%E5%88%86/"},{"title":"nginxé…ç½®æ–‡ä»¶ä¸­ifå¤šé‡åˆ¤æ–­","text":"1234upstream teststrem2 { server 127.0.0.1:8300 max_fails=1 fail_timeout=60s; server 127.0.0.1:8301 max_fails=1 fail_timeout=60s; } max_fails ã€ fail_timeout æ˜¯Nginxçš„è´Ÿè½½å‡è¡¡æ£€æŸ¥æ¨¡å—ä¸­ä¸¤ä¸ªå¯é€‰å‚æ•°ã€‚ç”¨äºåˆ¤æ–­åç«¯èŠ‚ç‚¹çŠ¶æ€ã€‚ NginxåŸºäºè¿æ¥æ¢æµ‹ï¼Œå¦‚æœå‘ç°åç«¯å¼‚å¸¸ï¼Œåœ¨å•ä½å‘¨æœŸä¸ºfail_timeoutè®¾ç½®çš„æ—¶é—´ï¼Œä¸­è¾¾åˆ°max_failsæ¬¡æ•°ï¼Œè¿™ä¸ªå‘¨æœŸæ¬¡æ•°å†…ï¼Œå¦‚æœåç«¯åŒä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå°†æŠŠèŠ‚ç‚¹æ ‡è®°ä¸ºä¸å¯ç”¨ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸï¼ˆåŒæ ·æ—¶å¸¸ä¸ºfail_timeoutï¼‰å†ä¸€æ¬¡å»è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¿æ¥æ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸï¼Œå°†æ¢å¤ä¹‹å‰çš„è½®è¯¢æ–¹å¼ï¼Œå¦‚æœä¸å¯ç”¨å°†åœ¨ä¸‹ä¸€ä¸ªå‘¨æœŸ(fail_timeout)å†è¯•ä¸€æ¬¡ã€‚ åœ¨ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥åå“ªæ€•è¯·æ±‚åˆ°äº†ä¸å¯ç”¨çš„èŠ‚ç‚¹ï¼Œæ­¤æ¬¡è¯·æ±‚ä¹Ÿä¸ä¼šå¤±è´¥ï¼Œå› ä¸ºNginxä¼šæŠŠæ­¤æ¬¡è¯·æ±‚è½¬å‘åˆ°å¦å¤–ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹ï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼ŒNginxä¸çŸ¥é“èŠ‚ç‚¹æ˜¯å¦æ¢å¤çš„æ—¶å€™ï¼Œä¼šæŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚åŒæ—¶è½¬å‘åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­èŠ‚ç‚¹å¥åº·æƒ…å†µã€‚ å¯ç”¨äºè§£å†³ä¹‹å‰åˆ˜é—®çš„é—®é¢˜ï¼Œåç«¯æœåŠ¡æ›´æ–°æˆ–è€…å‡ºç°æº¢å‡ºï¼ŒæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œå¯¼è‡´å‰ç«¯æ¡Œé¢ç«¯å¡æ­»çš„æƒ…å†µã€‚ å‚è€ƒï¼šhttps://blog.51cto.com/kexiaoke/2316851 å‚è€ƒï¼šhttps://blog.51cto.com/kexiaoke/2316851","link":"/2020/03/29/nginx/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/nginx%E4%B8%ADmax_fails%E5%92%8Cfail_timeout/"},{"title":"nginxåœ¨è¯·æ±‚è·¯å¾„ä¸­ä¿®æ”¹å­—ç¬¦ä¸²","text":"nginxåœ¨è¯·æ±‚è·¯å¾„ååŠ å­—ç¬¦ä¸² éœ€æ±‚ä¸€ï¼šhttp://192.168.1.113:8080/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624a.m3u8ï¼Œä½ èƒ½è·Ÿæˆ‘è½¬å‘ç»™ï¼šhttp://192.168.1.113:8080/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624aä¹ˆï¼Ÿå°±æ˜¯æ’­æ”¾è¦è®¤åç¼€å.m3u8ï¼Œè€Œæˆ‘ä»¬ç³»ç»Ÿæ²¡æœ‰ç”¨åç¼€ã€‚ 123456location ~* /playhls/(.*) { set $suffix \".m3u8\"; if ($request_uri !~* /(.*)\\.m3u8$) { rewrite ^/(.*)$ http://$server_name$request_uri$suffix; } } nginx$å‚æ•° éœ€æ±‚äºŒï¼šæŠŠ/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624a.m3u8 è½¬å‘åˆ°/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624a å³å‰ç«¯è¦ç”¨playhls/xxx.m3u8ï¼Œè½¬åˆ°åå°æ˜¯playhls/xxx 123456789location ~* /playhls/(.*) { if ($request_uri ~* (/.*)\\.m3u8$) { set $repath $1; #echo $repath; rewrite ^/(.*)$ $repath break; proxy_pass http://192.168.1.101:8088; # rewrite ^/(.*)$ http://$server_name$repath; }} 1ã€å…ˆç”¨æ­£åˆ™(/.*)\\.m3u8$åŒ¹é…åˆ°/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624a.m3u8 2ã€ç„¶åæŠŠæ‹¬å·ä¸­æˆªå–åˆ°çš„å­—ç¬¦/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624a èµ‹å€¼ç»™å˜é‡$repath , $1è¡¨ç¤ºç¬¬ä¸€ä¸ªæ‹¬å·å†…åŒ¹é…çš„æ­£åˆ™å‚æ•°ã€‚ 3ã€ç„¶åç”¨rewrite ä¿®æ”¹ $uriã€‚ 4ã€æœ€åproxy_passæŒ‰è·¯å¾„/cpnsp/ws/playhls/4f2ef26002aa4b0b8990e1503abe624aè½¬å‘åˆ° http://192.168.1.101:8088 æ³¨æ„ rewrite è¦æœ‰ä¸ªé‡æ–°åŒ¹é… location çš„å‰¯ä½œç”¨ã€‚ç”±äº proxy_pass çš„å¤„ç†é˜¶æ®µæ¯” location å¤„ç†æ›´æ™šï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ break æ‰ï¼Œä»¥é˜²æ­¢ rewrite è¿›å…¥ä¸‹ä¸€æ¬¡ location åŒ¹é…è€Œä¸¢å¤± proxy_passã€‚","link":"/2020/04/28/nginx/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/nginx%E5%9C%A8%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%E4%B8%AD%E4%BF%AE%E6%94%B9%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"title":"ä½¿ç”¨systemdæ§åˆ¶frp(frpcfrps)å¼€æœºè‡ªå¯","text":"ä»¥frpcä¸ºä¾‹ 1ã€æ–°å»ºé¡¹ç›®çš„systemdç®¡ç†æ–‡ä»¶frpc.service vim /etc/systemd/system/boot_cpnspcms.service 123456789101112[Unit]Description=FRP to bypass NAT NetworkAfter=network.target[Service]Type=simpleExecStart=/opt/frp/frp_0.30.0/frpc -c /opt/frp/frp_0.30.0/frpc.iniStandardOutput=syslogStandardError=inherit[Install]WantedBy=multi-user.target 2ã€ç®¡ç† 123$ systemctl daemon-reload$ systemctl enable frpc.service$ systemctl start frpc.service","link":"/2019/12/02/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/frp/%E4%BD%BF%E7%94%A8systemd%E6%8E%A7%E5%88%B6frp(frpcfrps)%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/"},{"title":"æ¢…è¥¿","text":"æ¢…è¥¿ï¼Œè¿™ä¸ªåå­— åˆé—»å¤§æ¦‚æ˜¯å¤§ä¸‰é‚£å¹´å·´è¥¿ä¸–ç•Œæ¯ï¼ŒåŒåœ¨å®¿èˆè§‚çœ‹ä¸–ç•Œæ¯çš„å®¤å‹å£ä¸­ç¬¬ä¸€æ¬¡å¬åˆ°æ¢…è¥¿è¿™ä¸ªåå­—ï¼Œç”±äºæ­¤å‰å¹¶æœªå…³æ³¨è¿‡è¶³çƒï¼Œè‡³æ­¤ï¼Œæ—¶è‡³ä¿„ç½—æ–¯ä¸–ç•Œæ¯ï¼Œå¯¹æ¢…è¥¿çš„å°è±¡ä¹Ÿåªæ˜¯è¸¢çƒæ¯”è¾ƒå‰å®³ï¼Œåˆ«çš„å†æ— å…¶å®ƒï¼Œç”šè‡³ä»–æ‰€ä»£è¡¨çš„å›½å®¶ä¹Ÿæ˜¯åœ¨è¿™æ¬¡ä¿„ç½—æ–¯ä¸–ç•Œæ¯æ‰å¾—çŸ¥çš„ã€‚ç«¯åˆå‡æœŸæ­£å€¼ä¸–ç•Œæ¯å¼€èµ›ï¼Œæœ‰å¹¸è§‚çœ‹äº†é˜¿æ ¹å»·ä¸å†°å²›çš„æ¯”èµ›ï¼Œæœ€ç»ˆæ˜¯1æ¯”1å¹³ï¼ŒæœŸé—´æœ‰ä¸ªç‚¹çƒï¼Œæ˜¯æ¢…è¥¿ä¸»ç½šï¼Œä½†æœ€ç»ˆæ˜¯è¢«å†°å²›é—¨å°†æ‰‘å‡ºã€‚ä¹‹åä¸¤å¤©ä¾¿æ˜¯å„ç§çˆ†æ–™ï¼Œæ¢…è¥¿ç‚¹çƒè¢«å¯¼æ¼”é—¨å°†æ‰‘å‡ºçš„æ–°é—»ã€‚å‰ä¸¤å¤©é˜¿æ ¹å»·å¯¹é˜µå…‹ç½—åœ°äºš 0ï¼š3 æƒ¨è´¥ï¼Œæ„Ÿè§‰æ€ä¹ˆæ¢…è¥¿ä¸æƒ³ä¼ è¯´ä¸­çš„é‚£æ ·ã€‚è¿™ä¸¤å¤©å¯¹æ¢…è¥¿æœ‰äº†è¿›ä¸€æ­¥è®¤è¯†ï¼Œä»Šå¤©åˆæ— æ„å¾—çŸ¥ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥ï¼Œå†…å¿ƒäº§ç”Ÿäº†ä¸€äº›å…±é¸£ã€‚ ç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼ ä»¥ä¸‹è½¬è‡ªï¼šhttps://kuaibao.qq.com/s/FTB2018062400947700 1987å¹´6æœˆ24æ—¥ï¼Œé˜¿æ ¹å»·åœ£è²èƒœç½—è¨é‡Œå¥¥å¸‚ï¼Œä¸€ä¸ªå©´å­©å‘±å‘±å åœ°ã€‚5å¹´åä»–å¼€å§‹è¸¢çƒï¼Œ11å¹´åè¢«è¯Šæ–­æ‚£æœ‰ä¾å„’ç—‡ï¼Œ13å¹´åä»–ç”¨è‡ªå·±çš„è¶³çƒå¤©èµ‹æ¢æ¥äº†æ²»ç–—ç–¾ç—…çš„è´¹ç”¨ã€‚ä»è¿™ä¸€å¹´å¼€å§‹ï¼Œä»–çš„äººç”Ÿå’Œè¶³çƒå½»åº•æ†ç»‘åœ¨äº†ä¸€èµ·ã€‚ç„¶åï¼Œ31å¹´åçš„6æœˆ24æ—¥ï¼Œ2018å¹´ä¿„ç½—æ–¯ï¼Œ31å²çš„ä»–å¸¦ç€å¤©ä¹‹éª„å­çš„ç§°å·ï¼Œå¸¦ç€æ½˜å¸•æ–¯é›„é¹°çš„éª„å‚²ï¼Œå†æ¬¡ç«™åœ¨ä¸–ç•Œæ¯çš„èˆå°ä¸Šäº†ã€‚é‡Œå¥¥-æ¢…è¥¿ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ å¦‚æœæˆ‘ä»¬è¯•ç€å»è¯»æ‡‚æ¢…è¥¿ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªæ€»æ˜¯èƒŒå¯¹å…¨ä¸–ç•Œçš„ç˜¦å°ç”·äººå…¶å®è¶…ä¹å¯»å¸¸çš„å¸…æ°”ã€‚ èº«é«˜170cmï¼Œæ²¡æœ‰å‘è¾¾çš„è‚Œè‚‰ï¼Œå¯æ¯å½“ä»–çªç€å°ç†Šä¸€èˆ¬çš„åœ†çœ¼ç›å‘æ‡µçš„æ—¶å€™ï¼Œä»–å¾®å¾®è¹™çœ‰çš„æ—¶å€™ï¼Œä»–å’§å˜´å¤§ç¬‘çš„æ—¶å€™ï¼Œå´å°†â€œèŒå¸…â€æ¼”ç»åˆ°äº†æè‡´ã€‚ è€Œå‰¥å»â€œèŒå¸…â€çš„å¤–è¡¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åˆ™æ˜¯ä»–å®‰é™ä½è°ƒã€å®³ç¾å†…æ•›çš„æ€§æ ¼ï¼Œæ˜¯ä»–å”¯çˆ±ä¸è¶³çƒä¸å¯è¾œè´Ÿçš„å¿ è´ï¼Œæ˜¯ä»–æ•°åå¹´å¦‚ä¸€æ—¥ä»æœªå´©å¡Œçš„äººè®¾ã€‚ ã€è‹¥ä½ å–œæ¬¢æ€ªäººï¼Œå…¶å®æˆ‘å¾ˆç¾ã€‘ 5å²å¼€å§‹è¸¢çƒï¼Œ11å²è¢«è¯Šæ–­å‡ºä¾å„’ç—‡ï¼Œå®¶é‡Œæ²»ä¸èµ·ï¼Œæ¯é˜Ÿçº½ç»´å°”è€ä¼™è®¡ä»¥åŠä¸€åº¦æƒ³è¦æŒ–è§’çš„æ²³åºŠé˜Ÿåœ¨å¾—çŸ¥ä»–çš„é¡½ç–¾åéƒ½é€‰æ‹©äº†æ”¾å¼ƒã€‚ä¹Ÿè®¸è¦æ„Ÿè°¢å½“å¹´ä»–ä»¬çš„ä¸æ•‘ä¹‹æ©ï¼Œæ‰æœ‰äº†åæ¥çš„é‡Œå¥¥-æ¢…è¥¿ã€‚ 2000å¹´9æœˆï¼Œå¹´ä»…13å²èº«é«˜åªæœ‰140cmçš„æ¢…è¥¿å»äº†å·´å¡ç½—é‚£é’è®­è¥æ‹‰ç›è¥¿äºšè¯•è®­ã€‚åœ¨è¯•è®­æœŸé—´ï¼Œæ¢…è¥¿ç”¨è¡¨ç°å¾æœäº†å·´è¨é’å¹´é˜Ÿæ•™ç»ƒï¼Œä¹Ÿä¸ºè‡ªå·±èµ¢å¾—äº†æ²»ç–—èº«ä½“çš„é å±±ã€‚ é£æ‰¬èµ·äº†ä»–çš„é»‘å‘ï¼Œä»–ä¸ç»å¿ƒåœ°ç”©è¿‡é¬“é¢Šã€‚æ— è®ºæ˜¯é‚£ä¸ªå³è·¯æ— é™çªç ´ï¼Œèƒ½å¤Ÿå¤åˆ¶é©¬æ‹‰å¤šçº³å½“å¹´è¿è¿‡äº”äººè¿›çƒçš„è¿½é£å°‘å¹´ï¼Œè¿˜æ˜¯è½¬ä¸ºä¸­é”‹åç–¯ç‹‚è¿›çƒçš„æ¢…çƒç‹ï¼Œè€³è¾¹è¶Šæ¥è¶Šå˜ˆæ‚ï¼Œä»–å§‹ç»ˆå®‰é™ç€ã€‚ ä¸åŒäºå—ç¾çƒæ˜Ÿçš„ç‹¬é¢†é£éªšï¼Œæ›´ä¸åƒæ¬§æ´²çƒæ˜Ÿçš„éœ¸æ°”å¤–éœ²ï¼Œæˆ‘ä»æ²¡æœ‰è§è¿‡åƒæ¢…è¥¿è¿™æ ·â€œå­˜åœ¨æ„Ÿæä½â€çš„å‰é”‹ï¼Œè¿‡äººæ‘”å€’äº†å±…ç„¶å¯ä»¥ç¬é—´å¼¹èµ·æ¥ï¼Œä»–ä¸æ“…é•¿è¡¨æ¼”ç–¼ç—›ï¼Œä»–æ“…é•¿ç»§ç»­å¸¦çƒã€‚æ²¡æœ‰ç‹‚æ‹½ç‚«é…·çš„è¿›çƒåº†ç¥åŠ¨ä½œï¼Œæ¯å½“ç ´é—¨å¾—åˆ†æ—¶ï¼Œä»–åªä¼šå‚»å‚»çš„æŒ¯è‡‚ç‹‚å¥”ï¼Œè™”è¯šåœ°åŒæ‰‹æŒ‡å¤©ã€‚åæ¥è¿™ä¸ªæ›¾ç»æ—äººçœ¼é‡Œæœ‰äº›æ€ªå¼‚çš„â€œç—…å­©å­â€ç«™åœ¨äº†ä¸–ç•Œä¹‹å·…ï¼Œå´ä»ç„¶è¡Œäº‹ä½è°ƒå¾—ä¸åƒä¸ªå·¨æ˜Ÿã€‚ åƒæ¢…è¥¿è¿™æ ·çš„â€œæ€ªäººâ€ï¼Œæ—¥æœ¬ä½œå®¶ä¸­å²›æ•¦åœ¨ã€Šå±±æœˆè®°ã€‹ä¸­å¦‚æ˜¯æè¿°ï¼šå› ä¸ºå®³æ€•è‡ªå·±å¹¶éæ˜ç è€Œä¸æ•¢åˆ»è‹¦ç¢ç£¨ï¼Œåˆå› ä¸ºæœ‰å‡ åˆ†ç›¸ä¿¡è‡ªå·±æ˜¯æ˜ç ï¼Œè€Œä¸èƒ½ä¸ç“¦ç ¾ç¢Œç¢Œä¸ºä¼ï¼Œé‚é€æ¸è¿œç¦»ä¸–é—´ï¼Œç–é¿äººç¾¤ï¼Œç»“æœåœ¨å†…å¿ƒä¸æ–­åœ°ç”¨æ„¤æ‡‘å’Œç¾æ€’é¥²è‚²ç€è‡ªå·±æ‡¦å¼±çš„è‡ªå°Šå¿ƒã€‚ä¸–ä¸Šæ¯ä¸ªäººéƒ½æ˜¯é©¯å…½å¸ˆï¼Œè€Œé‚£åŒ¹çŒ›å…½ï¼Œå°±æ˜¯æ¯äººå„è‡ªçš„æ€§æƒ…ã€‚ ã€ä½ æ˜¯å—å›½æ¥çš„å­©å­ï¼Œäººè¦çˆ±äººè¦æ¨çš„æ ·å­ã€‘ ç‚¹çƒï¼Œå¯¹æ¯ä¸ªå‰é”‹æ¥è¯´æ˜¯è£è¾±å…¼å…·çš„ç¥ç§˜å¤§ç¤¼ã€‚è€Œå¯¹æ¢…è¥¿æ¥è¯´ï¼Œç‚¹çƒç•™ä¸‹çš„å‡ ä¹å…¨æ˜¯ä¸å ªçš„å›å¿†ã€‚è‡ªæ¢…è¥¿å‡ºé“ä»¥æ¥ï¼Œä»–ä¸€å…±è¸¢äº†107ä¸ªç‚¹çƒï¼Œè¸¢ä¸¢äº†23æ¬¡ï¼Œå¾—åˆ†ç‡ä»…ä¸º76%ã€‚åœ¨å›½å®¶é˜Ÿä¸­ï¼Œæ¢…è¥¿21æ¬¡ç‚¹çƒè¸¢ä¸¢4æ¬¡ã€‚è€Œåœ¨æ¬§å† ã€è¥¿ç”²ã€å›½ç‹æ¯ç­‰å„æ¡æˆ˜çº¿ä»–å‡æœ‰ç‚¹çƒä¸è¿›çš„å†å²ã€‚ä»–ç”šè‡³åœ¨è‡ªå·±30å²æ—¶ï¼Œæ‰ç©å‡ºäº†èŒä¸šç”Ÿæ¶¯ç¬¬ä¸€ä¸ªâ€œå‹ºå­â€ç‚¹çƒã€‚ 2015å¹´åæœˆåœ¨åŒ—äº¬é¸Ÿå·¢ä¸¾è¡Œçš„å—ç¾è¶…çº§æ¯ä¸Šï¼Œæ¢…è¥¿ç‚¹çƒè¢«å·´è¥¿é—¨å°†æ‰‘å‡ºï¼Œå¯¼è‡´é˜¿æ ¹å»·æœ€ç»ˆè½è´¥ã€‚2012å¹´æ¬§å† åŠå†³èµ›å¯¹é˜µåˆ‡å°”è¥¿ï¼Œåœ¨åˆ‡å°”è¥¿è¢«ç½šä¸‹ä¸€äººçš„æƒ…å†µä¸‹ï¼Œæ¢…è¥¿åŠ æ—¶èµ›ç‚¹çƒå‡»ä¸­æ¨ªæ¢ï¼Œæœ€ç»ˆå·´è¨æƒ¨é­æ‰˜é›·æ–¯ç»æ€ã€‚2016å¹´ç¾æ´²æ¯å†³èµ›ï¼Œç‚¹çƒå¤§æˆ˜ï¼Œæ¢…è¥¿é¢å¯¹æ™ºåˆ©é—¨å°†æ²¡èƒ½æˆ˜èƒœæ¿’ä¸´å´©æºƒçš„å¿ƒç†é˜²çº¿ä¸€è„šå°†çƒè¸¢é£ã€‚ æœ¬å±Šä¸–ç•Œæ¯å°ç»„èµ›é¦–è½®ï¼Œæ¢…è¥¿å·¦ä¾§æ‰“é—¨ï¼Œä¸€ä¸ªè´¨é‡ä¸é«˜çš„åŠé«˜çƒè¢«å†°å²›é—¨å°†å“ˆå„¿å¤šæ¾è‡ªä¿¡çš„æ‰‘æ•‘æ‹’ä¹‹é—¨å¤–â€¦â€¦è®©äººæƒ³èµ·å¼ æ‚¬é‚£é¦–ã€Šå—å›½çš„å­©å­ã€‹ ä½ æ˜¯å—å›½æ¥çš„å­©å­ æœ‰ç€ä¸èƒ½ç¼šçš„æ€§å­ èº«ä¸ŠæŠ«è¦†äº†é¢„è¨€è€Œæµ‘ç„¶ä¸çŸ¥ å¥”è·‘ç€å¿˜æˆ‘çš„å¿«ä¹æ‚²ä¼¤éƒ½æ”¾è‚† é˜³å…‰ä¹Ÿä¸æ„¿é˜»æ­¢ çƒåœºä¸Šçš„æ¢…è¥¿ä¼¼ä¹æ›´ä¹ æƒ¯äºé£é©°ç”µæ£çš„çªå‡ºé‡å›´ï¼Œæˆ–æ˜¯ç§¯æä¸“æ³¨çš„ç»„ç»‡è¿›æ”»ï¼Œè€Œç«™ä¸Šç½šçƒç‚¹çš„æ¢…è¥¿ï¼Œåªæ˜¯ä¸€ä¸ªèµ°ä¸‹ç¥å›çš„å‡¡äººï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ä»–çš„å½·å¾¨ï¼Œç„¦è™‘ï¼Œå’Œæ— åŠ©ã€‚ äº”å¤ºé‡‘çƒï¼Œå››å¤ºé‡‘é´ï¼Œè¥¿ç”²ã€å›½ç‹æ¯ã€æ¬§å† ã€å¥¥è¿ä¼šé‡‘ç‰Œï¼Œä»–åœ¨è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ä¸­å·²ç»åšåˆ°äº†æè‡´ã€‚å¦‚æœè¿˜æœ‰ä»€ä¹ˆé—æ†¾ï¼Œé‚£ä¾¿æ˜¯èº«ä¸Šçš„é˜¿æ ¹å»·çƒè¡£å¸¦ç»™ä»–çš„ä¸‰ä¸ªäºšå†›äº†ï¼ˆ2014å·´è¥¿ä¸–ç•Œæ¯äºšå†›ã€2015æ™ºåˆ©ç¾æ´²æ¯äºšå†›ã€2016ç¾å›½ç¾æ´²æ¯äºšå†›ï¼‰ã€‚ä½†è¶³çƒä¸–ç•Œè‹¥æ³¨å®šè¦ä»¥ä¸€åº§ä¸–ç•Œæ¯æ¥å°ç‹å—ï¼Ÿ ä½ æ˜¯å—å›½æ¥çš„å­©å­ äººè¦çˆ±äººè¦æ¨çš„æ ·å­ è¡€é‡Œæµä¼ ç€è¿œåœ¨å¤è€çš„æ•…äº‹ æ‰‹å¿ƒåˆ»åˆ’ä¸Šå¸çš„ä»æ…ˆ ä¸æœªçŸ¥ç›¸ä¼¼ æ— è®ºæ˜¯Cç½—è¿˜æ˜¯æ¢…è¥¿ï¼Œå¾ˆå¤šäººéƒ½ä¹ æƒ¯åœ¨ä»–ä»¬è½è´¥çš„æ—¶å€™æ‘†å‡ºå¤§è¯„è®ºå®¶çš„å§¿æ€å»æŒ‡æ‘˜ï¼Œä½†ä¹Ÿè®¸è¦ä¸äº†å‡ å¹´ï¼Œæˆ‘ä»¬å°±å¿«åœ¨çƒè¿·çš„å£æ°´ä¹‹ä¸­è¿æ¥æ— å·¨æ˜Ÿçš„è¶³å›ã€‚å¦‚æœæ— æ³•æ¬£èµï¼Œä¹Ÿè¯·åˆ«å†è‹›è´£ï¼Œè‡³å°‘çæƒœè¿™ä¸ªå°šä¸”è¿˜æœ‰å·¨æ˜Ÿçš„æ—¶ä»£ã€‚ ã€ä¸€ç”Ÿä¸€ä¸–ä¸€åŒäººï¼Œä¸€çº¢ä¸€è“ä¸€é¢—é­‚ã€‘ å…³äºæ¢…è¥¿æœ‰å¤šå¿ è¯šï¼Œå®‰ä¸œå†…æ‹‰å’Œå·´å¡ç½—é‚£å¿ƒé‡Œæœ€æœ‰æ•°ã€‚ æœ‰äººè¯´æ¢…è¥¿æœ€å‰å®³çš„åœ°æ–¹ä¸æ˜¯å¹´åº¦91çƒï¼Œä¹Ÿä¸æ˜¯äº”åº§é‡‘çƒå¥–ï¼Œè€Œæ˜¯9å²é™ªä¼´åœ¨ä»–èº«è¾¹çš„å¥³å­©ï¼Œ30å²ä¾ç„¶åœ¨ã€‚ å»å¹´ï¼Œä¸€å‘ä½è°ƒçš„æ¢…è¥¿ï¼Œå´ç»ˆäºåœ¨çˆ±æƒ…ä¸Šä»»æ€§äº†ä¸€å›ã€‚è¯·äº†è¶³å›çš„åŠå£æ±Ÿå±±ï¼ŒæŠŠä¸€åœºä¸–çºªå©šç¤¼çŒ®ç»™ä»–å”¯ä¸€æŒšçˆ±çš„å¥³äººå®‰ä¸œå†…æ‹‰ã€‚å°½ç®¡å©šç¤¼è±ªåï¼Œä½†æ¢…è¥¿æ‰§æ„ä¸æ”¶ä»½å­é’±ï¼Œè¦ç»™å°±æç»™æ…ˆå–„æœºæ„ã€‚æ¢…è¥¿çš„ä¸–çºªå©šç¤¼ï¼Œä¸ä¸ºå™±å¤´ï¼Œåªå› çˆ±æƒ…ã€‚ç»“å©šé‚£å¤©ä»–è¯´ï¼Œâ€œæˆ‘è¿™ä¸€ç”Ÿæœ€å¤§çš„è£èª‰ï¼Œæ˜¯å¨¶åˆ°äº†æˆ‘å–œæ¬¢äº†21å¹´çš„å¥³å­©ã€‚â€ ä¹å²å¯¹å¥¹ä¸€è§é’Ÿæƒ…ï¼ŒåäºŒå²å†™äº†äººç”Ÿç¬¬ä¸€å°æƒ…ä¹¦ï¼Œåå…«å²å¬è¯´å¥¹é—ºèœœè½¦ç¥¸èº«äº¡ä¾¿ç«‹åˆ»é£å›é˜¿æ ¹å»·é™ªä¼´â€¦â€¦ä»–ä¼šåœ¨åŠŸæˆåå°±çš„æ—¶å€™æ‰“ç”µè¯ç»™å¥¹è¯´ï¼Œæˆ‘è¿˜æ˜¯å½“å¹´é‚£ä¸ªå–œæ¬¢è¸¢çƒçš„å®³ç¾ç”·å­©ï¼Œæ— è®ºæˆ‘å¾—åˆ°å¤šå°‘è£èª‰ï¼Œæˆ‘è¿˜æ˜¯é‚£ä¸ªå–œæ¬¢ä½ çš„é‡Œå¥¥-æ¢…è¥¿ã€‚å¯¹äºå®‰ä¸œå†…æ‹‰æ¥è¯´ï¼Œå’Œæ¢…è¥¿åœ¨ä¸€èµ·çš„è¿™äº›å¹´åŒæ ·åå·ï¼Œæ¢…è¥¿çš„ä½è°·å’Œå·…å³°ï¼Œä¹Ÿæ˜¯å¥¹é™ªä»–ä¸€èµ·èµ°è¿‡ã€‚ æˆ‘çˆ±ä½ ï¼Œä½ çˆ±æˆ‘ï¼Œé‚£å°±åˆ«ç®¡å¤–é¢å‡ åŒçœ¼ç›å‡ åªè€³æœµï¼Œè¯·å…±æˆ‘ä¸€èµ·ï¼Œæ”¾å¿ƒæ¢æˆˆã€‚ ç»ˆè€è¯ºåæ™®ï¼Ÿ SÃ­,quiero.ï¼ˆæ˜¯çš„ï¼Œæˆ‘æ„¿æ„ã€‚ï¼‰ å»å¹´ä¸‰åå²çš„æ¢…è¥¿ï¼Œä¸ä»…å¯¹å®‰ä¸œå†…æ‹‰è¯´ï¼Œä¹Ÿå¯¹å·´å¡ç½—é‚£è¯´ã€‚ ä»2000å¹´åˆ°å¦‚ä»Šï¼Œæ¢…è¥¿é€èµ°äº†å·´è¨ä¸€ä»£åˆä¸€ä»£çš„ç¥é”‹ï¼Œ18å¹´çš„ä¸ç¦»ä¸å¼ƒï¼Œè¿˜å°†å»¶ç»­ã€‚ä¹Ÿè®¸çœŸçš„æ˜¯æ€§æ ¼ä½¿ç„¶ï¼Œçˆ±ä¸€ä¸ªäººè¦çˆ±åˆ°å¤©è’åœ°è€ï¼Œç€ä¸€èº«è¡«é‚£å°±è¿™æ ·ç»ˆè€ã€‚å¯¹çˆ±æƒ…ï¼Œå¯¹è¶³çƒï¼Œæ¢…è¥¿èº«ä¸Šéƒ½æœ‰ä¸€è‚¡è¿‘ä¹æ‰§æ‹—çš„å€”å¼ºã€‚ æ·±å±±çš„é¹¿ï¼Œä¸çŸ¥å½’å¤„ï¼Œä¸‡èˆ¬çš†è‹¦ï¼Œåªå¯è‡ªæ¸¡ã€‚ä»–å°„ç©ºè¿‡ï¼Œä¹Ÿå¤±è½è¿‡ï¼Œä¹Ÿè®¸å¤©æ‰ç”Ÿæ¥å°±æ˜¯å­¤ç‹¬ï¼Œä¸€èº«æ‰åä¸æ»¡è…”æŠ±è´Ÿä¹Ÿä¸è¿‡æ˜¯æ— å¤„å®‰æ”¾ã€‚å…‰é˜´èè‹’ï¼Œæˆ‘ä»¬çœ‹åˆ°å·¦å²¸èº«æŠ«çº¢è“è¡«çš„æ¢…è¥¿ç«™åœ¨åˆ¶é«˜ç‚¹ä¸æ–­åœ°åˆ·æ–°ç€è£èª‰ï¼Œè€Œå³å²¸é‚£ä¸ªèº«æŠ«è“ç™½è¡«çš„æ¢…è¥¿åˆ™æ€»æ˜¯å‚å¤´å¤±æ„ã€‚ æ·¡æ¼ åˆ°å¤±å»çƒ­å¿±çš„æ—¶å€™ä»–ä¹Ÿè®¸å°±ä¼šè§‰å¾—è‡ªå·±è€äº†ï¼Œè€ŒæŸäº›ç¬é—´ï¼Œç”šè‡³æ— æ³•æè¿°é‚£ä¸ªç¬é—´ï¼Œæˆ‘ä»¬å›ºæ‰§åœ°ç›¸ä¿¡ä»–ä»æ—§æ˜¯å½“å¹´é‚£ä¸ªç¾æ¶©çš„å­©å­ã€‚å¯å½“åˆä¸€æ¬¡ä¸èƒœåˆ©æ“¦è‚©çš„æ— åŠ›æ„Ÿå¸­å·è€Œæ¥ï¼Œæ¢…è¥¿31å²äº†ï¼Œæˆ‘ä»¬åªèƒ½ä»»å‡­æ‰€æœ‰çš„æ‰§å¿µæ— ç–¾è€Œç»ˆã€‚æˆ–è®¸ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬çˆ±ä»–çš„åŸå› ã€‚ å°ç»„èµ›æœ«è½®ä¾¿æ˜¯é˜¿æ ¹å»·çš„ç”Ÿæ­»æˆ˜ï¼Œä¹Ÿè®¸è¿˜æœ‰ä¸€ä¸ªç½®ä¹‹æ­»åœ°è€Œåç”Ÿçš„å‰§æœ¬ç­‰ç€æˆ‘ä»¬å»å¼€å¯ã€‚ä»–åœ¨ç”¨èƒŒå½±å‘Šè¯‰æˆ‘ä»¬ï¼šæˆ‘ä¸æ˜¯å¤©ç”Ÿå¼ºå¤§ï¼Œæˆ‘åªæ˜¯å¤©ç”Ÿè¦å¼ºã€‚æˆ‘æ²¡åœ¨æ…Œï¼Œæˆ‘å·²ç»æ˜¯çƒç‹ã€‚ ç”Ÿæ—¥å¿«ä¹ï¼Œå”¯ä¸€çš„é‡Œå¥¥-æ¢…è¥¿ã€‚","link":"/2018/06/24/%E5%85%B6%E5%AE%83/%E6%96%87%E4%BB%B6%E5%A4%B9/%E6%A2%85%E8%A5%BF/"},{"title":"ngrokå†…ç½‘ç©¿é€š","text":"ä¸€ã€ngrok æœåŠ¡ç«¯ æš‚ä¸æ­å»ºï¼Œä½¿ç”¨å®˜æ–¹æˆ–å…¶ä»–äººæä¾›çš„æœåŠ¡ç«¯ã€‚ 1ã€ä¸‹è½½å®¢æˆ·ç«¯ï¼š https://ngrok.com/download http://www.ittun.com 12$ unzip /opt/ngrok.zip$ cd /opt/ngrok 2ã€å®šä¹‰é…ç½®æ–‡ä»¶ vim ngrok.yml (ä¸‹é¢æ˜¯ä¸ªç¤ºä¾‹) 123456789101112131415161718---server_addr: \"ngrok.xiaomiqiu.cn:4443\"trust_host_root_certs: falsetunnels: ssh: remote_port: 51001 proto: tcp: \":22\" web: subdomain: test root: \"html/\" proto: http: \":8080\" web2: hostname: pimwx2 root: \"D:/java/nginx-1.0.11/html\" proto: http: \":80\" å­—æ®µè¯´æ˜ï¼šå‚è€ƒï¼šhttps://ngrok.com/docs æ¯ä¸ªéš§é“å¿…é¡»å®šä¹‰ protoå’Œaddrã€‚å…¶ä»–å±æ€§å¯ç”¨ï¼Œè®¸å¤šæ˜¯åè®®ç‰¹å®šçš„ã€‚ server_addrï¼šæœåŠ¡ç«¯åœ°å€ï¼Œä»ç½‘ä¸Šæ‰¾ï¼Œæœ‰äº›æœåŠ¡å¯èƒ½å·²ç»åœäº†ï¼Œå¯å‚è€ƒï¼šhttp://ngrok.ciqiuwl.cn/ã€https://natapp.cn/ã€http://www.ittun.comã€‚ã€‚ã€‚ï¼ˆtunnel.phpor.me:4443ã€tunnel.phpor.me:4443ã€ittun.com:44433ã€tunnel.mobi:44433ã€tunnel.phpor.me:4443) trust_host_root_certsï¼štrue æŒ‡ç¤ºngrokä¿¡ä»»è®¡ç®—æœºä¸Šçš„æ ¹è¯ä¹¦ï¼›false ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚ proto éœ€è¦ æ‰€æœ‰ éš§é“åè®®åç§°ï¼Œä¸­çš„ä¸€ä¸ªhttpï¼Œtcpï¼Œtls addr éœ€è¦ æ‰€æœ‰ å°†æµé‡è½¬å‘åˆ°æœ¬åœ°ç«¯å£å·æˆ–ç½‘ç»œåœ°å€ inspect æ‰€æœ‰ å¯ç”¨httpè¯·æ±‚æ£€æŸ¥ auth HTTP HTTPåŸºæœ¬è®¤è¯å‡­æ®æ¥å¼ºåˆ¶æ‰§è¡Œéš§é“è¯·æ±‚ host_header HTTP å°†HTTP Hostå¤´é‡å†™ä¸ºæ­¤å€¼ï¼Œæˆ–preserveå°†å…¶ä¿æŒä¸å˜ bind_tls HTTP æ€§ç»“åˆçš„HTTPSæˆ–HTTPç«¯ç‚¹æˆ–ä¸¤è€…trueï¼Œfalseæˆ–both subdomain HTTP TLS å­åŸŸåè¯·æ±‚ã€‚å¦‚æœæœªæŒ‡å®šï¼Œè¯·ä½¿ç”¨éš§é“åç§° hostname HTTP TLS è¦æ±‚çš„ä¸»æœºåï¼ˆéœ€è¦ä¿ç•™åç§°å’ŒDNS CNAMEï¼‰ crt TLS æ­¤è·¯å¾„ä¸Šçš„PEM TLSè¯ä¹¦åœ¨æœ¬åœ°è½¬å‘ä¹‹å‰ç»ˆæ­¢TLSæµé‡ key TLS æ­¤è·¯å¾„ä¸Šçš„PEM TLSç§é’¥åœ¨æœ¬åœ°è½¬å‘ä¹‹å‰ç»ˆæ­¢TLSæµé‡ client_cas TLS æ­¤è·¯å¾„ä¸Šçš„PEM TLSè¯ä¹¦é¢å‘æœºæ„å°†éªŒè¯ä¼ å…¥çš„TLSå®¢æˆ·ç«¯è¿æ¥è¯ä¹¦ã€‚ remote_addr TCP ç»‘å®šç»™å®šåœ°å€ä¸Šçš„è¿œç¨‹TCPç«¯å£ 3ã€å¯åŠ¨ å¤šç§æ–¹å¼ï¼š 123$ ./ngrok -config=config.yml -subdomain=bjcscn 80$ ngrok start --all$ ngrok start admin ssh æˆåŠŸåå¦‚ä¸‹ï¼š 1234567ITTUN Tunnel Status onlineVersion 1.7/1.7Forwarding http://bjcscn.ngrok.xiaomiqiu.cn -&gt; 127.0.0.1:80Web Interface disabled# Conn 0Avg Conn Time 0.00ms å¦‚å¯åŠ¨ä¸æˆåŠŸ æŸ¥çœ‹å…·ä½“æŠ¥é”™è¡Œæ•° 1$ ./ngrok list æ³¨æ„ï¼šyamlè¯­æ³• æ¯è¡Œçš„ç¼©è¿›è¦ä¸€è‡´ã€‚ 4ã€åå°è¿è¡Œæ–¹æ³• ngrokç”¨&amp;ä¸èƒ½åå°è¿è¡Œï¼Œè¦ä½¿ç”¨screenå‘½ä»¤æˆ–è€…Supervisorç®¡ç†ã€‚ ä»¥ä¸‹ä½¿ç”¨screenå‘½ä»¤ã€‚ å®‰è£…ï¼šapt-get install screen screen -S ä»»æ„åï¼ˆå¦‚keepngron è¿›ç¨‹åï¼‰ ./ngrok start ssh mongo redis æœ€åæŒ‰å¿«æ·é”® ctrl+A+D é€€å‡ºï¼Œå³å¯ä¿æŒngrokåå°è¿è¡Œã€‚ 5ã€æœåŠ¡ç«¯ï¼š å¦‚éœ€æ­å»ºæœåŠ¡ç«¯å‚è€ƒï¼šhttp://blog.csdn.net/u013216667/article/details/50782084 https://github.com/inconshreveable/ngrok/blob/master/docs/SELFHOSTING.md https://hteen.cn/docker/docker-ngrok.html äºŒã€frp å‚è€ƒï¼šhttps://github.com/fatedier/frp/blob/master/README_zh.md ä¸‰ã€zerotier https://www.v2ex.com/t/486244#reply14 å››ã€å…¶å®ƒæœåŠ¡ å¦‚ï¼šxtunnelã€OpenVPN ã€pagekiteã€â€¦..","link":"/2017/09/29/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ngrok/ngrok%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%9A/"},{"title":"å†…ç½‘ç©¿é€š-frp","text":"ä¸€ã€frp åœ¨æœåŠ¡ç«¯ï¼ˆæœ‰å…¬ç½‘IPçš„æœºå™¨ï¼‰å’Œ å®¢æˆ·ç«¯ï¼ˆéœ€è¦ç©¿é€çš„å†…ç½‘ç¯å¢ƒæœºå™¨ï¼‰ä¸Šä¸‹è½½frpç¨‹åº æœåŠ¡ç«¯ä¸»è¦ä½¿ç”¨frps åŠ frps.ini å®¢æˆ·ç«¯ä¸»è¦ä½¿ç”¨frpc åŠ frpc.ini äºŒã€é…ç½® æœåŠ¡ç«¯å‚è€ƒé…ç½® vim frps.ini 123456789101112131415161718192021[common]bind_port = 7000# webæœåŠ¡vhost_http_port = 7070#vhost_https_port = 443subdomain_host = frps.com # è‡ªå®šä¹‰äºŒçº§åŸŸå#frp çš„çŠ¶æ€åŠä»£ç†ç»Ÿè®¡ä¿¡æ¯dashboard_port = 7500dashboard_user = admindashboard_pwd = admin#auth tokentoken = 123456#loglog_file = /dbdata/opt/frps/frp_0.21.0_linux_amd64/frps.loglog_level = infolog_max_days = 3 å°†æ³›åŸŸå *.frps.com è§£æåˆ° frps æ‰€åœ¨æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ å®¢æˆ·ç«¯å‚è€ƒé…ç½® vim frpc.ini 123456789101112131415161718192021222324[common]server_addr = 111.124.41.152server_port = 7000#authenticationtoken = 123456#loglog_file = ./frpc.loglog_level = infolog_max_days = 3# 192.168.1.111 ä¸ŠæœåŠ¡[ssh_111]type = tcplocal_ip = 127.0.0.1local_port = 22remote_port = 11122[web_101]type = httplocal_ip = 192.168.1.101local_port = 80subdomain = fei ä¸‰ã€å¯åŠ¨ å¯åŠ¨ä¸¤ä¸ªfrpæœåŠ¡ 12$ nohup ./frps -c ./frps.ini &gt; nohup.log 2&gt;&amp;1 &amp; # æœåŠ¡ç«¯$ nohup ./frpc -c ./frpc.ini &gt; nohup.log 2&gt;&amp;1 &amp; #å®¢æˆ·ç«¯ å››ã€è®¿é—®ï¼š dashboard : http://[server_addr]:7500 è®¿é—® dashboard ç•Œé¢ï¼Œç”¨æˆ·åå¯†ç é»˜è®¤ä¸º admin web_101 : http://fei.frps.com:7070 ssh_111: ssh -oPort=11122 root@x.x.x.x å‚è€ƒï¼šhttps://github.com/fatedier/frp/blob/master/README_zh.md","link":"/2018/11/13/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/frp/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%9A-frp/"},{"title":"æ•°æ®ç»“æ„äºç®—æ³•ä¸€","text":"å¹¿ä¹‰ä¸Šè®²æ•°æ®ç»“æ„å°±æ˜¯ä¸€ç»„æ•°æ®å­˜å‚¨çš„ç»“æ„ï¼Œç®—æ³•å°±æ˜¯æ“ä½œæ•°æ®çš„æ–¹å¼ã€‚ æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯ç›¸è¾…ç›¸æˆçš„ï¼Œæ•°æ®ç»“æ„æ˜¯ä¸ºç®—æ³•æœåŠ¡çš„ï¼Œç®—æ³•è¦ä½œç”¨åœ¨ç‰¹å®šçš„æ•°æ®ç»“æ„ä¹‹ä¸Šã€‚ å¦‚æ•°ç»„å…·æœ‰éšæœºè®¿é—®çš„ç‰¹ç‚¹ï¼ŒäºŒåˆ†æŸ¥æ‰¾ç®—æ³•éœ€è¦ç”¨æ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚å¦‚æœé€‰ç”¨äº†é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œå°±ä¸èƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•äº†ï¼Œå› ä¸ºé“¾è¡¨ä¸å…·æœ‰éšæœºè®¿é—®çš„ç‰¹æ€§ã€‚ åŸºç¡€å¸¸ç”¨çš„ 10ä¸ªæ•°æ®ç»“æ„ï¼šæ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ã€å †ã€è·³è¡¨ã€å›¾ã€Trieæ ‘ï¼› 10ä¸ªç®—æ³•ï¼šé€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³• å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„è¿‡ç¨‹ï¼Œæ˜¯éå¸¸å¥½çš„æ€ç»´è®­ç»ƒçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼Œåƒä¸‡ä¸è¦è¢«åŠ¨åœ°è®°å¿†ï¼Œè¦å¤šè¾©è¯åœ°æ€è€ƒï¼Œå¤šé—®ä¸ºä»€ä¹ˆã€‚ å­¦ä¹ æ–¹æ³• è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜ã€‚ å¤šé—®ï¼Œå¤šæ€è€ƒï¼Œå¤šäº’åŠ¨ã€‚ è®¾ç«‹ä¸€ä¸ªåˆ‡å®å¯è¡Œçš„ç›®æ ‡ã€‚ çŸ¥è¯†éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰ã€‚","link":"/2019/08/29/%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E4%B8%80%E6%96%B9%E6%B3%95/"},{"title":"å¤æ‚åº¦åˆ†æ","text":"æ—¶é—´ã€ç©ºé—´å¤æ‚åº¦åˆ†æ å¤§Oè¡¨ç¤ºæ³•ï¼šT(n) = O( f(n)) T(n)è¡¨ç¤ºä»£ç æ‰§è¡Œçš„æ—¶é—´ï¼Œnä»£è¡¨æ•°æ®çš„è§„æ¨¡å¤§å°ï¼Œf(n)ä»£è¡¨æ¯è¡Œä»£ç æ‰§è¡Œæ¬¡æ•°çš„æ€»å’Œï¼ŒOè¡¨ç¤ºä»£ç çš„æ‰§è¡Œæ—¶é—´ä¸f(n)è¡¨è¾¾å¼æˆæ­£æ¯”ã€‚ å¤§Oè¿™ç§å¤æ‚åº¦è¡¨ç¤ºæ–¹æ³•åªæ˜¯è¡¨ç¤ºä¸€ç§å˜åŒ–è¶‹åŠ¿ã€‚é€šå¸¸ä¼šå¿½ç•¥æ‰å…¬å¼ä¸­çš„å¸¸é‡ã€ä½é˜¶ã€ç³»æ•°ï¼Œåªéœ€è¦è®°å½•ä¸€ä¸ªæœ€å¤§é˜¶çš„é‡çº§å°±å¯ä»¥äº†ã€‚ åˆ†ææ—¶é—´å¤æ‚åº¦ 1ã€åªå…³æ³¨å¾ªç¯æ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç ã€‚ 2ã€åŠ æ³•åŸåˆ™ï¼Œæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚ 3ã€ä¹˜æ³•åŸåˆ™ï¼ŒåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯ã€‚ å¸¸è§çš„å¤šé¡¹å¼æ—¶é—´å¤æ‚åº¦ 1ã€O(1) O(1) æ˜¯å¸¸é‡çº§æ—¶é—´å¤æ‚åº¦çš„ä¸€ç§è¡¨ç¤ºæ–¹æ³•ï¼Œä»£ç çš„æ‰§è¡Œæ—¶é—´ä¸éšnçš„å¢å¤§è€Œå¢é•¿ã€‚ 2ã€O(logn)ã€O(nlogn) 1234i=1;while (i &lt;= n) { i = i * 2;} å˜é‡ i çš„å€¼ä» 1 å¼€å§‹å–ï¼Œæ¯å¾ªç¯ä¸€æ¬¡å°±ä¹˜ä»¥ 2 ã€‚å½“å¤§äº n æ—¶ï¼Œå¾ªç¯ç»“æŸï¼Œå˜é‡ i çš„å–å€¼å°±æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚å³æ±‚è§£2^x =nï¼Œxå³ä»£ç æ‰§è¡Œçš„æ¬¡æ•°ï¼Œx=log 2 nï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(log 2 n)ã€‚ åœ¨å¯¹æ•°é˜¶æ—¶é—´å¤æ‚åº¦çš„è¡¨ç¤ºæ–¹æ³•é‡Œï¼Œå¯ä»¥å¿½ç•¥å¯¹æ•°çš„â€œåº•â€ï¼Œç»Ÿä¸€è¡¨ç¤ºä¸º O(logn) ã€‚ å¦‚æœä¸€æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn) ï¼Œå¾ªç¯æ‰§è¡Œ n éï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nlogn) äº†ã€‚ O(nlogn) ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦ã€‚æ¯”å¦‚ï¼Œå½’å¹¶æ’åºã€å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn) ã€‚ 3ã€O(m+n)ã€O(m*n) ä»£ç çš„å¤æ‚åº¦ç”±ä¸¤ä¸ªæ•°æ®çš„è§„æ¨¡æ¥å†³å®šã€‚ å¸¸è§çš„å¤æ‚åº¦å¹¶ä¸å¤šï¼Œä»ä½é˜¶åˆ°é«˜é˜¶æœ‰ï¼šO(1)ã€O(logn)ã€O(n)ã€O(nlogn)ã€O(n^2 ) æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å’Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚ å¹³å‡æ—¶é—´å¤æ‚åº¦çš„å…¨ç§°åº”è¯¥å«åŠ æƒå¹³å‡æ—¶é—´å¤æ‚åº¦æˆ–è€…æœŸæœ›æ—¶é—´å¤æ‚åº¦ã€‚ å‡æ‘Šæ—¶é—´å¤æ‚åº¦ï¼Œå¯¹åº”çš„åˆ†ææ–¹æ³•ï¼Œæ‘Šè¿˜åˆ†æ å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ åº”ç”¨åœºæ™¯ï¼Œå¯¹ä¸€ç»„æ•°æ®ç»“æ„çš„è¿ç»­æ“ä½œï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½å¾ˆä½ï¼Œåªæœ‰ä¸ªåˆ«æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”è¿™äº›æ“ä½œå­˜åœ¨ç€å‰åè¿è´¯çš„æ—¶åºå…³ç³»ï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥å°†è¿™ç»„æ“ä½œæ”¾åœ¨ä¸€å—åˆ†æã€‚çœ‹èƒ½å¦å°†æ—¶é—´å¤æ‚åº¦è¾ƒé«˜çš„é‚£æ¬¡æ“ä½œè€—æ—¶ï¼Œå‡æ‘Šåˆ°æ—¶é—´å¤æ‚åº¦ä½çš„æ“ä½œä¸Šï¼Œè€Œä¸”ï¼Œèƒ½å¤Ÿè¿ç”¨å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†æçš„åœºåˆï¼Œä¸€èˆ¬å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±ç­‰äºæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚ ç©ºé—´å¤æ‚åº¦åˆ†æ è¡¨ç¤ºç®—æ³•çš„å­˜å‚¨ç©ºé—´ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»ã€‚ å¸¸è§çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯O(1)ã€O(n)ã€O(n^2 )ã€‚","link":"/2019/08/29/%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/"},{"title":"æ•°æ®ç»“æ„äºç®—æ³•â€”â€”æ•°ç»„","text":"æ•°ç»„æ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ï¼Œç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„ç›¸åŒç±»å‹çš„æ•°æ®ã€‚ å…³é”®è¯ 1ã€çº¿æ€§è¡¨ çº¿æ€§è¡¨å³æ•°æ®æ’åˆ—æˆåƒçº¿ä¸€æ ·çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªçº¿æ€§è¡¨ä¸Šçš„æ•°æ®æœ€å¤šåªæœ‰å‘å‰ã€å‘åä¸¤ä¸ªæ–¹å‘ã€‚æ•°ç»„ã€é“¾è¡¨ã€é˜Ÿåˆ—ã€æ ˆéƒ½æ˜¯çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚ éçº¿æ€§è¡¨ç»“æ„å¦‚äºŒå‰æ ‘ã€å †ã€å›¾ç­‰ï¼Œæ•°æ®é—´ä¸æ˜¯ç®€å•çš„å‰åå…³ç³»ã€‚ 2ã€è¿ç»­çš„å†…å­˜ç©ºé—´å’Œç›¸åŒçš„æ•°æ®ç±»å‹ æ­£æ˜¯è¿™ä¸¤ä¸ªé™åˆ¶ï¼Œä½¿æ•°ç»„å…·æœ‰â€œéšæœºè®¿é—®â€çš„ç‰¹æ€§ã€‚å½“ç„¶è¿™ä¸ªç‰¹æ€§ä¹Ÿä½¿æ•°æ®çš„æœ‰äº›æ“ä½œå˜å¾—å¾ˆä½æ•ˆï¼Œå¦‚æ’å…¥å’Œåˆ é™¤ï¼Œä¸ºäº†ä¿è¯è¿ç»­æ€§ï¼Œå°±éœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»å·¥ä½œã€‚ é“¾è¡¨é€‚åˆæ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œæ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œæ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1),é€‚åˆæŸ¥æ‰¾æ“ä½œï¼Œæ’å¥½åºçš„æ•°ç»„ç”¨äºŒåˆ†æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ã€‚ å…³äºæ•°ç»„æ’å…¥å’Œåˆ é™¤çš„æ€è·¯å’ŒæŠ€å·§ å¦‚æœæ•°ç»„ä¸­çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå°†è¦å°†ä¹‹åçš„æ•°æ®å‘åæ¬ç§»ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ•°æ®æ˜¯æ²¡æœ‰è§„å¾‹ï¼Œæ•°ç»„åªæ˜¯è¢«å½“ä½œä¸€ä¸ªå­˜å‚¨æ•°æ®çš„é›†åˆï¼Œè¿™ç§æƒ…å†µï¼Œåœ¨æ•°ç»„çš„ç¬¬kä¸ªä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œä¸ºäº†é¿å…å¤§è§„æ¨¡çš„æ•°æ®è¿ç§»ï¼Œå¯ä»¥å°†ç¬¬kä½æ•°æ®æ¬ç§»åˆ°æ•°ç»„æœ€åï¼ŒæŠŠæ–°å…ƒç´ æ’å…¥åˆ°ç¬¬Kä½ä¸Šã€‚è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±å°†ä¸ºäº†O(1)ï¼Œå¿«æ’ä¸­å°±æ˜¯è¿™ç§å¤„ç†æ€æƒ³ã€‚ åˆ é™¤æ“ä½œä¹Ÿæ˜¯ç±»ä¼¼ï¼Œå¦‚æœå¹¶ä¸ä¸€å®šè¿½æ±‚æ•°æ®çš„è¿ç»­æ€§ï¼Œå¯ä»¥å…ˆè®°å½•å·²åˆ é™¤çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„æ¬ç§»æ•°æ®ï¼Œåªæ˜¯è®°å½•æ•°æ®è¢«åˆ é™¤ï¼Œå½“æ•°ç»„æ²¡æœ‰æ›´å¤šçš„å­˜å‚¨ç©ºé—´æ—¶ï¼Œå†è§¦å‘ä¸€æ¬¡çœŸæ­£çš„åˆ é™¤æ“ä½œã€‚è¿™ä¹Ÿæ˜¯JVMçš„æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•çš„æ ¸å¿ƒã€‚ æ³¨æ„æ•°ç»„çš„è®¿é—®è¶Šç•Œé—®é¢˜ ArrayListä¸æ•°ç»„ ArrayListå°†æ•°ç»„çš„æ“ä½œ(å¦‚ï¼šæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œ)å°è£…èµ·æ¥äº†ï¼Œå¹¶ä¸”ArrayListæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œå­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹ä¸ºåŸæ¥çš„1.5å€ã€‚ ArrayListæ— æ³•å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå„¿è£…ç®±å’Œæ‹†ç®±æ“ä½œä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œå¦‚ç‰¹åˆ«å…³æ³¨æ€§èƒ½ï¼Œæˆ–è€…å¸Œæœ›ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå°±å¯ä»¥é€‰æ‹©æ•°ç»„ã€‚ äº‹å…ˆå·²çŸ¥æ•°æ®å¤§å°ï¼Œå¹¶ä¸”å¯¹æ•°æ®çš„æ“ä½œæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ä¸åˆ°ArrayListä¸­çš„æ“ä½œï¼Œå¯ä»¥é€‰ç”¨æ•°ç»„ã€‚ è¦è¡¨ç¤ºå¤šç»´æ•°ç»„æ—¶ï¼Œæ•°ç»„æ›´åŠ ç›´è§‚ã€‚å¦‚Object[] [] array,ç”¨Listå°±åƒArrayList arrayã€‚ 12int[][] arr = new int[3][2];//è¡¨ç¤ºarrä¸­æœ‰3ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ¯ä¸ªä¸€ç»´æ•°ç»„ä¸­æœ‰2ä¸ªå…ƒç´ ","link":"/2019/08/30/%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E7%BB%84/"},{"title":"MongoDB4.0æ“ä½œpushAllé—®é¢˜.","text":"mongodb4.0ä¸­ä½¿ç”¨$pushAll(),ä¼šæŠ¥é”™ï¼šcom.mongodb.MongoWriteException: Unknown modifier: $pushAll mongodb4.0ç‰ˆæœ¬ä¸­$pushAll()å·²å¼ƒç”¨ã€‚æ”¹ä¸ºè¿ç®—ç¬¦$pushå’Œ$each(), $eachä¸$pushä½¿ç”¨ï¼ŒæŠŠæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ·»åŠ åˆ°å­—æ®µä¸­ã€‚(ä¼šæ·»åŠ é‡å¤é¡¹) 1234db.students.update( { name: \"joe\" }, { $push: { scores: { $each: [ 90, 92, 92, 85 ] } } }) $eachä¸$addToSetä¸€èµ·ä½¿ç”¨ï¼ŒæŠŠæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ·»åŠ åˆ°å­—æ®µä¸­ï¼Œ(ä¸ä¼šæ·»åŠ é‡å¤é¡¹) 1234db.inventory.update( { _id: 2 }, { $addToSet: { tags: { $each: [ \"camera\", \"electronics\", \"accessories\" ] } } } ) å‚è€ƒï¼šhttps://docs.mongodb.com/v4.0/reference/operator/update/each/ https://github.com/Automattic/mongoose/issues/5574 https://docs.mongodb.com/v3.0/reference/operator/update/pushAll/","link":"/2018/12/20/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB4.0%E6%93%8D%E4%BD%9CpushAll%E9%97%AE%E9%A2%98/"},{"title":"æ•°æ®ç»“æ„äºç®—æ³•â€”â€”é“¾è¡¨","text":"ç¼“å­˜æ·˜æ±°ç­–ç•¥ 1ã€å…ˆè¿›å…ˆå‡ºç­–ç•¥ FIFO ï¼ˆ First In ï¼Œ First Out ï¼‰ 2ã€æœ€å°‘ä½¿ç”¨ç­–ç•¥ LFU ï¼ˆ Least Frequently Used ï¼‰ 3ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥LRUï¼ˆ Least Recently Used ï¼‰ é“¾è¡¨ å¸¸è§çš„é“¾è¡¨ç»“æ„ å•é“¾è¡¨ã€åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨","link":"/2019/09/08/%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%93%BE%E8%A1%A8/"},{"title":"MongoDbè‡ªåŠ¨å¤‡ä»½","text":"1ã€æ–°å»ºmongoDBå¤‡ä»½å­˜æ”¾ç›®å½•ï¼š 12mkdir /dbdata/db_backup/mongodb_ali/mongodb_bak_nowmkdir /dbdata/db_backup/mongodb_ali/mongodb_bak_list 2ã€åˆ›å»ºå¤‡ä»½è„šæœ¬è¯´æ˜ï¼šåˆ é™¤å‘½ä»¤ä¸€å®šè¦æ³¨æ„vim mongodb_ali_auto_backup.sh 12345678910111213141516171819202122232425262728293031323334#!/bin/bash#backup MongoDB_aliMONGODBDUMP=/path/to/mongodb3.6/bin/mongodump#ä¸´æ—¶å¤‡ä»½ç›®å½•OUT_DIR=/dbdata/db_backup/mongodb_ali/mongodb_bak_now#å¤‡ä»½å­˜æ”¾ç›®å½•TAR_DIR=/dbdata/db_backup/mongodb_ali/mongodb_bak_list#è·å–å½“å‰ç³»ç»Ÿæ—¶é—´DATE=`date +%Y-%m-%d`HOST=dds-bp1a3d180d2abtest1.mongodb.rds.aliyuncs.com:3717USER=rootDATABASE=adminPASSWD=XXXX#ä¿å­˜å¤©æ•°DAY=1TAR_BAK=\"mongod_bak_$DATE.tar.gz\"cd $OUT_DIRrm -rf $OUT_DIR/*mkdir -p $OUT_DIR/$DATE$MONGODBDUMP --host $HOST --authenticationDatabase $DATABASE -u $USER -p $PASSWD -o $OUT_DIR/$DATEtar -zcvf $TAR_DIR/$TAR_BAK $DATE#scp -P 10110 $TAR_DIR/$TAR_BAK root@10.47.96.105:/path/to/db_backup/mongodb_alifind $TAR_DIR/ -mtime +$DAY -deleteecho \"å¤‡ä»½å®Œæˆ\"exit 3ã€æ·»åŠ å®šæ—¶ä»»åŠ¡vim /etc/crontab 1230 2 * * * /bin/bash /path/to/db_backup/mongodb_ali_auto_backup.sh &gt;&gt; /var/log/mongodb/backlog_ali/$(date +\"\\%Y-\\%m-\\%d\").log 2&gt;&amp;1# æ¯å¤©2ç‚¹30åˆ†æ‰§è¡Œ æœªè§£å†³é—®é¢˜ï¼šè¾“å‡ºæ—¥å¿—é‡å®šå‘ã€‚å•ç‹¬æ‰§è¡Œè„šæœ¬æ—¶ï¼Œæ—¥å¿—å¯ä»¥é‡å®šå‘åˆ°ç›®æ ‡æ–‡ä»¶ã€‚ç”±crontab å®šæ—¶æ‰§è¡Œæ—¶ï¼Œ æ—¥å¿—æ–‡ä»¶å¹¶æ²¡æœ‰é‡å®šå‘åˆ°ç›®æ ‡æ–‡ä»¶ã€‚ 18.3.20 å·²è§£å†³ é‡å®šå‘ç¬¦å·ç”± &amp;&gt; æ¢æˆäº† &gt;&gt; â€œ/var/log/mongodb/backlog_ali/$(date +â€%Y-%m-%dâ€).logâ€ 2&gt;&amp;1","link":"/2018/03/19/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/"},{"title":"MongoDBå¯è§†åŒ–ç®¡ç†å·¥å…·é—®é¢˜","text":"ä½¿ç”¨NoSQL Manage for MongoDB å·¥å…·è¿æ¥ æ–°çš„ï¼ˆæœªåˆ›å»ºä»»ä½•æ•°æ®åº“ï¼‰é˜¿é‡Œäº‘MongoDbæ•°æ®åº“æ—¶ä¸€ç›´æŠ¥é”™ï¼šæœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„å®ä¾‹ã€‚ ç½‘ä¸Šçœ‹åˆ°è¯´å’Œ net framework ç‰ˆæœ¬æœ‰å…³ç³»ï¼Œæ¢äº†ç‰ˆæœ¬ä¹Ÿä¸è¡Œã€‚ è§£å†³åŠæ³•ï¼š åœ¨ä¸Šé¢åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œç„¶åç”¨ä¸€ä¸ªæ–°çš„è´¦å·ï¼ˆä¸è¦ç»™rootæƒé™ï¼‰å»è¿æ¥ï¼Œä¾¿å¯ä»¥è¿ä¸Šã€‚","link":"/2018/12/14/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E9%97%AE%E9%A2%98/"},{"title":"mongodbå†…å­˜é™åˆ¶","text":"é»˜è®¤æƒ…å†µä¸‹ï¼Œmongodbå ç”¨çš„å†…å­˜å¤§å°ä¸ºï¼š 1234Starting in MongoDB 3.4, the default WiredTiger internal cache size is the larger of either:50% of (RAM - 1 GB), or256 MB. å³ ï¼ˆæ€»å†…å­˜ Ã— 50% - 1GBï¼‰ å’Œ ï¼ˆ256MBï¼‰ ä¸¤è€…ä¸­çš„è¾ƒå¤§å€¼ã€‚å½“æ€»å†…å­˜å¤§äº1GBæ—¶ï¼Œä¸ºæ€»å†…å­˜çš„ä¸€åŠï¼Œæ€»å†…å­˜å°äº1GBæ—¶ï¼Œä¸º256MB ç”±äºmongodbä¼šå ç”¨è¾ƒå¤§å†…å­˜ï¼Œæ‰€ä»¥ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬ä¼šå°†mongodbå•ç‹¬æ‰˜ç®¡ã€‚ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”å¦‚è°ƒè¯•å¼€å‘ç¯å¢ƒï¼Œæˆ–åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥é™åˆ¶mongodbçš„å†…å­˜ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/mongod.conf, å³æ·»åŠ storage.wiredTiger.engineConfig.cacheSizeGBå‚æ•°å¦‚ä¸‹ï¼š 12345678910111213141516systemLog: destination: file path: \"/ssdb1/mongodb/mongodb4.0.13/logs/mongod.log\" logAppend: truestorage: dbPath: \"/ssdb1/mongodb/mongodb4.0.13/data\" journal: enabled: true wiredTiger: engineConfig: cacheSizeGB: 3processManagement: fork: truenet: bindIp: 0.0.0.0 port: 27017 ç„¶åé‡å¯mongodb 1$ service mongodb restart å‚è€ƒï¼šWiredTiger Storage Enginestorage.wiredTiger.engineConfig.cacheSizeGB","link":"/2019/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E5%86%85%E5%AD%98%E9%99%90%E5%88%B6/"},{"title":"mongodbå‰¯æœ¬é›†æ­å»º(äºŒ)å¼€å¯æƒé™éªŒè¯","text":"å¼€å¯æƒé™éªŒè¯ å‰¯æœ¬é›†å¯ç”¨èº«ä»½éªŒè¯ï¼Œéœ€ç”ŸæˆkeyFileæ–‡ä»¶ï¼š 1ã€æ–°å®‰è£…çš„å‰¯æœ¬é›†æ²¡æœ‰å¯ç”¨èº«ä»½éªŒè¯ã€‚å…ˆæ·»åŠ rootç”¨æˆ·ã€‚ 12$ use admin$ db.createUser({user:\"root\",pwd:\"root\",roles:[\"root\"]} 2ã€ç”ŸæˆkeyFileæ–‡ä»¶ åœ¨å…¶ä¸­ä¸€å°æœºå™¨ä¸Šï¼Œç”ŸæˆkeyFileæ–‡ä»¶ã€‚ 123$ cd /data/mongodb/mongodb4.0.3$ openssl rand -base64 753 &gt; mongodb.keyfile$ chmod 600 mongodb.keyfile å¤åˆ¶åˆ°å…¶å®ƒ2å°æœºå™¨ä¸Š 12$ scp mongodb.keyfile root@192.168.138.3:/data/mongodb/mongodb4.0.3$ scp mongodb.keyfile root@192.168.138.4:/data/mongodb/mongodb4.0.3 3ã€ä¿®æ”¹mongodb.conf æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 123security: authorization: enabled keyFile: /data/mongodb/mongodb4.0.3/mongodb.keyfile 4ã€ç„¶åé‡å¯mongodb å‚è€ƒï¼šhttps://docs.mongodb.com/manual/administration/configuration/#replication-configuration","link":"/2018/11/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E5%89%AF%E6%9C%AC%E9%9B%86%E6%90%AD%E5%BB%BA(%E4%BA%8C)/"},{"title":"mongodbå‰¯æœ¬é›†æ­å»º(ä¸€)","text":"å‰¯æœ¬é›†æ˜¯mongodbæœåŠ¡æä¾›å†—ä½™å’Œé«˜å¯ç”¨æ€§çš„æ–¹æ³•ã€‚ ä¸»è¦æˆå‘˜åŒ…æ‹¬ï¼š ä¸»èŠ‚ç‚¹ï¼ˆprimary ï¼‰â€“ ä¸»è¦æ¥æ”¶æ‰€æœ‰å†™æ“ä½œ è¾…åŠ©èŠ‚ç‚¹ï¼ˆSecondaries ï¼‰â€“ ä»ä¸»èŠ‚ç‚¹å¤åˆ¶æ“ä½œä»¥ç»´æŠ¤ç›¸åŒçš„æ•°æ®é›†ï¼Œå¯ä»¥æ— æŠ•ç¥¨æƒvotes:0ï¼Œpriority: 0ã€‚ ä»²è£èŠ‚ç‚¹ï¼ˆArbiters ï¼‰â€“ ä»²è£è€…ä¸ä¿ç•™æ•°æ®çš„å‰¯æœ¬ï¼Œä½†å¯ä»¥å‚ä¸æŠ•ç¥¨ã€‚ è¾…åŠ©èŠ‚ç‚¹ç»´æŠ¤ä¸»èŠ‚ç‚¹æ•°æ®é›†çš„å‰¯æœ¬ã€‚å®ƒä»ä¸»èŠ‚ç‚¹çš„oplogä¸­è¿›è¡Œæ•°æ®çš„åŒæ­¥ã€‚è¾…åŠ©æˆå‘˜ä¸­æœ‰ï¼šä¼˜å…ˆçº§ä¸º0çš„å‰¯æœ¬é›†æˆå‘˜ï¼ˆä¸èƒ½æˆä¸ºä¸»èŠ‚ç‚¹ï¼‰ã€éšè—çš„å‰¯æœ¬é›†æˆå‘˜ï¼ˆå¯¹å®¢æˆ·ç«¯ç¨‹åºä¸å¯è§ï¼Œä¸èƒ½æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥å‚ä¸æŠ•ç¥¨ï¼‰ã€å»¶è¿Ÿå‰¯æœ¬é›†æˆå‘˜ï¼ˆä¼˜å…ˆçº§å¿…é¡»æ˜¯0ï¼Œæ˜¯éšè—èŠ‚ç‚¹ï¼Œå¯å‚ä¸æŠ•ç¥¨ï¼‰ mongodbå‰¯æœ¬é›†æ­å»º å‡†å¤‡3å°æœåŠ¡å™¨ï¼š192.168.138.2ã€192.168.138.3ã€192.168.138.4 1ã€æ¯å°éƒ½å®‰è£…å¥½mongodbã€‚2ã€ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼švim /etc/mongodb.conf 12345678910111213141516# mongodb.confsystemLog: destination: file path: \"/data/mongodb/mongodb4.0.3/logs/mongod.log\" #æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½• logAppend: truestorage: dbPath: \"/data/mongodb/mongodb4.0.3/data\" #æ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½• journal: enabled: trueprocessManagement: fork: true #åå°è¿è¡Œnet: bindIp: 0.0.0.0 port: 27017replication: replSetName: enroll-rs0 #å‰¯æœ¬é›†çš„åç§°ï¼Œç”¨æ¥è¯†åˆ«æ˜¯å¦å±äºåŒä¸€ä¸ªé›†ç¾¤ 3ã€ç„¶åä¾æ¬¡å¯åŠ¨3å°æ•°æ®åº“ï¼šmongod -f /etc/mongodb.conf 4ã€åˆå§‹åŒ–å‰¯æœ¬é›† ç™»å…¥ä»»æ„ä¸€å°æœºå™¨çš„MongoDBæ‰§è¡Œï¼šå› ä¸ºæ˜¯å…¨æ–°çš„å‰¯æœ¬é›†æ‰€ä»¥å¯ä»¥ä»»æ„è¿›å…¥ä¸€å°æ‰§è¡Œï¼›è¦æ˜¯æœ‰ä¸€å°æœ‰æ•°æ®ï¼Œåˆ™éœ€è¦åœ¨æœ‰æ•°æ®ä¸Šæ‰§è¡Œï¼›è¦å¤šå°æœ‰æ•°æ®åˆ™ä¸èƒ½åˆå§‹åŒ–ã€‚ 123456789$ mongo$ rs.initiate( { _id : \"enroll-rs0\", members: [ { _id: 0, host: \"192.168.138.2:27017\" }, { _id: 1, host: \"192.168.138.3:27017\" }, { _id: 2, host: \"192.168.138.4:27017\" } ]}) è¯´æ˜ï¼š â€œ_idâ€:å‰¯æœ¬é›†åç§°ã€‚ â€œmembersâ€: å‰¯æœ¬é›†çš„æœåŠ¡å™¨åˆ—è¡¨ã€‚ â€œ_idâ€: æœåŠ¡å™¨çš„å”¯ä¸€ID â€œhostâ€: æœåŠ¡å™¨ä¸»æœºåæˆ–IPã€‚ â€œpriorityâ€: æ˜¯ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¸º1ï¼Œä¼˜å…ˆçº§0ä¸ºè¢«åŠ¨èŠ‚ç‚¹ï¼Œä¸èƒ½æˆä¸ºæ´»è·ƒèŠ‚ç‚¹ã€‚ä¼˜å…ˆçº§ä¸ä½0åˆ™æŒ‰ç…§æœ‰å¤§åˆ°å°é€‰å‡ºæ´»è·ƒèŠ‚ç‚¹ã€‚(å¯é€‰) â€œarbiterOnlyâ€: ä»²è£èŠ‚ç‚¹ï¼Œåªå‚ä¸æŠ•ç¥¨ï¼Œä¸æ¥æ”¶æ•°æ®ï¼Œä¹Ÿä¸èƒ½æˆä¸ºæ´»è·ƒèŠ‚ç‚¹ã€‚ï¼ˆå¯é€‰ï¼‰ 5ã€æŸ¥çœ‹å‰¯æœ¬é›†é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364$ rs.conf();{ \"_id\" : \"enroll-rs0\", \"version\" : 1, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 0, \"host\" : \"192.168.138.2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 1, \"host\" : \"192.168.138.3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"192.168.138.4:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5bdfa91cc04c5a3e91f5ebdb\") }} 6ã€æŸ¥çœ‹å‰¯æœ¬é›†è¿è¡ŒçŠ¶æ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117$ rs.status(); { \"set\" : \"enroll-rs0\", \"date\" : ISODate(\"2018-11-05T02:21:43.971Z\"), \"myState\" : 2, \"term\" : NumberLong(1), \"syncingTo\" : \"192.168.138.4:27017\", \"syncSourceHost\" : \"192.168.138.4:27017\", \"syncSourceId\" : 3, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"durableOpTime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1541384489, 3), \"members\" : [ { \"_id\" : 0, \"name\" : \"192.168.138.2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 25, \"optime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2018-11-05T02:21:32Z\"), \"optimeDurableDate\" : ISODate(\"2018-11-05T02:21:32Z\"), \"lastHeartbeat\" : ISODate(\"2018-11-05T02:21:43.331Z\"), \"lastHeartbeatRecv\" : ISODate(\"2018-11-05T02:21:43.099Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1541384489, 1), \"electionDate\" : ISODate(\"2018-11-05T02:21:29Z\"), \"configVersion\" : 1 }, { \"_id\" : 1, \"name\" : \"192.168.138.3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 1195, \"optime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2018-11-05T02:21:32Z\"), \"syncingTo\" : \"192.168.138.4:27017\", \"syncSourceHost\" : \"192.168.138.4:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 1, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 3, \"name\" : \"192.168.138.4:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 25, \"optime\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1541384492, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2018-11-05T02:21:32Z\"), \"optimeDurableDate\" : ISODate(\"2018-11-05T02:21:32Z\"), \"lastHeartbeat\" : ISODate(\"2018-11-05T02:21:43.331Z\"), \"lastHeartbeatRecv\" : ISODate(\"2018-11-05T02:21:42.756Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"192.168.138.2:27017\", \"syncSourceHost\" : \"192.168.138.2:27017\", \"syncSourceId\" : 0, \"infoMessage\" : \"\", \"configVersion\" : 1 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1541384492, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1541384492, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } }} è‡³æ­¤æ•´ä¸ªå‰¯æœ¬é›†å·²ç»æ­å»ºæˆåŠŸäº†ã€‚ 7ã€å…¶å®ƒå¸¸ç”¨å‘½ä»¤ 12345$ rs.isMaster() //æŸ¥è¯¢è¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸»èŠ‚ç‚¹$ rs.slaveOk() //å…è®¸åœ¨SECONDARYèŠ‚ç‚¹ä¸Šè¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé»˜è®¤ä»èŠ‚ç‚¹ä¸å…·æœ‰æŸ¥è¯¢åŠŸèƒ½$ rs.add(\"ip:port\"); //æ·»åŠ æ–°çš„èŠ‚ç‚¹åˆ°è¯¥å‰¯æœ¬é›†ä¸­$ rs.remove(\"ip:port\"); //ä»å‰¯æœ¬é›†ä¸­åˆ é™¤èŠ‚ç‚¹$ rs.addArb(â€œip:portâ€); //æ–°å¢ä»²è£èŠ‚ç‚¹ å‰¯æœ¬é›†çš„ç»´æŠ¤å¯å‚è€ƒï¼šhttps://www.cnblogs.com/zhoujinyi/p/3554010.html å‚è€ƒï¼šhttps://docs.mongodb.com/manual/tutorial/deploy-replica-set/ https://www.cnblogs.com/out-of-memory/p/6810525.html","link":"/2018/11/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E5%89%AF%E6%9C%AC%E9%9B%86%E6%90%AD%E5%BB%BA(%E4%B8%80)/"},{"title":"mongodbæ•°æ®å»é‡","text":"æ•°æ®ï¼š12345{ &quot;_id&quot; : NumberLong(1), &quot;browserId&quot; : NumberLong(3), &quot;sex&quot; : 1, &quot;province&quot; : &quot;å¹¿è¥¿å£®æ—è‡ªæ²»åŒº&quot; }{ &quot;_id&quot; : NumberLong(2), &quot;browserId&quot; : NumberLong(6), &quot;sex&quot; : 1, &quot;province&quot; : &quot;æ¹–å—&quot; }{ &quot;_id&quot; : NumberLong(3), &quot;browserId&quot; : NumberLong(5), &quot;sex&quot; : 0,&quot;province&quot; : &quot;æ¹–å—&quot; }{ &quot;_id&quot; : NumberLong(4), &quot;browserId&quot; : NumberLong(4) }{ &quot;_id&quot; : NumberLong(5), &quot;browserId&quot; : NumberLong(6), &quot;sex&quot; : 1 , &quot;province&quot; : &quot;æ¹–å—&quot; } æŒ‰browserIdå­—æ®µå»é‡123456db.coll.aggregate([ {$sort: {id: -1}}, {$group: {_id: &quot;$browserId&quot;, doc: {$first: &quot;$$ROOT&quot;}}}, {$replaceRoot: {newRoot: &quot;$doc&quot;}}, {&quot;$project&quot;:{_id:1,browserId:1,sex:1,province:1}}]); ç»“æœï¼š1234{ &quot;_id&quot; : NumberLong(1), &quot;browserId&quot; : NumberLong(3), &quot;sex&quot; : 1, &quot;province&quot; : &quot;å¹¿è¥¿å£®æ—è‡ªæ²»åŒº&quot; }{ &quot;_id&quot; : NumberLong(3), &quot;browserId&quot; : NumberLong(5), &quot;sex&quot; : 0, &quot;province&quot; : &quot;æ¹–å—&quot; }{ &quot;_id&quot; : NumberLong(4), &quot;browserId&quot; : NumberLong(4) }{ &quot;_id&quot; : NumberLong(5), &quot;browserId&quot; : NumberLong(6), &quot;sex&quot; : 1&quot;, province&quot; : &quot;æ¹–å—&quot; } å»é‡åï¼ŒæŒ‰æ€§åˆ«è¿›è¡Œåˆ†ç»„ç»Ÿè®¡123456db.coll.aggregate([ {$sort:{_id:-1}}, {&quot;$group&quot;:{_id:&quot;$browserId&quot;,doc:{&quot;$first&quot;:&quot;$$ROOT&quot;}}}, {&quot;$replaceRoot&quot;:{newRoot:&quot;$doc&quot;}}, {&quot;$group&quot;:{_id:&quot;$sex&quot;,count:{&quot;$sum&quot;:1}}}]) ç»“æœï¼š123{ &quot;_id&quot; : null, &quot;count&quot; : 1 }{ &quot;_id&quot; : 0, &quot;count&quot; : 1 }{ &quot;_id&quot; : 1, &quot;count&quot; : 2 } $replaceRoot ï¼šå°†æŒ‡å®šæ–‡æ¡£æå‡åˆ°é¡¶çº§å¹¶æ›¿æ¢æ‰€æœ‰å…¶ä»–å­—æ®µã€‚ Mongodbç‰ˆæœ¬3.4ä»¥ä¸Šã€‚ ROOT : å¼•ç”¨å½“å‰æ­£åœ¨èšåˆç®¡é“é˜¶æ®µå¤„ç†çš„æ ¹æ–‡æ¡£ï¼Œå³é¡¶çº§æ–‡æ¡£ã€‚ å‚è€ƒï¼šhttps://docs.mongodb.com/manual/reference/operator/aggregation/replaceRoot/index.html https://segmentfault.com/q/1010000010874460","link":"/2018/07/31/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D/"},{"title":"MongoDbè§£å‹ç¼©å®‰è£…","text":"1ã€æ–°å»ºmongodbå·¥ä½œç›®å½• 1$ mkdir /usr/local/mongodb 2ã€ä¸‹è½½å®‰è£…åŒ…ä»å®˜ç½‘ä¸‹è½½ï¼šä¸‹è½½åœ°å€3ã€è§£å‹ç¼© 1234$ tar -zxvf mongodb-linux-x86_64-ubuntu1604-3.6.3.tgz$ mv mongodb-linux-x86_64-ubuntu1604-3.6.3 mongodb3.6.3 #ä¿®æ”¹ä¸‹ç›®å½•å$ mkdir /usr/local/mongodb/mongodb3.6.3/data #åˆ›å»ºæ•°æ®ç›®å½•$ mkdir /usr/local/mongodb/mongodb3.6.3/logs/ #åˆ›å»ºæ—¥å¿—ç›®å½• 4ã€æ·»åŠ åˆ°ç¯å¢ƒå˜é‡vim /etc/profile 123#MONGODBexport MONGODB_HOME=/usr/local/mongodb/mongodb3.6.3export PATH=$MONGODB_HOME/bin:$PATH source /etc/profile5ã€åˆ›å»ºé…ç½®æ–‡ä»¶ åœ¨2.6ç‰ˆæœ¬åå¼•å…¥äº†YMALçš„é…ç½®æ ¼å¼ï¼Œä½†ä»ç„¶æ˜¯å‘åå…¼å®¹çš„ã€‚å¯å‚è€ƒï¼šmongodn.conf vim /etc/mongodb.conf 12345678910# mongodb.confbind_ip = 0.0.0.0port = 27017logpath=/usr/local/mongodb/mongodb3.6.3/logs/mongodb.loglogappend=truedbpath = /usr/local/mongodb/mongodb3.6.3/datajournal=truefork = true YAMLæ ¼å¼ï¼š 12345678910111213systemLog: destination: file path: \"/usr/local/mongodb/mongodb-4.0.1/logs/mongodb.log\" logAppend: truestorage: dbPath: \"/usr/local/mongodb/mongodb-4.0.1/data\" journal: enabled: trueprocessManagement: fork: truenet: bindIp: 0.0.0.0 port: 27017 6ã€å¯åŠ¨ 1$ mongod -f /etc/mongodb.conf å…³äºå¼€æœºè‡ªå¯ï¼Œè§ï¼šKeepalivedå®ç°mongoDBçš„é«˜å¯ç”¨","link":"/2018/05/15/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E8%A7%A3%E5%8E%8B%E7%BC%A9%E5%AE%89%E8%A3%85/"},{"title":"mongodbæŒ‰æ—¶é—´åˆ†ç»„ç»Ÿè®¡","text":"mongodbæŒ‰æ—¶é—´åˆ†ç»„ç»Ÿè®¡ å…³é”®å­—ï¼šæ—¶é—´æ®µåˆ†ç»„ã€AggregationExpressionã€$bucketã€$bucketAuto æ•°æ®ï¼š 1234567891011121314151617181920212223242526272829303132333435/* 1 */{ &quot;_id&quot; : &quot;6c2f6089d0df424dbb3dc05a89dd3260_13&quot;, &quot;contentId&quot; : NumberLong(13), &quot;upCnt&quot; : 1, &quot;upTime&quot; : ISODate(&quot;2018-08-07T03:56:51.798Z&quot;), &quot;isLiving&quot; : true, &quot;uid&quot; : &quot;7634aa19f67a44bfaba59e66b9acf7e1&quot;, &quot;_class&quot; : &quot;com.eyeshot.model.EsLiveUp&quot;, &quot;createTime&quot; : &quot;2018-08-07 10:12:00&quot;}/* 2 */{ &quot;_id&quot; : &quot;893e6ee867ba4bc8b58fe3e9046f1520_13&quot;, &quot;contentId&quot; : NumberLong(13), &quot;upCnt&quot; : 1, &quot;upTime&quot; : ISODate(&quot;2018-08-07T04:16:24.848Z&quot;), &quot;isLiving&quot; : true, &quot;uid&quot; : &quot;19d4ec6945c741558fd6321b926bce1e&quot;, &quot;_class&quot; : &quot;com.eyeshot.model.EsLiveUp&quot;, &quot;createTime&quot; : &quot;2018-08-07 10:42:00&quot;}/* 3 */{ &quot;_id&quot; : &quot;73379B9556FDC7FE86E2FCACC8EEC914_13&quot;, &quot;contentId&quot; : NumberLong(13), &quot;upCnt&quot; : 1, &quot;upTime&quot; : ISODate(&quot;2018-08-07T05:46:24.848Z&quot;), &quot;isLiving&quot; : true, &quot;uid&quot; : &quot;49d4ec6945c741558fd6321b926bce5e&quot;, &quot;_class&quot; : &quot;com.eyeshot.model.EsLiveUp&quot;, &quot;createTime&quot; : &quot;2018-08-07 11:12:00&quot;} å¦‚æœè¦ç»Ÿè®¡2018-08-07 0ç‚¹-14ç‚¹ä¹‹é—´æ¯éš”30åˆ†é’Ÿç‚¹èµæ•°æ® 1234567891011121314151617181920212223db.esLiveUp.aggregate([ {\"$match\":{\"upTime\":{\"$gte\":ISODate(\"2018-08-07T00:00:00.00Z\"),\"$lte\":ISODate(\"2018-08-07T14:00:00.00Z\")}}}, {\"$group\":{ \"_id\":{\"$subtract\":[ { \"$subtract\": [ \"$upTime\", new Date(\"1970-01-01\") ] }, { \"$mod\": [ { \"$subtract\": [ \"$upTime\", new Date(\"1970-01-01\") ] }, 1000 * 60 * 20 //30åˆ†é’Ÿ ]} ] }, \"total\": {'$sum': '$upCnt'} }}, {\"$project\": { \"_id\": 0, \"total\":1, 'datetime': {'$add': [new Date(0), '$_id']} }}, {\"$sort\": { 'datetime': 1 }}]) ç»“æœï¼š 123{ &quot;total&quot; : 1, &quot;datetime&quot; : ISODate(&quot;2018-08-07T03:40:00Z&quot;) }{ &quot;total&quot; : 1, &quot;datetime&quot; : ISODate(&quot;2018-08-07T04:00:00Z&quot;) }{ &quot;total&quot; : 1, &quot;datetime&quot; : ISODate(&quot;2018-08-07T05:40:00Z&quot;) } ä»¥ä¸Šå‚è€ƒï¼šhttps://blog.csdn.net/orangleliu/article/details/79864624 å¯æ˜¯åœ¨javaä¸­æœªæ‰¾åˆ°å¯¹$groupæœ‰å¦‚æ­¤å¤æ‚çš„åˆ†ç»„ã€‚ åªäº†è§£åˆ°projectä¸­å…³äº AggregationExpression çš„ç”¨æ³• ä»¥ä¸‹æ˜¯ä¸€æ®µæ— å®é™…æ„ä¹‰çš„ä¾‹å­ã€‚ä»…è®°å½•AggregationExpressionçš„ç”¨æ³•ã€‚ 12345678910ArithmeticOperators.Subtract subtract = ArithmeticOperators.Subtract.valueOf(new AggregationExpression() { @Override public Document toDocument(AggregationOperationContext context) { Document document = new Document(); document.put(\"$subtract\", Arrays.asList(\"$upTime\" ,new Date())); return document; } }).subtract(1);ProjectionOperation project = Aggregation.project().and(subtract).as(\"title\");//.andExpression(\"upTime\").extractMinute().as(\"datetime\"), å®Œæ•´æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728 @RequestMapping(value = \"/getLiveUpStat1/{contentUid}\") @ResponseBody public ResponseData&lt;String&gt; getLiveUpStat1(@PathVariable String contentUid, ) { ResponseData&lt;String&gt; rd = new ResponseData&lt;&gt;(); EsContent content = mongoDao.getByUid(EsContent.class, contentUid, null); ArithmeticOperators.Subtract subtract = ArithmeticOperators.Subtract.valueOf(new AggregationExpression() { @Override public Document toDocument(AggregationOperationContext context) { Document document = new Document(); document.put(\"$subtract\", Arrays.asList(\"$upTime\" ,new Date())); return document; } }).subtract(1); // GroupOperation group = Aggregation.bucket(groupByExpression).group(subtract); MatchOperation match = Aggregation.match(new Criteria().andOperator(Criteria.where(\"contentId\").is(content.getId()).and(\"upTime\").gte(Utils.getDateFromStr(\"2018-08-07 00:00:00\", \"yyyy-MM-dd HH:mm:ss\")).lte(new Date()))); ProjectionOperation project = Aggregation.project().and(subtract).as(\"title\");//.andExpression(\"upTime\").extractMinute().as(\"datetime\"), GroupOperation group = Aggregation.group().count().as(\"count\"); TypedAggregation&lt;EsLiveUp&gt; upAggre = Aggregation.newAggregation(EsLiveUp.class, match, project, group);//[{ \"$match\" : { \"$and\" : [{ \"contentId\" : { \"$numberLong\" : \"13\" }, \"upTime\" : { \"$gte\" : { \"$date\" : 1533571200000 }, \"$lte\" : { \"$date\" : 1533706925605 } } }] } }, { \"$project\" : { \"title\" : { \"$subtract\" : [{ \"$subtract\" : [\"$upTime\", { \"$date\" : 1533706931075 }] }, 1] } } }, { \"$group\" : { \"_id\" : null, \"count\" : { \"$sum\" : 1 } } }] List&lt;EsLiveViewDataDto&gt; upStat = mongoDao.aggregate(upAggre, EsLiveViewDataDto.class); return rd; } ä½†åŸéœ€æ±‚å¯é€šè¿‡$bucketã€$bucketAutoè§£å†³ 1234567db.esLiveUp.aggregate([ {\"$bucketAuto\":{ groupBy:\"$createTime\", buckets:3, output:{\"time\":{\"$min\":\"$createTime\"},\"count\":{\"$sum\":1}}}}, {\"$project\":{_id:0,time:1,count:1}} ]) ç»“æœï¼š 123{ &quot;time&quot; : &quot;2018-08-07 10:12:00&quot;, &quot;count&quot; : 1 }{ &quot;time&quot; : &quot;2018-08-07 10:42:00&quot;, &quot;count&quot; : 1 }{ &quot;time&quot; : &quot;2018-08-07 11:12:00&quot;, &quot;count&quot; : 1 } ä¼ªä»£ç ï¼š 1234MatchOperation match = Aggregation.match(new Criteria().andOperator(Criteria.where(\"contentId\").is(content.getId())));BucketAutoOperation bucketAuto = Aggregation.bucketAuto(\"upTime\", 20).andOutput(\"upTime\").min().as(\"upTime\").andOutputCount().as(\"count\"); TypedAggregation&lt;EsLiveUp&gt; upAggre = Aggregation.newAggregation(EsLiveUp.class, match, bucketAuto); å‚è€ƒï¼š https://docs.mongodb.com/manual/meta/aggregation-quick-reference/#aggregation-expressions https://segmentfault.com/q/1010000013755740 https://stackoverflow.com/questions/42840426/mongo-aggregation-using-new-date-as-in-input-to-form-a-aggregationexpression/42856500 https://docs.mongodb.com/manual/reference/operator/aggregation/bucket/index.html https://docs.mongodb.com/manual/reference/operator/aggregation/bucketAuto","link":"/2018/08/08/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E6%8C%89%E6%97%B6%E9%97%B4%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1/"},{"title":"mongodbè®¾ç½®å¼€æœºè‡ªå¯ï¼ˆsystemdæ–¹å¼ï¼‰","text":"ç¯å¢ƒï¼šUbuntu18.04 1ã€åœ¨/etc/systemd/systemä¸‹æ–°å»ºmongodb.service vim /etc/systemd/system/mongodb.service 12345678910111213[Unit]Description=mongodbAfter=network.target remote-fs.target nss-lookup.target[Service]Type=forkingExecStart=/ssdb1/mongodb/mongodb4.0.13/bin/mongod --config /etc/mongodb.confExecReload=/bin/kill -s HUP $MAINPIDExecStop=/ssdb1/mongodb/mongodb4.0.13/bin/mongod --shutdown --config /etc/mongodb.confPrivateTmp=true[Install]WantedBy=multi-user.target 2ã€è®¾ç½®æƒé™ 1$ chmod 754 mongodb.service 3ã€å¯åŠ¨å…³é—­æœåŠ¡ï¼Œè®¾ç½®å¼€æœºå¯åŠ¨ 123456#å¯åŠ¨æœåŠ¡ $ systemctl start mongodb.service #å…³é—­æœåŠ¡ $ systemctl stop mongodb.service #å¼€æœºå¯åŠ¨ $ systemctl enable mongodb.service /etc/init.d/mongodbæ–¹å¼è§ã€Keepalivedå®ç°mongoDBçš„é«˜å¯ç”¨ã€‘","link":"/2019/11/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/mongodb%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%90%AF%E5%8A%A8/"},{"title":"mongodbå¤‡å¿˜è®°å½•","text":"1ã€æ›´æ–°æ•°ç»„é‡Œé¢çš„ä¸€ç»„å¯¹è±¡çš„å±æ€§ æƒ³è¦å¯¹gradeæ˜¯85å¯¹åº”çš„å¯¹è±¡çš„cntåŠ ä¸€ã€‚ åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š 12345678{ \"_id\" : NumberLong(2), \"grades\": [ {\"grade\": 80, \"cnt\": 8 }, {\"grade\": 85, \"cnt\": 6 }, {\"grade\": 90, \"cnt\": 3 } ]} æ›´æ–°ï¼š 1db.student.update({\"_id\":2,\"grades.grade\":85},{\"$inc\":{\"grades.$.cnt\":1}}) 1æ— æ³•é€šè¿‡ä¸€ä¸ªupdateæ“ä½œæ›´æ–°å¤šä¸ªarrayå…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸ªå¾ªç¯ http://ju.outofmemory.cn/entry/177346","link":"/2019/09/16/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/update/"},{"title":"ä¿®æ”¹mongodbå‰¯æœ¬é›†ä¸­çš„ä¸»æœºå","text":"ä¿®æ”¹mongodbå‰¯æœ¬é›†ä¸­çš„ä¸»æœºå mongodbå¼€å¯å‰¯æœ¬é›†åˆå§‹åŒ–åé»˜è®¤ä¸º&quot;host&quot; : &quot;ä¸»æœºå:27017&quot; å¦‚ä¸‹ï¼š é…ç½®å¤åˆ¶é›†çš„åç§°ï¼š mongod â€“replSet myDevReplSet 123456789101112131415161718192021222324252627282930313233343536373839404142&gt; rs.initiate(){ \"info2\" : \"no configuration specified. Using a default configuration for the set\", \"me\" : \"ubuntu:27017\", \"ok\" : 1}myDevReplSet:OTHER&gt; rs.conf(){ \"_id\" : \"myDevReplSet\", \"version\" : 1, \"protocolVersion\" : NumberLong(1), \"members\" : [ { \"_id\" : 0, \"host\" : \"ubuntu:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : 2000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5b35a8568dccf16c7734a30b\") }} å¦‚æœå±€åŸŸç½‘ä¸­æœ‰ä¸¤å°ç›¸åŒä¸»æœºåæœºå™¨å°±ä¼šéœ€è¦ä¿®æ”¹å‰¯æœ¬é›†åç§° 1ã€åœæ­¢å‰¯æœ¬é›†ä¸­æ‰€æœ‰æˆå‘˜ï¼ˆæœ¬ä¾‹è¯¥å‰¯æœ¬é›†åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼‰ 2ã€å¯åŠ¨mongodbæœåŠ¡ï¼Œä½†ä¸ä½¿ç”¨ --replSet å‚æ•° 3ã€å¯¹æ¯ä¸ªå‰¯æœ¬é›†æˆå‘˜æ‰§è¡Œä¸‹åˆ—æ“ä½œï¼ˆæœ¬ä¾‹è¯¥å‰¯æœ¬é›†åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼‰ â€‹ aã€è¿æ¥åˆ°mongodbçš„shell â€‹ 1$ mongo â€‹ bã€æ‰‹åŠ¨ç¼–è¾‘å‰¯æœ¬é›†é…ç½®ã€‚å‰¯æœ¬é›†é…ç½®æ˜¯æ•°æ®åº“ä¸­system.replset é›†åˆä¸­å”¯ä¸€çš„æ–‡æ¡£localã€‚ä½¿ç”¨æ–°ä¸»æœºåå’Œå‰¯æœ¬é›†æ‰€æœ‰æˆå‘˜çš„æ­£ç¡®ç«¯å£ç¼–è¾‘å‰¯æœ¬é›†é…ç½®ã€‚è€ƒè™‘ä»¥ä¸‹å‘½ä»¤åºåˆ—æ¥æ›´æ”¹ä¸‰ä¸ªæˆå‘˜é›†ä¸­çš„ä¸»æœºåï¼š 1234567891011use localcfg = db.system.replset.findOne( { &quot;_id&quot;: &quot;rs&quot; } )cfg.members[0].host = &quot;mongodb0.example.net:27017&quot;cfg.members[1].host = &quot;mongodb1.example.net:27017&quot;cfg.members[2].host = &quot;mongodb2.example.net:27017&quot;db.system.replset.update( { &quot;_id&quot;: &quot;rs&quot; } , cfg ) â€‹ cã€åœæ­¢mongodæˆå‘˜æœåŠ¡ 4ã€æ‰€æœ‰æˆå‘˜é…ç½®å®Œæˆåï¼Œä½¿ç”¨--replSeté€‰é¡¹å¯åŠ¨æœåŠ¡ 5ã€éªŒè¯ 123456789101112131415161718192021222324252627282930313233343536myDevReplSet:PRIMARY&gt; rs.conf();{ \"_id\" : \"myDevReplSet\", \"version\" : 1, \"protocolVersion\" : NumberLong(1), \"members\" : [ { \"_id\" : 0, \"host\" : \"192.168.1.18:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : 2000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5b35a8568dccf16c7734a30b\") }} å‚è€ƒï¼šchange-hostnames-in-a-replica-set","link":"/2018/06/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E4%BF%AE%E6%94%B9mongodb%E5%89%AF%E6%9C%AC%E9%9B%86%E4%B8%AD%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%90%8D/"},{"title":"å¼€å¯ç”¨æˆ·è®¤è¯","text":"å¼€å¯è®¤è¯ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/mongodb.confæ‰“å¼€authæ³¨é‡Š 1auth = true æ·»åŠ ç®¡ç†å‘˜æ·»åŠ è¶…çº§ç®¡ç†å‘˜è´¦å· 12345678$ use admin;$ db.createUser( { user: \"root\", pwd: \"root\", roles: [ \"root\" } ] }) é‡å¯mongoDB1$ service mongodb restart è¿›è¡ŒéªŒè¯ç™»å½• 1$ mongo --authenticationDatabase admin -u root -p root æˆ–è€…ç™»é™†åéªŒè¯ 12$ use admin;$ db.auth(\"root\", \"root\" ); æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯12$ use admin;$ db.getUser(\"root\") æ·»åŠ æ•°æ®åº“ç”¨æˆ·1ã€ä¸ºå…¶ä»–æ•°æ®åº“æ·»åŠ ç”¨æˆ·ï¼Œæ·»åŠ ç”¨æˆ·å‰éœ€è¦åˆ‡æ¢åˆ°è¯¥æ•°æ®åº“ 12345678$ use testdb;$ db.createUser( { user: \"testUser\", pwd: \"password\", roles: [ \"read\",\"readWrite\",\"dbAdmin\",\"dbOwner\",\"userAdmin\" ] }) å¯¹å½“å‰åº“çš„æƒé™ å½“å‰åº“æ™®é€šæ“ä½œè§’è‰² æƒé™ è¯´æ˜ read æŸ¥è¯¢æœ¬åº“çš„æƒé™ readWrite å¢åˆ æ”¹æŸ¥æœ¬åº“çš„æƒé™ å½“å‰åº“ç®¡ç†å‘˜æ“ä½œè§’è‰² æƒé™ è¯´æ˜ dbAdmin æ•°æ®åº“å¯¹è±¡çš„ç®¡ç†æ“ä½œï¼Œä½†æ²¡æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™ userAdmin åœ¨æœ¬åº“ä¸‹åˆ›å»ºç”¨æˆ·çš„æƒé™ dbOwner æœ¬åº“æ‰€æœ‰æ“ä½œçš„æƒé™ å®ä¾‹çº§åˆ«æ“ä½œè§’è‰² æƒé™ è¯´æ˜ readAnyDatabase æŸ¥è¯¢æœ¬å®ä¾‹æ‰€æœ‰åº“çš„æƒé™ readWriteAnyDatabase å¢åˆ æ”¹æŸ¥æœ¬ä¾‹æ‰€æœ‰åº“çš„æƒé™ userAdminAnyDatabase åœ¨æœ¬å®ä¾‹æ‰€æœ‰åº“ä¸‹åˆ›å»ºç”¨æˆ·çš„æƒé™ dbAdminAnyDatabase æœ¬å®ä¾‹æ‰€æœ‰åº“çš„dbAdminæƒé™ é›†ç¾¤ç®¡ç†å‘˜è§’è‰² æƒé™ è¯´æ˜ hostManager ç®¡ç†å’Œç›‘æ§æœåŠ¡å™¨çš„æƒé™ clusterMonitor æŸ¥è¯¢é›†ç¾¤å’Œå¤åˆ¶é›†çš„æƒé™ clusterManager ç®¡ç†å’Œç›‘æ§é›†ç¾¤å’Œå¤åˆ¶é›†çš„æƒé™ clusterAdmin é›†ç¾¤æ‰€æœ‰æ“ä½œçš„æƒé™ å¤‡ä»½ä¸æ¢å¤æ“ä½œè§’è‰² æƒé™ è¯´æ˜ backup mongodumpæƒé™ restore mongorestoreæƒé™ è¶…çº§è§’è‰² æƒé™ è¯´æ˜ root rootæƒé™ 2ã€æ·»åŠ æ•°æ®å¤‡ä»½è´¦å·ï¼š 12$ use admin;$ db.createUser({user:\"backUser\",pwd:\"password\",roles:[\"backup\",\"restore\"]}); ä¿®æ”¹ç”¨æˆ·å¯†ç éœ€è¦åœ¨å®šä¹‰è¯¥è´¦å·çš„æ•°æ®ä¸­ä¿®æ”¹ 12$ use admin$ db.changeUserPassword(\"root\", \"SOh3TbYhx8ypJPxmt1oOfL\") #ä¿®æ”¹rootè´¦å·å¯†ç  å‚è€ƒï¼šhttps://docs.mongodb.com/manual/tutorial/enable-authentication/https://docs.mongodb.com/manual/core/security-built-in-roles/https://docs.mongodb.com/manual/reference/method/db.createUser/","link":"/2017/12/22/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E5%BC%80%E5%90%AF%E7%94%A8%E6%88%B7%E9%AA%8C%E8%AF%81/"},{"title":"mongodbæŒ‰å­—ç¬¦ä¸²é•¿åº¦æŸ¥æ‰¾æ•°æ®","text":"æ ¹æ®å­—ç¬¦ä¸²å­—æ®µçš„é•¿åº¦æ¥ç­›é€‰ä¸€äº›æ•°æ®ï¼Œè¿™æ—¶å€™å¯èƒ½ä¼šç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥ç”¨mongodbçš„$whereã€‚ æŸ¥è¯¢èŒä¸šç¼–ç å¤§äºç­‰äº10çš„èŒä¸šã€‚ 12345# $whereå†™æ³•:$ db.spOccupation.find({\"$where\":\"this.code.length&gt;=10\"});# æ­£åˆ™è¡¨è¾¾å¼å†™æ³•ï¼š$ db.spOccupation.find({\"code\":{\"$regex\":/^.{10,}$/}}); å…¶ä»–æ¡ä»¶æ­£åˆ™ï¼š^.{n,m}$ n &lt;= é•¿åº¦ &lt;= m^.{n}$ é•¿åº¦ = n è¿™ä¸ªé•¿åº¦æ˜¯å­—ç¬¦çš„é•¿åº¦ï¼Œæ¯”å¦‚â€æ­£åˆ™è¡¨è¾¾å¼â€é•¿åº¦å°±æ˜¯5 æ­£åˆ™çš„æ€§èƒ½æ¯”$where çš„é€Ÿåº¦å¿«å¾ˆå¤š","link":"/2020/03/16/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E6%8C%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6%E6%9F%A5%E6%89%BE%E6%95%B0%E6%8D%AE/"},{"title":"å…³äºMongoDB","text":"ç´¢å¼•1ã€ åˆ›å»ºåˆé€‚çš„ç»„åˆç´¢å¼•ï¼Œä¸è¦ä¾èµ–äºäº¤å‰ç´¢å¼•ï¼ˆå³å¤šä¸ªå•å­—æ®µç´¢å¼•ï¼‰ã€‚ 2ã€ ç»„åˆç´¢å¼•å­—æ®µé¡ºåºï¼šåŒ¹é…æ¡ä»¶åœ¨å‰ï¼ŒèŒƒå›´æ¡ä»¶åœ¨åã€‚ 3ã€ å°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚ æŸ¥è¯¢å­—æ®µåŠè¿”å›å­—æ®µä¸ç´¢å¼•å­—æ®µç›¸åŒï¼ˆæ³¨æ„æŸ¥è¯¢ä¼šé»˜è®¤åŒ…å«_idï¼‰ 4ã€ å»ºç«‹ç´¢å¼•è¦åœ¨åå°è¿è¡Œã€‚ å¯¹é›†åˆåˆ›å»ºç´¢å¼•æ—¶ï¼Œè¯¥é›†åˆé»˜è®¤ä¸æ¥å—å…¶å®ƒè¯»å†™æ“ä½œã€‚å»ºè®®ä½¿ç”¨åå°è¿è¡Œé€‰é¡¹{background:true} æ¨¡å¼è®¾è®¡1ã€ ä¸è¦æŒ‰ç…§å…³ç³»å‹æ¥è®¾è®¡è¡¨ç»“æ„ã€‚ MongoDBå¯ä»¥åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·è®¾è®¡è¡¨ç»“æ„ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒå¤–é”®ï¼Œä¹Ÿä¸æ”¯æŒå¤æ‚çš„Joinï¼ 2ã€ æ•°æ®åº“é›†åˆæ•°é‡ä¸å®œå¤ªå¤šã€‚ MongoDBè¡¨è®¾è®¡ä¸éµä»ç¬¬ä¸‰èŒƒå¼ã€‚MongoDBçš„æ•°æ®æ¨¡å‹éå¸¸æ¥è¿‘äºå¯¹è±¡æ¨¡å‹ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå°±æ˜¯æŒ‰ç…§ä¸»è¦çš„Domain objectçš„æ•°é‡æ¥å»ºç›¸åº”çš„é›†åˆã€‚ 3ã€ ä¸è¦å®³æ€•æ•°æ®å†—ä½™ã€‚ MongoDBæ¨¡å¼è®¾è®¡ä¸èƒ½æŒ‰ç…§ç¬¬ä¸‰èŒƒå¼ï¼Œå¾ˆå¤šæ—¶å€™å…è®¸æ•°æ®åœ¨å¤šä¸ªæ–‡æ¡£ä¸­é‡å¤ï¼Œæ¯”å¦‚è¯´ï¼Œåœ¨æ¯ä¸€ä¸ªå‘˜å·¥çš„æ–‡æ¡£ä¸­é‡å¤ä»–çš„éƒ¨é—¨åå­—ï¼Œå°±æ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—çš„åšæ³•ã€‚å¦‚æœéƒ¨é—¨åå­—æ”¹äº†ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªupdate({},{}, {multi:true}) çš„å¤šæ–‡æ¡£æ›´æ–°æ¥ä¸€æ¬¡æ€§æŠŠéƒ¨é—¨åå­—æ›´æ–°æ‰ã€‚ 4ã€ é€‚åˆå’Œä¸é€‚åˆå†—ä½™çš„æ•°æ®ç±»å‹ å¦‚æœæŸä¸ªå­—æ®µçš„æ•°å€¼ç»å¸¸ä¼šå˜ï¼Œåˆ™ä¸å¤ªé€‚åˆè¢«å¤§é‡å†—ä½™åˆ°åˆ«çš„æ–‡æ¡£æˆ–è€…åˆ«çš„é›†åˆé‡Œé¢å»ï¼›å¦‚æœæ˜¯ä¸€äº›ä¸ç»å¸¸å˜çš„å­—æ®µï¼Œå¦‚å®¢æˆ·çš„å§“åï¼Œåœ°å€ï¼Œéƒ¨é—¨ç­‰ï¼Œåˆ™å¯ä»¥å°½ç®¡è¿›è¡Œå†—ä½™ã€‚ 5ã€ å¯¹äº1ï¼šN(ä¸€äº›)çš„å…³ç³»ä½¿ç”¨å…¨éƒ¨å†…åµŒ å¯¹äºä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå¦‚ä¸€ä¸ªäººæœ‰å‡ ä¸ªè”ç³»æ–¹å¼ï¼Œä¸€æœ¬ä¹¦æœ‰10å‡ ä¸ªç« èŠ‚ï¼Œç­‰ç­‰ï¼Œå»ºè®®ä½¿ç”¨å†…åµŒæ–¹å¼ï¼ŒæŠŠNçš„æ•°æ®ä»¥æ•°ç»„å½¢å¼æ¥æè¿° 6ã€ å¯¹äº1ï¼šNN(å¾ˆå¤š)çš„å…³ç³»ä½¿ç”¨IDå†…åµŒ æœ‰äº›æ—¶å€™è¿™ä¸ªä¸€å¯¹å¤šçš„å¤šç«¯æ•°é‡è¾ƒå¤§ï¼Œå¦‚ï¼šä¸€ä¸ªéƒ¨é—¨å¯èƒ½æœ‰æ•°åƒå‘˜å·¥ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæŠŠæ‰€æœ‰å‘˜å·¥ä¿¡æ¯ç›´æ¥å†…åµŒåˆ°éƒ¨é—¨å†…è‚¯å®šä¸æ˜¯ä¸ªå¥½çš„é€‰æ‹©ï¼Œæœ‰å¯èƒ½ä¼šè¶…å‡º16MBçš„æ–‡æ¡£é™åˆ¶ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥é‡‡ç”¨å¼•ç”¨IDçš„æ–¹å¼ å¦‚æœéœ€è¦æŸ¥è¯¢éƒ¨é—¨ä¸‹å‘˜å·¥ç›¸å…³ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨$lookupèšåˆæ“ä½œç¬¦æ¥æŠŠå‘˜å·¥ä¿¡æ¯è¿›è¡Œå…³è”å¹¶è¿”å›ã€‚ 7ã€ å¯¹äº1ï¼šNNN(å¾ˆå¤šå¾ˆå¤š)çš„å…³ç³» åº”è¯¥æŠŠå¤šç«¯çš„æ•°æ®åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œå¹¶åœ¨é‚£ä¸ªé›†åˆçš„æ–‡æ¡£é‡ŒåŠ å…¥å¯¹ä¸»æ–‡æ¡£çš„è¿æ¥å¼•ç”¨ã€‚ 8ã€ æŠŠäºŒè¿›åˆ¶å¤§æ–‡ä»¶å’Œå…ƒæ•°æ®åˆ†é›†åˆå­˜æ”¾ å¦‚æœä½ æœ‰éœ€è¦æŠŠPDFæ–‡ä»¶ï¼Œå›¾ç‰‡ï¼Œç”šè‡³å°è§†é¢‘ç­‰äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ç®¡ç†ï¼Œå»ºè®®ä½¿ç”¨MongoDB çš„GridFS API æˆ–è€…è‡ªå·±æ‰‹åŠ¨åˆ†é›†åˆæ¥åˆ†å¼€ç®¡ç†äºŒè¿›åˆ¶æ•°æ®å’Œå…ƒæ•°æ®ã€‚ 9ã€ å¯¹äºç»å¸¸æ›´æ–°çš„æ•°æ®ä¸è¦æ”¾åœ¨åµŒå¥—æ•°ç»„å†… ã€‚ ç¨‹åºé…ç½® è®¾å®šåˆé€‚çš„MongoDBè¿æ¥æ± å¤§å° Javaé©±åŠ¨é»˜è®¤è¿æ¥æ± å¤§å°æ˜¯100ã€‚å¯¹å‹åŠ›è¾ƒå°çš„åº”ç”¨å¯é€‚å½“å‡å°‘å¯¹æœåŠ¡å™¨èµ„æºçš„å ç”¨ã€‚ æ­£ç¡®ä½¿ç”¨å†™å…³æ³¨è®¾ç½® ä¸è¦å®ä¾‹åŒ–å¤šä¸ªMongoClient MongoClientæ˜¯ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œè‡ªå¸¦çº¿ç¨‹æ± ã€‚é€šå¸¸åœ¨ä¸€ä¸ªJVMå†…ä¸è¦å®ä¾‹åŒ–å¤šä¸ªMongoClientå®ä¾‹ï¼Œé¿å…è¿æ¥æ•°è¿‡å¤šå’Œèµ„æºçš„ä¸å¿…è¦æµªè´¹ã€‚ å¯¹å†™æ“ä½œä½¿ç”¨Retryæœºåˆ¶ é¿å…ä½¿ç”¨å¤ªé•¿çš„å­—æ®µå ä½¿ç”¨æœ‰è§„å¾‹çš„å‘½åæ–¹å¼ æ­£ç¡®ä½¿ç”¨æ›´æ–°è¯­å¥ MongoDBæ”¯æŒå’Œå…³ç³»å‹æ•°æ®åº“updateè¯­å¥ç±»ä¼¼çš„in place updateã€‚ä½ åªéœ€è¦åœ¨updateè¯­å¥ä¸­æŒ‡å®šéœ€è¦æ›´æ–°çš„å­—æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡æ¡£å¯¹è±¡ã€‚ ä½¿ç”¨æŠ•å°„ ï¼ˆprojectionï¼‰æ¥å‡å°‘è¿”å›çš„å†…å®¹ MongoDB æ”¯æŒç±»ä¼¼äºSQLè¯­å¥é‡Œé¢çš„selectï¼Œå¯ä»¥å¯¹è¿”å›çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ã€‚ä½¿ç”¨Projectionå¯ä»¥å‡å°‘è¿”å›çš„å†…å®¹ï¼Œé™ä½ç½‘ç»œä¼ è¾“çš„é‡å’Œä»£ç ä¸­è½¬åŒ–æˆå¯¹è±¡æ‰€éœ€çš„æ—¶é—´ã€‚ ä½¿ç”¨TTLæ¥è‡ªåŠ¨åˆ é™¤è¿‡æœŸçš„æ•°æ® å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç”¨MongoDBæ¥å­˜å‚¨ä¸€äº›æ—¶æ•ˆæ€§çš„æ•°æ®ï¼Œå¦‚7å¤©çš„ç›‘æ§æ•°æ®ã€‚ä¸å…¶è‡ªå·±å†™ä¸ªåå°è„šæœ¬å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨TTLç´¢å¼•æ¥è®©MongoDBè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®ï¼š 1db.data.ensureIndex({create_time:1}, {expireAfterSeconds: 7*24*3600}} ä½¿ç”¨executeå‘½ä»¤æ¥å®ç°upsert æœ‰äº›æ—¶å€™ä½ ä¸çŸ¥é“ä¸€æ¡æ–‡æ¡£æ•°æ®æ˜¯å¦å·²ç»åœ¨åº“é‡Œå­˜åœ¨ã€‚è¿™ä¸ªæ—¶å€™ä½ è¦ä¹ˆå…ˆæŸ¥è¯¢ä¸€ä¸‹ï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨upsertè¯­å¥ã€‚åœ¨SpringDataä¸‹é¢upsertè¯­å¥éœ€è¦ä½ æŠŠæ¯ä¸ªå­—æ®µçš„å€¼éƒ½åœ¨upsertè¯­å¥ä¸­æ ¼å¼åŒ–å‡ºæ¥ã€‚å­—æ®µå¤šçš„æ—¶å€™æœªå…æœ‰äº›ç¹çã€‚SpringData MongoDBé‡Œé¢çš„MongoTemplateæœ‰ä¸ªexecuteæ–¹æ³•å¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ªDBè°ƒç”¨ï¼Œä¹Ÿä¸ç”¨ç¹ççš„æŠŠæ‰€æœ‰å­—æ®µç½—åˆ—å‡ºæ¥çš„ä¾‹å­ã€‚ 123456789101112131415public boolean persistEmployee(Employee employee) throws Exception { BasicDBObject dbObject = new BasicDBObject(); mongoTemplate.getConverter().write(employee, dbObject); mongoTemplate.execute(Employee.class, new CollectionCallback&lt;Object&gt;() { public Object doInCollection(DBCollection collection) throws MongoException, DataAccessException { collection.update(new Query(Criteria.where(\"name\").is(employee.getName())).getQueryObject(), dbObject, true, // means upsert - true false // multi update â€“ false ); return null; } }); return true; } åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ SpringData MongoDBé»˜è®¤ä¼šåœ¨MongoDBæ–‡æ¡£ä¸­æ·»åŠ ä¸€ä¸ª_classå­—æ®µï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯fully qualified class nameï¼Œ å¦‚â€com.mongodb.examples.Customerâ€ã€‚å¯¹äºæœ‰äº›å°æ–‡æ¡£æ¥è¯´ï¼Œè¿™ä¸ªå­—æ®µå¯èƒ½ä¼šå æ®ä¸å°ä¸€éƒ¨åˆ†çš„å­˜å‚¨ç©ºé—´ã€‚å¦‚æœä½ ä¸å¸Œæœ›SpringData è‡ªåŠ¨åŠ å…¥è¿™ä¸ªå­—æ®µï¼Œ å¯ä»¥ 1ï¼‰è‡ªå®šä¹‰MongoTypeMapper 12345678@Beanpublic MongoTemplate mongoTemplate() throws UnknownHostException {MappingMongoConverter mappingMongoConverter = new MappingMongoConverter(new DefaultDbRefResolver(mongoDbFactory()), newMongoMappingContext());mappingMongoConverter.setTypeMapper(new DefaultMongoTypeMapper(null));return new MongoTemplate(mongoDbFactory(), mappingMongoConverter );} 2ï¼‰ åœ¨ä½¿ç”¨findè¯­å¥æ—¶ï¼Œæ˜¾å¼åœ°æŒ‡å®šç±»çš„åå­—/ç±»å‹ï¼š 1MongoTemplate.find(new Query(), Inventory.class)) åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ åˆ é™¤SpringData MongoDBä¸‹é¢çš„_class å­—æ®µ","link":"/2017/09/15/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E5%85%B3%E4%BA%8EMongoDB/"},{"title":"æ…¢æŸ¥è¯¢ä¼˜åŒ–1","text":"æ…¢æŸ¥è¯¢ä¼˜åŒ– åœ¨é˜¿é‡Œäº‘mongodbæ§åˆ¶å°ï¼Œå¯çœ‹åˆ°æ…¢æ—¥å¿—çš„ç»Ÿè®¡å’Œæ˜ç»†åˆ†ææ¯”è¾ƒæ–¹ä¾¿ï¼Œæˆ–è€…å¯ä»¥åœ¨mongodb shllç¯å¢ƒä¸­é’ˆå¯¹æŸä¸ªæ•°æ®åº“æŸ¥çœ‹æ…¢æ—¥å¿—è®°å½•ã€‚ 1db.system.profile.find( { millis : { $gt : 120 } } ) åœ¨æ§åˆ¶å°æŸ¥å¾—å¦‚ä¸‹æ…¢æŸ¥è¯¢è®°å½• 1234567891011db.setStudyRecord.find({\"ownerId\": \"eat_cp_210\", \"courseId\": 488, \"studentId\": 7107, \"studyType\": { \"$gte\": 10, \"$lt\": 20 }, \"isFinished\": false, \"studyResId\": { \"$in\": [ 1344,1345,1347,1348,1349,1350,1351 ] }}) ä½¿ç”¨MongoDB explainè¿›è¡Œåˆ†æ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197db.setStudyRecord.find({\"ownerId\": \"eat_cp_210\", \"courseId\": 488, \"studentId\": 7107, \"studyType\": { \"$gte\": 10, \"$lt\": 20 }, \"isFinished\": false, \"studyResId\": { \"$in\": [1344,1345,1347,1348,1349,1350,1351 ] }}).explain(\"executionStats\");{ \"queryPlanner\" : { \"plannerVersion\" : 1, \"namespace\" : \"aixueyou_eat190428.setStudyRecord\", \"indexFilterSet\" : false, \"parsedQuery\" : { \"$and\" : [ { \"courseId\" : { \"$eq\" : 488 } }, { \"isFinished\" : { \"$eq\" : false } }, { \"ownerId\" : { \"$eq\" : \"eat_cp_210\" } }, { \"studentId\" : { \"$eq\" : 7107 } }, { \"studyType\" : { \"$lt\" : 20 } }, { \"studyType\" : { \"$gte\" : 10 } }, { \"studyResId\" : { \"$in\" : [ 1344, 1345, 1347, 1348, 1349, 1350, 1351 ] } } ] }, \"winningPlan\" : { \"stage\" : \"COLLSCAN\", \"filter\" : { \"$and\" : [ { \"courseId\" : { \"$eq\" : 488 } }, { \"isFinished\" : { \"$eq\" : false } }, { \"ownerId\" : { \"$eq\" : \"eat_cp_210\" } }, { \"studentId\" : { \"$eq\" : 7107 } }, { \"studyType\" : { \"$lt\" : 20 } }, { \"studyType\" : { \"$gte\" : 10 } }, { \"studyResId\" : { \"$in\" : [ 1344, 1345, 1347, 1348, 1349, 1350, 1351 ] } } ] }, \"direction\" : \"forward\" }, \"rejectedPlans\" : [ ] }, \"executionStats\" : { \"executionSuccess\" : true, \"nReturned\" : 0, \"executionTimeMillis\" : 289, \"totalKeysExamined\" : 0, \"totalDocsExamined\" : 286856, \"executionStages\" : { \"stage\" : \"COLLSCAN\", \"filter\" : { \"$and\" : [ { \"courseId\" : { \"$eq\" : 488 } }, { \"isFinished\" : { \"$eq\" : false } }, { \"ownerId\" : { \"$eq\" : \"eat_cp_210\" } }, { \"studentId\" : { \"$eq\" : 7107 } }, { \"studyType\" : { \"$lt\" : 20 } }, { \"studyType\" : { \"$gte\" : 10 } }, { \"studyResId\" : { \"$in\" : [ 1344, 1345, 1347, 1348, 1349, 1350, 1351 ] } } ] }, \"nReturned\" : 0, \"executionTimeMillisEstimate\" : 280, \"works\" : 286858, \"advanced\" : 0, \"needTime\" : 286857, \"needYield\" : 0, \"saveState\" : 2241, \"restoreState\" : 2241, \"isEOF\" : 1, \"invalidates\" : 0, \"direction\" : \"forward\", \"docsExamined\" : 286856 } }, \"ok\" : 1, \"operationTime\" : Timestamp(1585311418, 2), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1585311418, 2), \"signature\" : { \"hash\" : BinData(0,\"vFOb4kXYvePgnFtOu1B8ASuxLi0=\"), \"keyId\" : NumberLong(\"6778070851129442306\") } }} å¯ä»¥çœ‹åˆ°æ˜¯å…¨è¡¨æ‰«æï¼Œæ‰§è¡Œæ—¶é—´280ms å»ºç«‹ç´¢å¼• 1$ db.setStudyRecord.createIndex( { ownerId: 1,courseId:1,studentId:1,studyType:1,isFinished:1,studyResId:1}, {background: true} )","link":"/2020/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%961/"},{"title":"mongodbå¤‡å¿˜è®°å½•","text":"1ã€æ›´æ–°æ•°ç»„é‡Œé¢çš„ä¸€ç»„å¯¹è±¡çš„å±æ€§ æƒ³è¦å¯¹gradeæ˜¯85å¯¹åº”çš„å¯¹è±¡çš„cntåŠ ä¸€ã€‚ åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š 12345678{ \"_id\" : NumberLong(2), \"grades\": [ {\"grade\": 80, \"cnt\": 8 }, {\"grade\": 85, \"cnt\": 6 }, {\"grade\": 90, \"cnt\": 3 } ]} æ›´æ–°ï¼š 1db.student.update({\"_id\":2,\"grades.grade\":85},{\"$inc\":{\"grades.$.cnt\":1}}) 2ã€æ›´æ–°é›†åˆæ–‡æ¡£ä¸­çš„å¤šä¸ªå­—æ®µæˆ–æ•°ç»„å±æ€§å€¼ åŸå§‹æ•°æ® (æ•°æ®ä¸»è¦ä¸ºå®éªŒéœ€è¦æ‰€æ„é€ ) 123456789101112131415161718192021222324252627{ \"_id\" : NumberLong(1), \"age\" : 20, \"day\" : 20, \"spotSeatCnts\" : { \"101\" : { \"1\" : 30, \"2\" : 30 }, \"102\" : { \"3\" : 30, \"4\" : 30 } }, \"roomIntentSpots\" : { \"101\" : [ { \"testSpotId\" : 1, \"testSpotTitle\" : \"åŒ—äº¬å¤§å­¦\", \"cnt\" : 34.0 }, { \"testSpotId\" : 2, \"testSpotTitle\" : \"æ¸…åå¤§å­¦\", \"cnt\" : 33.0 } ], \"102\" : { } }, \"descn\" : { \"grades\" : [ { \"grade\" : 80, \"cnt\" : 30 }, { \"grade\" : 85, \"cnt\" : 31 } ] }, \"grades\" : [ { \"grade\" : 90, \"mean\" : 75, \"std\" : 6 }, { \"grade\" : 87, \"mean\" : 90, \"std\" : 3 }, { \"grade\" : 85, \"mean\" : 85, \"std\" : 4 } ]} å¯¹ageå’Œdayå­—æ®µåŒæ—¶åšåŠ ä¸€æ“ä½œ 12db.neTestPlan.update({\"_id\":1},{\"$inc\":{\"age\":1,\"day\":1}}) #å¯ä»¥db.neTestPlan.update({\"_id\":1},{\"$inc\":{\"age\":1},\"$inc\":{\"day\":1}}) #ä¸å¯ä»¥ï¼Œåªæœ‰day+1 åŒç†ï¼Œä¸‹é¢çš„æ“ä½œ 12db.neTestPlan.update({\"_id\":1},{\"$inc\":{\"spotSeatCnts.101.1\":1,\"spotSeatCnts.101.2\":1,\"spotSeatCnts.102.3\":1}}) #å¯ä»¥db.neTestPlan.update({\"_id\":1},{\"$inc\":{\"spotSeatCnts.101.1\":1},\"$inc\":{\"spotSeatCnts.102.3\":1}}) #ä¸å¯ä»¥ï¼Œåªä¼šæ›´æ–°spotSeatCnts.102.3+1 æ€»ç»“ï¼šå¯¹é›†åˆæ–‡æ¡£ä¸­çš„å­—æ®µæˆ–å­—æ®µä¸­çš„Mapå¯¹è±¡ï¼ŒåŒæ“ä½œç±»å‹($incã€$setç­‰)æ›´æ–°ä¸¤ä¸ªåŠä»¥ä¸Šå­—æ®µï¼Œéƒ½æ˜¯ä¸Šé¢çš„æ“ä½œåŸç†ã€‚ æ›´æ–°æ•°ç»„ä¸­çš„å¤šä¸ªå…ƒç´ ï¼Œ3.6ç‰ˆæœ¬ä¹‹å‰æ²¡å‘ç°æœ‰å¥½çš„åŠæ³•ï¼Œåƒè¿™ç¯‡æ–‡ç« æ— æ³•é€šè¿‡ä¸€ä¸ªupdateæ“ä½œæ›´æ–°å¤šä¸ªarrayå…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸ªå¾ªç¯ ã€‚3.6æ–°å¢äº†arrayFilterså¯ä»¥è¿‡æ»¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¿›è€Œå¯¹æ•°ç»„ä¸­å¤šä¸ªå…ƒç´ æ›´æ–°ã€‚è¯¦ç»†å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šdb.collection.update 12345db.neTestPlan.update({\"_id\":100}, {\"$inc\":{\"roomIntentSpots.101.$[elem].cnt\":1}}, {\"arrayFilters\":[{\"elem.testSpotId\":{\"$in\":[1,2]}}]}) #å¯ä»¥db.neTestPlan.update({\"_id\":100}, {\"$inc\":{\"descn.grades.$[elem].cnt\":1}}, {\"arrayFilters\":[{\"elem.grade\":{\"$in\":[80,85]}}]}) #å¯ä»¥db.neTestPlan.findAndModify({query:{\"_id\":100},new:true,update:{\"$inc\":{\"roomIntentSpots.101.$[elem].cnt\":1}},arrayFilters:[{\"elem.testSpotId\":{\"$in\":[1,2]}}]}) #å¯ä»¥ å…³äºupdateã€updateOneã€updateManyã€saveã€findAndModifyçš„åŒºåˆ«å¯å‚è€ƒæœ‰å‘å‹¿è¸©ï¼ˆä¸‰ï¼‰â€”â€”å…³äºæ•°æ®æ›´æ–°","link":"/2019/09/16/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E7%89%B9%E6%AE%8A%E6%93%8D%E4%BD%9C/"},{"title":"mongodbæ›´æ–°ä¸€ä¸ªè¡¨ä¸­å­—æ®µä¸ºå¦ä¸€è¡¨ä¸­çš„å­—æ®µå€¼","text":"æ›´æ–°ä¸€ä¸ªè¡¨ä¸­å­—æ®µä¸ºå¦ä¸€è¡¨ä¸­çš„å­—æ®µå€¼ 1234567891011db.tePendingWork.find({&quot;testPlanId&quot;:{&quot;$exists&quot;:false}}).forEach( function(work){ db.teTestPlanItem.find({_id:work.testPlanItemId}).forEach( function(item){ //db.tePendingWork.update({_id:work._id}) db.tePendingWork.update({_id:work._id},{&quot;$set&quot;:{&quot;testPlanId&quot;:item.testPlanId,&quot;unitId&quot;:item.unitId}}) //printjson(work._id+&quot; testPlanId &quot; +item.testPlanId +&quot; unitId &quot; +item.unitId); //æ§åˆ¶å°æ‰“å° } ); } ) å¦ä¸€ç§æ€æƒ³ï¼šå…ˆæŸ¥è¯¢æ‰€æœ‰teTestPlanItemç„¶åæŒ‰_idåškeyå­˜å…¥mapä¸­ç„¶ååœ¨tePendingWorkæŒ‰ç…§testPlanItemIdè·å–ç›¸åº”çš„å€¼ã€‚ 1234567891011121314151617181920function testMap(){ var map = new Map(); db.teTestPlanItem.find().forEach( function(item){ map.put(item._id,item); printjson(&quot; item &quot; + item._id ) } ) //mapéå† //for(var key in map){ // printjson(map[key] ) //} db.tePendingWork.find().forEach( function(work){ printjson(work.testPlanItemId +&quot; &quot; + map.get(work.testPlanItemId)._id) } )}testMap(); //æ‰§è¡ŒtestMapå‡½æ•° å¼•ç”³ï¼šMap_Reduce","link":"/2018/04/24/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E6%9B%B4%E6%96%B0%E4%B8%80%E4%B8%AA%E8%A1%A8%E4%B8%AD%E5%AD%97%E6%AE%B5%E4%B8%BA%E5%8F%A6%E4%B8%80%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E5%80%BC/"},{"title":"mongoDBç›‘æ§å·¥å…·mongostat","text":"mongostatè¿”å›åæ˜ 1ç§’é’Ÿå†…çš„æ“ä½œçš„å€¼ã€‚å½“mongostat çš„å€¼å¤§äº1æ—¶ï¼Œmongostatå°†ç»Ÿè®¡æ•°æ®å¹³å‡ä»¥åæ˜ æ¯ç§’çš„å¹³å‡æ“ä½œã€‚ mongostatä»ç³»ç»Ÿå‘½ä»¤è¡Œè¿è¡Œï¼Œè€Œä¸æ˜¯mongoshellã€‚å¸¸ç”¨å‘½ä»¤å‚æ•° â€“host &lt;:port&gt;, -h &lt;:port&gt; æŒ‡å®šè¿æ¥çš„ä¸»æœºå â€“port æŒ‡å®šç«¯å£ â€“username , -u æŒ‡å®šä¸€ä¸ªç”¨æˆ·åï¼Œç”¨æ¥éªŒè¯ä½¿ç”¨éªŒè¯çš„MongoDBæ•°æ®åº“ã€‚ä¸â€“passwordå’Œ â€“authenticationDatabaseé€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚ â€“password , -p æŒ‡å®šæ•°æ®åº“çš„å¯†ç  â€“authenticationDatabase æŒ‡å®šç”¨æˆ·åˆ›å»ºçš„æ•°æ®åº“ â€“rowcount , -n æ§åˆ¶è¦è¾“å‡ºçš„è¡Œæ•°ã€‚ä¸sleeptimeå‚æ•°ä¸€èµ·ä½¿ç”¨æ¥æ§åˆ¶mongostatæ“ä½œçš„æŒç»­æ—¶é—´ ã€‚ â€“jsonmongostatä»¥JSONæ ¼å¼è¿”å›è¾“å‡ºã€‚ ä¸¤æ¬¡mongostatè°ƒç”¨ä¹‹é—´ç­‰å¾…çš„æ—¶é—´é•¿åº¦ï¼Œä»¥ç§’ä¸ºå•ä½ ã€‚é»˜è®¤ä¸º1ç§’ã€‚ å­—æ®µè¯´æ˜mongostat è¾“å‡ºä»¥ä¸‹å­—æ®µ insertsæ¯ç§’æ’å…¥åˆ°æ•°æ®åº“ä¸­çš„å¯¹è±¡çš„æ•°é‡ã€‚å¦‚æœåé¢è·Ÿç€æ˜Ÿå·ï¼ˆå¦‚*ï¼‰ï¼Œåˆ™æ•°æ®æ˜¯æŒ‡å¤åˆ¶çš„æ“ä½œã€‚ queryæ¯ç§’æŸ¥è¯¢æ“ä½œæ¬¡æ•°ã€‚ deleteæ¯ç§’åˆ é™¤æ“ä½œçš„æ•°é‡ã€‚ getmoreæ¯ç§’è·å¾—æ›´å¤šï¼ˆå³æ¸¸æ ‡æ‰¹æ¬¡ï¼‰æ“ä½œçš„æ¬¡æ•°ã€‚getmoreé€šå¸¸å‘ç”Ÿåœ¨ç»“æœé›†æ¯”è¾ƒå¤§çš„æŸ¥è¯¢æ—¶ï¼Œç¬¬ä¸€ä¸ªqueryè¿”å›äº†éƒ¨åˆ†ç»“æœï¼Œåç»­çš„ç»“æœæ˜¯é€šè¿‡getmoreæ¥è·å–çš„ã€‚ commandæ¯”å¦‚æ‰¹é‡æ’å…¥ï¼Œåªè®¤ä¸ºæ˜¯ä¸€æ¡å‘½ä»¤ã€‚æ¯ç§’å‘½ä»¤çš„æ•°é‡ã€‚å¦‚æœæ˜¯slaveç”±ç®¡é“å­—ç¬¦ï¼ˆä¾‹å¦‚|ï¼‰ åˆ†éš”çš„ä¸¤ä¸ªå€¼local|replicatedã€‚ flusheså¯¹äºWiredTigerå­˜å‚¨å¼•æ“ï¼ŒflushesæŒ‡çš„æ˜¯åœ¨æ¯ä¸ªè½®è¯¢é—´éš”ä¹‹é—´è§¦å‘çš„WiredTigeræ£€æŸ¥ç‚¹çš„æ•°é‡ã€‚å¯¹äºMMAPv1å­˜å‚¨å¼•æ“ï¼Œflushesè¡¨ç¤ºæ¯ç§’fsyncæ“ä½œçš„æ•°é‡ ã€‚ä¸€èˆ¬éƒ½æ˜¯0ï¼Œæˆ–è€…1ï¼Œé€šè¿‡è®¡ç®—ä¸¤ä¸ª1ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼Œå¯ä»¥å¤§è‡´äº†è§£å¤šé•¿æ—¶é—´flushä¸€æ¬¡ã€‚ dirtyå¸¦æœ‰è„å­—èŠ‚çš„WiredTigerç¼“å­˜çš„ç™¾åˆ†æ¯” usedæ­£åœ¨ä½¿ç”¨çš„WiredTigerç¼“å­˜çš„ç™¾åˆ†æ¯” mappedä»¥å…†å­—èŠ‚æ˜ å°„çš„æ•°æ®æ€»é‡ã€‚ vsizeè¿›ç¨‹ä½¿ç”¨çš„ä»¥å…†å­—èŠ‚ä¸ºå•ä½çš„è™šæ‹Ÿå†…å­˜é‡ã€‚ non-mappedä¸åŒ…æ‹¬æ‰€æœ‰æ˜ å°„å†…å­˜çš„è™šæ‹Ÿå†…å­˜æ€»é‡ã€‚mongostatåªæœ‰åœ¨ä½¿ç”¨è¯¥â€“allé€‰é¡¹å¯åŠ¨æ—¶æ‰ä¼šè¿”å›æ­¤å€¼ ã€‚ resè¿›ç¨‹ä½¿ç”¨çš„é©»ç•™å†…å­˜é‡ï¼ˆä»¥å…†å­—èŠ‚ä¸ºå•ä½ï¼‰è¯´æ˜ï¼šmapped, vsizeï¼Œreså’Œtopçœ‹åˆ°çš„ç›¸åŒï¼Œmapped, vsizeä¸€èˆ¬ä¸ä¼šæœ‰å¤§çš„å˜åŠ¨ faultsæ¯ç§’çš„é¡µé¢é”™è¯¯æ¬¡æ•°ã€‚ lrå¿…é¡»ç­‰å¾…è¯»å–é”å®šé‡‡é›†çš„ç™¾åˆ†æ¯”ã€‚mongostatæ˜¾ç¤ºlr|lw é”å®šé‡‡é›†æ˜¯å¦ç­‰å¾…ã€‚ lwå¿…é¡»ç­‰å¾…å†™é”å®šæ”¶è´­çš„ç™¾åˆ†æ¯”ã€‚ lrtå¹³å‡è·å–æ—¶é—´ï¼ˆä»¥å¾®ç§’ä¸ºå•ä½ï¼‰ç­‰å¾…è¯»å–é”å®šé‡‡é›†ã€‚ mongostatæ˜¾ç¤ºlrt|lwté”å®šé‡‡é›†æ˜¯å¦ç­‰å¾…ã€‚ lwtå¹³å‡è·å–æ—¶é—´ï¼Œä»¥å¾®ç§’ä¸ºå•ä½ï¼Œç­‰å¾…å†™å…¥é”å®šé‡‡é›†ã€‚ idx missç´¢å¼•è®¿é—®å°è¯•çš„ç™¾åˆ†æ¯”ï¼Œè¦æ±‚é¡µé¢é”™è¯¯åŠ è½½btreeèŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ªæŠ½æ ·å€¼ã€‚ qrç­‰å¾…ä»MongoDBå®ä¾‹è¯»å–æ•°æ®çš„å®¢æˆ·ç«¯é˜Ÿåˆ—çš„é•¿åº¦ã€‚ qwç­‰å¾…ä»MongoDBå®ä¾‹å†™å…¥æ•°æ®çš„å®¢æˆ·ç«¯é˜Ÿåˆ—çš„é•¿åº¦ã€‚ aræ‰§è¡Œè¯»å–æ“ä½œçš„æ´»åŠ¨å®¢æˆ·ç«¯çš„æ•°é‡ã€‚ awæ‰§è¡Œå†™å…¥æ“ä½œçš„æ´»åŠ¨å®¢æˆ·ç«¯çš„æ•°é‡ã€‚ netInMongoDBå®ä¾‹æ”¶åˆ°çš„ç½‘ç»œæµé‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚è¿™åŒ…æ‹¬æ¥è‡ªmongostatå®ƒè‡ªå·±çš„æµé‡ã€‚ netOutMongoDBå®ä¾‹å‘é€çš„ç½‘ç»œæµé‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚è¿™åŒ…æ‹¬æ¥è‡ªmongostatå®ƒè‡ªå·±çš„æµé‡ã€‚ connæ‰“å¼€çš„è¿æ¥æ€»æ•°ã€‚ setå‰¯æœ¬é›†çš„åç§° replæˆå‘˜çš„å¤åˆ¶çŠ¶æ€ã€‚ value Type M master SEC secondary REC recovering UNK unknown SLV slave RTR mongos process (â€œrouterâ€) ARB arbiterï¼ˆä»²è£ï¼‰","link":"/2017/12/22/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7mongostat/"},{"title":"mongoDBç´¢å¼•ç®¡ç†","text":"ç´¢å¼•æ˜¯ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œä»¥ç®€å•çš„éå†å½¢å¼å­˜å‚¨é›†åˆæ•°æ®é›†çš„ä¸€å°éƒ¨åˆ†ã€‚ç´¢å¼•å­˜å‚¨ç‰¹å®šå­—æ®µæˆ–å­—æ®µé›†åˆçš„å€¼ï¼ŒæŒ‰å­—æ®µçš„å€¼æ’åºã€‚ç´¢å¼•æ¡ç›®çš„æ’åºæ”¯æŒé«˜æ•ˆçš„ç›¸ç­‰åŒ¹é…å’ŒåŸºäºèŒƒå›´çš„æŸ¥è¯¢æ“ä½œã€‚å¦å¤–ï¼ŒMongoDBå¯ä»¥ä½¿ç”¨ç´¢å¼•ä¸­çš„æ’åºæ¥è¿”å›æ’åºç»“æœã€‚ ç´¢å¼•åˆ›å»ºè‡ª3.0.0ç‰ˆä»¥æ¥ä¸æ¨èä½¿ç”¨db.collection.ensureIndexï¼ˆé”®ï¼Œé€‰é¡¹ï¼‰åˆ›å»ºç´¢å¼• mongoDBç´¢å¼•ç±»å‹å•å­—æ®µç´¢å¼•MongoDBé»˜è®¤åˆ›å»ºçš„_idç´¢å¼•ä¹Ÿæ˜¯è¿™ç§ç±»å‹ã€‚ 1db.collection.createIndexes(&quot;age&quot;:1) {age: 1} ä»£è¡¨å‡åºç´¢å¼•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡{age: -1}æ¥æŒ‡å®šé™åºç´¢å¼•ï¼Œå¯¹äºå•å­—æ®µç´¢å¼•ï¼Œå‡åº/é™åºæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ å¤åˆç´¢å¼•é’ˆå¯¹å¤šä¸ªå­—æ®µè”åˆåˆ›å»ºç´¢å¼•ï¼Œå…ˆæŒ‰ç¬¬ä¸€ä¸ªå­—æ®µæ’åºï¼Œç¬¬ä¸€ä¸ªå­—æ®µç›¸åŒçš„æ–‡æ¡£æŒ‰ç¬¬äºŒä¸ªå­—æ®µæ’åºï¼Œä¾æ¬¡ç±»æ¨ã€‚ 1db.collection.createIndex( {age: 1, name: 1} ) å¤åˆç´¢å¼•ä¹Ÿèƒ½åŒ¹é…å¤åˆç´¢å¼•å‰ç¼€çš„æŸ¥è¯¢ï¼Œå¦‚æŒ‰ageè¿›è¡Œçš„æŸ¥è¯¢ï¼Œä¹Ÿèƒ½é€šè¿‡è¯¥ç´¢å¼•æ¥åŠ é€Ÿã€‚è‹¥å¦‚æœæŒ‰nameæŸ¥è¯¢ï¼Œåˆ™æ— æ³•ä½¿ç”¨è¯¥å¤åˆç´¢å¼•ã€‚ å¤škeyç´¢å¼• ï¼ˆMultikey Indexï¼‰MongoDBä½¿ç”¨å¤šé”®ç´¢å¼•æ¥ç´¢å¼•å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„å†…å®¹ã€‚å¦‚æœç´¢å¼•ä¸€ä¸ªåŒ…å«æ•°ç»„å€¼çš„å­—æ®µï¼ŒMongoDBå°†ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºå•ç‹¬çš„ç´¢å¼•æ¡ç›®ã€‚è¿™äº›å¤šé”®ç´¢å¼•å…è®¸æŸ¥è¯¢é€šè¿‡åŒ¹é…æ•°ç»„çš„å…ƒç´ æ¥é€‰æ‹©åŒ…å«æ•°ç»„çš„æ–‡æ¡£ã€‚å¦‚æœç´¢å¼•å­—æ®µåŒ…å«æ•°ç»„å€¼ï¼ŒMongoDBå°†è‡ªåŠ¨ç¡®å®šæ˜¯å¦åˆ›å»ºå¤šé”®ç´¢å¼•; ä¸éœ€è¦æ˜ç¡®æŒ‡å®šå¤šé”®ç±»å‹ã€‚å¯¹æ•°ç»„å­—æ®µå»ºç«‹ç´¢å¼• 1db.collection.createIndex( { ratings: 1 } ) å¯¹è±¡çš„æ•°ç»„å­—æ®µä¸Šåˆ›å»ºå¤šé”®ç´¢å¼• 1db.collection.createIndex( { &quot;stock.size&quot;: 1, &quot;stock.quantity&quot;: 1 } ) åœ°ç†ç©ºé—´ç´¢å¼•ä¸ºäº†æ”¯æŒåœ°ç†ç©ºé—´åæ ‡æ•°æ®çš„é«˜æ•ˆæŸ¥è¯¢ï¼ŒMongoDBæä¾›äº†ä¸¤ä¸ªç‰¹æ®Šç´¢å¼•ï¼šè¿”å›ç»“æœæ—¶ä½¿ç”¨å¹³é¢å‡ ä½•çš„ 2d indexeså’Œä½¿ç”¨çƒé¢å‡ ä½•è¿”å›ç»“æœçš„2dsphere indexesã€‚ åˆ›å»º2dsphereç´¢å¼• 1db.collection.createIndex( { &lt;location field&gt; : &quot;2dsphere&quot; } ) æ–‡æœ¬ç´¢å¼•MongoDBæä¾›äº†æ–‡æœ¬ç´¢å¼•æ¥æ”¯æŒå­—ç¬¦ä¸²å†…å®¹çš„æ–‡æœ¬æœç´¢æŸ¥è¯¢ã€‚textç´¢å¼•å¯ä»¥åŒ…å«ä»»ä½•å­—æ®µï¼Œå…¶å€¼æ˜¯å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²å…ƒç´ çš„æ•°ç»„ã€‚ 1db.collection.createIndex( { comments: &quot;text&quot; } ) è¯¥å­—æ®µ+â€textâ€åœ¨ç´¢å¼•æ–‡æ¡£ä¸­æŒ‡å®šå­—ç¬¦ä¸²æ–‡å­—. ç´¢å¼•å±æ€§å”¯ä¸€ç´¢å¼• (unique index)ä¿è¯ç´¢å¼•å¯¹åº”çš„å­—æ®µä¸ä¼šå‡ºç°ç›¸åŒçš„å€¼ï¼Œæ¯”å¦‚_idç´¢å¼•å°±æ˜¯å”¯ä¸€ç´¢å¼•ã€‚ 12db.collection.createIndex( { &quot;user_id&quot;: 1 }, { unique: true } )db.collection.createIndex( { age: 1, name: 1}, { unique: true } ) éƒ¨åˆ†ç´¢å¼• (partial index)åªé’ˆå¯¹ç¬¦åˆæŸä¸ªç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£å»ºç«‹ç´¢å¼•ï¼Œï¼ˆä»…ç´¢å¼•ç¬¦åˆæŒ‡å®šè¿‡æ»¤å™¨è¡¨è¾¾å¼çš„é›†åˆä¸­çš„æ–‡æ¡£ã€‚ï¼‰éœ€è¦ç”¨partialFilterExpressionæŒ‡å®šã€‚ 1234db.collection.createIndex( { name: 1 }, { partialFilterExpression: { age: { $gt: 5 } } }) ç¨€ç–ç´¢å¼•(sparse index)åªé’ˆå¯¹å­˜åœ¨ç´¢å¼•å­—æ®µçš„æ–‡æ¡£å»ºç«‹ç´¢å¼•ã€‚ç”¨sparseï¼štrueæŒ‡å®šä¸ºç¨€ç–ç´¢å¼•ã€‚ 1db.collection.createIndex( { score: 1 } , { sparse: true } ) TTLç´¢å¼•TTLç´¢å¼•ï¼ŒMongoDBå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨ä»é›†åˆä¸­ç§»é™¤æ–‡æ¡£ã€‚ç”¨expireAfterSeconds æŒ‡å®šè¿‡æœŸæ—¶é—´ã€‚ 1db.collection.createIndex( { &quot;createdAt&quot;: 1 }, { expireAfterSeconds: 3600 } ) å…¶å®ƒï¼šå¦‚åœ¨å·²æœ‰è¾ƒå¤šæ•°æ®çš„é›†åˆä¸Šåˆ›å»ºç´¢å¼•ï¼Œå¯èƒ½ä¼šèŠ±è¾ƒé•¿æ—¶é—´ï¼Œå¯ä»¥ç”¨backgroundé€‰é¡¹ï¼Œè¿›è¡Œåå°åˆ›å»ºã€‚ 1$ db.collection.createIndex( { name: 1}, {background: true} ) åˆ é™¤ç´¢å¼• åˆ é™¤é›†åˆä¸Šçš„æŒ‡å®šç´¢å¼•ã€‚12db.collection.dropIndex(&quot;name_age&quot;) //name_ageä¸ºç´¢å¼•åç§°db.collection.dropIndex({age:1,name:1}) åˆ é™¤é›†åˆä¸Šæ‰€æœ‰ç´¢å¼•ã€‚1db.collection.dropIndexes() #æŸ¥çœ‹ç´¢å¼• æŸ¥çœ‹è¯¥é›†åˆä¸Šæ‰€æœ‰ç´¢å¼•1db.collection.getIndexes()","link":"/2017/12/28/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86/"},{"title":"mongodbèšåˆç»Ÿè®¡ä¸€","text":"mongodbèšåˆç»Ÿè®¡å†™äº†å¿˜ï¼Œå¿˜äº†å†™ï¼Œé‚åšè®°å½•ï¼Œä»¥å¤‡æŸ¥çœ‹ã€‚ æ•°æ®ä¿¡æ¯å¦‚ä¸‹ï¼š è¦æ±‚ï¼šæŒ‰æœºæ„Idï¼Œåˆ†ç»„ç»Ÿè®¡å„æœºæ„çš„èŒä¸šæ•°å’ŒèŒä¸šç­‰çº§ä¸ªæ•°ã€‚ æ³¨æ„ï¼šèŒä¸šç­‰çº§ï¼ˆtestLevelsï¼‰å­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦ç»Ÿè®¡å‡ºæ•°ç»„ä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼Œå³ä¸‹é¢ä¸­projectä¸­çš„&quot;occuLevelCnt&quot; : { &quot;$size&quot; : [&quot;$testLevels&quot;] }è¯­å¥ï¼Œåº”è¯¥é€šè¿‡$unwindä¹Ÿå¯ä»¥å®ç°ã€‚ mongodbèšåˆ 1234567891011121314151617181920212223242526272829303132[{ $match: { unitId: { &quot;$in&quot;: [1,2,3] } }}, { $project: { occupationId: 1, occupationTitle: 1, unitId: 1, occuLevelCnt: { $size: &quot;$testLevels&quot; } }}, { $group: { _id: &quot;$unitId&quot;, occupationCnt: { $sum: 1 }, occuLevelCnt: { $sum: &quot;$occuLevelCnt&quot; } }}, { $project: { unitId: &quot;$_id&quot;, occupationCnt: 1, occuLevelCnt: 1 }}] ç»“æœï¼š Javaä¸­ 1234567TypedAggregation&lt;IrTestRange&gt; occuAggregation = Aggregation.newAggregation(IrTestRange.class, Aggregation.match(Criteria.where(\"unitId\").in(testUnitIds)), Aggregation.project(\"unitId\",\"occupationId\").and(\"testLevels\").size().as(\"occuLevelCnt\"), Aggregation.group(\"unitId\").count().as(\"occupationCnt\").sum(\"occuLevelCnt\").as(\"occuLevelCnt\"), Aggregation.project(\"occupationCnt\", \"occuLevelCnt\").and(Aggregation.previousOperation()).as(\"unitId\"));List&lt;OmTestUnitOccuStatDto&gt; testUnitOccuStat = mongoDao.aggregate(occuAggregation, OmTestUnitOccuStatDto.class);rd.getData().put(\"testUnitOccuStat\", testUnitOccuStat);","link":"/2019/09/14/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E8%81%9A%E5%90%881/"},{"title":"PowerDesignerç”Ÿæˆæ•°æ®å­—å…¸","text":"PowerDesignerè¿æ¥mysqlæ•°æ®åº“ï¼Œç”Ÿæˆæ•°æ®å­—å…¸ã€‚ è½¯ä»¶ç‰ˆæœ¬ 1.æ‰“å¼€PowerDesignerï¼Œé€‰æ‹©èœå•ï¼šFile â€”&gt; Reverse Engineer â€”&gt; Databaseâ€¦ 2.ç”Ÿæˆæ•°æ®å­—å…¸æŠ¥å‘Š ç‚¹å‡»PDMæ¨¡å‹é¡¹ç›®â€“&gt;Newâ€“&gt;Report é€‰æ‹©Tableâ€“&gt;List of Table Columns (å…ˆæŠŠtableåŠ åˆ°å³è¾¹ï¼Œç„¶åå°†å…¶ä»–æ— ç”¨çš„åˆ æ‰ï¼Œåªç•™ä¸‹Table Card å’ŒList of table columns)ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚ åŒå‡»è®¾ç½®è¡¨å¤´çš„åå­—: åœ¨é€‰å®šçš„æ¡ç›®ä¸Šå³é”®ï¼Œé€‰æ‹©SelectionæŠŠä½ æ•°æ®å­—å…¸éœ€è¦çš„æ•°æ®å‹¾ä¸Š é€‰æ‹©Layout,è®¾ç½®æ˜¾ç¤ºæ ¼å¼ ç”Ÿæˆæ•°æ®å­—å…¸æŠ¥å‘Šã€‚ ç”Ÿæˆçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š","link":"/2018/10/12/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/PowerDesigner%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/"},{"title":"mysqlæœåŠ¡å®‰è£…","text":"ç³»ç»Ÿç¯å¢ƒ Ubuntu 16.04 MySQL ç‰ˆæœ¬ï¼š5.7 å®‰è£…æ–¹å¼ï¼šaptå­˜å‚¨åº“ å®‰è£…1ã€æ›´æ–°APTå­˜å‚¨åº“åŒ…ä¿¡æ¯ 1$ sudo apt-get update 2ã€å®‰è£…MySQLæœåŠ¡ 1$ sudo apt-get install mysql-server è¿™æ ·å°†å®‰è£…MySQLæœåŠ¡å™¨çš„åŒ…ï¼Œä»¥åŠå®¢æˆ·ç«¯å’Œæ•°æ®åº“å…¬å…±æ–‡ä»¶çš„åŒ…ã€‚ åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šæç¤ºè¾“å…¥mysqlä¸­rootç”¨æˆ·çš„å¯†ç ã€‚ 3ã€æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ 1$ netstat â€“tap | grep mysql 4ã€æŸ¥çœ‹ç‰ˆæœ¬ 12$ mysql --versionmysql Ver 14.14 Distrib 5.7.24, for Linux (x86_64) using EditLine wrapper 5ã€è®¾ç½®æ•°æ®åº“ç¼–ç ä¸ºutf-8 (1) æŸ¥çœ‹æ•°æ®åº“å½“å‰ç¼–ç ï¼šSHOW VARIABLES LIKE &apos;character%&apos;; (2) ä¿®æ”¹ï¼š (5.7ç‰ˆæœ¬ï¼Œé»˜è®¤è·¯å¾„ä¸‹) : vim /etc/mysql/mysql.conf.d/mysqld.cnf åœ¨[mysqld] ä¸­æ·»åŠ  character_set_server=utf8 (5.7ä¹‹å‰ç‰ˆæœ¬ï¼Œé»˜è®¤è·¯å¾„ä¸‹) ï¼švim /etc/mysql/my.cnf [mysqld] character_set_server=utf8 [mysql] default-character-set = utf8 [client] default-character-set = utf8 12345678910111213141516171819 (3) é‡å¯MySQLæœåŠ¡ service mysql restart (4) æŸ¥çœ‹æ•°æ®åº“ç¼–ç  ![](https://ww1.sinaimg.cn/large/007iUjdily1fyap5qekdxj30eu07gwel.jpg)å®‰è£…å®Œæˆï¼#### ç®¡ç†1ã€æŸ¥çœ‹mysqlæœåŠ¡çŠ¶æ€```shell$ sudo service mysql status 2ã€å¯åŠ¨MySQLæœåŠ¡ 1$ sudo service mysql start 3ã€åœæ­¢MySQLæœåŠ¡ 1$ sudo service mysql stop 4ã€é‡å¯MySQLæœåŠ¡å™¨ 1$ sudo service mysql restart åŸºæœ¬ä½¿ç”¨1ã€ç™»å½•mysqlï¼šmysql â€“u root â€“p 2ã€é€€å‡ºmysqlï¼šquit;/exit; 3ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“ï¼šshow databases; 4ã€åˆ›å»ºæ•°æ®åº“testï¼šcreate database test; 5ã€æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„è¡¨ï¼šshow tables; 6ã€å»ºè¡¨ï¼š 12345create table student( -&gt; id int not null primary key, -&gt; name char(8), -&gt; age char(8),-&gt; birthday date ); 7ã€æ˜¾ç¤ºè¡¨ç»“æ„ï¼š desc è¡¨å; 8ã€æ’å…¥ï¼š 12$ insert into test set col_name=expression, col_name=expression, ... $ insert into test (col1,col2) VALUES(15,col1*2); 9ã€æ›´æ–°ï¼š 1$ UPDATE test SET price='20',type=0 WHERE id=2; 10ã€åˆ é™¤æ•°æ®åº“testï¼šdrop database test; 11ã€åˆ é™¤è¡¨ï¼šdrop table è¡¨å; 12ã€åˆ é™¤æ•°æ®ï¼šdelete from Myclass where id = 1; 13ã€æ•°æ®åº“æˆæƒç”¨æˆ· 12$ create database xxdb;$ grant all privileges on xxdb.* to xxuser@'%' identified by '123456'; 14ã€å¤‡ä»½é™¤information_schema|performance_schema|mysqlå¤–æ‰€æœ‰æ•°æ®åº“ 1$ mysql -e \"show databases;\" -u root -ppasswd |grep -Ev \"Database|information_schema|performance_schema|mysql|test\" |xargs mysqldump -u root -ppasswd --databases &gt; /ssddata/db_backup/mysql/2017-04-11/mysql_dump.sql 15ã€å¤‡ä»½å•ä¸ªæ•°æ®åº“ 1$ mysqldump -u root -p ssdb50 &gt; /opt/ssdb60.sql 16ã€å¯¼å…¥ 1$ source /opt/ssdb60 å‚è€ƒï¼šhttps://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/","link":"/2018/12/18/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85/"},{"title":"sqlpluså®‰è£…","text":"1ã€åœ¨oracelå®˜ç½‘ä¸‹è½½Instantclient-Basic-linux.x64-19.3.0.0.0dbru.zip ã€ Instantclient-sqlplus-linux.x64-19.3.0.0.0dbru.zip åˆ°åŒä¸€ä¸ªè·¯å¾„ä¸‹ï¼ˆ/opt/oracle/ï¼‰ 2ã€è§£å‹ä¸¤ä¸ªå‹ç¼©åŒ… 12$ unzip Instantclient-Basic-linux.x64-19.3.0.0.0dbru.zip$ unzip Instantclient-sqlplus-linux.x64-19.3.0.0.0dbru.zip 3ã€å®‰è£…æ“ä½œç³»ç»Ÿlibaio1è½¯ä»¶åŒ… 1$ apt-get install libaio1 4ã€åœ¨oracleè§£å‹ç›®å½•ä¸‹èƒ½çœ‹åˆ° instantclient_19_3æ‰¾åˆ°sqlplus è¿è¡Œã€‚ 5ã€æ‰§è¡Œsqlpluså‘½ä»¤å¯èƒ½å‡ºç°ä»¥ä¸‹é”™è¯¯ 12$ /opt/oracle/instantclient_19_3/sqlplus./sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory 6ã€è®¾ç½®ç¯å¢ƒå˜é‡ï¼švim /etc/profile åœ¨æ–‡ä»¶æœ€åæ·»åŠ  123export LD_LIBRARY_PATH=/opt/oracle/instantclient_19_3/:$LD_LIBRARY_PATHexport PATH=/opt/oracle/instantclient_19_3:$PATHexport NLS_LANG=\"american_america.zhs16gbk\" æœ€åæ›´æ–°ç¯å¢ƒå˜é‡ä½¿å…¶ç”Ÿæ•ˆ source /etc/profile 7ã€ç™»å½•æ•°æ®åº“ 1234567891011121314$ sqlplus SQL*Plus: Release 19.0.0.0.0 - Production on Wed Oct 23 16:12:24 2019Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle. All rights reserved.Enter user-name: userName/passwd@ip:port/serviceName #è¾“å…¥é“¾æ¥åœ°å€Connected to:Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsSQL&gt; å‚è€ƒï¼šLinux x86-64ï¼ˆ64ä½ï¼‰çš„å³æ—¶å®¢æˆ·ç«¯å®‰è£… SQLpluså®‰è£…ï¼ˆwindowsç‰ˆæœ¬ï¼‰ OracleæœåŠ¡å®‰è£…åsqlpluså‘½ä»¤æç¤ºé”™è¯¯ SQLPLUSä¸‹å‡ºç°æ˜¾ç¤ºé—®å·çš„é—®é¢˜","link":"/2019/10/23/%E6%95%B0%E6%8D%AE%E5%BA%93/oracle/sqlplus%E5%AE%89%E8%A3%85/"},{"title":"StringRedisTemplateä¸RedisTemplateçš„æ•°æ®æ“ä½œ","text":"StringRedisTemplateç»§æ‰¿è‡ªRedisTemplateã€‚ ä¸¤è€…æ•°æ®æ˜¯ä¸å…±é€šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´StringRedisTemplateåªèƒ½ç®¡ç†StringRedisTemplateé‡Œé¢çš„æ•°æ®ï¼ŒRedisTemplateåªèƒ½ç®¡ç†RedisTemplateä¸­çš„æ•°æ®ã€‚ å…¶å®ä»–ä»¬ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨äºä»–ä»¬ä½¿ç”¨çš„åºåˆ—åŒ–ç±»: RedisTemplateä½¿ç”¨çš„æ˜¯JdkSerializationRedisSerializer å­˜å…¥æ•°æ®ä¼šå°†æ•°æ®å…ˆåºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„ç„¶ååœ¨å­˜å…¥Redisæ•°æ®åº“ã€‚ StringRedisTemplateä½¿ç”¨çš„æ˜¯StringRedisSerializerã€‚ ä½¿ç”¨æ—¶æ³¨æ„äº‹é¡¹ å½“redisæ•°æ®åº“é‡Œé¢æœ¬æ¥å­˜çš„æ˜¯å­—ç¬¦ä¸²æ•°æ®æˆ–è€…è¦å­˜å–çš„æ•°æ®å°±æ˜¯å­—ç¬¦ä¸²ç±»å‹æ•°æ®çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨StringRedisTemplateå³å¯ã€‚ å¦‚æœæ•°æ®æ˜¯å¤æ‚çš„å¯¹è±¡ç±»å‹ï¼Œè€Œå–å‡ºçš„æ—¶å€™åˆä¸æƒ³åšä»»ä½•çš„æ•°æ®è½¬æ¢ï¼Œç›´æ¥ä»Redisé‡Œé¢å–å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆä½¿ç”¨RedisTemplateæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ RedisTemplateä½¿ç”¨æ—¶å¸¸è§é—®é¢˜ redisTemplate ä¸­å­˜å–æ•°æ®éƒ½æ˜¯å­—èŠ‚æ•°ç»„ã€‚å½“redisä¸­å­˜å…¥çš„æ•°æ®æ˜¯å¯è¯»å½¢å¼è€Œéå­—èŠ‚æ•°ç»„æ—¶ï¼Œä½¿ç”¨redisTemplateå–å€¼çš„æ—¶å€™ä¼šæ— æ³•è·å–å¯¼å‡ºæ•°æ®ï¼Œè·å¾—çš„å€¼ä¸ºnullã€‚å¯ä»¥ä½¿ç”¨ StringRedisTemplate è¯•è¯•ã€‚ å¸¸ç”¨æ“ä½œ","link":"/2019/10/25/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/StringRedisTemplate%E4%B8%8ERedisTemplate%E7%9A%84%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/"},{"title":"redisçš„å®‰è£…ã€å¼€æœºè‡ªå¯","text":"ä¸¤ç§å®‰è£…redisçš„æ–¹å¼ï¼šç¼–è¯‘å®‰è£…æˆ–aptå®‰è£… ç¼–è¯‘å®‰è£…1ã€ä¸‹è½½ç¼–è¯‘å®‰è£… 12345678$ cd /opt/redis #åˆ›å»ºå¹¶è¿›å…¥rediså‡†å¤‡ç›®å½•$ wget http://download.redis.io/releases/redis-4.0.1.tar.gz$ tar -zxvf redis-4.0.1.tar.gz # è§£å‹$ cd redis-4.0.1 #è¿›å…¥è§£å‹ç›®å½•$ make #ç¼–è¯‘,ç¼–è¯‘å®Œæˆåä¼šåœ¨srcç›®å½•ä¸‹ç”ŸæˆRedisæœåŠ¡ç«¯ç¨‹åºredis-serverå’Œå®¢æˆ·ç«¯ç¨‹åºredis-cli$ make install #å®‰è£…$ mkdir /etc/redis #åˆ›å»ºredisé…ç½®ç›®å½•$ cp /opt/redis/redis-4.0.1/redis.conf /etc/redis/ #æ‹·è´é…ç½®æ–‡ä»¶ ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆæš‚é»˜è®¤ï¼‰ä¿®æ”¹ç«¯å£ã€é…ç½®æ•°æ®åº“ä¿å­˜ç›®å½•ã€å…¶å®ƒ 2ã€å¯åŠ¨ï¼š 12$ redis-server /etc/redis/redis.conf # é€šè¿‡æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨$ redis-server &amp; # ä»¥åå°ç¨‹åºæ–¹å¼è¿è¡Œ 3ã€ç™»å½• 12$ redis-cli$ redis-cli -h 127.0.0.1 4ã€å…³é—­æœåŠ¡ 1$ redis-cli shutdown è®¾ç½®REDISå¼€æœºå¯åŠ¨1ã€ä¿®æ”¹/etc/redis/redis.conf 12daemonize yes #æ‰“å¼€åå°è¿è¡Œé€‰é¡¹logfile \"/var/log/redis/redis.log\" #è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ 2ã€ç¼–å†™è„šæœ¬ vim /etc/init.d/redis 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#!/bin/sh# chkconfig: 2345 10 90# description: Start and Stop redis### BEGIN INIT INFO# Provides: OSSEC HIDS# Required-Start: $network $remote_fs $syslog $time# Required-Stop:# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: OSSEC HIDS### END INIT INFOPATH=/usr/local/binREDISPORT=6379EXEC=/usr/local/bin/redis-serverREDIS_CLI=/usr/local/bin/redis-cliPIDFILE=/var/run/redis.pidCONF=\"/etc/redis/redis.conf\"case \"$1\" in start) if [ -f $PIDFILE ] then echo \"$PIDFILE exists, process is already running or crashed.\" else echo \"Starting Redis server...\" $EXEC $CONF fi if [ \"$?\"=\"0\" ] then echo \"Redis is running...\" fi ;; stop) if [ ! -f $PIDFILE ] then echo \"$PIDFILE exists, process is not running.\" else PID=$(cat $PIDFILE) echo \"Stopping...\" $REDIS_CLI -p $REDISPORT SHUTDOWN while [ -x $PIDFILE ] do echo \"Waiting for Redis to shutdown...\" sleep 1 done echo \"Redis stopped\" fi ;; restart|force-reload) ${0} stop ${0} start ;; *) echo \"Usage: /etc/init.d/redis {start|stop|restart|fore-reload}\" exit 1esac 3ã€æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™ 1$ sudo chmod +x /etc/init.d/redis 4ã€æ³¨å†Œä¸ºæœåŠ¡ï¼š 1$ sudo update-rc.d redis defaults 5ã€ ä½¿ç”¨è„šæœ¬ç®¡ç†æœåŠ¡ 1234$ service redis start #å¼€å¯redis$ service redis stop #åœæ­¢redis$ service redis restart #é‡å¯redis$ service redis status #æŸ¥çœ‹æœåŠ¡çŠ¶æ€ aptå®‰è£…12345$ sudo apt-get update #å‡çº§è½¯ä»¶ç®¡ç†æ¨¡å—$ sudo apt-get install redis-server #å®‰è£…RedisæœåŠ¡$ redis-server #å¯åŠ¨ Redis$ ps -ef | grep redis #æŸ¥çœ‹ redisè¿›ç¨‹$ netstat -an|grep 6379 #redisçš„é»˜è®¤ç«¯å£å·6379 å¯è¿ç½‘çŠ¶æ€ä¸‹ä¸€èˆ¬é€‰æ‹©aptè¿›è¡Œå®‰è£…ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚","link":"/2017/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E7%9A%84%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/"},{"title":"redisè®¾ç½®å¯†ç ç™»å½•","text":"ä¿®æ”¹é…ç½®æ–‡ä»¶vim /etc/redis.confrequirepass foobaredå»æ‰æ³¨é‡Šï¼Œfoobaredæ”¹ä¸ºè‡ªå·±çš„å¯†ç ï¼Œ 1requirepass 123456 ä¿å­˜ï¼Œé‡å¯æœåŠ¡ 1$ service redis-server restart æµ‹è¯•é“¾æ¥ 1234567$ redis-cli127.0.0.1:6379&gt; keys *(error) NOAUTH Authentication required.127.0.0.1:6379&gt; auth 123456OK127.0.0.1:6379&gt; keys * 1) \"ts_ea_6206\" æˆ–è€…è¿æ¥æ—¶éªŒè¯ 1$ redis-cli -a 123456","link":"/2017/12/22/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/"},{"title":"redisé›†ç¾¤éƒ¨ç½²","text":"redisé›†ç¾¤éƒ¨ç½² redisé›†ç¾¤è‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹ï¼ˆ3ä¸»3ä»ï¼‰ï¼Œä¹Ÿå°±éœ€è¦6ä¸ªå®ä¾‹ï¼Œå› èµ„æºæœ‰é™ï¼Œåªæœ‰3ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥åœ¨æ¯å°ä¸Šåˆ›å»º2ä¸ªèŠ‚ç‚¹ã€‚ 1ã€ä¸‹è½½ç¼–è¯‘å®‰è£…å®Œredisã€‚ 2ã€åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹æ–‡ä»¶å¤¹ 12$ mkdir -p /etc/redis/redis-cluster/6379$ mkdir -p /etc/redis/redis-cluster/6380 3ã€æ‹·è´é…ç½®æ–‡ä»¶åˆ°ç›¸åº”èŠ‚ç‚¹ç›®å½• 12$ cp /data/redis/redis-4.0.1/redis.conf /etc/redis/redis-cluster/6379$ cp /data/redis/redis-4.0.1/redis.conf /etc/redis/redis-cluster/6380 4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ 123456789bind 192.168.138.3port 6379 dir /etc/redis/redis-cluster/6380/logfile \"/var/log/redis/redis_6379.log\"daemonize yes # åå°è¿è¡Œcluster-enabled yes #å¯ç”¨é›†ç¾¤cluster-config-file /etc/redis/redis-cluster/6379/nodes_6379.conf # èŠ‚ç‚¹é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé›†ç¾¤åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºcluster-node-timeout 15000appendonly yes æ³¨æ„ä¿®æ”¹æ¯ä¸ªä¸»æœºä¸Šçš„ç›¸åº”èŠ‚ç‚¹çš„bindã€portã€‚ 5ã€å¯åŠ¨æ¯ä¸ªä¸»æœºä¸Šçš„2ä¸ªèŠ‚ç‚¹ 12$ redis-server /etc/redis/redis-cluster/6379/redis.conf$ redis-server /etc/redis/redis-cluster/6380/redis.conf 6ã€åˆ›å»ºé›†ç¾¤ ä½¿ç”¨ä¸Šé¢è¿™äº›å®ä¾‹æ¥åˆ›å»ºé›†ç¾¤ 1$ redis-cli --cluster create 192.168.138.2:6379 192.168.138.2:6380 192.168.138.3:6379 192.168.138.3:6380 192.168.138.4:6379 192.168.138.4:6380 --cluster-replicas 1 è¿™ä¸ªå‘½ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é›†ç¾¤, é€‰é¡¹â€“replicas 1 è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚ ä¹‹åè·Ÿç€çš„å…¶ä»–å‚æ•°åˆ™æ˜¯è¿™ä¸ªé›†ç¾¤å®ä¾‹çš„åœ°å€åˆ—è¡¨,3ä¸ªmaster3ä¸ªslave redis-trib ä¼šæ‰“å°å‡ºä¸€ä»½é¢„æƒ³ä¸­çš„é…ç½®ç»™ä½ çœ‹ï¼Œ å¦‚æœä½ è§‰å¾—æ²¡é—®é¢˜çš„è¯ï¼Œ å°±å¯ä»¥è¾“å…¥ yes ï¼Œ redis-cli å°±ä¼šå°†è¿™ä»½é…ç½®åº”ç”¨åˆ°é›†ç¾¤å½“ä¸­,è®©å„ä¸ªèŠ‚ç‚¹å¼€å§‹äº’ç›¸é€šè®¯,æœ€åå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š 1[OK] All 16384 slots covered. è¿™è¡¨ç¤ºé›†ç¾¤ä¸­çš„ 16384 ä¸ªæ§½éƒ½æœ‰è‡³å°‘ä¸€ä¸ªä¸»èŠ‚ç‚¹åœ¨å¤„ç†ï¼Œ é›†ç¾¤è¿ä½œæ­£å¸¸ã€‚ æ³¨æ„ï¼šredis5.0å¯ä»¥ä½¿ç”¨redis-cliæ¥åˆ›å»ºé›†ç¾¤ï¼Œä¸åœ¨éœ€è¦ä½¿ç”¨rubyè¯­è¨€çš„redis-trib.rbæ¥åˆ›å»ºäº†ã€‚ 7ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ 123$ redis-cli -c -h 192.168.138.3 -p 6379&gt; cluster info&gt; cluster nodes å…¶å®ƒï¼š rediså“¨å…µæ¨¡å¼ å‚è€ƒ å“¨å…µæ¨¡å¼å¯ä»¥ç›‘æ§ã€æ•…éšœè½¬ç§»ã€é…ç½®æä¾›è€…å’Œé€šçŸ¥ï¼Œå®ç°äº†redisçš„é«˜å¯ç”¨ã€‚ redisé›†ç¾¤æ¨¡å¼ ä¸»è¦ç”¨æ¥åšæ°´å¹³æ‰©å®¹ï¼Œæ‰©å¤§å‚¨å­˜å®¹é‡ï¼Œè§£å†³å®¹ç¾é—®é¢˜ã€‚Redis é›†ç¾¤ä¼šæŠŠæ•°æ®å‚¨å­˜åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œæµé‡åˆ†å‘ã€‚redisé›†ç¾¤æ¨¡å¼æˆ‘è®¤ä¸ºä¹Ÿå°±å…·æœ‰é«˜å¯ç”¨æ€§ã€‚ å‚è€ƒï¼šhttp://www.redis.cn/topics/cluster-tutorial.html","link":"/2018/11/06/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"},{"title":"ubuntuä¸‹ssrå®‰è£…","text":"Shadowsocks ä¸ Shadowsocksr åŒºåˆ«ï¼š SSæ˜¯åŸç‰ˆï¼ŒSSRæ˜¯åŸç‰ˆåŸºç¡€ä¸Šè¡ç”Ÿå‡ºæ¥çš„ç¬¬ä¸‰æ–¹ç‰ˆæœ¬ï¼Œå…¼å®¹åŸç‰ˆåè®®ï¼Œæ¯”åŸç‰ˆå¤šäº†ä¸€äº›ä¼ªè£…åŠŸèƒ½ï¼ˆåè®®å’Œæ··æ·†ï¼‰ã€‚ SSR ä¸»è¦ç‰¹ç‚¹æ˜¯å¢åŠ äº†ä¸€äº›äººæ€§åŒ–åŠŸèƒ½ï¼Œæ¯”å¦‚æœåŠ¡å™¨è¿æ¥ç»Ÿè®¡ã€è¿æ¥ç®¡ç†ã€åè®®è½¬æ¢ã€å¤šé‡ä»£ç†ç­‰ã€‚ 1ã€ä¸‹è½½ssrå®¢æˆ·ç«¯ 1$ git clone https://github.com/ssrbackup/shadowsocksr ç„¶åè¿è¡Œï¼š 1$ bash ~/shadowsocksr/initcfg.sh 2ã€é…ç½®ssæ–‡ä»¶åœ¨ä¸‹è½½çš„æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ° ssr é…ç½®æ–‡ä»¶ config.jsonï¼Œä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼ˆå…·ä½“çš„æœåŠ¡å™¨ï¼Œå¯†ç ï¼Œç«¯å£ä»SSå¸å·æä¾›å•†é‚£é‡Œè·å–ï¼‰ 123456\"server\": \"0.0.0.0\", //æœåŠ¡å™¨ ip åœ°å€\"server_port\":8388, //ç«¯å£\"password\":\"password\", //å¯†ç  \"protocol\":\"origin\", //åè®®æ’ä»¶ \"obfs\":\"http_simple\", //æ··æ·†æ’ä»¶ \"method\":\"aes-256-cfb\", //åŠ å¯†æ–¹å¼ 3ã€è¿è¡Œssr 1$ nohup python ~/shadowsocksr/shadowsocks/local.py -c ~/shadowsocksr/config.json &gt;nohup.log 2&gt;&amp;1 &amp; çœ‹è¾“å‡ºæ—¥å¿—æ˜¯å¦å¯åŠ¨æ­£å¸¸ã€‚ å¯èƒ½å‡ºç°ç¼ºå°‘libsodiumçš„é—®é¢˜ï¼š 123456789101112131415161718192021IPv6 supportTraceback (most recent call last): File \"server.py\", line 215, in &lt;module&gt; main() File \"server.py\", line 38, in main config = shell.get_config(False) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/shell.py\", line 299, in get_config check_config(config, is_local) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/shell.py\", line 129, in check_config encrypt.try_cipher(config['password'], config['method']) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/encrypt.py\", line 46, in try_cipher Encryptor(key, method) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/encrypt.py\", line 90, in __init__ random_string(self._method_info[1])) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/encrypt.py\", line 119, in get_cipher return m[2](method, key, iv, op) File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/crypto/sodium.py\", line 71, in __init__ load_libsodium() File \"/opt/shadowsocksr/shadowsocks/../shadowsocks/crypto/sodium.py\", line 42, in load_libsodium raise Exception('libsodium not found')Exception: libsodium not found è§£å†³ï¼š 12345$ apt-get install build-essential$ wget https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz$ tar -zxvf libsodium-1.0.10.tar.gz &amp;&amp; cd libsodium-1.0.10$ ./configure &amp;&amp; make -j2 &amp;&amp; make installldconfig å…·ä½“å¯ä»¥å‚è€ƒLinux å®‰è£… libsodium ç»„ä»¶ å®‰è£… å¯åŠ¨æ­£å¸¸åï¼Œæ£€æŸ¥ç«¯å£ï¼Œé»˜è®¤ç›‘å¬ç«¯å£1080 1234$ lsof -i:1080COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEpython 10448 root 3u IPv4 1030403 0t0 TCP localhost:socks (LISTEN)python 10448 root 4u IPv4 1030404 0t0 UDP localhost:socks 4ã€è½¬æ¢HTTPä»£ç†Shadowsocksé»˜è®¤æ˜¯ç”¨Socks5åè®®çš„ï¼Œå¯¹äºTerminalçš„get,wgetç­‰èµ°httpåè®®çš„åœ°æ–¹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢æˆhttpä»£ç†ï¼ŒåŠ å¼ºé€šç”¨æ€§ï¼Œè¿™é‡Œä½¿ç”¨çš„è½¬æ¢æ–¹æ³•æ˜¯åŸºäºPolipoçš„ã€‚ 12$ sudo apt-get install polipo # å®‰è£…Polipo$ sudo vim /etc/polipo/config # ä¿®æ”¹é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶ 123456789101112131415logSyslog = falselogFile = \"/var/log/polipo/polipo.log\"socksParentProxy = \"127.0.0.1:1080\"socksProxyType = socks5chunkHighMark = 50331648objectHighMark = 16384serverMaxSlots = 64serverSlots = 16serverSlots1 = 32proxyAddress = \"0.0.0.0\"proxyPort = 8123 é‡å¯Polipo: 1$ /etc/init.d/polipo restart éªŒè¯ä»£ç†æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š 12$ export http_proxy=\"http://127.0.0.1:8123/\"$ curl www.google.com å¦‚æœæ­£å¸¸ï¼Œå°±ä¼šè¿”å›æŠ“å–åˆ°çš„Googleç½‘é¡µå†…å®¹ã€‚æ­¤æ—¶ï¼Œç»ˆç«¯é‡Œé¢å¯ä»¥è®¿é—®å¤–ç½‘äº†ã€‚ å¦å¤–ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://127.0.0.1:8123/ä¾¿å¯ä»¥è¿›å…¥åˆ°Polipoçš„ä½¿ç”¨è¯´æ˜å’Œé…ç½®ç•Œé¢ã€‚ å…¶å®ƒé—®é¢˜ å‚è€ƒï¼šhttps://www.jianshu.com/p/a0f3268bfa33","link":"/2018/09/29/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/ubuntu%E4%B8%8Bssr%E5%AE%89%E8%A3%85/"},{"title":"ubuntu Serverç»ˆç«¯ä¸­æ–‡è±å½¢ä¹±ç ","text":"ubuntu Server å®‰è£…è¿‡ç¨‹ä¸­é€‰æ‹©çš„ä¸­æ–‡ï¼Œå®‰è£…å®Œæˆåï¼Œç³»ç»Ÿé»˜è®¤çš„è¯­è¨€å°†ä¼šæ˜¯ä¸­æ–‡zh_CN.UTF-8ã€‚ ä½†åœ¨ç»ˆç«¯ä¸‹æ— æ³•æ­£å¸¸çš„æ˜¾ç¤ºé»˜è®¤ä¸­æ–‡ç¼–ç zh_CN.UTF-8ã€‚ è§£å†³æ–¹æ³•ï¼š ç¬¬ä¸€ç§ã€*ä½¿ç”¨puttyã€securteCRTç­‰è™šæ‹Ÿç»ˆç«¯è½¯ä»¶ * ç›´æ¥ä¿®æ”¹è™šæ‹Ÿç»ˆç«¯ç•Œé¢é…ç½®é¡¹ç›®ä¸­çš„å­—ä½“ç¼–ç ä¸ºUTF-8å³å¯ ã€‚ä½†åœ¨å®é™…ç»ˆç«¯ä¸‹ï¼Œä»ç„¶æ— æ³•æ­£å¸¸æ˜¾ç¤º æ±‰å­—ã€‚ ç¬¬äºŒç§ã€æŠŠç³»ç»Ÿè½¬æˆè‹±æ–‡çš„ ä¿®æ”¹/etc/default/locale æ–‡ä»¶,å°†å†…å®¹æ”¹ä¸ºï¼š 12LANG=â€en_US.UTF-8â€³LANGUAGE=â€en_US:enâ€ å†è¿è¡Œï¼š 1$ sudo locale-gen -en_US:en ç„¶åé‡å¯ï¼Œä¼šæç¤ºæ˜¯å¦å°†æ–‡ä»¶å¤¹æ”¹æˆè‹±æ–‡çš„ï¼Œæ­¤æ—¶é€‰æ‹©â€œUpdateâ€¦â€å³å¯ ã€‚ ç¬¬ä¸‰ç§ã€å®‰è£…zhconè½¯ä»¶åŒ… 1$ sudo apt-get install zhcon","link":"/2018/08/23/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/ubuntuServer%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%96%87%E8%8F%B1%E5%BD%A2%E4%B9%B1%E7%A0%81/"},{"title":"SRSåˆ†å‘RTMPæµåŠHLSæµ","text":"SRSæ”¯æŒHLS/RTMPä¸¤ç§æˆç†Ÿè€Œä¸”å¹¿æ³›åº”ç”¨çš„æµåª’ä½“åˆ†å‘æ–¹å¼ã€‚ RTMPæŒ‡Adobeçš„RTMP(Realtime Message Protocol)ï¼Œå¹¿æ³›åº”ç”¨äºä½å»¶æ—¶ç›´æ’­ï¼Œä¹Ÿæ˜¯ç¼–ç å™¨å’ŒæœåŠ¡å™¨å¯¹æ¥çš„å®é™…æ ‡å‡†åè®®ï¼Œåœ¨PCï¼ˆFlashï¼‰ä¸Šæœ‰æœ€ä½³è§‚çœ‹ä½“éªŒå’Œæœ€ä½³ç¨³å®šæ€§ã€‚ å®æ—¶æ€§é«˜ï¼Œå®æ—¶æ€§åœ¨3ç§’ä¹‹å†…ã€‚ ç¨³å®šæ€§é«˜ã€‚ æ”¯æŒåŠ å¯†ã€‚ã€‚ã€‚ã€‚ HLSæŒ‡Appleçš„HLS(Http Live Streaming)ï¼Œæœ¬èº«å°±æ˜¯Liveï¼ˆç›´æ’­ï¼‰çš„ï¼Œä¸è¿‡Vodï¼ˆç‚¹æ’­ï¼‰ä¹Ÿèƒ½æ”¯æŒã€‚HLSæ˜¯Appleå¹³å°çš„æ ‡å‡†æµåª’ä½“åè®®ï¼Œå’ŒRTMPåœ¨PCä¸Šä¸€æ ·æ”¯æŒå¾—å¤©è¡£æ— ç¼ï¼Œç‚¹æ’­ä»¥HLSä¸ºä¸»ã€‚ è·¨å¹³å°ï¼Œèƒ½è·¨PC/Android/IOSã€‚ å®æ—¶æ€§å·®ï¼Œå»¶è¿Ÿåœ¨10ç§’ä»¥ä¸Šã€‚ æ€§èƒ½é«˜ã€‚ã€‚ã€‚ã€‚HLSå’ŒRTMPä¸¤ç§åˆ†å‘æ–¹å¼ï¼Œå°±å¯ä»¥æ”¯æŒæ‰€æœ‰çš„ç»ˆç«¯ã€‚ 1ã€RTMPç›´æ’­ (1)ç¼–å†™SRSé…ç½®æ–‡ä»¶ vim conf/rtmp.conf 12345# conf/rtmp.conf listen 1935; max_connections 1000; vhost __defaultVhost__ { } (2)å¯åŠ¨SRS 1$ ./objs/srs -c conf/rtmp.conf (3)ä½¿ç”¨æ¨æµå·¥å…·æ¨æµ ä½¿ç”¨FFMPEGå‘½ä»¤æ¨æµï¼š 123456for((;;)); do \\ ./objs/ffmpeg/bin/ffmpeg -re -i ./doc/source.200kbps.768x320.flv \\ -vcodec copy -acodec copy \\ -f flv -y rtmp://192.168.1.36/live/livestream; \\ sleep 1; \\ done (4)è§‚çœ‹RTMPæµ RTMPæµåœ°å€ä¸ºï¼šrtmp://192.168.1.36/live/livestream ä½¿ç”¨VLCè§‚çœ‹æˆ–ä½¿ç”¨åœ¨çº¿SRSæ’­æ”¾å™¨æ’­æ”¾ï¼šsrs-player2ã€åº•å»¶æ—¶é…ç½® å‚è€ƒï¼šLowLatency (1)ç¼–è¾‘é…ç½®æ–‡ä»¶ vim conf/realtime.conf 123456789101112listen 1935;max_connections 1000;vhost __defaultVhost__ { gop_cache off; queue_length 10; min_latency on; mr { enabled off; } mw_latency 100; tcp_nodelay on;} (2)å¯åŠ¨SRS 1./objs/srs -c conf/realtime.conf (3)ä½¿ç”¨æ¨æµå·¥å…·æ¨æµ ä½¿ç”¨FFMPEGå‘½ä»¤æ¨æµï¼š 123456for((;;)); do \\ ./objs/ffmpeg/bin/ffmpeg -re -i ./doc/source.200kbps.768x320.flv \\ -vcodec copy -acodec copy \\ -f flv -y rtmp://192.168.1.36/live/livestream; \\ sleep 1; \\ done (4)è§‚çœ‹RTMPæµ RTMPæµåœ°å€ä¸ºï¼šrtmp://192.168.1.36/live/livestream æ³¨æ„ï¼šä¸è¦ä½¿ç”¨VLCè§‚çœ‹ï¼ŒVLCçš„å»¶è¿Ÿä¼šå¾ˆå¤§ã€‚3ã€åˆ†å‘hlsæµ å‚è€ƒï¼šHLSé…ç½® (1)å¯åŠ¨åˆ†å‘hlsï¼ˆm3u8/tsï¼‰çš„nginx 1./objs/nginx/sbin/nginx nginxå¯åŠ¨åå¯ä»¥è®¿é—®:nginx (2)ç¼–å†™SRSé…ç½®æ–‡ä»¶ vim conf/hls.conf 1234567891011121314listen 1935;max_connections 1000;daemon off;srs_log_tank console;vhost __defaultVhost__ { hls { enabled on; hls_fragment 10; hls_window 60; hls_path ./objs/nginx/html; hls_m3u8_file [app]/[stream].m3u8; hls_ts_file [app]/[stream]-[seq].ts; }} å¤‡æ³¨ï¼šhls_pathå¿…é¡»å­˜åœ¨ï¼Œsrsåªä¼šè‡ªåŠ¨åˆ›å»º${hls_path}ä¸‹çš„appçš„ç›®å½•ã€‚ å‚æ•°å«ä¹‰ï¼š enabledï¼šæ˜¯å¦å¼€å¯HLSã€‚ hls_fragmentï¼šç§’ï¼ŒæŒ‡å®štsåˆ‡ç‰‡çš„æœ€å°é•¿åº¦ã€‚ hls_windowï¼šä¿ç•™çš„tsæ–‡ä»¶çš„æ—¶é•¿ï¼Œè¶…è¿‡æ€»æ—¶é•¿åï¼Œä¸¢å¼ƒç¬¬ä¸€ä¸ªm3u8ä¸­çš„ç¬¬ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç›´åˆ°tsçš„æ€»æ—¶é•¿åœ¨è¿™ä¸ªé…ç½®é¡¹èŒƒå›´ä¹‹å†…ã€‚ hls_pathï¼šHLSçš„m3u8å’Œtsæ–‡ä»¶ä¿å­˜çš„è·¯å¾„ã€‚m3u8å’Œtsæ–‡ä»¶éƒ½ä¿å­˜åœ¨è¿™ä¸ªç›®å½•ä¸­ã€‚ hls_m3u8_file: HLSçš„m3u8æ–‡ä»¶åï¼ŒåŒ…å«å¯æ›¿æ¢çš„[vhost],[app]å’Œ[stream]å˜é‡. hls_ts_fileï¼šHLSçš„tsæ–‡ä»¶åï¼ŒåŒ…å«å¯æ›¿æ¢çš„ä¸€ç³»åˆ—å˜é‡ï¼Œå‚è€ƒå˜é‡ hls_entry_prefix: tsçš„base urlã€‚å¦‚ï¼šhttp://your-serverã€‚ hls_cleanupï¼šæ˜¯å¦åˆ é™¤è¿‡æœŸçš„tsåˆ‡ç‰‡ï¼Œä¸åœ¨hls_windowä¸­å°±æ˜¯è¿‡æœŸã€‚ hls_dispose: HLSæ¸…ç†çš„è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ã€‚ hls_wait_keyframe: æ˜¯å¦æŒ‰topåˆ‡ç‰‡ï¼Œå³ç­‰å¾…åˆ°å…³é”®å¸§åå¼€å§‹åˆ‡ç‰‡ã€‚ hls_nb_notify: ä»notifyæœåŠ¡å™¨è¯»å–æ•°æ®çš„é•¿åº¦ã€‚ on_hls: å½“åˆ‡ç‰‡ç”Ÿæˆæ—¶ï¼Œå›è°ƒè¿™ä¸ªurlï¼Œä½¿ç”¨POSTå›è°ƒã€‚ç”¨æ¥å’Œè‡ªå·±çš„ç³»ç»Ÿé›†æˆï¼Œè­¬å¦‚å®ç°åˆ‡ç‰‡ç§»åŠ¨ç­‰ã€‚ on_hls_notify: å½“åˆ‡ç‰‡ç”Ÿæˆæ—¶ï¼Œå›è°ƒè¿™ä¸ªurlï¼Œä½¿ç”¨GETå›è°ƒã€‚ (3)å¯åŠ¨SRS 1./objs/srs -c conf/hls.conf (4)ä½¿ç”¨æ¨æµå·¥å…·æ¨æµ ä½¿ç”¨FFMPEGå‘½ä»¤æ¨æµï¼š 123456for((;;)); do \\ ./objs/ffmpeg/bin/ffmpeg -re -i ./doc/source.200kbps.768x320.flv \\ -vcodec copy -acodec copy \\ -f flv -y rtmp://192.168.1.36/live/livestream; \\ sleep 1; \\ done æ³¨æ„ï¼šHLSéœ€è¦RTMPæµçš„ç¼–ç ä¸ºh.264+aac/mp3ï¼Œè‹¥ä¸ç¬¦åˆè¿™ä¸ªè¦æ±‚åˆ™éœ€è¦è½¬ç ã€‚å¦åˆ™ä¼šè‡ªåŠ¨ç¦ç”¨HLSã€‚å‚è€ƒï¼šHLSè½¬ç ã€ HLS+Transcode 5ã€è§‚çœ‹RTMPæµ RTMPæµåœ°å€ä¸ºï¼šrtmp://192.168.1.36/live/livestream å¯ä»¥ä½¿ç”¨VLCè§‚çœ‹æˆ–è€…ä½¿ç”¨åœ¨çº¿SRSæ’­æ”¾å™¨æ’­æ”¾srs_player 6ã€è§‚çœ‹HLSæµ HLSæµåœ°å€ä¸ºï¼š http://192.168.1.36/live/livestream.m3u8 å¯ä»¥ä½¿ç”¨VLCè§‚çœ‹æˆ–è€…ä½¿ç”¨åœ¨çº¿SRSæ’­æ”¾å™¨æ’­æ”¾jwplayer å…¶å®ƒï¼šRTMPä¸HLSçš„ä¼˜åŠ¿åŠåº”ç”¨åœºæ™¯å‚è€ƒï¼šSRS_HLSSRS_RTMPSRS_RTMP PK HLS","link":"/2018/03/21/%E6%B5%81%E5%AA%92%E4%BD%93/srs/SRS%E5%88%86%E5%8F%91RTMP%E6%B5%81%E5%8F%8AHLS%E6%B5%81/"},{"title":"ç»ˆç«¯ç™»å½•è¶…æ—¶è®¾ç½®","text":"ä¿®æ”¹/ect/profile 1export TMOUT=120 è¯´æ˜ï¼šTMOUTä»¥ç§’è®¡ç®—ï¼Œ120ä¸ºä¸¤åˆ†é’Ÿåé€€å‡ºã€‚ ä½¿è®¾ç½®ç”Ÿæ•ˆ 1source /etc/profile","link":"/2017/12/22/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/%E7%BB%88%E7%AB%AF%E7%99%BB%E5%BD%95%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE/"},{"title":"SRS-HTTP-FLVç‚¹æ’­FLVæµ","text":"SRSæ”¯æŒå°†RTMPæµè½¬å°è£…ä¸ºHTTP flvæµï¼Œå³åœ¨publishå‘å¸ƒRTMPæµæ—¶ï¼Œåœ¨SRSçš„httpæ¨¡å—ä¸­æŒ‚è½½ä¸€ä¸ªå¯¹åº”çš„httpåœ°å€ï¼ˆæ ¹æ®é…ç½®ï¼‰ï¼Œç”¨æˆ·åœ¨è®¿é—®è¿™ä¸ªhttp flvæ–‡ä»¶æ—¶ï¼Œä»rtmpæµè½¬å°è£…ä¸ºflvåˆ†å‘ç»™ç”¨æˆ·ã€‚æ‰€æœ‰çš„HTTP FLVæµéƒ½æ˜¯ä¸€ä¸ªHTTP FLVåœ°å€ï¼Œè­¬å¦‚ï¼šhttp://192.168.1.36:8080/live/livestream.flvä½†æ˜¯ï¼Œæµçš„å½¢å¼å´è‡³å°‘æœ‰ä¸‰ç§ï¼š1ã€FLVæ–‡ä»¶ï¼Œæ”¾ä¸€ä¸ªæ–‡ä»¶åˆ°nginxç›®å½•ï¼Œå¯ä»¥è®¿é—®ä¸‹è½½åœ¨æ’­æ”¾å™¨æ’­æ”¾ï¼Œè¿™æ˜¯HTTP FLVæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¸è¿›å¼ä¸‹è½½æµã€‚æ‰€è°“æ¸è¿›å¼ä¸‹è½½ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è§‚çœ‹æ—¶æ— æ³•ä»æœªä¸‹è½½çš„åœ°æ–¹å¼€å§‹çœ‹ã€‚2ã€FLVä¼ªæµã€‚ä¸€èˆ¬è¯´çš„HTTP FLVï¼Œå¦‚ï¼Œä¸€ä¸ª120åˆ†é’Ÿçš„ç”µå½±ï¼Œä½œä¸ºæ¸è¿›å¼æµæ’­æ”¾æ—¶ï¼Œç”¨æˆ·éœ€è¦ä»60åˆ†é’Ÿå¼€å§‹çœ‹ï¼Œå¦‚ä½•æ”¯æŒå‘¢ï¼Ÿå› ä¸ºnginxæ˜¯å½“åšæ–‡ä»¶ä¸‹è½½çš„ï¼Œæ— æ³•ç›´æ¥è·³è½¬åˆ°ç¬¬60åˆ†é’Ÿï¼ˆnginxä¹Ÿä¸çŸ¥é“60åˆ†é’Ÿå¯¹åº”çš„å­—èŠ‚åç§»æ˜¯å¤šå°‘å‘€ï¼‰ã€‚åæ¥æœ‰äººå°±æ”¯æŒè¿™ç§è·³ç€æ’­æ”¾ï¼Œé€šè¿‡æŒ‡å®šæ—¶é—´æœåŠ¡å™¨ä»æŒ‡å®šçš„ä½ç½®å¼€å§‹ç»™æµï¼Œè¿™ç§æ”¯æŒflv?start=ï¼Œï¼ˆnginxçš„flvæ¨¡å—ï¼‰ã€‚å°±æ˜¯http flvçš„ä¼ªæµï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ç‚¹æ’­æµã€‚3ã€FLVç›´æ’­æµã€‚æœ‰RTMPçš„æ‰€æœ‰ç‰¹å¾ï¼Œè­¬å¦‚é›†ç¾¤ã€ä½å»¶è¿Ÿã€çƒ­å¤‡ã€GOP cacheï¼Œè€Œä¸”æœ‰HTTPçš„ä¼˜åŠ¿ï¼Œè­¬å¦‚302ã€ç©¿å¢™ã€é€šç”¨ã€‚ 1ã€HTTP FLVç›´æ’­æµåˆ†å‘ HTTP FLV (1)ç¼–å†™SRSé…ç½®æ–‡ä»¶ vim conf/http.flv.live.conf 123456789101112131415# conf/http.flv.live.conflisten 1935;max_connections 1000;http_server { enabled on; listen 8080; dir ./objs/nginx/html;}vhost __defaultVhost__ { http_remux { enabled on; mount [vhost]/[app]/[stream].flv; hstrs on; }} (2)å¯åŠ¨SRS 1./objs/srs -c conf/http.flv.live.conf (3)ç”¨æ¨æµå·¥å…·è¿›è¡Œæ¨æµ ä½¿ç”¨FFMPEGå‘½ä»¤æ¨æµï¼š 123456for((;;)); do \\ ./objs/ffmpeg/bin/ffmpeg -re -i ./doc/source.200kbps.768x320.flv \\ -vcodec copy -acodec copy \\ -f flv -y rtmp://192.168.1.36/live/livestream; \\ sleep 1; \\ done (4)è§‚çœ‹RTMPæµ RTMPæµåœ°å€ä¸ºï¼šrtmp://192.168.1.170/live/livestream (5)è§‚çœ‹FLVæµ HTTP FLVæµåœ°å€ä¸ºï¼š http://192.168.1.170:8080/live/livestream.flv æ³¨æ„ï¼šåœ¨nginx/html/live/ä¸‹å¹¶æœªä¿å­˜livestream.flvæ–‡ä»¶ã€‚2ã€ç‚¹æ’­FLVæµ VOD FLVsrsä¸æ”¯æŒç‚¹æ’­ï¼Œåªæ”¯æŒç›´æ’­ï¼Œç‚¹æ’­å»ºè®®ç”¨httpåˆ†å‘ç‚¹æ’­FLVæµçš„ä¸»è¦æµç¨‹æ˜¯ï¼š æœåŠ¡å™¨å½•åˆ¶ç›´æ’­ä¸ºFLVæ–‡ä»¶ï¼Œæˆ–è€…ä¸Šä¼ FLVç‚¹æ’­æ–‡ä»¶èµ„æºï¼Œåˆ°SRSçš„HTTPæ ¹ç›®å½•ï¼šobjs/nginx/html HTTPæœåŠ¡å™¨å¿…é¡»è¦æ”¯æŒflvçš„start=offsetï¼Œè­¬å¦‚nginxçš„flvæ¨¡å—ï¼Œæˆ–è€…SRSçš„å®éªŒæ€§HTTPæœåŠ¡å™¨ã€‚ ä½¿ç”¨research/librtmp/objs/srs_flv_injecterå°†FLVçš„æ—¶é—´å’Œå¯¹äºçš„offsetï¼ˆæ–‡ä»¶åç§»é‡ï¼‰å†™å…¥FLVçš„metadataã€‚ æ’­æ”¾å™¨è¯·æ±‚FLVæ–‡ä»¶ï¼Œè­¬å¦‚ï¼šhttp://192.168.1.170:8080/sample.flv ç”¨æˆ·ç‚¹å‡»è¿›åº¦æ¡è¿›è¡ŒSEEKï¼Œè­¬å¦‚SEEKåˆ°300ç§’ã€‚ æ’­æ”¾å™¨æ ¹æ®injectçš„æ—¶é—´å’Œoffsetå¯¹åº”å…³ç³»æ‰¾å‡ºå‡†ç¡®çš„å…³é”®å¸§çš„offsetã€‚è­¬å¦‚ï¼š300ç§’åç§»æ˜¯6638860 æ ¹æ®offsetå‘èµ·æ–°è¯·æ±‚ï¼šhttp://192.168.1.170:8080/sample.flv?start=6638860 3ã€DVR å‚è€ƒ SRSæ”¯æŒå°†RTMPæµå½•åˆ¶æˆflvæ–‡ä»¶ã€‚ é…ç½®è¯´æ˜ 1234567891011listen 1935;max_connections 1000;vhost __defaultVhost__ { dvr { enabled on; dvr_path ./objs/nginx/html/[app]/[stream]/[2006]/[01]/[02]/[15].[04].[05].[999].flv; dvr_plan segment; dvr_duration 30; dvr_wait_keyframe on; }} dvr_plan å†³å®šä»€ä¹ˆæ—¶å€™å…³é—­flvæ–‡ä»¶ï¼Œæ‰“å¼€æ–°çš„flvæ–‡ä»¶ sessionï¼šæŒ‰ç…§sessionæ¥å…³é—­flvæ–‡ä»¶ï¼Œå³ç¼–ç å™¨åœæ­¢æ¨æµæ—¶å…³é—­flvï¼Œæ•´ä¸ªsessionå½•åˆ¶ä¸ºä¸€ä¸ªflvã€‚. segmentï¼šæŒ‰ç…§æ—¶é—´åˆ†æ®µå½•åˆ¶ï¼Œflvæ–‡ä»¶æ—¶é•¿é…ç½®ä¸ºdvr_durationå’Œdvr_wait_keyframeã€‚ time_jitter: æ—¶é—´æˆ³æŠ–åŠ¨ç®—æ³•ã€‚fullä½¿ç”¨å®Œå…¨çš„æ—¶é—´æˆ³çŸ«æ­£ï¼›zeroåªæ˜¯ä¿è¯ä»0å¼€å§‹ï¼›offä¸çŸ«æ­£æ—¶é—´æˆ³ã€‚ dvr_path: å½•åˆ¶çš„è·¯å¾„ã€‚4ã€HTTPå›è°ƒ HTTPCallbackäº‹ä»¶ï¼š on_connect å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šçš„vhostå’Œappæ—¶ã€‚ on_close å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œæˆ–è€…SRSä¸»åŠ¨å…³é—­è¿æ¥æ—¶ã€‚ on_publish å½“å®¢æˆ·ç«¯å‘å¸ƒæµæ—¶ï¼Œè­¬å¦‚flash/FMLEæ–¹å¼æ¨æµåˆ°æœåŠ¡å™¨ã€‚ on_unpublish å½“å®¢æˆ·ç«¯åœæ­¢å‘å¸ƒæµæ—¶ã€‚ on_play å½“å®¢æˆ·ç«¯å¼€å§‹æ’­æ”¾æµæ—¶ã€‚ on_stop å½“å®¢æˆ·ç«¯åœæ­¢æ’­æ”¾æ—¶ã€‚å¤‡æ³¨ï¼šåœæ­¢æ’­æ”¾å¯èƒ½ä¸ä¼šå…³é—­è¿æ¥ï¼Œè¿˜èƒ½å†ç»§ç»­æ’­æ”¾ã€‚ on_dvr å½“DVRå½•åˆ¶å…³é—­ä¸€ä¸ªflvæ–‡ä»¶æ—¶ã€‚è¯´æ˜ï¼š äº‹ä»¶ï¼šå‘ç”Ÿè¯¥äº‹ä»¶æ—¶ï¼Œå³å›è°ƒæŒ‡å®šçš„HTTPåœ°å€ã€‚ HTTPåœ°å€ï¼šå¯ä»¥æ”¯æŒå¤šä¸ªï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼ŒSRSä¼šä¾æ¬¡å›è°ƒè¿™äº›æ¥å£ã€‚ æ•°æ®ï¼šSRSå°†æ•°æ®POSTåˆ°HTTPæ¥å£ã€‚ è¿”å›å€¼ï¼šSRSè¦æ±‚HTTPæœåŠ¡å™¨è¿”å›HTTP200å¹¶ä¸”responseå†…å®¹ä¸ºæ•´æ•°é”™è¯¯ç ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼‰ï¼Œå…¶ä»–é”™è¯¯ç ä¼šæ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚","link":"/2018/03/20/%E6%B5%81%E5%AA%92%E4%BD%93/srs/SRS%E7%82%B9%E6%92%ADFLV%E6%B5%81/"},{"title":"SRSæµåª’ä½“æœåŠ¡å™¨","text":"å‰è¨€SRSæ”¯æŒHLS/RTMPä¸¤ç§æˆç†Ÿè€Œä¸”å¹¿æ³›åº”ç”¨çš„æµåª’ä½“åˆ†å‘æ–¹å¼ã€‚ ä¸€ã€ç¼–è¯‘å®‰è£…1ã€æºç ä¸‹è½½ 1$ git clone https://git.oschina.net/winlinvip/srs.oschina.git 2ã€åˆ‡æ¢åˆ†æ”¯ ç¨³å®šåº¦ 2.0release/1.0release &gt;&gt; develop. (1) æŸ¥çœ‹å½“å‰åˆ†æ”¯ 12$ cd /opt/srs.oschina$ git branch (2) æ”¹å˜åˆ°2.0åˆ†æ”¯ 1$ git pull &amp;&amp; git checkout 2.0release3ã€ç¼–è¯‘å®‰è£…ç¼–è¯‘å‚æ•°å«ä¹‰å‚è€ƒï¼šé…ç½®å‚æ•°è¯´æ˜ 12$ cd trunk/$ ./configure --prefix=/usr/local/srs --with-ssl --with-hls --with-hds --with-dvr --with-nginx --with-http-callback --with-http-server --with-stream-caster --with-http-api --with-ffmpeg --with-transcode --with-ingest --with-stat --with-librtmp --with-research --with-utest 4ã€ç¬¬ä¸‰æ–¹åº”ç”¨å¯åŠ¨ 123$ sudo ./objs/nginx/sbin/nginx # to start the nginx http server for hls$ ./objs/ffmpeg/bin/ffmpeg # is used for live stream transcoding$ python ./research/api-server/server.py 8085 # to start the api-server 5ã€SRSå¯åŠ¨ (1) ç›´æ¥å¯åŠ¨ 1$ cd srs/trunk &amp;&amp; ./etc/init.d/srs start (2) æ·»åŠ ä¸ºç³»ç»ŸæœåŠ¡ * å°†trunk/etc/init.d/srs æ–‡ä»¶ä¸­ ROOT=â€./â€œæ”¹ä¸ºå®é™…å®‰è£…ç›®å½•(é»˜è®¤/usr/local/srs)ã€‚ * é“¾æ¥å®‰è£…ç›®å½•çš„init.d/srsåˆ°/etc/init.d/srs 1$ sudo ln -sf /usr/local/srs/etc/init.d/srs /etc/init.d/srs â€‹ * æ·»åŠ åˆ°ç³»ç»ŸæœåŠ¡. 12$ sudo update-rc.d srs defaults # ubuntu$ sudo /sbin/chkconfig --add srs # centos 1å¯åŠ¨ï¼š$ /etc/init.d/srs start 6ã€SRS-APIå®‰è£…SRSçš„APIå³api-serverï¼ŒSRSå¯ä»¥è°ƒç”¨api-serveræä¾›çš„httpæ¥å£ï¼Œéœ€è¦æ‰“å¼€â€“with-http-callbackæ”¯æŒã€‚SRSä½¿ç”¨python(cherrypy)ç¼–å†™çš„server.pyï¼Œä¹Ÿç›´æ¥è¿è¡Œè„šæœ¬ã€‚APIæœåŠ¡å™¨ä¸»è¦æä¾›httpè°ƒç”¨æœåŠ¡ï¼Œæä¾›demoè¿è¡Œçš„é¡µé¢ï¼Œæ’­æ”¾å™¨å’Œç¼–ç å™¨è§†é¢‘ä¼šè®®ç­‰DEMOã€‚å¯åŠ¨åå¯ä»¥é€šè¿‡http://192.168.1.36:8085åœ°å€è§‚çœ‹ã€‚ (1)å®‰è£…api 1$ make install-api (2)å¯åŠ¨apiï¼š 12$ /usr/local/srs/etc/init.d/srs-api start` å³å¯ä»¥è§‚çœ‹demoçš„é¡µé¢ã€‚æ¨æµéœ€è¦è‡ªå·±æ‰‹åŠ¨æ¨æµã€‚ (3)æ³¨å†Œä¸ºç³»ç»ŸæœåŠ¡ 12$ sudo ln -sf /usr/local/srs/etc/init.d/srs-api /etc/init.d/srs-api$ sudo update-rc.d srs-api defaults å…¶å®ƒ1ã€ç¼–è¯‘è¿‡ç¨‹å¯èƒ½å‡ºç°çš„é—®é¢˜ 12sudo: python: command not foundssr build CherryPy-3.2.4 failed, ret=1 è§£å†³ï¼š 12345$ cp 3rdparty/CherryPy-3.2.4.zip ./objs/$ cd objs/$ rm -r CherryPy-3.2.4$ unzip CherryPy-3.2.4.zip$ rm CherryPy-3.2.4.zip ä¹‹åç»§ç»­ç¼–è¯‘å®‰è£…ã€‚2ã€srs-apiå¯åŠ¨æ—¶é—®é¢˜ 12345$ python ./research/api-server/server.py 8085 File &quot;server.py&quot;, line 44 print &quot;[%s][trace] %s&quot;%(date, msg) ^ SyntaxError: invalid syntax è§£å†³ï¼špythonç‰ˆæœ¬é—®é¢˜ å®‰è£…Python2.7ç‰ˆæœ¬ 1$ apt-get install python 3ã€cherrypyå®‰è£…é—®é¢˜ 12345$ python ./research/api-server/server.py 8085Traceback (most recent call last): File &quot;server.py&quot;, line 39, in &lt;module&gt; import os, json, time, datetime, cherrypy, threading, urllib2ImportError: No module named cherrypy è§£å†³ï¼šå®‰è£…CherryPy(å®˜ç½‘) 12$ python ./objs/CherryPy-3.2.4setup.py install$ python -c &quot;import cherrypy&quot; # éªŒè¯","link":"/2018/03/20/%E6%B5%81%E5%AA%92%E4%BD%93/srs/SRS%E6%B5%81%E5%AA%92%E4%BD%93%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"nginxæ­å»ºRTMPæµåª’ä½“æœåŠ¡å™¨","text":"1ã€ä¸‹è½½nginx-rtmp-modulenginx-rtmp-moduleçš„githubåœ°å€ï¼šhttps://github.com/arut/nginx-rtmp-module 1$ git clone https://github.com/arut/nginx-rtmp-module.git 2ã€ç¼–è¯‘nginx(å·²å®‰è£…åˆ™é‡æ–°ç¼–è¯‘)å¯å‚è€ƒnginxå®‰è£…ã€HTTPSä¹‹Letâ€™s Encryptè¯ä¹¦çš„nginxå¼€å¯SSLæ¨¡å— 123$ ./configure --prefix=/usr/local/nginx --add-module=../nginx-rtmp-module --with-http_ssl_module $ make$ make install # å·²å®‰è£…ä¸è¦æ‰§è¡Œæ­¤å¥ï¼Œå¦åˆ™å°†è¦†ç›–å®‰è£… ç‚¹æ’­è§†é¢‘æœåŠ¡å™¨å®Œæˆä¸Šè¿°nginxæœåŠ¡éƒ¨ç½²åï¼Œå°±å¯ä»¥å¼€å¯è§†é¢‘ç‚¹æ’­æœåŠ¡äº†ã€‚åœ¨nginx.confä¸­å¤©å‰‘RTMPé…ç½® 1234567891011121314151617181920212223242526272829303132333435363738worker_processes 1;events { worker_connections 1024;}rtmp { #rtmpæœåŠ¡ server { listen 1935; #æœåŠ¡ç«¯å£ chunk_size 4096; #æ•°æ®ä¼ è¾“å—çš„å¤§å° application vod { play /opt/video; #è§†é¢‘å­˜æ”¾ä½ç½® } }}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } åœ¨/opt/videoç›®å½•ä¸‹æ”¾ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ã€‚ 12root@ubuntu:/opt/video# lstest.mp4 ç„¶ååœ¨VLCä¸­æ‰“å¼€æ–‡ä»¶ä¸²æµï¼Œå¡«ä¸Šç‚¹æ’­çš„èŠ‚ç›®åœ°å€ rtmp://192.168.1.23/vod/test.mp4ï¼Œå°±å¯ä»¥æ’­æ”¾äº†ã€‚ ç›´æ’­è§†é¢‘æœåŠ¡å™¨æ·»åŠ ç›´æ’­æœåŠ¡å™¨çš„é…ç½®ã€‚ä¸€å…±æ·»åŠ ä¸¤ä¸ªä½ç½®ã€‚ç¬¬ä¸€å¤„å°±æ˜¯ç»™RTMPæœåŠ¡æ·»åŠ ä¸€ä¸ªapplication åå­—å¯ä»¥ä»»æ„èµ·ï¼Œä¹Ÿå¯ä»¥èµ·å¤šä¸ªåå­—ï¼Œç”±äºæ˜¯ç›´æ’­å°±å«åšå®ƒliveå§ï¼Œå¦‚æœæ‰“ç®—å¼„å¤šä¸ªé¢‘é“çš„ç›´æ’­å°±å¯ä»¥live_cctv1ã€live_cctv2åå­—ä»»æ„ã€‚ç¬¬äºŒå¤„å°±æ˜¯æ·»åŠ ä¸¤ä¸ªlocationå­—æ®µã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455worker_processes 1;events { worker_connections 1024;}rtmp { server { listen 1935; chunk_size 4096; application vod { play /opt; } application live { #ç›´æ’­ é¢‘é“ live on; } }}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /stat { #ç›´æ’­locationé…ç½® rtmp_stat all; rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { #ç›´æ’­locationé…ç½® root /opt/nginx/nginx-rtmp-module; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } }} æ·»åŠ å®Œåï¼Œé‡å¯nginxæœåŠ¡ã€‚æ‰“å¼€æµè§ˆå™¨ http://192.168.1.23/statå¦‚å›¾ï¼šè¯´æ˜é…ç½®ç”Ÿæ•ˆäº†ã€‚ä½¿ç”¨æ¨æµå·¥å…·OBSæˆ–è€…liteAvå‘ rtmp://192.168.1.23/live/test è¿›è¡Œæ¨æµå°±å¯ä»¥ä½¿ç”¨VLCæ’­æ”¾ï¼šrtmp://192.168.1.23/live/teståœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ¨æµæƒ…å†µ http://192.168.1.23/stat ã€‚ ç›´æ’­è§†é¢‘å®æ—¶å›çœ‹è§†é¢‘æœåŠ¡å™¨çš„é…ç½®æŠŠæ­£åœ¨ç›´æ’­çš„è§†é¢‘å½•åˆ¶åœ¨æœ¬åœ°ï¼Œå°±å¯ä»¥å›çœ‹ä¹‹å‰çš„è§†é¢‘äº†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071worker_processes 1;events { worker_connections 1024;}rtmp { server { listen 1935; chunk_size 4096; application vod { play /opt; } application live { live on; hls on; # è¿™ä¸ªå‚æ•°æŠŠç›´æ’­æœåŠ¡å™¨æ”¹é€ æˆå®æ—¶å›æ”¾æœåŠ¡å™¨ wait_key on; # ä½¿è§†é¢‘æµä»¥å…³é”®å¸§å¼€å§‹ hls_path /opt/hls; #åˆ‡ç‰‡è§†é¢‘æ–‡ä»¶å­˜æ”¾ä½ç½® hls_fragment 10s; #æ¯ä¸ªè§†é¢‘åˆ‡ç‰‡çš„æ—¶é•¿ hls_playlist_length 60s; #æ€»å…±å¯ä»¥å›çœ‹çš„äº‹ä»¶ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯1åˆ†é’Ÿ hls_continuous on; # è¿ç»­æ¨¡å¼ hls_cleanup on; #å¯¹å¤šä½™çš„åˆ‡ç‰‡è¿›è¡Œåˆ é™¤ hls_nested on; #åµŒå¥—æ¨¡å¼ } }}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /stat { rtmp_stat all; rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { root /opt/nginx/nginx-rtmp-module; } location /live { #è§†é¢‘å›çœ‹é…ç½® types { appplication/vnd.apple.mpegurl m3u8; video/mp2t ts; } alias /opt/hls; expires -1; add_header Cache-Control no-cache; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } }} é…ç½®å®Œåï¼Œé‡å¯nginxæœåŠ¡ï¼Œè¿™æ¬¡å‘nginxæ¨æµçš„ç›´æ’­è§†é¢‘ï¼Œä¼šå‘æœåŠ¡å™¨/opt/hlsç›®å½•å†™åˆ‡ç‰‡è§†é¢‘æ–‡ä»¶ 12root@ubuntu:/opt/hls/# ls0.ts 1.ts 2.ts 3.ts index.m3u8 æ’­æ”¾è§†é¢‘ http://192.168.1.23/live/index.m3u8 å…¶å®ƒ1ã€hlså¤šç ç‡å­˜å‚¨ç”¨æˆ·è®¾å¤‡çš„å°ºå¯¸ã€åˆ†è¾¨ç‡ã€ç½‘ç»œç¯å¢ƒã€å¸¦å®½ä¸åŒï¼Œå› è€Œéœ€è¦é’ˆå¯¹ä¸åŒçš„ç½‘ç»œç¯å¢ƒé‡‡ç”¨ä¸åŒçš„ç ç‡ã€‚ ä¸ƒç‰›å¤šç ç‡æ’­æ”¾hls_playlist_lengthå‚æ•° å‚è€ƒï¼šhttp://blog.csdn.net/kingroc/article/details/50839994 2ã€ç›´æ’­æƒé™æ§åˆ¶æƒé™æ§åˆ¶notifyå‚æ•° 3ã€è·å–è§‚çœ‹ç”¨æˆ·æ•°é‡ç”¨æˆ·æ•°é‡ rtmpå‚æ•°ï¼šhttps://github.com/arut/nginx-rtmp-module/wiki/Directiveshttp://blog.csdn.net/liwf616/article/details/77886991 4ã€ä¸€ä»½è¾ƒå®Œæ•´é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120user root;worker_processes 1;events { worker_connections 1024;}rtmp { #rtmpæœåŠ¡ server { listen 1935; #æœåŠ¡ç«¯å£ chunk_size 4096; #æ•°æ®ä¼ è¾“å—çš„å¤§å° application vod { ##æ’­æ”¾/optä¸‹è§†é¢‘ rtmp://192.168.1.23/vod/cq2014.mp4 play /opt; #è§†é¢‘å­˜æ”¾ä½ç½®(flv/mp4..) } application live { #ç›´æ’­ é¢‘é“ ##å‘æ­¤æ¨æµè¿›è¡Œåˆ‡ç‰‡ä¿å­˜ rtmp://192.168.1.23/live/XXX live on; hls on; # è¿™ä¸ªå‚æ•°æŠŠç›´æ’­æœåŠ¡å™¨æ”¹é€ æˆå®æ—¶å›æ”¾æœåŠ¡å™¨ wait_key on; # ä½¿è§†é¢‘æµä»¥å…³é”®å¸§å¼€å§‹ hls_path /opt/hls; #åˆ‡ç‰‡è§†é¢‘æ–‡ä»¶å­˜æ”¾ä½ç½® hls_fragment 10s; #æ¯ä¸ªè§†é¢‘åˆ‡ç‰‡çš„æ—¶é•¿ hls_playlist_length 1h; #æ€»å…±å¯ä»¥å›çœ‹çš„äº‹ä»¶ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯1åˆ†é’Ÿ hls_continuous on; # è¿ç»­æ¨¡å¼-HLSåºåˆ—ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®å¼€å§‹ hls_cleanup on; #å¯¹å¤šä½™çš„åˆ‡ç‰‡è¿›è¡Œåˆ é™¤ ä¸hls_playlist_lengthæœ‰å…³ hls_nested on; #åµŒå¥—æ¨¡å¼-ä¸ºæ¯ä¸ªæµåˆ›å»ºä¸€ä¸ªå­ç›®å½• # hls_base_url http://192.168.1.23/; # hls_fragment_naming system; #è®¾ç½®ç‰‡æ®µå‘½åæ¨¡å¼-æ ¹æ®ç³»ç»Ÿæ—¶é—´ # hls_type event; #åœ¨eventæ¨¡å¼ä¸‹ç¡®ä¿æ’­æ”¾åˆ—è¡¨é•¿åº¦è¶³å¤Ÿæ•´ä¸ªäº‹ä»¶ tsä¸åˆ é™¤ # hls_keys on; #å¯ç”¨HLSåŠ å¯† # hls_key_path /tmp/keys; #è®¾ç½®ä¿å­˜è‡ªåŠ¨ç”Ÿæˆçš„HLSå¯†é’¥çš„ç›®å½• # hls_key_url http://192.168.1.23/keys/; #è®¾ç½®HLSå¯†é’¥æ–‡ä»¶æ¡ç›®çš„URL # hls_fragments_per_key 10; #è®¾ç½®ç”¨åŒä¸€ä¸ªå¯†é’¥åŠ å¯†çš„HLSåˆ†æ®µçš„æ•°é‡ } application mytv { ##å‘æ­¤æ¨æµ flvæ ¼å¼ä¿å­˜ rtmp://192.168.1.23/live/XXX live on; record all; record_path /opt/video; #æŒ‡å®šå½•åˆ¶çš„flvæ–‡ä»¶çš„è®°å½•è·¯å¾„ record_suffix _recorded.flv; #è®¾ç½®è®°å½•æ–‡ä»¶åç¼€ # record_unique on; #å°†å½“å‰æ—¶é—´æˆ³æ·»åŠ åˆ°å½•åˆ¶æ–‡ä»¶ä¸­ record_max_size 10M; #è®¾ç½®æœ€å¤§è®°å½•æ–‡ä»¶å¤§å° # allow publish 192.168.1.101; #å…è®¸ä»æŒ‡å®šåœ°å€å‘å¸ƒ # deny play all; #æ‹’ç»æ‰€æœ‰åœ°å€æ’­æ”¾ # allow play all; } application big { # æ¥å—rtmpæ¨æµï¼Œä½¿ç”¨ffmpegé™ä½åˆ†è¾¨ç‡ä¸º32x32 å‘å¸ƒåˆ°smallåº”ç”¨ç¨‹åº live on; exec /usr/local/nginx/sbin/ffmpeg -re -i rtmp://192.168.1.23/$app/$name -vcodec flv -acodec copy -s 32x32 -f flv rtmp://192.168.1.23/small/${name}; } application small { live on; } application notify { live on; publish_notify on; on_publish http://baidu.com/on_publish.html; } } log_format new $remote_addr [$time_local] $command &quot;$app&quot; &quot;$name&quot; &quot;$args&quot; - $bytes_received $bytes_sent &quot;$pageurl&quot; &quot;$flashver&quot; ($session_readable_time); access_log logs/rtmp_access.log new; access_log logs/rtmp_access.log; # access_log off;}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { #video.jsæ’ä»¶æ’­æ”¾m3u8 é¦–é¡µ root html/hls; index index.html index.htm; } location /stat { #ç»Ÿè®¡é…ç½® http://192.168.1.23/stat rtmp_stat all; rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { #ç»Ÿè®¡é…ç½® root /opt/nginx/nginx-rtmp-module; } location /live { #è§†é¢‘å›çœ‹é…ç½® ä¸applicationçš„liveå¯¹åº” vlcç½‘ç»œä¸²æµæ’­æ”¾ http://192.168.1.23/live/XXX/index.m3u8 types { appplication/vnd.apple.mpegurl m3u8; video/mp2t ts; } alias /opt/hls; expires -1; add_header Cache-Control no-cache; } location /test { #video.jsæ’ä»¶æ’­æ”¾m3u8 ä¸applicationçš„liveå¯¹åº” http://192.168.1.23/test/index.m3u8 root /opt/hls; } location /keys { #å¯ç”¨HLSåŠ å¯†å å¯†é’¥è¯·æ±‚åœ°å€ root /tmp; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } }} å¼€æºæµåª’ä½“æœåŠ¡å™¨ç³»ç»Ÿ SRS:http://www.ossrs.net/srs.release/releases/","link":"/2018/03/07/%E6%B5%81%E5%AA%92%E4%BD%93/nginx/nginx%E6%90%AD%E5%BB%BARTMP%E6%B5%81%E5%AA%92%E4%BD%93%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"svnæœåŠ¡å®‰è£…ä¸ä½¿ç”¨","text":"svnæœåŠ¡ç«¯å®¢æˆ·ç«¯å®‰è£… ubuntu ï¼šapt-get install subvision åˆ›å»ºç‰ˆæœ¬åº“ï¼šsvnadmin crate /path/reposåˆ é™¤ç‰ˆæœ¬åº“ï¼šrm -rvf /path/repos svnç‰ˆæœ¬åº“çš„é…ç½®åŠæƒé™åˆ†ç»„é…ç½®æ–‡ä»¶ä½äº/path/repos/conf/ç›®å½•ä¸‹ authz â€“ é…ç½®ç”¨æˆ·ç»„ä»¥åŠç”¨æˆ·ç»„æƒé™ passwd â€“ é…ç½®ç”¨æˆ·åå’Œå¯†ç  svnsere.conf â€“ é…ç½®é»˜è®¤æƒé™ã€æƒé™é…ç½®æ–‡ä»¶åŠå¯†ç é…ç½®æ–‡ä»¶ å¯åŠ¨svnç‰ˆæœ¬åº“ï¼šsvnserve -d -r /path/repos/ é»˜è®¤ç«¯å£å·ï¼š3690 â€“listen-port æŒ‡å®šç«¯å£å·åœæ­¢ç‰ˆæœ¬åº“ï¼škillall svnservesvnç‰ˆæœ¬åº“æ£€å‡º ï¼šsvn checkout svn://192.168.0.130 -r 2 æ£€å‡ºç‰ˆæœ¬2 â€“username ç”¨æˆ·å â€“password å¯†ç  svnæœåŠ¡è‡ªå¯åŠ¨ä¸€ç§æ–¹å¼(/etc/rc.local) vim /etc/rc.local 1$ svnserve -d -r /path/repos/ å¦ä¸€ç§æ–¹å¼(/etc/init.d/) checkoutä¸exportåŒºåˆ« checkout-æ£€å‡º export-å¯¼å‡º-checkoutæ£€å‡ºçš„å·¥ä½œå‰¯æœ¬ä¸­å«.svnæ–‡ä»¶å¤¹-ç‰ˆæœ¬æ§åˆ¶ä¸­æœ‰ä¸€ç§æ–‡ä»¶çŠ¶æ€ï¼šæ— ç‰ˆæœ¬æ§åˆ¶ checkout =&gt; .svn + é¡¹ç›®æ–‡ä»¶ export =&gt; é¡¹ç›®æ–‡ä»¶ï¼ˆæ— ç‰ˆæœ¬æ§åˆ¶çŠ¶æ€ï¼‰ svn å®¢æˆ·ç«¯å‘½ä»¤ svn add -æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ svn add * â€“force svn commit - æäº¤ä¿®æ”¹åˆ°æœåŠ¡ç«¯ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬å·ï¼‰ svn commit -m â€œæ³¨é‡Šâ€ index.html svn update - æ›´æ–°å·¥ä½œå‰¯æœ¬ svn update * svn delete - ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• svn diff - ç‰ˆæœ¬å·®å¼‚æ¯”è¾ƒ svn diff index.html svn mkdir - åˆ›å»ºç›®å½•å¹¶æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ svn cat - ä¸æ£€å‡ºå·¥ä½œå‰¯æœ¬ä¹‹é—´æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶ svn cat svn://192.168.0.130/index.htmlå·¥ä½œå‰¯æœ¬è¿˜åŸ svn revert [â€“recursive][filename|*] svn å¤„ç†å†²çª svn resolve index.html æˆ–è€…ç›´æ¥ç¼–è¾‘index.htmlæ–‡ä»¶ svn resolved inde.html svn è§£é”ä¸é”å®š svn lock - é”å®šæ–‡ä»¶ï¼Œé˜²æ­¢å…¶ä»–æˆå‘˜å¯¹æ–‡ä»¶è¿›è¡Œæäº¤ svn unlock - è§£é”æ–‡ä»¶ svn list - åˆ—å‡ºå½“å‰ç›®å½•ä¸‹å¤„äºç‰ˆæœ¬æ§åˆ¶çš„æ‰€æœ‰æ–‡ä»¶ svn ls -v â€“recursive svn status -åˆ—å‡ºå·¥ä½œå‰¯æœ¬ä¸­çš„æ–‡ä»¶ï¼ˆå¤¹ï¼‰çš„çŠ¶æ€ çŠ¶æ€ï¼š ï¼Ÿ - æ— ç‰ˆæœ¬æ§åˆ¶ D - å·²è¢«æ ‡è®°ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤ M - å·²è¢«ç¼–è¾‘è¿‡ A - å·²è¢«æ ‡è®°å¢åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­ R - æ–‡ä»¶è¢«æ›¿æ¢ C - æ–‡ä»¶å­˜åœ¨å†²çª ï¼- æ–‡ä»¶ç¼ºå¤± svn log - æŸ¥çœ‹æäº¤æ—¥å¿—ï¼ˆæ¥è‡ªsvn commitçš„-m å‚æ•°ï¼‰ svn info - å·¥ä½œå‰¯æœ¬åŠæ–‡ä»¶ï¼ˆå¤¹ï¼‰çš„è¯¦ç»†ä¿¡æ¯ å¤šä¸ªç‰ˆæœ¬åº“è§£å†³æ–¹æ¡ˆ ä¸€ã€ å¤šä¸ªç«¯å£å·ï¼š ç‰ˆæœ¬åº“å¯ä»¥åˆ›å»ºåœ¨ä»»æ„ä½ç½® ç«¯å£å·å®¹æ˜“æ··æ·† äºŒã€ä¸€ä¸ªç«¯å£å·ï¼š ç‰ˆæœ¬åº“å¿…é¡»åˆ›å»ºåœ¨åŒä¸€ç›®å½•ä¸‹ æ— éœ€åˆ†é…ç«¯å£å· svn cp å·¥ä½œå‰¯æœ¬â€“&gt;å·¥ä½œå‰¯æœ¬ å·¥ä½œå‰¯æœ¬â€“&gt;ç‰ˆæœ¬åº“ï¼ˆä¸å¯è·¨åº“ï¼‰ ç‰ˆæœ¬åº“ â€“&gt;å·¥ä½œå‰¯æœ¬ï¼ˆå…è®¸è·¨åº“ï¼‰ ç‰ˆæœ¬åº“ â€“&gt;ç‰ˆæœ¬åº“ï¼ˆä¸å¯è·¨åº“ï¼‰ ä¸»å¹²ç‰ˆæœ¬ trunkåˆ†æ”¯ç‰ˆæœ¬ branchå‘å¸ƒç‰ˆæœ¬çš„å¤‡ä»½ tag hooks é’©å­å½“æ‰§è¡ŒæŸäº›ç‰¹å®šæ“ä½œæ—¶è§¦å‘æ‰§è¡Œé¢„å…ˆè®¾å®šå¥½çš„ä»»åŠ¡ã€‚é’©å­çš„å®è´¨æ˜¯shellè„šæœ¬ã€‚æ•°æ®å…ˆä»æœ¬åœ°ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œå†ä»æœåŠ¡å™¨å¤åˆ¶åˆ°ç‰ˆæœ¬åº“ã€‚æ‰€ä»¥æœ‰3ä¸ªæ—¶é—´ç‚¹ï¼š ä¼ è¾“ä¹‹å‰ï¼ˆstartï¼‰ï¼›ä¼ è¾“ä¹‹åå¤åˆ¶ä¹‹å‰ï¼ˆpreï¼‰ï¼›å¤åˆ¶ä¹‹åï¼ˆpostï¼‰ã€‚é’©å­éå¸¸å¼ºå¤§ï¼Œgithubæ¶è®¾åœ¨svnä¹‹ä¸Šä¹Ÿæ˜¯é€šè¿‡é’©å­å®ç°çš„ã€‚ ç‰ˆæœ¬åº“çš„è¿ç§» æ–¹å¼ä¸€ï¼š1ã€killall svnserve 2ã€æŠŠ/path/repos/å‹ç¼©æˆrepos.zip 3ã€å¤åˆ¶repos.zipåˆ°æ–°æœåŠ¡å™¨å¹¶è§£å‹ã€‚ 4ã€åœ¨æ–°æœåŠ¡å™¨ä¸Šè¿è¡Œreposç‰ˆæœ¬åº“ã€‚ æ–¹å¼äºŒï¼š 1ã€killall svnserve 2ã€svnadmin dump /path/repos -r 1:100 &gt; /temp/repos.repo //ï¼ˆ-r ç‰ˆæœ¬å·ï¼šç‰ˆæœ¬å·ï¼‰ 3ã€svnadmin load /path/newrepos/ &lt; /temp/repos.repo 4ã€æŠŠé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°æ–°ç‰ˆæœ¬åº“ä¸­ã€‚ 5ã€æŠŠæ—§çš„ç‰ˆæœ¬åº“åˆ é™¤ã€‚ 7ã€å¯åŠ¨æ–°ç‰ˆæœ¬åº“æœåŠ¡ã€‚svnç‰ˆæœ¬åº“çš„é‡å®šå‘svn switch â€“relocate svn://192.168.0.130/repos svn://192.168.x.xx/newrepos","link":"/2018/04/02/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/SVN/svn/"},{"title":"GitHubæäº¤æ—¶å¿½ç•¥ä¸å¿…è¦ä¸Šä¼ çš„æ–‡ä»¶","text":"æ–°å»º.gitignoreæ–‡ä»¶ï¼Œå†™å…¥è¦å¿½ç•¥çš„å†…å®¹ 123456789.gitignore .settings/ //å¿½ç•¥ideaç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶.project //å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ .project æ–‡ä»¶target/*.zip //å¿½ç•¥æ‰€æœ‰.zipç»“å°¾çš„æ–‡ä»¶doc/*.txt //å¿½ç•¥ doc/notes.txt,ä½†ä¸åŒ…æ‹¬ doc/server/arch.txt!test.txt //ä¸å¿½ç•¥ test.txt æ–‡ä»¶ æ³¨:å¦‚æœè¦å¿½ç•¥çš„æ–‡ä»¶å·²è¢«gitç®¡ç†,éœ€è¦å…ˆç§»é™¤,å‘½ä»¤å¦‚ä¸‹: 1git rm -r target/ //-rä¸ºé€’å½’ ç„¶ågit commit æœ€å.gitignoreä¸­çš„å¿½ç•¥ï¼Œå°±ä¼šèµ·ä½œç”¨","link":"/2019/12/21/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/git/GitHub%E6%8F%90%E4%BA%A4%E6%97%B6%E5%BF%BD%E7%95%A5%E4%B8%8D%E5%BF%85%E8%A6%81%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6/"},{"title":"svnæœåŠ¡å®‰è£…ä¸ä½¿ç”¨","text":"1ã€svnæœåŠ¡å®‰è£… 1$ apt-get install subversion 2ã€åˆ›å»ºç‰ˆæœ¬åº“ 12$ mkdir /usr/local/svn$ svnadmin create /usr/local/svn/repos 3ã€æŸ¥çœ‹ç‰ˆæœ¬åº“ç”Ÿæˆæ–‡ä»¶ 123$ cd /usr/local/svn/repos$ lsconf db format hooks locks README.txt confæ–‡ä»¶å¤¹ä¸‹æ˜¯å­˜æ”¾ä¸»é…ç½®æ–‡ä»¶å’Œç”¨æˆ·ã€æƒé™ä½ç½®ï¼Œdbæ–‡ä»¶å¤¹æ˜¯å­˜æ”¾svnè½¬å‚¨åçš„æ•°æ®ã€‚ 123$ cd conf$ lsauthz hooks-env.tmpl passwd svnserve.conf authzæ–‡ä»¶æ˜¯è®¾ç½®ç”¨æˆ·æƒé™ï¼Œpasswdæ–‡ä»¶æ˜¯å­˜å‚¨ç”¨æˆ·åŠå¯†ç ï¼Œsvnserve.confæ˜¯ä¸»é…ç½®æ–‡ä»¶ã€‚4ã€é…ç½®ç‰ˆæœ¬åº“ (1) vim svnserve.conf 12345[general]anon-access = none #åŒ¿åè®¿é—®æƒé™ï¼Œé»˜è®¤readï¼Œnoneä¸ºä¸å…è®¸è®¿é—®auth-access = write #è®¤è¯ç”¨æˆ·æƒé™ password-db = passwd #ç”¨æˆ·ä¿¡æ¯å­˜æ”¾æ–‡ä»¶ï¼Œé»˜è®¤åœ¨ç‰ˆæœ¬åº“/confä¸‹é¢ï¼Œä¹Ÿå¯ä»¥ç»å¯¹è·¯å¾„æŒ‡å®šæ–‡ä»¶ä½ç½®authz-db = authz æ³¨æ„ï¼šæ¯è¡Œå‰é¢ä¸€å®šä¸è¦æœ‰ç©ºæ ¼ã€‚ (2) vim passwd #æ ¼å¼æ˜¯ç”¨æˆ·å=å¯†ç ï¼Œé‡‡ç”¨æ˜æ–‡å¯†ç  1234[users]xiaoming = 123zhangsan = 123lisi = 123 (3)vim authz 1234567[groups]manage = xiaomingdevelop = zhangsan,lisi[repos:/] ##ä»¥æ ¹ç›®å½•èµ·å§‹çš„reposç‰ˆæœ¬åº“managerç»„ä¸ºè¯»å†™æƒé™@manage = rw[repos:/project] ##developå¯¹reposç‰ˆæœ¬åº“ä¸‹mediaç›®å½•ä¸ºè¯»å†™æƒé™@develop = rw5ã€å¯åŠ¨svnæœåŠ¡ 1$ svnserve -d -r /usr/local/svn -dè¡¨ç¤ºä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨ï¼Œ-rè¡¨ç¤ºä»£ç ä»“åº“çš„æ ¹ç›®å½•.æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ,ç›‘å¬3690ç«¯å£ 12$ netstat -tanp |grep svnservetcp 0 0 0.0.0.0:3690 0.0.0.0:* LISTEN 3032/svnserve 6ã€å…³é—­svnæœåŠ¡ 1pkill svnserve","link":"/2018/03/30/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/SVN/svn%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"title":"gitæœåŠ¡å™¨çš„åˆæ­¥ç®€å•éƒ¨ç½²","text":"gitæœåŠ¡å™¨çš„åˆæ­¥ç®€å•éƒ¨ç½² ç¯å¢ƒï¼šgitæœåŠ¡å™¨Ubuntuï¼Œå¼€å‘æœºå™¨Windows 7ã€‚ 1ã€å®‰è£…git 1$ apt-get install git 2.åˆ›å»ºgitç”¨æˆ·åŠæƒé™ 12$ adduser -m git$ passwd git æ·»åŠ gitç”¨æˆ·åä¼šåœ¨/homeä¸‹ç”Ÿæˆgitç›®å½•ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›è¿™ä¸ªç”¨æˆ·é€šè¿‡sshè¿æ¥åˆ°æœåŠ¡å™¨ä¸Šé¢å»ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ç¦æ­¢è¿™ä¸ªç”¨æˆ·ä½¿ç”¨sshè¿æ¥ä¸Šå»è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬é€šè¿‡ç¼–è¾‘/etc/passwdæƒé™æ–‡ä»¶æ¥å¤„ç†ã€‚ 12#git:x:1001:1001:,,,:/home/git:/bin/bashgit:x:1001:1001:,,,:/home/git:/usr/bin/git-shell 3ã€åœ¨å¼€å‘æœºå™¨ä¸Šç”Ÿæˆå…¬é’¥ é¦–å…ˆä¸‹è½½å®‰è£…git åœ¨æœ¬æœºç”Ÿæˆå¯†é’¥ï¼š 1234567891011121314151617181920212223admin@admin-PC MINGW64 ~$ ssh-keygen.exeGenerating public/private rsa key pair.Enter file in which to save the key (/c/Users/admin/.ssh/id_rsa):Created directory '/c/Users/admin/.ssh'.Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in /c/Users/admin/.ssh/id_rsa.Your public key has been saved in /c/Users/admin/.ssh/id_rsa.pub.The key fingerprint is:SHA256:49440Ss8DHEeufZG9U7sQWhe+zUOkkCvyEMjReHdwcg admin@admin-PCThe key's randomart image is:+---[RSA 2048]----+| .oo o. || ...E... || ...o.. . || ..o+. .+ o || ++S+o+.= . || .==ooo..*..|| =o+ ..+ooo|| .*o+ o..|| o=. |+----[SHA256]-----+ æŠŠC:\\Users\\admin.sshä¸‹çš„id_rsa.pubå‘é€åˆ°gitæœåŠ¡å™¨ä¸Š 4ã€åœ¨æœåŠ¡å™¨é…ç½®å…¬é’¥ 1234$ cd /home/git/$ mkdir .ssh$ cd .ssh$ vi authorized_keys æŠŠå¼€å‘æœºå™¨ä¸Šçš„id_rsa.pubæ–‡ä»¶å†…å®¹æ·»åŠ ä¿å­˜åˆ°authorized_keysæ–‡ä»¶ã€‚ 5ã€åˆå§‹åŒ–ä¸€ä¸ªgitä»“åº“ 12345678$ su gitgit@ubuntu:~$ mkdir /home/git/repositoriesgit@ubuntu:~$ chown git:git /home/git/repositories/git@ubuntu:~$ chmod 755 /home/git/repositories/git@ubuntu:~$ cd repositories/git@ubuntu:~/repositories$ mkdir helloworld.gitgit@ubuntu:~/repositories$ cd helloworld.git/git@ubuntu:~/repositories/helloworld.git$ git --bare init 6ã€åœ¨æœ¬åœ°å…‹éš†testä»“åº“ 1$ git clone git@192.168.1.32:/home/git/repositories/helloworld.git 7ã€å¤šç”¨æˆ·ä¸æƒé™ç®¡ç† å¦‚æœå›¢é˜Ÿäººæ•°è¾ƒå°‘ï¼ŒæŠŠæ¯ä¸ªäººçš„å…¬é’¥æ”¶é›†èµ·æ¥æ”¾åˆ°æœåŠ¡å™¨çš„/home/git/.ssh/authorized_keysæ–‡ä»¶é‡Œå°±æ˜¯å¯è¡Œçš„ã€‚å¦‚æœå›¢é˜Ÿäººæ•°è¾ƒå¤šï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨Gitosisæ¥ç®¡ç†å…¬é’¥ã€‚","link":"/2017/08/23/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%88%9D%E6%AD%A5%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2-%E4%B8%80/"},{"title":"gitæœåŠ¡å™¨çš„æƒé™æ§åˆ¶","text":"æƒé™æ§åˆ¶ gitçš„æƒé™æ§åˆ¶æ˜¯é‡‡ç”¨çš„gitoliteï¼Œè‡ªèº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“ï¼ˆgitolite-adminï¼‰ï¼Œä»–ä»¬çš„ç®¡ç†ä¸é…ç½®éƒ½å¯ä»¥é€šè¿‡gitçš„æ–¹å¼ï¼Œåˆ†å¸ƒå¼çš„è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé€šè¿‡pushçš„æ–¹å¼æäº¤åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡æ‰€è°“çš„é’©å­è„šæœ¬è‡ªåŠ¨æ›´æ–°æƒé™æ§åˆ¶æ–‡ä»¶ã€‚ 1ã€åˆ‡æ¢åˆ°gitç”¨æˆ·ä¸‹(gitä»“åº“æ˜¯åœ¨gitç”¨æˆ·ä¸‹) 1$ su git gitoliteæœ¬è´¨å°±æ˜¯æ ¹æ®ä½ çš„é…ç½®ï¼Œè‡ªåŠ¨ç”Ÿæˆauthorized_keysæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒè¦æ±‚ä½ çš„authorized_keysæ–‡ä»¶å¿…é¡»æ˜¯ç©ºçš„ï¼Œæˆ–è€…ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹²è„†åˆ äº†å®ƒ 1$ rm ~/.ssh/authorized_keys gitoliteåœ¨åˆå§‹åŒ–æ—¶éœ€è¦é€šè¿‡æŸä¸€ç”¨æˆ·çš„å…¬é’¥æ–‡ä»¶æŒ‡å®šä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ï¼Œgitoliteå®‰è£…æˆåŠŸåï¼Œåªæœ‰è¿™ä¸ªè¶…çº§ç®¡ç†å‘˜å¯ä»¥æ›´æ–°gitoliteä»¥æ›´æ–°å„ç§æƒé™æ§åˆ¶ï¼ˆåŒ…æ‹¬å¯¹å…¶è‡ªèº«çš„æ›´æ–°æƒé™æ§åˆ¶ï¼‰ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æŒ‡å®šè¯¥è¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„å…¬é’¥æ–‡ä»¶ï¼ˆæœ€å¥½ç›´æ¥å°†å…¶æ‹·è´åˆ°gitç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼ˆä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºä½¿ç”¨åŒä¸€æœåŠ¡å™¨ä¸Šçš„å¦ä¸€å¸¸ç”¨ç®¡ç†å‘˜ç”¨æˆ·adminï¼‰ã€‚ æ–°å»ºadminç”¨æˆ· 12$ useradd -m admin$ passwd admin åˆ‡æ¢åˆ°adminä¸‹ï¼Œç”Ÿæˆè¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„å…¬é’¥æ–‡ä»¶ 123root@ubuntu:~# su adminadmin@ubuntu:~$ ssh-keygenadmin@ubuntu:~$ sudo cp .ssh/id_rsa.pub /home/git/id_rsa.pub 2ã€å®‰è£…gitolite 123456admin@ubuntu:/home/git$ su gitgit@ubuntu:~$ cd ~git@ubuntu:~$ git clone git://github.com/sitaramc/gitolitegit@ubuntu:~$ mkdir -p $HOME/bin #ä¸ºgitoliteçš„äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆåˆ›å»ºç›®å½•git@ubuntu:~$ gitolite/install -to $HOME/bin/ # ç¼–è¯‘ç”Ÿæˆå®‰è£…æ–‡ä»¶git@ubuntu:~$ $HOME/bin/gitolite setup -pk id_rsa.pub # å®‰è£…å¹¶åˆå§‹åŒ–ï¼ŒæŒ‡å®šid_rsa.pubå…¬é’¥æ–‡ä»¶å¯¹åº”çš„ç”¨æˆ·ä¸ºè¶…çº§ç®¡ç†å‘˜ gitoliteå®‰è£…åæœ¬èº«æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“â€”â€”gitolite-adminï¼Œåˆ†å¸ƒå¼çš„è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé€šè¿‡pushçš„æ–¹å¼æäº¤ï¼Œå…¶ä¼šé€šè¿‡é’©å­è„šæœ¬æ‰§è¡Œæƒé™æ›´æ–°ã€‚gitoliteè‡ªåŠ¨ç”Ÿæˆäº†ä¸¤ä¸ªç‰ˆæœ¬åº“ï¼šgitolite-admin.gitå’Œtesting.gitï¼Œå…¶ä¸­çš„gitol-admin.gitå°±æ˜¯é‚£ä¸ªæƒé™æ§åˆ¶çš„ç‰ˆæœ¬åº“ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯å›åˆ°ä½ åˆšåˆšæŒ‡å®šçš„è¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„ç”µè„‘è·Ÿè´¦æˆ·ä¸‹ï¼Œcloneå‡ºgitolite-adminè¿™ä¸ªç‰¹æ®Šçš„gitç‰ˆæœ¬åº“ï¼ˆå½“å‰æƒ…å†µä¸‹ï¼Œåªæœ‰è¯¥è¶…çº§ç®¡ç†å‘˜è´¦æˆ·å¯ä»¥cloneå¹¶æ›´æ–°gitolite-adminè¿™ä¸ªç‰ˆæœ¬åº“ï¼‰ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„éœ€è¦å¯¹å…¶è¿›è¡Œé…ç½®ï¼ˆå¦‚æ·»åŠ æ›´å¤šçš„ç®¡ç†å‘˜è´¦æˆ·ã€æ·»åŠ æ–°çš„ç‰ˆæœ¬åº“å¹¶ä¸ºä¸åŒçš„ç”¨æˆ·æŒ‡å®šæƒé™ï¼‰ 3ã€æƒé™è®¾ç½® 123root@ubuntu:~# su adminadmin@ubuntu:/root$ cd ~admin@ubuntu:~$ git clone git@192.168.1.32:gitolite-admin.git å¦‚æœä¸Šé¢çš„æ­¥éª¤éƒ½æˆåŠŸäº†çš„è¯ï¼Œåº”è¯¥å¯ä»¥æŸ¥çœ‹åˆ°æœ‰ä¸€ä¸ªgitolite-adminçš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸¤ä¸ªç›®å½•confã€keydirã€‚cloneé»˜è®¤è·¯å¾„æ˜¯/home/git/repositoriesï¼Œæƒé™æ§åˆ¶æ˜¯åªæœ‰å½“å‰çš„è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·å¯ä»¥è®¿é—®gitolite-adminå’Œtestingä¸¤ä¸ªç‰ˆæœ¬åº“ï¼Œä½ ä¹‹å‰æµ‹è¯•åˆ›å»ºçš„ç‰ˆæœ¬åº“ä¹Ÿå·²ç»æ— æ³•è®¿é—®ï¼Œå¦‚æœä½ å°è¯•å†æ¬¡cloneä¹‹å‰åˆ›å»ºçš„æµ‹è¯•ç‰ˆæœ¬åº“ï¼Œå°±ä¼šæç¤ºæ²¡æœ‰æƒé™ã€‚è¦ç»§ç»­è®¿é—®ä¹‹å‰åˆ›å»ºçš„é¡¹ç›®ï¼Œéœ€è¦å°†è¿™ä¸ªé¡¹ç›®æ·»åŠ åˆ°gitoliteçš„æƒé™æ§åˆ¶å†…ã€‚ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹ä¸ºå½“å‰çš„è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·æŒ‡å®šä¹‹å‰åˆ›å»ºçš„helloworldæµ‹è¯•ç‰ˆæœ¬åº“çš„è¯»å†™æƒé™ï¼ˆå¯è¯»å¯å†™ï¼‰ï¼Œä»¥æ­¤æ¼”ç¤ºgitoliteæŒ‡å®šæƒé™çš„ä¸€èˆ¬æµç¨‹ï¼š1ã€å°†éœ€è¦æŒ‡å®šæƒé™çš„ç”¨æˆ·çš„sshå…¬é’¥æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨gitolite-adminç‰ˆæœ¬åº“çš„keydirç›®å½•ä¸‹ï¼ˆå¦‚æœæäº¤çš„éƒ½æ˜¯id_rsa.pubï¼Œå¯ä»¥å°†å…¶é‡å‘½åä¸ºè¯¥ç”¨æˆ·çš„idæˆ–è€…åç§°ï¼ŒåŒæ—¶ä¹Ÿæ¨èè¿™æ ·é‡å‘½åï¼Œä»¥æ˜ç¤ºå“ªä¸ªå…¬é’¥æ–‡ä»¶æ˜¯å“ªä¸ªç”¨æˆ·çš„ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬åˆå§‹åŒ–æ—¶ï¼Œgitoliteå·²ç»å°†è¯¥è¶…çº§ç®¡ç†å‘˜çš„å…¬é’¥æ–‡ä»¶è‡ªåŠ¨æ‹·è¿›å»äº†ï¼Œæ‰€ä»¥çœç•¥æ­¤æ­¥éª¤ã€‚2ã€ç¼–è¾‘confç›®å½•ä¸‹çš„gitolite.confæ–‡ä»¶ï¼Œæ·»åŠ helloworldç‰ˆæœ¬åº“ç®¡ç†ç»„ï¼Œä¸ºè¶…çº§ç®¡ç†å‘˜æŒ‡å®šè¯»å†™æƒé™ï¼ˆRW+ï¼Œå…·ä½“çš„æƒé™å®šä¹‰ï¼Œå‚è€ƒgitoliteå®˜æ–¹æ–‡æ¡£ï¼‰ 1234567repo gitolite-adminRW+ = id_rsarepo testing RW+ = @allrepo helloworld RW+ = id_rsa 3ã€commitåˆ°æœ¬åœ° 1git commit -am â€˜add the helloworld repo and add RW+ to id_rsaâ€™ æäº¤æ—¶ï¼Œé¦–å…ˆè¦ç”¨åç§° 12git config â€“global user.email â€œyou@example.comâ€git config â€“global user.name â€œYour Nameâ€ 4ã€pushåˆ°gitä»“åº“ 1git push pushæˆåŠŸï¼Œå½“å‰è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·åº”è¯¥å°±å¯ä»¥æˆåŠŸclone helloworldç‰ˆæœ¬åº“ï¼Œå¹¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ä¸pushç­‰æ“ä½œäº†ã€‚ å‚è€ƒï¼š http://blog.csdn.net/xsl1990/article/details/25486211 https://github.com/sitaramc/gitolite","link":"/2017/08/28/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6-%E4%BA%8C/"},{"title":"gitæœåŠ¡å™¨çš„ç”¨æˆ·ç®¡ç†","text":"1ã€æ·»åŠ ç”¨æˆ· è¦æ·»åŠ æ–°ç”¨æˆ·aliceï¼Œbobå’Œcarolï¼Œé¦–å…ˆè·å–ä»–ä»¬çš„å…¬é’¥ï¼Œå¹¶å°†å®ƒä»¬åˆ†åˆ«æ·»åŠ åˆ°ç®¡ç†å‘˜â€œgitolite-admin/keydirâ€ä½œä¸ºalice.pubï¼Œbob.pubå’Œcarol.pubã€‚(ä»¥ç”¨æˆ·åè¿›è¡Œå‘½åã€‚) è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ä»“åº“repo:foo,å¹¶ç»™äºˆä¸Šè¿°è¿™äº›ç”¨æˆ·ä¸åŒçº§åˆ«çš„è®¿é—®æƒé™ç¼–è¾‘ vim conf/gitolite.conf 1234repo foo RW+ = alice RW = bob R = carol å®Œæˆè¿™äº›æ›´æ”¹åï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1234git add confgit add keydirgit commit -m \"added foo, gave access to alice, bob, carol\"git push pushå®Œä¹‹åï¼Œgitoliteå°†æ·»åŠ æ–°çš„ç”¨æˆ·åˆ° ~/.ssh/authorized_keysæœåŠ¡å™¨ä¸Šï¼Œä»¥åŠåˆ›å»ºä¸€ä¸ªåä¸ºfooçš„ç©ºçš„repoã€‚ 2ã€è®¿é—®è§„åˆ™ 1234567repo foo RW+ = alice - master = bob - refs/tags/v[0-9] = bob RW = bob RW refs/tags/v[0-9] = carol R = dave aliceå¯ä»¥å¯¹ä»»ä½•åˆ†æ”¯æˆ–æ ‡ç­¾åšä»»ä½•äº‹æƒ…, åˆ›å»ºï¼Œæ¨é€ï¼Œåˆ é™¤,æ’¤å›ï¼Œè¦†ç›–ç­‰ã€‚ bob å¯ä»¥åˆ›å»ºæˆ–æ¨é€åç§°ä¸ä»¥â€œmasterâ€å¼€å¤´çš„åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºåç§°ä¸ä»¥â€œvâ€+æ•°å­—å¼€å¤´çš„ä»»ä½•æ ‡ç­¾ã€‚ carolå¯ä»¥åˆ›å»ºåç§°ä»¥â€œvâ€+æ•°å­—å¼€å¤´çš„æ ‡ç­¾ã€‚ daveä»…å¯ä»¥å…‹éš†ã€‚ 3ã€ç»„ æ–¹ä¾¿ç¾¤ç»„ç”¨æˆ·ç®¡ç†ï¼Œä¸‹é¢æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªç»„ 1234567@staff = alice bob carol@interns = ashokrepo secret RW = @staffrepo foss RW+ = @staff RW = @interns ç»„åˆ—è¡¨ç´¯ç§¯ã€‚ä»¥ä¸‹ä¸¤è¡Œä¸ä¸Šé¢çš„@staffçš„æ—©æœŸå®šä¹‰å…·æœ‰ç›¸åŒçš„æ•ˆæœï¼š 12@staff = alice bob@staff = carol å¯ä»¥åœ¨å…¶å®ƒç»„ä¸­ä½¿ç”¨ç»„å 1@all-devs = @staff @interns å¸®åŠ©ç”¨æˆ· 1ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ git clone git@host:reponameçš„å½¢å¼å…‹éš†ä»“åº“ã€‚ 2ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ ssh git@host info æŸ¥çœ‹å¯è®¿é—®çš„ä»“åº“åŠæƒé™ã€‚ 3ã€ç”¨æˆ·å¯ä»¥é€šè¿‡ ssh git@host helpè·å–å¸®åŠ©ã€‚","link":"/2017/08/28/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-%E4%B8%89/"},{"title":"çº¢çƒ§è‚‰åšæ³•","text":"1ã€çŒªè‚‰åˆ‡å—ã€‚ 2ã€åœ¨é”…ä¸­åŠ å…¥å†·æ°´ï¼ŒæŠŠçŒªè‚‰å€’å…¥é”…ä¸­ï¼ŒæŠŠæ°´ç…®æ²¸ï¼Œæå–æµ®æ²«ï¼Œä¹‹åæŠŠè‚‰ç››å‡ºã€‚ 3ã€åœ¨ç‚’ç“¢ä¸­å€’å…¥æ²¹ï¼ŒåŠ å…¥è’œæ°ç­‰è°ƒæ–™ï¼Œç„¶åæŠŠè‚‰å€’å…¥ï¼Œå¼€å§‹ç¿»ç‚’ã€‚ 4ã€ç¿»ç‚’å¤§çº¦5åˆ†é’Ÿï¼Œè‚‰æœ‰ä¸€ä¸ç„¦é»„åï¼ŒæŠŠè‚‰ç››å‡ºã€‚ 5ã€åœ¨ç‚’ç“¢ä¸­åŠ å…¥æ²¹ï¼Œç„¶ååŠ å…¥ç™½ç³–ï¼Œå¾…ç³–åŒ–åï¼ŒæŠŠè‚‰å€’å…¥ã€‚ç¿»ç‚’ã€‚ 6ã€è‚‰ä¸Šè‰²åï¼ŒåŠ å…¥é…±æ²¹ã€‚ç›ã€‚ 7ã€åŠ å…¥ä¸¤ç¢—æ°´ï¼Œå¤§ç«ç…®æ²¸ã€‚ 8ã€ç…®æ²¸åè½¬ä¸­å°ç«ï¼Œç…®50åˆ†é’Ÿã€‚ 9ã€æ°´å¿«å¹²æ—¶ï¼Œè½¬å¤§ç«ï¼Œæ”¶æ±ã€‚","link":"/2018/06/17/%E7%94%9F%E6%B4%BB/%E5%81%9A%E8%8F%9C/%E7%BA%A2%E7%83%A7%E8%82%89/"},{"title":"è¯´è¯","text":"ä¸ºäº†å±¥è¡Œä¹‹å‰çš„æ‰¿è¯ºï¼Œå°±è¦å»æ‰§è¡Œ åº†ä½™å¹´ï¼Œä¸‰é›†çœ‹å®Œå…¶å®æ²¡æœ‰æ˜ç™½è¿™ä¸ªåå­—çš„å«ä¹‰ï¼Œåªæ˜¯é™ˆé“æ˜é¥°æ¼”çš„çš‡å¸å¥½åƒå«åº†å¸ï¼Œè¿˜æœ‰å¼€å¤´ç°ä»£é‚£æ®µå¼ è‹¥æ˜€è¯´çš„çº¢æ¥¼æ¢¦é‚£æ®µå¥½åƒæœ‰äº›å…³è”ï¼Œä½†æ˜¯æ²¡å¤ªæ³¨æ„ã€‚ é¥°æ¼”ç«¥å¹´æ—¶ä»£çš„èŒƒé—²é‚£ä¸ªå°å­©ï¼Œåˆçœ‹æ—¶ç›¸è²Œå¹³å¹³æ·¡æ·¡ï¼Œå¹¶æ²¡æœ‰äº§ç”Ÿå–œæ¬¢çš„å¿µå¤´ï¼Œåé¢ä»–å’Œè´¹è€å¸ˆå­¦è§£å‰–å’Œä¸‹æ¯’é‚£æ®µè¿˜æ˜¯å¾ˆæœºçµææ€ªçš„ï¼Œä¾¿åˆå¾ˆè®¨äººå–œæ¬¢ï¼Œä¸è®ºåœ¨ç°å®ä¸­è¿˜æ˜¯åœ¨ç”µè§†ä¸­å¤çµç²¾æ€ªçš„å°å­©å¾ˆæ˜æ˜¾è¦æ¯”è€å®ä¹–å·§çš„è¦æ‹›äººå–œæ¬¢ã€‚å¤çµç²¾æ€ªçš„å°å­©è„‘æ´çµæ´»ï¼Œä¸æ€•å‡ºä¸‘ï¼Œæ•¢äºè¯•é”™ï¼Œå³ä½¿é”™äº†ï¼Œä¹Ÿå¯ä»¥è½»æ¾è‡ªå¦‚çš„åŒ–è§£ã€‚è€å®ä¹–å·§çš„å°å­©è„‘ç­‹ä¹Ÿå¯èƒ½è½¬åŠ¨å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å–„äºå»è¡¨ç°å‡ºæ¥ï¼Œå½±å“åŠ›ä¸å¤§ï¼Œè‡ªç„¶å°±ä¸å¦‚å¤çµç²¾æ€ªçš„æœºä¼šå¤šï¼Œè®¨äººå–œæ¬¢ã€‚ ç¦»åˆ«æ˜¯æœ€ä»¤äººä¼¤å¿ƒçš„å§ï¼Œå¹¼æ—¶èŒƒé—²ä¸è‹¥è‹¥é’æ¢…ç«¹é©¬ï¼Œä¸€èµ·ç©è€ï¼Œè‹¥è‹¥è¢«é€å¾€äº¬åŸï¼Œå’ŒèŒƒé—²ç¦»åˆ«ï¼Œä¸¤ä¸ªäººæˆ–è®¸è‡ªæ­¤ä¾¿å¾ˆéš¾ç›¸è§äº†ï¼Œå¯¹ä¸¤ä¸ªå¹¼å°çš„å¿ƒçµéƒ½æ˜¯ä¸å°çš„æ‰“å‡»ã€‚ä½†æ˜¯å‘½è¿å¹¶ä¸èƒ½è‡ªå·±æŒæ§ï¼Œåªèƒ½å¬å—å®‰æ’ï¼Œå³ä¾¿å†è¿‡æ‚²ä¼¤ï¼Œä¹Ÿåªèƒ½ç”¨æ—¶é—´æ¥æ²»æ„ˆã€‚ç¬¬äºŒæ¬¡ç¦»åˆ«æ˜¯èŒƒé—²ä¸è´¹è€å¸ˆï¼Œè´¹è€å¸ˆä¸æ˜¯ä¸€ä¸ªæ­»æ¿çš„äººï¼Œåœ¨æ•™ä»–å­¦ä¹ çš„è¿™æ®µæ—¶é—´ï¼Œä¸¤ä¸ªäººç›¸å¤„éƒ½æ˜¯éå¸¸å¼€å¿ƒçš„ï¼Œä»–æ•™æˆäº†ä»–æˆé•¿ï¼Œä»–ç»™äº†ä»–å¿«ä¹ï¼Œèƒ½é‡è§å½¼æ­¤ï¼Œéƒ½æ˜¯å„è‡ªçš„å¹¸è¿ã€‚ç¬¬ä¸‰æ¬¡æ˜¯èŒƒé—²ä¸å¥¶å¥¶çš„ç¦»åˆ«ï¼Œé•¿å¤§äº†è‡ªç„¶è¦é£å‡ºæ¸¯æ¹¾ï¼Œå¥¶å¥¶ä¸ä»–çš„å…³ç³»å¹¶ä¸æ˜¯é‚£ç§å¦‚èƒ¶ä¼¼æ¼†çš„ç–¼çˆ±ï¼Œä»–ä»¬ä¹‹é—´éš”ç€ä¸€å±‚è–„çº±ï¼Œä½†æ˜¯å¿ƒé‡Œéƒ½æ˜¯éƒ½æ˜¯çˆ±ç€å¯¹æ–¹ï¼Œç¦»åˆ«æ—¶ï¼Œå¥¶å¥¶åœ¨å±‹é‡Œå¬è§é‚£å£°å°‘çˆ·ï¼Œå¿ƒé‡Œæ˜¯æœ‰å¤šæ¿€åŠ¨ï¼Œæ»¡è„¸éƒ½æ˜¯æƒŠå–œï¼ŒèŒƒé—²äº²äº†å¥¶å¥¶é¢å¤´ï¼Œåœ¨å½“æ—¶æ˜¯ä¸æ•¬çš„ï¼Œè™½è¯´å¥¶å¥¶å˜´ä¸Šè¯´æˆä½•ä½“ç»Ÿï¼Œä½†å¿ƒé‡Œä¸€å®šæ˜¯ä¹å¼€äº†èŠ±ã€‚æˆ‘ä»æ¥éƒ½ä¸ä¼šå»è¡¨è¾¾è‡ªå·±çš„çˆ±ï¼Œä¸€åˆ‡éƒ½éšä¸å¿ƒåº•ï¼Œåœ¨å¤–é¢è¡¨ç°å¾—åˆæ˜¯é‚£ä¹ˆå†°å†·ï¼Œä¸æ¯«æ²¡æœ‰äººæƒ…å‘³ï¼Œæ˜¯ä¸å¥½æ„æ€ï¼Œä¹Ÿæ˜¯ä¸ä¼šå»è¡¨è¾¾ï¼Œåªå¾—ä¸å¤–äººå…³ç³»è¶Šæ¥è¶Šç–è¿œï¼Œæç»—é‚£æ¬¡å’Œçˆ¶æ¯é‡Œé¢æ‹¥æŠ±çš„ç”»é¢å¯¹æˆ‘å°±å¾ˆéœ‡æ’¼ï¼Œå®Œå…¨æ²¡æœ‰æ–™åˆ°ï¼Œå› ä¸ºæˆ‘ä»æ¥éƒ½æ²¡æœ‰è¿‡å¦‚æ­¤ä¸¾åŠ¨ï¼Œåªæœ‰è¡¨ç°å‡ºæ¥æ‰èƒ½çœŸåˆ‡æ„Ÿå—åˆ°å½¼æ­¤çš„æ¸©æš–å§ã€‚","link":"/2019/11/30/%E7%94%9F%E6%B4%BB/%E6%9D%82%E6%96%87/191130/"},{"title":"æˆ‘ä¸æ˜¯è¯ç¥","text":"èµ·åˆå†³å®šå»å–ä»¿åˆ¶è¯ä¹Ÿæ˜¯ä¸ºäº†èµšé’±ï¼Œå› ä¸ºå®¶åº­ï¼Œå› ä¸ºç”Ÿæ´»ï¼Œé¢å¯¹å¦‚æ­¤å·¨å¤§çš„éœ€æ±‚å¸‚åœºï¼Œè‡ªç„¶èµšçš„é‡‘ç›†é’µæ»¡ï¼Œä½†æ˜¯è¿™å§‹ç»ˆæ˜¯è¿æ³•çš„ï¼Œæœ€ç»ˆé€‰æ‹©äº†è§£æ•£ï¼Œä»–ä»¬å¿ƒä¸­æ˜¯å¤±æœ›çš„ï¼Œæ˜¯æ— å¥ˆçš„ï¼Œæ˜¯ç»æœ›çš„ã€‚ä½†æ˜¯ä»–ä»¬æ²¡æœ‰ç†ç”±å»è®©ä»–å»ä¸ºæ­¤å†’é™©ã€‚åªå¾—å¬å¤©ç”±å‘½ï¼Œæ…¢æ…¢ç­‰æ­»ã€‚é¢å¯¹å¦‚æ­¤é«˜æ˜‚çš„è´¹ç”¨ï¼Œé¢å¯¹è¢«æ‹–å®çš„å®¶åº­ï¼Œä¸å¾—ä¸é€‰æ‹©è‡ªæ€ã€‚å¾—çŸ¥ä»–çš„æ­»è®¯ï¼Œå’Œçœ‹ç€å¤§å®¶çš„æœŸå¾…ï¼Œè¿™æ¬¡åˆå†³å®šå»å†’é™©å»å–ä»¿åˆ¶è¯ï¼Œå¹¶ä¸”æŒ‰è¿›å£ä»·å‡ºå”®ï¼Œä¸ä¸ºç›ˆåˆ©ï¼Œå¤§å®¶åˆçœ‹åˆ°äº†ç”Ÿçš„å¸Œæœ›ã€‚å¯æ˜¯é¢å¯¹è­¦å¯Ÿçš„ä¸¥åŠ è¿½æŸ¥ï¼Œæœ€ç»ˆè¢«é”å®šï¼Œä¸ºäº†ä¸è®©ä»–è¢«æŠ“ï¼Œä»–å¼€è½¦å¸¦è­¦å¯Ÿé£å¥”ï¼Œæœ€ç»ˆå‡ºäº†è½¦ç¥¸ï¼Œä»–æ˜¯å¦‚æ­¤çš„ä¼¤å¿ƒï¼Œé¢å¯¹ä»–çš„è¿½é—®ï¼Œâ€œä»–æœ‰ä»€ä¹ˆç½ªâ€ï¼Œä»–ä¹Ÿæ˜¯ä¸‡åˆ†çš„æ— å¥ˆå’Œè‡ªè´£ï¼Œæœ€åè¾å»äº†è­¦å¯ŸèŒåŠ¡ã€‚å°åº¦ä»¿åˆ¶è¯å‚é¢å¯¹åŸè¯å‚çš„èµ·è¯‰ï¼Œä¹Ÿä¸å¾—ä¸å…³åœäº†è¯å‚ï¼Œä»¿åˆ¶è¯è™½è¯´æ²¡æœ‰ç»äº§ï¼Œä½†ä»·æ ¼ä¹Ÿç•ªäº†æ•°ç•ªã€‚ä½†ä»–ä»ç„¶å†³å®šæŒ‰ä¹‹å‰ä»·æ ¼å‡ºå”®ï¼Œè‡ªå·±å»å«ä»˜å‰©ä½™çš„å·®ä»·ã€‚æœ€ç»ˆè¿˜æ˜¯è¢«è­¦å¯ŸæŠ“åˆ°ã€‚å¤§å®¶å¿ƒä¸­éƒ½æ¸…æ¥šä»–æ²¡æœ‰ä»€ä¹ˆç½ªï¼Œæ³•å¤§äºæƒ…ï¼Ÿæœ€åè¢«åˆ¤äº†5å¹´ï¼Œé€å»ç›‘ç‹±çš„è·¯ä¸Šï¼Œå¤§å®¶éƒ½æ‘˜ä¸‹å£ç½©ï¼Œç›®é€ç¦»å¼€ï¼Œæœ€ç»ˆå¾—åˆ°äº†å‡åˆ‘ï¼Œæå‰å‡ºæ¥ã€‚ç»“å±€åˆ—å‡ºäº†ç°å®ä¸­çš„ä¸€äº›æ”¿ç­–çºªäº‹ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçœŸæ˜¯çš„æ•…äº‹ï¼šhttps://www.v2ex.com/t/468603 ç ”åˆ¶è¯å‚éœ€è¦ç ”å‘æ–°è¯ï¼Œåˆ¶å®šäº†é«˜æ˜‚çš„ä»·æ ¼ï¼Œç—…äººéœ€è¦æ´»å‘½ï¼Œå»ä¹°ä»¿åˆ¶è¯ï¼Œä¸¤è€…éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†è¿™ä¸¤è€…æ˜¯å¯¹ç«‹çŸ›ç›¾çš„ã€‚æ‰€ä»¥æœ€ç»ˆåªèƒ½æ˜¯ç”±å›½å®¶å‡ºé¢å»åè°ƒè§£å†³ã€‚ æ…¢æ€§ç²’ç»†èƒæ€§ç™½è¡€ç—… 1956å¹´å½¼å¾—åœ¨è´¹åŸå‘ç°äº†æ˜¯å› ä¸º22å·æŸ“è‰²ä½“æ¯”æ­£å¸¸çš„è¦çŸ­ã€‚è¢«ç§°ä¸ºè´¹åŸæŸ“è‰²ä½“ã€‚ 1973å¹´çå¦®ç‰¹å‘ç°äº†æŸ“è‰²ä½“ä¹‹æ‰€ä»¥ä¼šå˜çŸ­æ˜¯å› ä¸ºå‘ç”Ÿäº†æŸ“è‰²ä½“äº¤æ¢ã€‚å³9å·æŸ“è‰²ä½“å’Œ22å·æŸ“è‰²ä½“ï¼Œç”±äºæŸäº›åŸå› ï¼Œ9å·æŸ“è‰²ä½“ä¸‹é¢ä¼šæ–­å‡ºæ¥ä¸€æˆªï¼Œ22å·æŸ“è‰²ä½“ä¸‹é¢ä¹Ÿä¼šæ–­å‡ºä¸€æˆªï¼Œç„¶åä»–ä»¬å°±äº¤æ¢äº†ï¼Œäº¤æ¢å9å·æŸ“è‰²ä½“çš„ä¸€éƒ¨åˆ†æ¥åˆ°äº†22å·æŸ“è‰²ä½“ä¸Šï¼Œ22å·æŸ“è‰²ä½“çš„ä¸€éƒ¨åˆ†æ¥åˆ°äº†9å·æŸ“è‰²ä½“ä¸Šï¼Œè¿™æ ·å°±é€ æˆäº†22å·æŸ“è‰²ä½“å˜å¾—æ¯”æ­£å¸¸çš„è¦çŸ­ã€‚ 1983å¹´ç¾å›½å›½ç«‹ç™Œç—‡ç ”ç©¶æ‰€å‘ç°9å·æŸ“è‰²ä½“ä¸Šæœ‰ä¸€ä¸ªå«ABLçš„åŸºå› å’Œ22å·æŸ“è‰²ä½“ä¸Šçš„BCRåŸºå› ï¼Œå‘ç”Ÿäº†èåˆï¼Œå½¢æˆäº†ABL-BCRèåˆåŸºå› ï¼Œè¿™ç§èåˆåŸºå› ï¼Œå°±æ˜¯äº§ç”Ÿè¿™ç§æ¶æ€§è‚¿ç˜¤çš„åŸå› ã€‚ æ ¼åˆ—å« ç”±è¯ºåå…¬å¸ç”Ÿäº§ï¼Œå®ƒæ˜¯ä¸€ç§å°åˆ†å­é¶å‘è¯ç‰©ï¼Œä»–æ˜¯ä¸“é—¨æŠ‘åˆ¶è¿™ç§åŸºå› äº§ç”Ÿçš„ã€‚ åå¹´å­˜æ´»ç‡å¯ä»¥ç”±50%æé«˜åˆ°90%å·¦å³ã€‚ ç ”åˆ¶å‡ºçš„è¯ç‰©æ˜¯æœ‰ä¸“åˆ©æœŸçš„ï¼Œè¿‡äº†ä¸“åˆ©ä¿æŠ¤æœŸï¼Œåˆ«çš„è¯å‚å°±å¯ä»¥è¿›è¡Œä»¿åˆ¶ã€‚ ä»¿åˆ¶è¯ ä»¿åˆ¶çš„è¯éœ€è¦æ»¡è¶³2ä¸ªç­‰æ•ˆæ€§ï¼Œä¸€ã€è¯å­¦ç­‰æ•ˆæ€§ï¼Œå³è¦çš„å‰‚é‡ï¼Œç»™è¯æ–¹å¼ï¼Œæ´»æ€§æˆåˆ†ç­‰å› ç´ å¿…é¡»ç›¸åŒã€‚äºŒã€ç”Ÿç‰©ç­‰æ•ˆæ€§ï¼Œå³å¸æ”¶é€Ÿåº¦ç›¸åŒã€‚ èµ‹å½¢å‰‚å¯ä»¥ä¸åŒï¼Œå³å¡«å……è¯ç‰©ï¼Œåƒç¡«é…¸é’™ã€ä¹³ç³–ã€‚ å°åº¦å¯ä»¥ç”Ÿæˆä»¿åˆ¶è¯æ˜¯å› ä¸ºå°åº¦è®¸å¤šç©·äººåƒä¸èµ·è¯ï¼Œæ‰€ä»¥1970å¹´å°åº¦ä¿®æ”¹äº†è‡ªå·±çš„ä¸“åˆ©æ³•ï¼Œå…è®¸å¼ºä»¿ï¼Œå³è¯ç‰©ä¸Šå¸‚åï¼Œå…è®¸è¯å‚å¯¹å…¶è¿›è¡Œä»¿åˆ¶ï¼Œè€Œä¸å—ä¸“åˆ©æƒçš„é™åˆ¶ï¼Œæ‰€ä»¥ä¸€æ¬¾è¯ç‰©åœ¨ç¾å›½ä¸Šå¸‚åä¸‰ä¸ªæœˆä¹‹åå°åº¦å°±èƒ½å‡ºæ¥ä»¿åˆ¶è¯ã€‚","link":"/2018/07/15/%E7%94%9F%E6%B4%BB/%E6%9D%82%E6%96%87/%E6%88%91%E4%B8%8D%E6%98%AF%E8%8D%AF%E7%A5%9E/"},{"title":"è¯´è¯","text":"çœ‹åˆ°ä½ å¾ˆç‹¬ç«‹ï¼Œæˆ‘å¿ƒé‡Œæœ€çœŸå®çš„æƒ³æ³•å°±æ˜¯å¾ˆå¿ƒç–¼ã€‚æœ‰æ—¶å€™åˆºçŒ¬æ¯”å…”å­ï¼Œæ›´æ¸´æœ›æ‹¥æŠ±ã€‚ åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œè®©äººä¸èƒ½è‡ªæ‹”çš„ï¼Œé™¤äº†ç‰™é½¿ï¼Œå°±æ˜¯çˆ±æƒ…ã€‚","link":"/2018/07/14/%E7%94%9F%E6%B4%BB/%E6%9D%82%E6%96%87/%E8%AF%B4%E8%AF%9D/"},{"title":"æ¢…è¥¿","text":"æ¢…è¥¿ï¼Œè¿™ä¸ªåå­— åˆé—»å¤§æ¦‚æ˜¯å¤§ä¸‰é‚£å¹´å·´è¥¿ä¸–ç•Œæ¯ï¼ŒåŒåœ¨å®¿èˆè§‚çœ‹ä¸–ç•Œæ¯çš„å®¤å‹å£ä¸­ç¬¬ä¸€æ¬¡å¬åˆ°æ¢…è¥¿è¿™ä¸ªåå­—ï¼Œç”±äºæ­¤å‰å¹¶æœªå…³æ³¨è¿‡è¶³çƒï¼Œè‡³æ­¤ï¼Œæ—¶è‡³ä¿„ç½—æ–¯ä¸–ç•Œæ¯ï¼Œå¯¹æ¢…è¥¿çš„å°è±¡ä¹Ÿåªæ˜¯è¸¢çƒæ¯”è¾ƒå‰å®³ï¼Œåˆ«çš„å†æ— å…¶å®ƒï¼Œç”šè‡³ä»–æ‰€ä»£è¡¨çš„å›½å®¶ä¹Ÿæ˜¯åœ¨è¿™æ¬¡ä¿„ç½—æ–¯ä¸–ç•Œæ¯æ‰å¾—çŸ¥çš„ã€‚ç«¯åˆå‡æœŸæ­£å€¼ä¸–ç•Œæ¯å¼€èµ›ï¼Œæœ‰å¹¸è§‚çœ‹äº†é˜¿æ ¹å»·ä¸å†°å²›çš„æ¯”èµ›ï¼Œæœ€ç»ˆæ˜¯1æ¯”1å¹³ï¼ŒæœŸé—´æœ‰ä¸ªç‚¹çƒï¼Œæ˜¯æ¢…è¥¿ä¸»ç½šï¼Œä½†æœ€ç»ˆæ˜¯è¢«å†°å²›é—¨å°†æ‰‘å‡ºã€‚ä¹‹åä¸¤å¤©ä¾¿æ˜¯å„ç§çˆ†æ–™ï¼Œæ¢…è¥¿ç‚¹çƒè¢«å¯¼æ¼”é—¨å°†æ‰‘å‡ºçš„æ–°é—»ã€‚å‰ä¸¤å¤©é˜¿æ ¹å»·å¯¹é˜µå…‹ç½—åœ°äºš 0ï¼š3 æƒ¨è´¥ï¼Œæ„Ÿè§‰æ€ä¹ˆæ¢…è¥¿ä¸æƒ³ä¼ è¯´ä¸­çš„é‚£æ ·ã€‚è¿™ä¸¤å¤©å¯¹æ¢…è¥¿æœ‰äº†è¿›ä¸€æ­¥è®¤è¯†ï¼Œä»Šå¤©åˆæ— æ„å¾—çŸ¥ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥ï¼Œå†…å¿ƒäº§ç”Ÿäº†ä¸€äº›å…±é¸£ã€‚ ç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼ ä»¥ä¸‹è½¬è‡ªï¼šhttps://kuaibao.qq.com/s/FTB2018062400947700 1987å¹´6æœˆ24æ—¥ï¼Œé˜¿æ ¹å»·åœ£è²èƒœç½—è¨é‡Œå¥¥å¸‚ï¼Œä¸€ä¸ªå©´å­©å‘±å‘±å åœ°ã€‚5å¹´åä»–å¼€å§‹è¸¢çƒï¼Œ11å¹´åè¢«è¯Šæ–­æ‚£æœ‰ä¾å„’ç—‡ï¼Œ13å¹´åä»–ç”¨è‡ªå·±çš„è¶³çƒå¤©èµ‹æ¢æ¥äº†æ²»ç–—ç–¾ç—…çš„è´¹ç”¨ã€‚ä»è¿™ä¸€å¹´å¼€å§‹ï¼Œä»–çš„äººç”Ÿå’Œè¶³çƒå½»åº•æ†ç»‘åœ¨äº†ä¸€èµ·ã€‚ç„¶åï¼Œ31å¹´åçš„6æœˆ24æ—¥ï¼Œ2018å¹´ä¿„ç½—æ–¯ï¼Œ31å²çš„ä»–å¸¦ç€å¤©ä¹‹éª„å­çš„ç§°å·ï¼Œå¸¦ç€æ½˜å¸•æ–¯é›„é¹°çš„éª„å‚²ï¼Œå†æ¬¡ç«™åœ¨ä¸–ç•Œæ¯çš„èˆå°ä¸Šäº†ã€‚é‡Œå¥¥-æ¢…è¥¿ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ å¦‚æœæˆ‘ä»¬è¯•ç€å»è¯»æ‡‚æ¢…è¥¿ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªæ€»æ˜¯èƒŒå¯¹å…¨ä¸–ç•Œçš„ç˜¦å°ç”·äººå…¶å®è¶…ä¹å¯»å¸¸çš„å¸…æ°”ã€‚ èº«é«˜170cmï¼Œæ²¡æœ‰å‘è¾¾çš„è‚Œè‚‰ï¼Œå¯æ¯å½“ä»–çªç€å°ç†Šä¸€èˆ¬çš„åœ†çœ¼ç›å‘æ‡µçš„æ—¶å€™ï¼Œä»–å¾®å¾®è¹™çœ‰çš„æ—¶å€™ï¼Œä»–å’§å˜´å¤§ç¬‘çš„æ—¶å€™ï¼Œå´å°†â€œèŒå¸…â€æ¼”ç»åˆ°äº†æè‡´ã€‚ è€Œå‰¥å»â€œèŒå¸…â€çš„å¤–è¡¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åˆ™æ˜¯ä»–å®‰é™ä½è°ƒã€å®³ç¾å†…æ•›çš„æ€§æ ¼ï¼Œæ˜¯ä»–å”¯çˆ±ä¸è¶³çƒä¸å¯è¾œè´Ÿçš„å¿ è´ï¼Œæ˜¯ä»–æ•°åå¹´å¦‚ä¸€æ—¥ä»æœªå´©å¡Œçš„äººè®¾ã€‚ ã€è‹¥ä½ å–œæ¬¢æ€ªäººï¼Œå…¶å®æˆ‘å¾ˆç¾ã€‘ 5å²å¼€å§‹è¸¢çƒï¼Œ11å²è¢«è¯Šæ–­å‡ºä¾å„’ç—‡ï¼Œå®¶é‡Œæ²»ä¸èµ·ï¼Œæ¯é˜Ÿçº½ç»´å°”è€ä¼™è®¡ä»¥åŠä¸€åº¦æƒ³è¦æŒ–è§’çš„æ²³åºŠé˜Ÿåœ¨å¾—çŸ¥ä»–çš„é¡½ç–¾åéƒ½é€‰æ‹©äº†æ”¾å¼ƒã€‚ä¹Ÿè®¸è¦æ„Ÿè°¢å½“å¹´ä»–ä»¬çš„ä¸æ•‘ä¹‹æ©ï¼Œæ‰æœ‰äº†åæ¥çš„é‡Œå¥¥-æ¢…è¥¿ã€‚ 2000å¹´9æœˆï¼Œå¹´ä»…13å²èº«é«˜åªæœ‰140cmçš„æ¢…è¥¿å»äº†å·´å¡ç½—é‚£é’è®­è¥æ‹‰ç›è¥¿äºšè¯•è®­ã€‚åœ¨è¯•è®­æœŸé—´ï¼Œæ¢…è¥¿ç”¨è¡¨ç°å¾æœäº†å·´è¨é’å¹´é˜Ÿæ•™ç»ƒï¼Œä¹Ÿä¸ºè‡ªå·±èµ¢å¾—äº†æ²»ç–—èº«ä½“çš„é å±±ã€‚ é£æ‰¬èµ·äº†ä»–çš„é»‘å‘ï¼Œä»–ä¸ç»å¿ƒåœ°ç”©è¿‡é¬“é¢Šã€‚æ— è®ºæ˜¯é‚£ä¸ªå³è·¯æ— é™çªç ´ï¼Œèƒ½å¤Ÿå¤åˆ¶é©¬æ‹‰å¤šçº³å½“å¹´è¿è¿‡äº”äººè¿›çƒçš„è¿½é£å°‘å¹´ï¼Œè¿˜æ˜¯è½¬ä¸ºä¸­é”‹åç–¯ç‹‚è¿›çƒçš„æ¢…çƒç‹ï¼Œè€³è¾¹è¶Šæ¥è¶Šå˜ˆæ‚ï¼Œä»–å§‹ç»ˆå®‰é™ç€ã€‚ ä¸åŒäºå—ç¾çƒæ˜Ÿçš„ç‹¬é¢†é£éªšï¼Œæ›´ä¸åƒæ¬§æ´²çƒæ˜Ÿçš„éœ¸æ°”å¤–éœ²ï¼Œæˆ‘ä»æ²¡æœ‰è§è¿‡åƒæ¢…è¥¿è¿™æ ·â€œå­˜åœ¨æ„Ÿæä½â€çš„å‰é”‹ï¼Œè¿‡äººæ‘”å€’äº†å±…ç„¶å¯ä»¥ç¬é—´å¼¹èµ·æ¥ï¼Œä»–ä¸æ“…é•¿è¡¨æ¼”ç–¼ç—›ï¼Œä»–æ“…é•¿ç»§ç»­å¸¦çƒã€‚æ²¡æœ‰ç‹‚æ‹½ç‚«é…·çš„è¿›çƒåº†ç¥åŠ¨ä½œï¼Œæ¯å½“ç ´é—¨å¾—åˆ†æ—¶ï¼Œä»–åªä¼šå‚»å‚»çš„æŒ¯è‡‚ç‹‚å¥”ï¼Œè™”è¯šåœ°åŒæ‰‹æŒ‡å¤©ã€‚åæ¥è¿™ä¸ªæ›¾ç»æ—äººçœ¼é‡Œæœ‰äº›æ€ªå¼‚çš„â€œç—…å­©å­â€ç«™åœ¨äº†ä¸–ç•Œä¹‹å·…ï¼Œå´ä»ç„¶è¡Œäº‹ä½è°ƒå¾—ä¸åƒä¸ªå·¨æ˜Ÿã€‚ åƒæ¢…è¥¿è¿™æ ·çš„â€œæ€ªäººâ€ï¼Œæ—¥æœ¬ä½œå®¶ä¸­å²›æ•¦åœ¨ã€Šå±±æœˆè®°ã€‹ä¸­å¦‚æ˜¯æè¿°ï¼šå› ä¸ºå®³æ€•è‡ªå·±å¹¶éæ˜ç è€Œä¸æ•¢åˆ»è‹¦ç¢ç£¨ï¼Œåˆå› ä¸ºæœ‰å‡ åˆ†ç›¸ä¿¡è‡ªå·±æ˜¯æ˜ç ï¼Œè€Œä¸èƒ½ä¸ç“¦ç ¾ç¢Œç¢Œä¸ºä¼ï¼Œé‚é€æ¸è¿œç¦»ä¸–é—´ï¼Œç–é¿äººç¾¤ï¼Œç»“æœåœ¨å†…å¿ƒä¸æ–­åœ°ç”¨æ„¤æ‡‘å’Œç¾æ€’é¥²è‚²ç€è‡ªå·±æ‡¦å¼±çš„è‡ªå°Šå¿ƒã€‚ä¸–ä¸Šæ¯ä¸ªäººéƒ½æ˜¯é©¯å…½å¸ˆï¼Œè€Œé‚£åŒ¹çŒ›å…½ï¼Œå°±æ˜¯æ¯äººå„è‡ªçš„æ€§æƒ…ã€‚ ã€ä½ æ˜¯å—å›½æ¥çš„å­©å­ï¼Œäººè¦çˆ±äººè¦æ¨çš„æ ·å­ã€‘ ç‚¹çƒï¼Œå¯¹æ¯ä¸ªå‰é”‹æ¥è¯´æ˜¯è£è¾±å…¼å…·çš„ç¥ç§˜å¤§ç¤¼ã€‚è€Œå¯¹æ¢…è¥¿æ¥è¯´ï¼Œç‚¹çƒç•™ä¸‹çš„å‡ ä¹å…¨æ˜¯ä¸å ªçš„å›å¿†ã€‚è‡ªæ¢…è¥¿å‡ºé“ä»¥æ¥ï¼Œä»–ä¸€å…±è¸¢äº†107ä¸ªç‚¹çƒï¼Œè¸¢ä¸¢äº†23æ¬¡ï¼Œå¾—åˆ†ç‡ä»…ä¸º76%ã€‚åœ¨å›½å®¶é˜Ÿä¸­ï¼Œæ¢…è¥¿21æ¬¡ç‚¹çƒè¸¢ä¸¢4æ¬¡ã€‚è€Œåœ¨æ¬§å† ã€è¥¿ç”²ã€å›½ç‹æ¯ç­‰å„æ¡æˆ˜çº¿ä»–å‡æœ‰ç‚¹çƒä¸è¿›çš„å†å²ã€‚ä»–ç”šè‡³åœ¨è‡ªå·±30å²æ—¶ï¼Œæ‰ç©å‡ºäº†èŒä¸šç”Ÿæ¶¯ç¬¬ä¸€ä¸ªâ€œå‹ºå­â€ç‚¹çƒã€‚ 2015å¹´åæœˆåœ¨åŒ—äº¬é¸Ÿå·¢ä¸¾è¡Œçš„å—ç¾è¶…çº§æ¯ä¸Šï¼Œæ¢…è¥¿ç‚¹çƒè¢«å·´è¥¿é—¨å°†æ‰‘å‡ºï¼Œå¯¼è‡´é˜¿æ ¹å»·æœ€ç»ˆè½è´¥ã€‚2012å¹´æ¬§å† åŠå†³èµ›å¯¹é˜µåˆ‡å°”è¥¿ï¼Œåœ¨åˆ‡å°”è¥¿è¢«ç½šä¸‹ä¸€äººçš„æƒ…å†µä¸‹ï¼Œæ¢…è¥¿åŠ æ—¶èµ›ç‚¹çƒå‡»ä¸­æ¨ªæ¢ï¼Œæœ€ç»ˆå·´è¨æƒ¨é­æ‰˜é›·æ–¯ç»æ€ã€‚2016å¹´ç¾æ´²æ¯å†³èµ›ï¼Œç‚¹çƒå¤§æˆ˜ï¼Œæ¢…è¥¿é¢å¯¹æ™ºåˆ©é—¨å°†æ²¡èƒ½æˆ˜èƒœæ¿’ä¸´å´©æºƒçš„å¿ƒç†é˜²çº¿ä¸€è„šå°†çƒè¸¢é£ã€‚ æœ¬å±Šä¸–ç•Œæ¯å°ç»„èµ›é¦–è½®ï¼Œæ¢…è¥¿å·¦ä¾§æ‰“é—¨ï¼Œä¸€ä¸ªè´¨é‡ä¸é«˜çš„åŠé«˜çƒè¢«å†°å²›é—¨å°†å“ˆå„¿å¤šæ¾è‡ªä¿¡çš„æ‰‘æ•‘æ‹’ä¹‹é—¨å¤–â€¦â€¦è®©äººæƒ³èµ·å¼ æ‚¬é‚£é¦–ã€Šå—å›½çš„å­©å­ã€‹ ä½ æ˜¯å—å›½æ¥çš„å­©å­ æœ‰ç€ä¸èƒ½ç¼šçš„æ€§å­ èº«ä¸ŠæŠ«è¦†äº†é¢„è¨€è€Œæµ‘ç„¶ä¸çŸ¥ å¥”è·‘ç€å¿˜æˆ‘çš„å¿«ä¹æ‚²ä¼¤éƒ½æ”¾è‚† é˜³å…‰ä¹Ÿä¸æ„¿é˜»æ­¢ çƒåœºä¸Šçš„æ¢…è¥¿ä¼¼ä¹æ›´ä¹ æƒ¯äºé£é©°ç”µæ£çš„çªå‡ºé‡å›´ï¼Œæˆ–æ˜¯ç§¯æä¸“æ³¨çš„ç»„ç»‡è¿›æ”»ï¼Œè€Œç«™ä¸Šç½šçƒç‚¹çš„æ¢…è¥¿ï¼Œåªæ˜¯ä¸€ä¸ªèµ°ä¸‹ç¥å›çš„å‡¡äººï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ä»–çš„å½·å¾¨ï¼Œç„¦è™‘ï¼Œå’Œæ— åŠ©ã€‚ äº”å¤ºé‡‘çƒï¼Œå››å¤ºé‡‘é´ï¼Œè¥¿ç”²ã€å›½ç‹æ¯ã€æ¬§å† ã€å¥¥è¿ä¼šé‡‘ç‰Œï¼Œä»–åœ¨è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ä¸­å·²ç»åšåˆ°äº†æè‡´ã€‚å¦‚æœè¿˜æœ‰ä»€ä¹ˆé—æ†¾ï¼Œé‚£ä¾¿æ˜¯èº«ä¸Šçš„é˜¿æ ¹å»·çƒè¡£å¸¦ç»™ä»–çš„ä¸‰ä¸ªäºšå†›äº†ï¼ˆ2014å·´è¥¿ä¸–ç•Œæ¯äºšå†›ã€2015æ™ºåˆ©ç¾æ´²æ¯äºšå†›ã€2016ç¾å›½ç¾æ´²æ¯äºšå†›ï¼‰ã€‚ä½†è¶³çƒä¸–ç•Œè‹¥æ³¨å®šè¦ä»¥ä¸€åº§ä¸–ç•Œæ¯æ¥å°ç‹å—ï¼Ÿ ä½ æ˜¯å—å›½æ¥çš„å­©å­ äººè¦çˆ±äººè¦æ¨çš„æ ·å­ è¡€é‡Œæµä¼ ç€è¿œåœ¨å¤è€çš„æ•…äº‹ æ‰‹å¿ƒåˆ»åˆ’ä¸Šå¸çš„ä»æ…ˆ ä¸æœªçŸ¥ç›¸ä¼¼ æ— è®ºæ˜¯Cç½—è¿˜æ˜¯æ¢…è¥¿ï¼Œå¾ˆå¤šäººéƒ½ä¹ æƒ¯åœ¨ä»–ä»¬è½è´¥çš„æ—¶å€™æ‘†å‡ºå¤§è¯„è®ºå®¶çš„å§¿æ€å»æŒ‡æ‘˜ï¼Œä½†ä¹Ÿè®¸è¦ä¸äº†å‡ å¹´ï¼Œæˆ‘ä»¬å°±å¿«åœ¨çƒè¿·çš„å£æ°´ä¹‹ä¸­è¿æ¥æ— å·¨æ˜Ÿçš„è¶³å›ã€‚å¦‚æœæ— æ³•æ¬£èµï¼Œä¹Ÿè¯·åˆ«å†è‹›è´£ï¼Œè‡³å°‘çæƒœè¿™ä¸ªå°šä¸”è¿˜æœ‰å·¨æ˜Ÿçš„æ—¶ä»£ã€‚ ã€ä¸€ç”Ÿä¸€ä¸–ä¸€åŒäººï¼Œä¸€çº¢ä¸€è“ä¸€é¢—é­‚ã€‘ å…³äºæ¢…è¥¿æœ‰å¤šå¿ è¯šï¼Œå®‰ä¸œå†…æ‹‰å’Œå·´å¡ç½—é‚£å¿ƒé‡Œæœ€æœ‰æ•°ã€‚ æœ‰äººè¯´æ¢…è¥¿æœ€å‰å®³çš„åœ°æ–¹ä¸æ˜¯å¹´åº¦91çƒï¼Œä¹Ÿä¸æ˜¯äº”åº§é‡‘çƒå¥–ï¼Œè€Œæ˜¯9å²é™ªä¼´åœ¨ä»–èº«è¾¹çš„å¥³å­©ï¼Œ30å²ä¾ç„¶åœ¨ã€‚ å»å¹´ï¼Œä¸€å‘ä½è°ƒçš„æ¢…è¥¿ï¼Œå´ç»ˆäºåœ¨çˆ±æƒ…ä¸Šä»»æ€§äº†ä¸€å›ã€‚è¯·äº†è¶³å›çš„åŠå£æ±Ÿå±±ï¼ŒæŠŠä¸€åœºä¸–çºªå©šç¤¼çŒ®ç»™ä»–å”¯ä¸€æŒšçˆ±çš„å¥³äººå®‰ä¸œå†…æ‹‰ã€‚å°½ç®¡å©šç¤¼è±ªåï¼Œä½†æ¢…è¥¿æ‰§æ„ä¸æ”¶ä»½å­é’±ï¼Œè¦ç»™å°±æç»™æ…ˆå–„æœºæ„ã€‚æ¢…è¥¿çš„ä¸–çºªå©šç¤¼ï¼Œä¸ä¸ºå™±å¤´ï¼Œåªå› çˆ±æƒ…ã€‚ç»“å©šé‚£å¤©ä»–è¯´ï¼Œâ€œæˆ‘è¿™ä¸€ç”Ÿæœ€å¤§çš„è£èª‰ï¼Œæ˜¯å¨¶åˆ°äº†æˆ‘å–œæ¬¢äº†21å¹´çš„å¥³å­©ã€‚â€ ä¹å²å¯¹å¥¹ä¸€è§é’Ÿæƒ…ï¼ŒåäºŒå²å†™äº†äººç”Ÿç¬¬ä¸€å°æƒ…ä¹¦ï¼Œåå…«å²å¬è¯´å¥¹é—ºèœœè½¦ç¥¸èº«äº¡ä¾¿ç«‹åˆ»é£å›é˜¿æ ¹å»·é™ªä¼´â€¦â€¦ä»–ä¼šåœ¨åŠŸæˆåå°±çš„æ—¶å€™æ‰“ç”µè¯ç»™å¥¹è¯´ï¼Œæˆ‘è¿˜æ˜¯å½“å¹´é‚£ä¸ªå–œæ¬¢è¸¢çƒçš„å®³ç¾ç”·å­©ï¼Œæ— è®ºæˆ‘å¾—åˆ°å¤šå°‘è£èª‰ï¼Œæˆ‘è¿˜æ˜¯é‚£ä¸ªå–œæ¬¢ä½ çš„é‡Œå¥¥-æ¢…è¥¿ã€‚å¯¹äºå®‰ä¸œå†…æ‹‰æ¥è¯´ï¼Œå’Œæ¢…è¥¿åœ¨ä¸€èµ·çš„è¿™äº›å¹´åŒæ ·åå·ï¼Œæ¢…è¥¿çš„ä½è°·å’Œå·…å³°ï¼Œä¹Ÿæ˜¯å¥¹é™ªä»–ä¸€èµ·èµ°è¿‡ã€‚ æˆ‘çˆ±ä½ ï¼Œä½ çˆ±æˆ‘ï¼Œé‚£å°±åˆ«ç®¡å¤–é¢å‡ åŒçœ¼ç›å‡ åªè€³æœµï¼Œè¯·å…±æˆ‘ä¸€èµ·ï¼Œæ”¾å¿ƒæ¢æˆˆã€‚ ç»ˆè€è¯ºåæ™®ï¼Ÿ SÃ­,quiero.ï¼ˆæ˜¯çš„ï¼Œæˆ‘æ„¿æ„ã€‚ï¼‰ å»å¹´ä¸‰åå²çš„æ¢…è¥¿ï¼Œä¸ä»…å¯¹å®‰ä¸œå†…æ‹‰è¯´ï¼Œä¹Ÿå¯¹å·´å¡ç½—é‚£è¯´ã€‚ ä»2000å¹´åˆ°å¦‚ä»Šï¼Œæ¢…è¥¿é€èµ°äº†å·´è¨ä¸€ä»£åˆä¸€ä»£çš„ç¥é”‹ï¼Œ18å¹´çš„ä¸ç¦»ä¸å¼ƒï¼Œè¿˜å°†å»¶ç»­ã€‚ä¹Ÿè®¸çœŸçš„æ˜¯æ€§æ ¼ä½¿ç„¶ï¼Œçˆ±ä¸€ä¸ªäººè¦çˆ±åˆ°å¤©è’åœ°è€ï¼Œç€ä¸€èº«è¡«é‚£å°±è¿™æ ·ç»ˆè€ã€‚å¯¹çˆ±æƒ…ï¼Œå¯¹è¶³çƒï¼Œæ¢…è¥¿èº«ä¸Šéƒ½æœ‰ä¸€è‚¡è¿‘ä¹æ‰§æ‹—çš„å€”å¼ºã€‚ æ·±å±±çš„é¹¿ï¼Œä¸çŸ¥å½’å¤„ï¼Œä¸‡èˆ¬çš†è‹¦ï¼Œåªå¯è‡ªæ¸¡ã€‚ä»–å°„ç©ºè¿‡ï¼Œä¹Ÿå¤±è½è¿‡ï¼Œä¹Ÿè®¸å¤©æ‰ç”Ÿæ¥å°±æ˜¯å­¤ç‹¬ï¼Œä¸€èº«æ‰åä¸æ»¡è…”æŠ±è´Ÿä¹Ÿä¸è¿‡æ˜¯æ— å¤„å®‰æ”¾ã€‚å…‰é˜´èè‹’ï¼Œæˆ‘ä»¬çœ‹åˆ°å·¦å²¸èº«æŠ«çº¢è“è¡«çš„æ¢…è¥¿ç«™åœ¨åˆ¶é«˜ç‚¹ä¸æ–­åœ°åˆ·æ–°ç€è£èª‰ï¼Œè€Œå³å²¸é‚£ä¸ªèº«æŠ«è“ç™½è¡«çš„æ¢…è¥¿åˆ™æ€»æ˜¯å‚å¤´å¤±æ„ã€‚ æ·¡æ¼ åˆ°å¤±å»çƒ­å¿±çš„æ—¶å€™ä»–ä¹Ÿè®¸å°±ä¼šè§‰å¾—è‡ªå·±è€äº†ï¼Œè€ŒæŸäº›ç¬é—´ï¼Œç”šè‡³æ— æ³•æè¿°é‚£ä¸ªç¬é—´ï¼Œæˆ‘ä»¬å›ºæ‰§åœ°ç›¸ä¿¡ä»–ä»æ—§æ˜¯å½“å¹´é‚£ä¸ªç¾æ¶©çš„å­©å­ã€‚å¯å½“åˆä¸€æ¬¡ä¸èƒœåˆ©æ“¦è‚©çš„æ— åŠ›æ„Ÿå¸­å·è€Œæ¥ï¼Œæ¢…è¥¿31å²äº†ï¼Œæˆ‘ä»¬åªèƒ½ä»»å‡­æ‰€æœ‰çš„æ‰§å¿µæ— ç–¾è€Œç»ˆã€‚æˆ–è®¸ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬çˆ±ä»–çš„åŸå› ã€‚ å°ç»„èµ›æœ«è½®ä¾¿æ˜¯é˜¿æ ¹å»·çš„ç”Ÿæ­»æˆ˜ï¼Œä¹Ÿè®¸è¿˜æœ‰ä¸€ä¸ªç½®ä¹‹æ­»åœ°è€Œåç”Ÿçš„å‰§æœ¬ç­‰ç€æˆ‘ä»¬å»å¼€å¯ã€‚ä»–åœ¨ç”¨èƒŒå½±å‘Šè¯‰æˆ‘ä»¬ï¼šæˆ‘ä¸æ˜¯å¤©ç”Ÿå¼ºå¤§ï¼Œæˆ‘åªæ˜¯å¤©ç”Ÿè¦å¼ºã€‚æˆ‘æ²¡åœ¨æ…Œï¼Œæˆ‘å·²ç»æ˜¯çƒç‹ã€‚ ç”Ÿæ—¥å¿«ä¹ï¼Œå”¯ä¸€çš„é‡Œå¥¥-æ¢…è¥¿ã€‚","link":"/2018/06/24/%E7%94%9F%E6%B4%BB/%E6%9D%82%E6%96%87/%E6%A2%85%E8%A5%BF/"},{"title":"è›™æ³³æœ€åä¸€å ‚è¯¾","text":"é¦–å…ˆæ˜¯å¾ˆé«˜å…´æ€»ç®—æ˜¯èµ¶åœ¨äº†å¹´å‰å­¦ä¹ äº†æ¸¸æ³³ï¼Œå› ä¸ºä¹‹å‰ä»å…­æœˆä»½å°±æ‰“ç®—å­¦çš„ï¼Œå½“æ—¶å’Œæ‹›ç”Ÿçš„è€å¸ˆæ²Ÿé€šä¸€ä¸‹ï¼Œå¥¹ä¹Ÿä¸æ€ä¹ˆä¸Šå¿ƒï¼Œæ—¶å¸¸é—®äº†ä¹‹åä¹Ÿæ²¡æœ‰å›å¤ï¼Œè¿˜æœ‰å½“æ—¶ä¹Ÿå¿«åˆ°äº†æš‘å‡ï¼Œçœ‹å¥¹ä»¬è¯¾ç¨‹å®‰æ’ä¸»è¦æ˜¯é’ˆå¯¹å­¦ç”Ÿï¼Œéƒ½æ˜¯åå¤©ä¸€ä¸ªå‘¨æœŸï¼Œæ—¶é—´ä¹Ÿæ’ä¸å¼€ï¼Œæœ€ç»ˆä¹Ÿå°±æç½®äº†ï¼Œåˆ°äº†åæœˆä¸­æ—¬å‘ç°å¥¹ä»¬åœ¨æ‹›ç”Ÿï¼Œå°±ä¸å¥¹ä»¬åˆæ²Ÿé€šäº†ä¸‹ï¼Œæ’è¯¾æ—¶é—´æ˜¯æ¯å‘¨æœ«ä¸‹åˆï¼Œæ„Ÿè§‰æŒºåˆé€‚ï¼Œå°±æŠ¥åäº†ï¼Œåä¸€æœˆç¬¬äºŒå‘¨å¼€å§‹ä¸Šçš„è¯¾ã€‚ â€‹ ä»Šå¤©æ˜¯å­¦ä¹ è›™æ³³çš„æœ€åä¸€èŠ‚è¯¾ï¼Œä¹‹å‰çš„èŠ‚å¥æ„Ÿè§‰éƒ½è¿˜å¥½ï¼Œä»ä¸Šä¸€èŠ‚ï¼Œæ•™ç»ƒæŠŠæµ®å¸¦çš„æ°”åŸºæœ¬æ”¾å®Œäº†ï¼Œå†æ¸¸çš„æ—¶å€™ï¼Œæ€»æ˜¯æµ®ä¸èµ·æ¥ï¼Œé¦–å…ˆæ˜¯è…¿å¼€å§‹ä¸‹æ²‰ï¼Œæ…¢æ…¢æ•´ä¸ªäººéƒ½å¼€å§‹ä¸‹æ²‰ï¼Œæ‰‹è‡‚åˆ’æ°´æ¢æ°”çš„æ—¶å€™ï¼Œè¦å¾ˆè´¹åŠ²æ‰å‘¼åˆ°ä¸€å£ç©ºæ°”ï¼Œæ¸¸ä¸¤ä¸‹ï¼Œå°±å‘¼ä¸åˆ°ç©ºæ°”äº†ï¼Œåªå¥½æ†‹ä½ï¼Œèµ¶ç´§å‘æ± è¾¹æ¸¸ã€‚æ•™ç»ƒæ€»è·Ÿè¯´æˆ‘è¹¬è…¿çš„æ—¶å€™è¦ç”¨åŠ›ï¼ŒæŒ‰ç…§æ•™ç»ƒè¯´çš„ç¨å¾®å¥½äº›ï¼Œä½†è¿˜æ˜¯æ„Ÿè§‰æ€»æµ®ä¸èµ·æ¥ï¼Œå°¤å…¶æ˜¯åˆ’å®Œæ‰‹æ¢æ°”çš„æ—¶å€™ï¼Œæ•´ä¸ªäººéƒ½ä¸‹æ²‰å¥½æ·±ï¼Œç„¶åç”¨åŠ²è¹¬è…¿ï¼Œè™½ç„¶ä¼šæµ®èµ·æ¥ï¼Œä¸‹ä¸€æ¬¡æ¢æ°”çš„æ—¶å€™ï¼Œå°±åˆæœ‰æ²‰äº†ä¸‹å»ï¼Œæ¥æ¥å›å›ï¼Œæ¸¸ä¸äº†å‡ ä¸ªå›åˆå°±ä¸è¡Œäº†ï¼Œä¸‹åˆä¸€ç›´æ¸¸åˆ°äº†äº”ç‚¹ï¼Œä¹Ÿè¿˜æ˜¯æ²¡èƒ½æ‰¾åˆ°æ„Ÿè§‰ã€‚åªèƒ½ç­‰æœ‰æ—¶é—´å†å»ç»ƒä¹ äº†ã€‚ â€‹ å›æ¥åçœ‹åˆ°ä¸¤ç¯‡æ–‡ç« ï¼Œè›™æ³³æ—¶ï¼Œä¸ºä»€ä¹ˆæ¢æ°”åèº«ä½“ç«‹é©¬ä¸‹æ²‰åˆ°æ± åº•ï¼Ÿ å’Œ åˆå­¦è›™æ³³ï¼Œèº«ä½“å¾€ä¸‹æ²‰æµ®ä¸èµ·æ¥ï¼Œæ€ä¹ˆåŠï¼Ÿ å›æƒ³ä¸‹ä¹‹å‰çš„ç»ƒä¹ ï¼Œå¯èƒ½åŸå› ï¼Œä¸€æ˜¯è¹¬å¤¹æ°´åŠ¨ä½œä¸åˆ°ä½ ï¼ŒäºŒæ˜¯åˆ’æ‰‹æ¢æ°” ä¸æ ‡å‡†ï¼Œä¸‰æ˜¯ç¼ºä¹æ•´ä½“çš„åè°ƒæ€§ ï¼Œå››æ˜¯ä¸‹æ²‰çš„ææƒ§å¿ƒé‡Œï¼Œæœ‰æ—¶é—´å¤šçœ‹ä¸‹åˆ«äººçš„åˆ†äº«çš„ç»éªŒå’Œè§†é¢‘ï¼Œæœ‰æ—¶é—´å†å»ç»ƒä¹ ç»ƒä¹ ã€‚","link":"/2018/12/15/%E7%94%9F%E6%B4%BB/%E6%B8%B8%E6%B3%B3/%E8%9B%99%E6%B3%B3%E6%9C%80%E5%90%8E%E4%B8%80%E5%A0%82%E8%AF%BE/"},{"title":"Spring-bootå•å…ƒæµ‹è¯• ç®€å•ä½¿ç”¨","text":"ä¸€ã€å¼•å…¥å•å…ƒæµ‹è¯• 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;/dependency&gt; äºŒã€æµ‹è¯•ç±»ç¤ºä¾‹ 1ã€å¯¹Serviceæµ‹è¯•2ã€å¯¹Controlleræµ‹è¯• getè¯·æ±‚ postè¯·æ±‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181package com.baseinfo;import java.util.List;import org.junit.Before;import org.junit.Test;import org.junit.runner.RunWith;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.http.MediaType;import org.springframework.mock.web.MockHttpServletRequest;import org.springframework.mock.web.MockHttpServletResponse;import org.springframework.mock.web.MockHttpSession;import org.springframework.test.context.junit4.SpringRunner;import org.springframework.test.web.servlet.MockMvc;import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;import org.springframework.test.web.servlet.result.MockMvcResultHandlers;import org.springframework.test.web.servlet.result.MockMvcResultMatchers;import org.springframework.test.web.servlet.setup.MockMvcBuilders;import org.springframework.web.context.WebApplicationContext;import org.topcloud.modules.mongodb.dao.MongoDao;import org.topcloud.modules.sessioncookie.SessionCookieHelper;import org.topcloud.password.encoding.Md5PasswordEncoder;import com.cpnsp.api.ApiApplication;import com.cpnsp.model.SpUnit;import com.cpnsp.model.SpUser;import com.cpnsp.service.SpDataService;import com.testenroll.model.TeExaminee;@RunWith(SpringRunner.class)@SpringBootTest(classes = ApiApplication.class)public class BaseTest { @Autowired private WebApplicationContext wac; @Autowired private MockHttpServletRequest request; @Autowired private MockHttpServletResponse response; @Autowired private MockHttpSession session; @Autowired private SessionCookieHelper sessionCookieHelper; @Autowired private MongoDao mongoDao; @Autowired private SpDataService spDataService; private MockMvc mockMvc; @Before public void setup() { // this.mockMvc = MockMvcBuilders.standaloneSetup(new SpUnitController()).build(); mockMvc = MockMvcBuilders.webAppContextSetup(wac).build(); //åˆå§‹åŒ–mockMvcå¯¹è±¡ session = new MockHttpSession(); SpUser user = new SpUser(); user = mongoDao.findOneBy(SpUser.class, &quot;loginName&quot;, null, &quot;admin&quot;); // session.setAttribute(&quot;user&quot;, user); sessionCookieHelper.writeCookie(&quot;spu&quot;, user.getId().toString(), 60 * 60 * 24, request, response); } @Test public void findOneTest() { SpUser user = mongoDao.get(SpUser.class, 1); System.out.println(user.getLoginName()); } /** * serviceæµ‹è¯• */ @Test public void serviceTest() { List&lt;SpUnit&gt; units = spDataService.getUnitTreeData(&quot;1,&quot;); System.out.println(units.size()); } /** * é‡ç½®å¯†ç  */ @Test public void resetPasswd() { Md5PasswordEncoder passwordEncoder = new Md5PasswordEncoder(); String uid = &quot;60a70fa0aac64fbcb143fab5c6194df5&quot;; SpUser user = new SpUser(); user.setUid(uid); System.out.println(passwordEncoder.encodePassword(&quot;123456&quot;, user.getSalt())); TeExaminee examinee = new TeExaminee(); examinee.setUid(&quot;b854ab1cda634d0885b6275a4f8fafa7&quot;); System.out.println(passwordEncoder.encodePassword(&quot;123456&quot;, examinee.getSalt())); } /** * ç™»å½•æ¥å£æµ‹è¯• */ @Test public void httpLoginTest() { try { mockMvc.perform(MockMvcRequestBuilders.get(&quot;/admin/login/admin/123456&quot;, &quot;1&quot;)) .andExpect(MockMvcResultMatchers.status().isOk()) .andDo(MockMvcResultHandlers.print()) .andReturn(); } catch (Exception e) { e.printStackTrace(); } } /** * getæ–¹æ³•è¯·æ±‚æµ‹è¯• */ @Test public void httpGetTest() { try { mockMvc.perform(MockMvcRequestBuilders.get(&quot;/ws/canEnroll/{unitCode}&quot;, &quot;1&quot;)) .andExpect(MockMvcResultMatchers.status().isOk()) .andDo(MockMvcResultHandlers.print()) .andReturn(); } catch (Exception e) { e.printStackTrace(); } } /** * getæ–¹æ³•å¸¦cookieè¯·æ±‚æµ‹è¯• */ @Test public void httpGet_CookieTest() { try { mockMvc.perform(MockMvcRequestBuilders.get(&quot;/admin/getUnit/{unitUid}&quot;, &quot;8fd7979617cc40998c2ca3fa74dae7ab&quot;) .cookie(response.getCookies())) .andExpect(MockMvcResultMatchers.status().isOk()) .andDo(MockMvcResultHandlers.print()) .andReturn(); } catch (Exception e) { e.printStackTrace(); } } /** * postæ–¹æ³•è¯·æ±‚æµ‹è¯• * æ¥å—å‚æ•°ä¸º@RequestParam */ @Test public void httpPost_ParamTest() { try { // MockMvcRequestBuildersæ„å»ºGETè¯·æ±‚ String result = mockMvc.perform(MockMvcRequestBuilders.post(&quot;/ws/modifyPasswd&quot;) .cookie(response.getCookies()) .contentType(MediaType.APPLICATION_JSON_UTF8)// è¯·æ±‚ç¼–ç å’Œæ•°æ®æ ¼å¼ä¸ºjsonå’ŒUTF8 .param(&quot;oldPasswd&quot;, &quot;12345&quot;).param(&quot;newPasswd&quot;, &quot;123456&quot;))// è¯·æ±‚çš„å‚æ•°ï¼Œä¸ºjsonçš„æ ¼å¼ .andExpect(MockMvcResultMatchers.status().isOk()) // æœŸæœ›çš„è¿”å›å€¼ æˆ–è€…è¿”å›çŠ¶æ€ç  .andReturn().getResponse().getContentAsString(); // è¿”å›è¯·æ±‚çš„å­—ç¬¦ä¸²ä¿¡æ¯ System.out.println(result); } catch (Exception e) { e.printStackTrace(); } } /** * postæ–¹æ³•è¯·æ±‚æµ‹è¯• * æ¥å—å‚æ•°ä¸º@RequestBody */ @Test public void httpPost_BodyTest() { try { String content = &quot;{\\&quot;code\\&quot;:\\&quot;111111\\&quot;,\\&quot;linkman\\&quot;:\\&quot;å¼ ä¸‰\\&quot;}&quot;; // MockMvcRequestBuildersæ„å»ºGETè¯·æ±‚ String result = mockMvc.perform(MockMvcRequestBuilders.post(&quot;/admin/saveUnit&quot;) .cookie(response.getCookies()) .contentType(MediaType.APPLICATION_JSON_UTF8)// è¯·æ±‚ç¼–ç å’Œæ•°æ®æ ¼å¼ä¸ºjsonå’ŒUTF8 .content(content))// è¯·æ±‚çš„å‚æ•°ï¼Œä¸ºjsonçš„æ ¼å¼ .andExpect(MockMvcResultMatchers.status().isOk())// æœŸæœ›çš„è¿”å›å€¼ æˆ–è€…è¿”å›çŠ¶æ€ç  .andReturn().getResponse().getContentAsString();// è¿”å›è¯·æ±‚çš„å­—ç¬¦ä¸²ä¿¡æ¯ System.out.println(result); } catch (Exception e) { e.printStackTrace(); } }} æ­¤ç¯‡åªæ˜¯ç®€å•å¯¹serviceã€Controlleræµ‹è¯•ï¼Œæ¶‰åŠå¯¹sessionã€cookieçš„æ‹¦æˆªçš„æ–¹æ³•ã€‚å…¶å®ƒå…·ä½“ æ–­è¨€ã€äº‹åŠ¡ã€å›æ»šæš‚æœªè®¾æ¶‰åŠã€‚å¾…æ—¥åè¡¥å……ã€‚","link":"/2018/05/17/java/Spring-Boot/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/Spring-boot%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"},{"title":"ç¼–ç ä¸è§£ç ","text":"ç¼–ç ï¼šå­—ç¬¦ä¸²å˜æˆå­—èŠ‚æ•°ç»„ã€‚ è§£ç ï¼šå­—èŠ‚æ•°ç»„å˜æˆå­—ç¬¦ä¸²ã€‚ Stringâ€“&gt;byte[]; str.getBytes(); str.getBytes(charsetName); byte[]â€“&gt;String; new String(byte[]); new String(byte[],charsetName) 12345678910111213141516import java.util.*;class EncodeDemo{ public static void main(String[] args) throws Exception{ String s = &quot;ä½ å¥½&quot;; byte[] b1 = s.getBytes(&quot;GBK&quot;); System.out.println(Arrays.toString(b1)); String s1 = new String(b1,&quot;ISO8859-1&quot;); System.out.println(s1); //å¯¹s1è¿›è¡Œiso8859-1ç¼–ç ã€‚ byte[] b2 = s1.getBytes(&quot;ISO8859-1&quot;); System.out.println(Arrays.toString(b2)); String s2 = new String(b2,&quot;GBK&quot;); System.out.println(s2); }}","link":"/2018/05/12/java/exercise/IO/EncodeDemo/"},{"title":"æ“ä½œå­—èŠ‚æ•°ç»„ByteArrayInputStreamä¸ByteArrayOutputStream","text":"å†…å­˜æ“ä½œæµï¼š æ“ä½œå­—èŠ‚æ•°ç»„ByteArrayInputStreamã€ByteArrayOutputStream æ“ä½œå­—ç¬¦æµæ•°ç»„CharArrayReaderã€CharArrayWite æ“ä½œå­—ç¬¦ä¸²StringReaderã€StringWriter ByteArrayInputStreamã€ByteArrayOutputStreamç”¨äºæ“ä½œå­—èŠ‚æ•°ç»„çš„æµå¯¹è±¡ã€‚ ByteArrayInputStream:åœ¨æ„é€ çš„æ—¶å€™ï¼Œéœ€è¦æ¥æ”¶æ•°æ®æºã€‚è€Œä¸”æ•°æ®æºæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚ ByteArrayOutputStream:åœ¨æ„é€ çš„æ—¶å€™ï¼Œä¸ç”¨å®šä¹‰æ•°æ®ç›®çš„ã€‚å› ä¸ºè¯¥å¯¹è±¡ä¸­å·²ç»å°è£…äº†å¯å˜é•¿åº¦çš„å­—èŠ‚æ•°ç»„ã€‚è¿™å°±æ˜¯æ•°æ®ç›®çš„åœ°ã€‚ å› ä¸ºè¿™ä¸¤ä¸ªæµå¯¹è±¡éƒ½æ“ä½œæ•°æ®ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚æ‰€ä»¥ï¼Œä¸ç”¨è¿›è¡Œcloseå…³é—­ã€‚ åœ¨æµæ“ä½œè§„å¾‹è®²è§£æ—¶ï¼šæºè®¾å¤‡ï¼š - é”®ç›˜ System.in, ç¡¬ç›˜ FileStreamï¼Œå†…å­˜ ArrayStreamç›®çš„è®¾å¤‡ï¼š - æ§åˆ¶å° System.out ï¼Œç¡¬ç›˜ FileStreamï¼Œå†…å­˜ ArrayStream ç”¨æµçš„è¯»å†™æ€æƒ³æ¥æ“ä½œæ•°ç»„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.io.*;class ByteArrayStream{ public static void main(String[] args) throws IOException{ //byteArrayOutputStream_1(); byteArrayInputStream_1(); } public static void byteArrayInputStream_1() throws IOException{ byte[] buf = &quot;ABCD\\n123&quot;.getBytes(); ByteArrayInputStream bais = new ByteArrayInputStream(buf); BufferedReader br = new BufferedReader(new InputStreamReader(bais));//è½¬æ¢ä¸ºå­—ç¬¦æµ String str = null; while((str = br.readLine())!=null) { System.out.println(str); } br.close(); } public static void byteArrayOutputStream_1() throws IOException{ ByteArrayOutputStream baos = new ByteArrayOutputStream(); baos.write(&quot;abc&quot;.getBytes()); baos.writeTo(new FileOutputStream(&quot;F:\\\\logs\\\\baos.txt&quot;)); baos.reset(); System.out.println(baos.toString()); } public static void byteArray_1() throws IOException{ ByteArrayInputStream bis = new ByteArrayInputStream(&quot;ABCDEF&quot;.getBytes()); //æ•°æ®ç›®çš„ ByteArrayOutputStream bos = new ByteArrayOutputStream(); int by = 0; while((by = bis.read())!=-1){ bos.write(by); } System.out.println(bos.size()); System.out.println(bos.toString()); //bos.writeTo(new FileOutputStream(&quot;a.txt&quot;)); }}","link":"/2018/05/12/java/exercise/IO/ByteArrayStream/"},{"title":"ç¼–ç _è½¬æ¢æµInputStreamReaderä¸OutputStreamWriter","text":"è½¬æ¢æµ å­—èŠ‚æµé€šå‘å­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå¯ä»¥æŒ‡å®šå­—ç¬¦ç¼–ç è¡¨ã€‚InputStreamReaderã€OutputStreamWriter å¸¸è§çš„ç¼–ç è¡¨ï¼š - ASCIIï¼šç¾å›½æ ‡å‡†ä¿¡æ¯äº¤æ¢ç ã€‚ ç”¨ä¸€ä¸ªå­—èŠ‚çš„7ä½å¯ä»¥è¡¨ç¤ºã€‚ - ISO8859-1ï¼šæ‹‰ä¸ç è¡¨ã€‚æ¬§æ´²ç è¡¨ ç”¨ä¸€ä¸ªå­—èŠ‚çš„8ä½è¡¨ç¤ºã€‚ - GBK2312:ä¸­å›½çš„ä¸­æ–‡ç¼–ç è¡¨ã€‚ - GBK:ä¸­å›½çš„ä¸­æ–‡ç¼–ç è¡¨å‡çº§ã€‚ ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸”æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ä¸º1ã€‚æ‰€ä»¥æ•°å­—å°±ä¸ºè´Ÿæ•°ã€‚ - Unicodeï¼šå›½é™…æ ‡å‡†ç ï¼Œèåˆäº†å¤šç§æ–‡å­—ã€‚ æ‰€æœ‰çš„æ–‡å­—éƒ½ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œjavaè¯­è¨€ä½¿ç”¨çš„å°±æ˜¯unicodeã€‚ - UTF-8ï¼šæœ€å¤šç”¨ä¸‰ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚ â€¦ ä¸­æ–‡ä¸€ä¸ªæ–‡å­—åœ¨GBKç è¡¨ä¸­ç”±2ä¸ªå­—èŠ‚ã€‚ åœ¨UTF-8ç è¡¨ä¸­ç”±3ä¸ªå­—èŠ‚ã€‚ InputStreamReaderï¼šæ„é€ æ–¹æ³•ï¼š InputStreamReader(InputStream in) åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„InputStreamReaderã€‚ InputStreamReader(InputStream in, String charsetName) åˆ›å»ºä¸€ä¸ªä½¿ç”¨æŒ‡å®šå‘½åå­—ç¬¦é›†çš„InputStreamReaderã€‚ å¸¸ç”¨æ–¹æ³•ï¼š String getEncoding() è¿”å›æ­¤æµä½¿ç”¨çš„å­—ç¬¦ç¼–ç çš„åç§°ã€‚ int read() è¯»ä¸€ä¸ªå­—ç¬¦ int read(char[] cbuf, int offset, int length) å°†å­—ç¬¦è¯»å…¥æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚ boolean ready() è¿”å›æ­¤æµæ˜¯å¦å‡†å¤‡å¥½è¢«è¯»å–ã€‚ void close() å…³é—­æµã€‚ OutputStreamWriterï¼šæ„é€ æ–¹æ³•ï¼š OutputStreamWriter(OutputStream out) åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„OutputStreamWriterã€‚ OutputStreamWriter(OutputStream out, String charsetName) åˆ›å»ºä¸€ä¸ªä½¿ç”¨æŒ‡å®šå‘½åå­—ç¬¦é›†çš„OutputStreamWriterã€‚å¸¸ç”¨æ–¹æ³•ï¼š String getEncoding() è¿”å›æ­¤æµä½¿ç”¨çš„å­—ç¬¦ç¼–ç çš„åç§°ã€‚ void write(int c) å†™ä¸€ä¸ªå­—ç¬¦ void write(char[] cbuf, int off, int len) å†™å…¥å­—ç¬¦æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚ void write(String str, int off, int len) å†™ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚ void flush() åˆ·æ–°æµã€‚ void close() å…³é—­æµï¼Œå…ˆåˆ·æ–°ã€‚1234567891011121314151617181920import java.io.*;class EncodeStream{ public static void main(String[] args) throws IOException{ //writeText(); readText(); } public static void readText() throws IOException{ InputStreamReader isr = new InputStreamReader(new FileInputStream(&quot;utf.txt&quot;),&quot;GBK&quot;); char[] buf = new char[10]; int len = isr.read(buf); String s = new String(buf,0,len); System.out.println(s); } public static void writeText() throws IOException{ OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(&quot;utf.txt&quot;),&quot;utf-8&quot;); osw.write(&quot;ä½ å¥½&quot;); osw.close(); }}","link":"/2018/05/12/java/exercise/IO/EncodeStream/"},{"title":"æ“ä½œåŸºæœ¬æ•°æ®ç±»å‹DataInputStreamä¸DataOutputStream","text":"DataInputStreamã€DataOutputStreamå¯ç”¨äºæ“ä½œåŸºæœ¬æ•°æ®ç±»å‹çš„æµå¯¹è±¡ã€‚ DataInputStreamï¼š æ„é€ æ–¹æ³•ï¼š DataInputStream(InputStream in) - int read(byte[] b) - int read(byte[] b, int off, int len) - int skipBytes(int n) //ä»è¾“å…¥æµä¸­è·³è¿‡ nå­—èŠ‚çš„æ•°æ® - boolean readBoolean() //è¯»å–ä¸€ä¸ªè¾“å…¥å­—èŠ‚ - byte readByte() //è¯»å–å¹¶è¿”å›ä¸€ä¸ªè¾“å…¥å­—èŠ‚ã€‚ - int readUnsignedByte() //è¯»å–ä¸€ä¸ªè¾“å…¥å­—èŠ‚ï¼Œå°†å…¶æ‰©å±•åˆ°ç±»å‹ int ï¼Œå¹¶è¿”å›ç»“æœï¼Œå› æ­¤åœ¨ 0åˆ° 255 ã€‚ - int readUnsignedShort() //è¯»å–ä¸¤ä¸ªè¾“å…¥å­—èŠ‚ï¼Œå¹¶è¿”å› 0åˆ° 65535çš„ intå€¼ã€‚ - short readShort() //è¯»å–ä¸¤ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª shortå€¼ã€‚ - char readChar() //è¯»å–ä¸¤ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª charå€¼ã€‚ - int readInt() //è¯»å–å››ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª intå€¼ã€‚ - long readLong() //è¯»å–å…«ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª longå€¼ã€‚ - float readFloat() //è¯»å–å››ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª floatå€¼ã€‚ - double readDouble() //è¯»å–å…«ä¸ªè¾“å…¥å­—èŠ‚å¹¶è¿”å›ä¸€ä¸ª doubleå€¼ã€‚ - String readUTF() //è¯»å–å·²ä½¿ç”¨ ä¿®æ”¹ç‰ˆ UTF-8æ ¼å¼ç¼–ç çš„å­—ç¬¦ä¸²ã€‚DataOutputStream å°†åŸå§‹Javaæ•°æ®ç±»å‹å†™å…¥è¾“å‡ºæµã€‚ ç„¶ååº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ•°æ®è¾“å…¥æµæ¥è¯»å–æ•°æ®ã€‚ æ„é€ æ–¹æ³•ï¼š DataOutputStream(OutputStream out) å¸¸ç”¨æ–¹æ³•ï¼š void flush() åˆ·æ–°æ­¤æ•°æ®è¾“å‡ºæµã€‚ void write(int b)å°†æŒ‡å®šçš„å­—èŠ‚bçš„ä½8ä½ å†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void write(byte[] b, int off,int len) void writeBoolean(boolean v)å°†å¸ƒå°”å€¼ä»¥1å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeByte(int v)å°†byteä»¥1å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeShort(int v)å°†shortä»¥2å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeChar(int v)å°†charä»¥2å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeInt(int v)å°†intä»¥4å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeLong(long v)å°†longä»¥8å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeFloat(float v)å°†floatä»¥4å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeDouble(double v)å°†doubleä»¥4å­—èŠ‚ï¼Œå†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeBytes(String s)å°†å­—ç¬¦ä¸²ä½œä¸ºå­—èŠ‚åºåˆ—å†™å…¥åŸºç¡€è¾“å‡ºæµã€‚ void writeChars(String s)å°†å­—ç¬¦ä¸²ä½œä¸ºä¸€ç³»åˆ—å­—ç¬¦å†™å…¥åº•å±‚è¾“å‡ºæµã€‚ void writeUTF(String str)ä½¿ç”¨ä¿®æ”¹ç‰ˆUTF-8ç¼–ç å°†å­—ç¬¦ä¸²å†™å…¥åŸºç¡€è¾“å‡ºæµã€‚ int size()è¿”å›è®¡æ•°å™¨çš„å½“å‰å€¼written ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å†™å…¥æ­¤æ•°æ®è¾“å‡ºæµçš„å­—èŠ‚æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.io.*;class DataStreamDemo{ public static void main(String[] args)throws IOException{ //writeData(); //readData(); //writeUTFDemo(); //readUTFDemo(); writeUTF2(); } public static void writeUTF2()throws IOException{ OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(&quot;utf.txt&quot;),&quot;utf-8&quot;); osw.write(&quot;ä½ å¥½&quot;); osw.close(); } public static void readUTFDemo()throws IOException{ DataInputStream dis = new DataInputStream(new FileInputStream(&quot;utfdata.txt&quot;)); String s = dis.readUTF(); System.out.println(s); dis.close(); } public static void writeUTFDemo()throws IOException{ DataOutputStream dos = new DataOutputStream(new FileOutputStream(&quot;utfdata.txt&quot;)); dos.writeUTF(&quot;ä½ å¥½&quot;); dos.close(); } public static void readData()throws IOException{ DataInputStream dis = new DataInputStream(new FileInputStream(&quot;dos.txt&quot;)); int num = dis.readInt(); boolean b = dis.readBoolean(); double d =dis.readDouble(); System.out.println(&quot;num=&quot;+num); System.out.println(&quot;b=&quot;+b); System.out.println(&quot;d=&quot;+d); dis.close(); } public static void writeData()throws IOException{ DataOutputStream dos = new DataOutputStream(new FileOutputStream(&quot;dos.txt&quot;)); dos.writeInt(23); dos.writeBoolean(true); dos.writeDouble(45.65); dos.close(); }}","link":"/2018/05/12/java/exercise/IO/DataStreamDemo/"},{"title":"è§£ç â€”â€”â€è”é€šâ€œ","text":"å­—ç¬¦ä¸²â€è”é€šâ€œ äºŒè¿›åˆ¶æ•°å’ŒUTF-8ç¼–ç è¡¨è§„å¾‹å½¢åŒè®°äº‹æœ¬è½¯ä»¶è§£ç ï¼ŒæŸ¥ç¼–ç è¡¨æ—¶ï¼Œä¼šä»UTF-8ç¼–ç è¡¨ä¸­æŸ¥ï¼Œè€Œæ²¡æœ‰åœ¨GBKç¼–ç è¡¨ä¸­æŸ¥ï¼Œæ‰€ä»¥ä¼šé€ æˆä¹±ç ç°è±¡ã€‚ 123456789class EncodeDemo2{ public static void main(String[] args) throws Exception{ String s = &quot;è”é€š&quot;; byte[] by = s.getBytes(&quot;gbk&quot;); for(byte b : by) //System.out.println(b); System.out.println(Integer.toBinaryString(b&amp;255)); }}","link":"/2018/05/12/java/exercise/IO/EncodeDemo2/"},{"title":"Fileå¯¹è±¡","text":"Fileç±»å¸¸è§æ–¹æ³•ï¼š1ã€åˆ›å»ºã€‚ - boolean createNewFile();åœ¨æŒ‡å®šçš„ä½ç½®åˆ›å»ºæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»ºï¼Œè¿”å›falseã€‚ å’Œè¾“å‡ºæµä¸ä¸€æ ·ï¼Œè¾“å‡ºæµå¯¹è±¡ä¸€å»ºç«‹å°±åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¼šè¦†ç›–ã€‚ - boolean mkdir();åˆ›å»ºæ–‡ä»¶å¤¹ã€‚ - boolean mkdirs();åˆ›å»ºå¤šçº§æ–‡ä»¶å¤¹ã€‚ 2ã€åˆ é™¤ã€‚ - boolean delete();åˆ é™¤å¤±è´¥è¿”å›falseã€‚ - void deleteOnExit();åœ¨ç¨‹åºé€€å‡ºæ—¶åˆ é™¤æŒ‡å®šæ–‡ä»¶ã€‚3ã€åˆ¤æ–­ã€‚ - boolean exists();æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ - boolean isFile();æ˜¯å¦æ˜¯æ–‡ä»¶ã€‚ - boolean isDirectory();æ˜¯å¦æ˜¯ç›®å½•ã€‚ - boolean isAbsolute();æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„ã€‚4ã€è·å–ä¿¡æ¯ã€‚ - getName(); - getPath(); - getParent(); - getAbsolutePath(); - long lastModified(); - long length()File æ„é€ æ–¹æ³•ï¼š public File(String pathname) é€šè¿‡å°†æŒ‡å®šçš„è·¯å¾„åå­—ç¬¦ä¸²è½¬æ¢ä¸ºæŠ½è±¡è·¯å¾„åæ¥åˆ›å»ºæ–°çš„Fileå®ä¾‹ã€‚ public File(String parent, String child) ä»çˆ¶è·¯å¾„åå­—ç¬¦ä¸²å’Œå­è·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºæ–°çš„Fileå®ä¾‹ã€‚ public File(File parent, String child) ä»çˆ¶æŠ½è±¡è·¯å¾„åå’Œå­è·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºæ–°çš„Fileå®ä¾‹ã€‚ public File(URI uri) é€šè¿‡å°†ç»™å®šçš„file: URIè½¬æ¢ä¸ºæŠ½è±¡è·¯å¾„åæ¥åˆ›å»ºæ–°çš„Fileå®ä¾‹ã€‚æ–¹æ³•ï¼š String getName() è¿”å›ç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚ String getParent() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„çˆ¶è·¯å¾„åå­—ç¬¦ä¸². File getParentFile() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„çˆ¶æŠ½è±¡è·¯å¾„åã€‚ String getPath() å°†æ­¤æŠ½è±¡è·¯å¾„åè½¬æ¢ä¸ºè·¯å¾„åå­—ç¬¦ä¸²ã€‚ boolean isAbsolute() åˆ¤æ–­è¿™ä¸ªæŠ½è±¡è·¯å¾„åæ˜¯å¦æ˜¯ç»å¯¹çš„ã€‚ String getAbsolutePath() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„ç»å¯¹è·¯å¾„åå­—ç¬¦ä¸²ã€‚ File getAbsoluteFile() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„ç»å¯¹å½¢å¼ã€‚ String getCanonicalPath() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„è§„èŒƒè·¯å¾„åå­—ç¬¦ä¸²ã€‚ File getCanonicalFile() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„è§„èŒƒå½¢å¼ã€‚ URI toURI() æ„é€ ä¸€ä¸ªè¡¨ç¤ºæ­¤æŠ½è±¡è·¯å¾„åçš„file: URIã€‚ boolean canRead() åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯è¯»ã€‚ boolean canWrite() åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯å†™ã€‚ boolean exists() æµ‹è¯•æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚ boolean isDirectory() æµ‹è¯•æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æ˜¯å¦ä¸ºç›®å½•ã€‚ boolean isFile() æµ‹è¯•æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶ã€‚ long lastModified() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶ä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´ã€‚ long length() è¿”å›ç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶çš„é•¿åº¦ã€‚ boolean createNewFile() å½“ä¸”ä»…å½“å…·æœ‰è¯¥åç§°çš„æ–‡ä»¶å°šä¸å­˜åœ¨æ—¶ï¼ŒåŸå­åœ°åˆ›å»ºä¸€ä¸ªç”±è¯¥æŠ½è±¡è·¯å¾„åå‘½åçš„æ–°çš„ç©ºæ–‡ä»¶ã€‚ boolean delete() åˆ é™¤ç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚å¦‚æœæ­¤è·¯å¾„åè¡¨ç¤ºç›®å½•ï¼Œåˆ™ç›®å½•å¿…é¡»ä¸ºç©ºæ‰èƒ½åˆ é™¤ã€‚ void deleteOnExit() åœ¨è™šæ‹Ÿæœºç»ˆæ­¢æ—¶åˆ é™¤ç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ String[] list() è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå‘½åç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚ String[] list(FilenameFilter filter) è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå‘½åç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„ç›®å½•ä¸­æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨çš„æ–‡ä»¶å’Œç›®å½•ã€‚ File[] listFiles() è¿”å›ä¸€ä¸ªæŠ½è±¡è·¯å¾„åæ•°ç»„ï¼Œè¡¨ç¤ºç”±è¯¥æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ File[] listFiles(FilenameFilter filter) è¿”å›ä¸€ä¸ªæŠ½è±¡è·¯å¾„åæ•°ç»„ï¼Œè¡¨ç¤ºç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨çš„ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚ File[] listFiles(FileFilter filter) è¿”å›ä¸€ä¸ªæŠ½è±¡è·¯å¾„åæ•°ç»„ï¼Œè¡¨ç¤ºç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨çš„ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚ boolean mkdir() åˆ›å»ºç”±æ­¤æŠ½è±¡è·¯å¾„åå‘½åçš„ç›®å½•ã€‚ public boolean mkdirs() åˆ›å»ºç”±æ­¤æŠ½è±¡è·¯å¾„åå‘½åçš„ç›®å½•ï¼ŒåŒ…æ‹¬ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ã€‚ boolean renameTo(File dest) é‡å‘½åç”±æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶ã€‚ boolean setLastModified(long time) è®¾ç½®ç”±æ­¤æŠ½è±¡è·¯å¾„åå‘½åçš„æ–‡ä»¶æˆ–ç›®å½•çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ boolean setReadOnly() è®¾ç½®ç”±æ­¤æŠ½è±¡è·¯å¾„åå‘½åçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä»¥ä¾¿åªå…è®¸è¯»å–æ“ä½œã€‚ boolean setWritable(boolean writable, boolean ownerOnly)è®¾ç½®æ­¤æŠ½è±¡è·¯å¾„åçš„æ‰€æœ‰è€…æˆ–æ¯ä¸ªäººçš„å†™å…¥æƒé™ã€‚ boolean setWritable(boolean writable) è®¾ç½®æ‰€æœ‰è€…å¯¹æ­¤æŠ½è±¡è·¯å¾„åçš„å†™å…¥æƒé™ã€‚ boolean setReadable(boolean readable, boolean ownerOnly) è®¾ç½®æ­¤æŠ½è±¡è·¯å¾„åçš„æ‰€æœ‰è€…æˆ–æ¯ä¸ªäººçš„è¯»å–æƒé™ã€‚ boolean setReadable(boolean readable) è®¾ç½®æ‰€æœ‰è€…å¯¹æ­¤æŠ½è±¡è·¯å¾„åçš„è¯»å–æƒé™ã€‚ boolean setExecutable(boolean executable, boolean ownerOnly) è®¾ç½®è¯¥æŠ½è±¡è·¯å¾„åçš„æ‰€æœ‰è€…æˆ–æ¯ä¸ªäººçš„æ‰§è¡Œæƒé™ã€‚ boolean setExecutable(boolean executable) è®¾ç½®æ‰€æœ‰è€…çš„æ‰§è¡Œæƒé™ã€‚ boolean canExecute() åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯ä»¥æ‰§è¡Œã€‚ File[] listRoots() åˆ—å‡ºå¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ ¹ã€‚ long getTotalSpace() é€šè¿‡æ­¤æŠ½è±¡è·¯å¾„åè¿”å›åˆ†åŒºçš„å¤§å°ã€‚ long getFreeSpace() è¿”å›åˆ†åŒºæœªåˆ†é…çš„å­—èŠ‚æ•°ã€‚ long getUsableSpace() è¿”å›çš„å¯ç”¨å­—èŠ‚æ•°. File createTempFile(String prefix,String suffix, File directory) åœ¨æŒ‡å®šçš„ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ï¼Œä½¿ç”¨ç»™å®šçš„å‰ç¼€å’Œåç¼€å­—ç¬¦ä¸²ç”Ÿæˆå…¶åç§°ã€‚ File createTempFile(String prefix, String suffix) åœ¨é»˜è®¤ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œä½¿ç”¨ç»™å®šçš„å‰ç¼€å’Œåç¼€ç”Ÿæˆå…¶åç§°ã€‚ int compareTo(File pathname) æ¯”è¾ƒä¸¤ä¸ªæŠ½è±¡çš„è·¯å¾„åå­—å…¸ã€‚ è¯¥æ–¹æ³•å®šä¹‰çš„é¡ºåºå–å†³äºåº•å±‚ç³»ç»Ÿã€‚ boolean equals(Object obj) æµ‹è¯•æ­¤æŠ½è±¡è·¯å¾„åä¸ç»™å®šå¯¹è±¡çš„ç›¸ç­‰æ€§ã€‚ int hashCode() è®¡ç®—æ­¤æŠ½è±¡è·¯å¾„åçš„å“ˆå¸Œç ã€‚ String toString() è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„è·¯å¾„åå­—ç¬¦ä¸²ã€‚ Path toPath() è¿”å›ä»è¯¥æŠ½è±¡è·¯å¾„æ„é€ çš„java.nio.file.Pathå¯¹è±¡ã€‚ 12345678910111213141516import java.io.*;class FileDemo{ public static void main (String[] args) throws IOException{ method_1(); } public static void method_1() throws IOException{ File f = new File(&quot;file.txt&quot;); f.deleteOnExit(); System.out.println(&quot;create : &quot; + f.createNewFile()); if(1==1){ throw new RuntimeException(); } System.out.println(&quot;delete : &quot; + f.delete()); }}","link":"/2018/04/30/java/exercise/IO/FileDemo/"},{"title":"Fileç»ƒä¹ -æ–‡ä»¶è¿‡æ»¤","text":"æ–‡ä»¶è¿‡æ»¤FilenameFilterï¼š å®ç°æ­¤æ¥å£çš„ç±»çš„å®ä¾‹ç”¨äºè¿‡æ»¤æ–‡ä»¶åã€‚ boolean accept(File dir, String name) åˆ¤æ–­æŒ‡å®šæ–‡ä»¶æ˜¯å¦åº”åŒ…å«åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ã€‚ FileFilterï¼šæŠ½è±¡è·¯å¾„åçš„è¿‡æ»¤å™¨ã€‚ boolean accept(File pathname) åˆ¤æ–­æŒ‡å®šçš„æŠ½è±¡è·¯å¾„åæ˜¯å¦åº”åŒ…å«åœ¨è·¯å¾„ååˆ—è¡¨ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041import java.io.*;class FileDemo2{ public static void main(String[] args){ listDemo3(); } public static void listDemo3(){ File dir = new File(&quot;c:\\\\&quot;); File[] files = dir.listFiles(); for(File file : files){ System.out.println(&quot;name: &quot;+file.getName()+&quot;---length: &quot;+ file.length()); } } //è¿‡æ»¤æ–‡ä»¶å public static void listDemo2(){ File dir = new File(&quot;d:\\\\test&quot;); String[] arr = dir.list(new FilenameFilter(){ public boolean accept(File dir, String name){ return name.endsWith(&quot;.java&quot;); } }); for(String name :arr){ System.out.println(name); } } public static void listDemo(){ File dir = new File(&quot;c:\\\\&quot;); String[] names = dir.list();//è°ƒç”¨listæ–¹æ³•çš„fileå¯¹è±¡å¿…é¡»æ˜¯å°è£…äº†ä¸€ä¸ªç›®å½•ã€‚è¯¥ç›®å½•è¿˜å¿…é¡»å­˜åœ¨ã€‚ for(String name : names){ System.out.println(name); } } //åˆ—å‡ºå¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ ¹ã€‚ public static void listRootDemo(){ File[] files = File.listRoots(); for(File file : files){ System.out.println(file); } }}","link":"/2018/04/30/java/exercise/IO/FileDemo2/"},{"title":"LineNumberReader","text":"LineNumberReader: ç»§æ‰¿è‡ªBufferedReader å¯ä»¥ç¼“å†²å­—ç¬¦è¾“å…¥æµï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å’Œè·å–è¡Œå·ã€‚ LineNumberReader(Reader in) ä½¿ç”¨é»˜è®¤çš„è¾“å…¥ç¼“å†²åŒºå¤§å°åˆ›å»ºè¯¥å¯¹è±¡ã€‚ LineNumberReader(Reader in, int sz) ä½¿ç”¨æŒ‡å®šå¤§å°çš„è¾“å…¥ç¼“å†²åŒºå¤§å°åˆ›å»ºè¯¥å¯¹è±¡ã€‚ void setLineNumber(int lineNumber) è®¾ç½®å½“å‰è¡Œå·ã€‚ int getLineNumber() è·å–å½“å‰è¡Œå·ã€‚ int read() è¯»ä¸€ä¸ªå­—ç¬¦ã€‚ int read(char[] cbuf, int off, int len) å°†å­—ç¬¦è¯»å…¥æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚ String readLine() è¯»ä¸€è¡Œæ–‡å­—ã€‚ long skip(long n) è·³è¿‡å­—ç¬¦ ã€‚ void mark(int readAheadLimit) æ ‡è®°æµä¸­çš„å½“å‰ä½ç½®ã€‚ void reset() å°†æµé‡æ–°è®¾ç½®ä¸ºæœ€è¿‘çš„æ ‡è®°ã€‚ LineNumberInputStream: å·²å¼ƒç”¨ 1234567891011121314151617181920 import java.io.FileReader; import java.io.IOException; import java.io.LineNumberReader; public class LineNumberReaderDemo { public static void main(String[] args) throws IOException{ lineNumberReader_1(); //InputStream is = LineNumberReaderDemo.class.getResourceAsStream(&quot;urls.txt&quot;); } public static void lineNumberReader_1() throws IOException{ LineNumberReader lnrd = new LineNumberReader(new FileReader(&quot;F:\\\\logs\\\\urls.txt&quot;)); lnrd.setLineNumber(10); String str =null; while((str= lnrd.readLine())!=null) { System.out.println(lnrd.getLineNumber() + &quot;: &quot; + str); } lnrd.close(); }}","link":"/2018/05/24/java/exercise/IO/LineNumberReaderDemo/"},{"title":"Fileç»ƒä¹ -è¿‡æ»¤å­˜å‚¨","text":"ç»ƒä¹  å°†ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„javaæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ æ€è·¯ï¼š 1ã€å¯¹æŒ‡å®šçš„ç›®å½•è¿›è¡Œé€’å½’ã€‚ 2ã€è·å–é€’å½’è¿‡ç¨‹æ‰€æœ‰çš„javaæ–‡ä»¶è·¯å¾„ã€‚ 3ã€å°†è¿™äº›è·¯å¾„å­˜å‚¨åˆ°é›†åˆä¸­ã€‚ 4ã€å°†é›†åˆä¸­çš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import java.io.*;import java.util.*;class JavaFileList{ public static void main(String[] args) throws IOException{ File dir = new File(&quot;d:\\\\test&quot;); List&lt;File&gt; files = new ArrayList&lt;File&gt;(); fileToList(dir,files); System.out.println(files.size()); File javaListFile = new File(dir,&quot;javaListFile.txt&quot;); writeToFile(files,javaListFile.toString()); } public static void fileToList(File dir, List&lt;File&gt; list){ File[] files = dir.listFiles(); for(File file : files){ if(file.isDirectory()) fileToList(file,list); else{ if(file.getName().endsWith(&quot;.java&quot;)) list.add(file); } } } public static void writeToFile(List&lt;File&gt; list, String javaListFile) throws IOException{ BufferedWriter buwr = null; try{ buwr = new BufferedWriter(new FileWriter(javaListFile)); for(File file : list){ String path = file.getAbsolutePath(); buwr.write(path); buwr.newLine(); buwr.flush(); } }catch(IOException e){ throw e; }finally{ try{ if(buwr!=null){ buwr.close(); } }catch(IOException e){ System.out.println(&quot;å…³é—­æµå¼‚å¸¸&quot;); } } }}","link":"/2018/04/30/java/exercise/IO/JavaFileList/"},{"title":"å¯¹è±¡åºåˆ—åŒ–ObjectInputStreamä¸ObjectOutputStream","text":"å¯¹è±¡æ“ä½œæµObjectOutputStream åºåˆ—åŒ–æµï¼Œå‘è¾“å‡ºæµä¸­å†™å…¥åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ObjectInputStream ååºåˆ—åŒ–æµï¼Œä»æµä¸­è¯»å–å¯¹è±¡ã€‚ å¯ä»¥æ“ä½œåŸºæœ¬æ•°æ®ç±»å‹æˆ–å®ç°åºåˆ—åŒ–æ¥å£çš„å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778import java.io.*;class ObjectStreamDemo{ public static void main(String[] args) throws Exception{ //readObj(); //writeObj(); //objectOutputStream_1(); objectInputStream_1(); } public static void objectInputStream_1() throws Exception{ FileInputStream fis = new FileInputStream(new File(&quot;F:\\\\logs\\\\oos.log&quot;)); ObjectInputStream ois = new ObjectInputStream(fis); boolean b = ois.readBoolean(); double d = ois.readDouble(); String str = ois.readUTF(); Object obj = ois.readObject(); Student student = (Student)ois.readObject(); System.out.println(b); System.out.println(d); System.out.println(str); System.out.println(obj); System.out.println(student.toString()); ois.close(); fis.close(); } public static void objectOutputStream_1() throws IOException{ FileOutputStream fos = new FileOutputStream(&quot;F:\\\\logs\\\\oos.log&quot;); ObjectOutputStream oos = new ObjectOutputStream(fos); oos.writeBoolean(true); oos.writeDouble(1.23); oos.writeUTF(&quot;ä¸­æ–‡&quot;); oos.writeObject(new Date()); oos.writeObject(new Student(1, &quot;å¼ ä¸‰&quot;, 20)); oos.close(); fos.close(); } public static void readObj() throws Exception{ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;student.object&quot;)); Student s = (Student)ois.readObject(); System.out.println(s); ois.close(); } public static void writeObj() throws IOException{ ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;student.object&quot;)); oos.writeObject(new Student(2,&quot;zhangsan&quot;,12)); oos.close(); }}class Student implements Serializable{ public static final long serialVersionUID = 42L; private Integer id; private String name; private Integer age; private transient String address; public Student(){ } public Student(Integer id,String name,Integer age){ this.id = id; this.name = name; this.age = age; } Student(String name, int age,String country){ this.name = name; this.age = age; this.country = country; } @Override public String toString() { return &quot;Student [id=&quot; + id + &quot;, name=&quot; + name + &quot;, address=&quot; + address + &quot;]&quot;; }} å¦‚æœå¯¹è±¡éœ€è¦è¢«æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå¯¹è±¡æ‰€å±çš„ç±»å¿…é¡»è¦å®ç°Serializableæ¥å£ã€‚ Serializableæ¥å£æ²¡æœ‰ä»»ä½•çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£è€Œå·²ã€‚ å¯¹è±¡çš„ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å¹¶ä¸ä¼šè°ƒç”¨åˆ°æ„é€ æ–¹æ³•ã€‚ serialVersionUID æ˜¯ç”¨äºè®°å½•classæ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯çš„ï¼ŒserialVersionUIDè¿™ä¸ªæ•°å­—æ˜¯é€šè¿‡ä¸€ä¸ªç±»çš„ç±»åã€æˆå‘˜ã€åŒ…åã€å·¥ç¨‹åç®—å‡ºçš„ä¸€ä¸ªæ•°å­—ã€‚ ä½¿ç”¨ObjectInputStreamååºåˆ—åŒ–çš„æ—¶å€™ï¼ŒObjeectInputStreamä¼šå…ˆè¯»å–æ–‡ä»¶ä¸­çš„serialVersionUIDï¼Œç„¶åä¸æœ¬åœ°çš„classæ–‡ä»¶çš„serialVersionUIDè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœè¿™ä¸¤ä¸ªidä¸ä¸€è‡´ï¼Œååºåˆ—åˆ™å¤±è´¥ã€‚ å¦‚æœåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ—¶å€™å¯èƒ½ä¼šä¿®æ”¹ç±»çš„æˆå‘˜ï¼Œé‚£ä¹ˆæœ€å¥½ä¸€å¼€å§‹å°±ç»™è¿™ä¸ªç±»æŒ‡å®šä¸€ä¸ªserialVersionUIDï¼Œå¦‚æœä¸€ç±»å·²ç»æŒ‡å®šçš„serialVersionUIDï¼Œç„¶ååœ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œjvméƒ½ä¸ä¼šå†è‡ªå·±ç®—è¿™ä¸ª classçš„serialVersionUIDäº†ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æŸä¸ªå­—æ®µä¸æƒ³è¢«åºåˆ—åŒ–åˆ°ç¡¬ç›˜ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­—transientä¿®é¥°ã€‚ å¦‚æœä¸€ä¸ªç±»ç»´æŠ¤äº†å¦å¤–ä¸€ä¸ªç±»çš„å¼•ç”¨ï¼Œåˆ™å¦å¤–ä¸€ä¸ªç±»ä¹Ÿéœ€è¦å®ç°Serializableæ¥å£ã€‚","link":"/2018/05/01/java/exercise/IO/ObjectStreamDemo/"},{"title":"Fileç»ƒä¹ -åˆ—å‡ºç›®å½•ç»“æ„","text":"123456789101112131415161718192021222324import java.io.*;class FileDemo3{ public static void main(String[] args){ showDir(new File(&quot;D:\\\\test&quot;),0); } public static String getLevel(int level){ StringBuilder sb = new StringBuilder(); for(int x= 0;x&lt;level;x++){ sb.append(&quot;|--&quot;); } return sb.toString(); } public static void showDir(File dir,int level){ System.out.println(getLevel(level)+dir); level++; File[] files = dir.listFiles(); for(int i = 0; i&lt;files.length;i++){ if(files[i].isDirectory()) showDir(files[i],level); else System.out.println(getLevel(level)+files[i]); } }}","link":"/2018/04/30/java/exercise/IO/FileDemo3/"},{"title":"ç®¡é“æµå¯¹è±¡PipedInputStream","text":"ç®¡é“æµå¯¹è±¡PipedInputStreamã€PipedOutputStreamå¯ä»¥è®©å¤šçº¿ç¨‹é€šè¿‡ç®¡é“è¿›è¡Œçº¿ç¨‹é—´çš„é€šè®¯ã€‚ç®¡é“çš„è¾“å…¥è¾“å‡ºæ˜¯é€šè¿‡ä¸€ä¸ªå¾ªç¯ç¼“å†²æ•°ç»„å®ç°ï¼Œè¿™ä¸ªæ•°ç»„é»˜è®¤å¤§å°1024å­—èŠ‚ï¼Œè¾“å…¥æµPipedInputStreamä»è¿™ä¸ªç¼“å†²æ•°ç»„ä¸­è¯»æ•°æ®ï¼Œè¾“å‡ºæµPipedOutputStreamå‘è¿™ä¸ªå¾ªç¯æ•°ç»„ä¸­å†™å…¥æ•°æ®ã€‚å½“è¿™ä¸ªç¼“å†²æ•°ç»„é¦–æ¬¡ä¸ºç©ºçš„æ—¶å€™ï¼Œè¾“å…¥æµPipedInputStreamæ‰€åœ¨çš„çº¿ç¨‹å°†ä¼šå µå¡ï¼›å½“è¿™ä¸ªç¼“å†²æ•°ç»„å·²æ»¡æ—¶ï¼Œè¾“å‡ºæµPipedOutputStreamæ‰€åœ¨çš„çº¿ç¨‹å°†ä¼šå µå¡ã€‚ ä¸è¦å†å•ä¸ªçº¿ç¨‹ä½¿ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šä½¿çº¿ç¨‹æ­»é”ã€‚ PipedInputStreamï¼šæ„é€ æ–¹æ³•ï¼š PipedInputStream() åˆ›å»ºä¸€ä¸ª PipedInputStream å¯¹è±¡ã€‚å°šæœª connectedã€‚ PipedInputStream(int pipeSize) åˆ›å»ºä¸€ä¸ª PipedInputStream ï¼Œå°šæœª connected ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„ç®¡é“å¤§å°ä½œä¸ºç®¡é“çš„ç¼“å†²åŒºã€‚ PipedInputStream(PipedOutputStream src) åˆ›å»ºä¸€ä¸ª PipedInputStream ï¼Œä½¿å…¶è¿æ¥åˆ°ç®¡é“è¾“å‡ºæµ src ã€‚ PipedInputStream(PipedOutputStream src, int pipeSize) åˆ›å»ºä¸€ä¸ª PipedInputStream ï¼Œä½¿å…¶è¿æ¥åˆ°ç®¡é“è¾“å‡ºæµ src ï¼Œå¹¶ä¸ºç®¡é“ç¼“å†²åŒºä½¿ç”¨æŒ‡å®šçš„ç®¡é“å¤§å°ã€‚ void connect(PipedOutputStream src) ä½¿æ­¤ç®¡é“è¾“å…¥æµè¿æ¥åˆ°ç®¡é“è¾“å‡ºæµsrc ã€‚ å¦‚æœæ­¤å¯¹è±¡å·²è¿æ¥åˆ°å…¶ä»–ç®¡é“è¾“å‡ºæµï¼Œåˆ™æŠ›å‡ºIOException ã€‚ void receive(int b) æ¥æ”¶ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ å¦‚æœæ²¡æœ‰è¾“å…¥å¯ç”¨ï¼Œæ­¤æ–¹æ³•å°†é˜»æ­¢ã€‚ int read() ä»è¿™ä¸ªç®¡é“è¾“å…¥æµè¯»å–æ•°æ®çš„ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚ int read(byte[] b, int off, int len) ä»è¿™ä¸ªç®¡é“è¾“å…¥æµè¯»å–lenå­—èŠ‚çš„æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚ int available() è¿”å›å¯ä»¥ä»è¯¥è¾“å…¥æµè¯»å–è€Œä¸é˜»å¡çš„å­—èŠ‚æ•°ã€‚ void close() å…³é—­æ­¤ç®¡é“è¾“å…¥æµã€‚ void write(byte[] b, int off, int len) ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥lenå­—èŠ‚ã€‚ void flush() åˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶ä»»ä½•ç¼“å†²çš„è¾“å‡ºå­—èŠ‚è¢«å†™å‡ºã€‚ void close() å…³é—­æ­¤ç®¡é“è¾“å‡ºæµã€‚ PipedOutputStreamï¼šæ„é€ æ–¹æ³•ï¼š PipedOutputStream() åˆ›å»ºä¸€ä¸ªå°šæœªè¿æ¥åˆ°ç®¡é“è¾“å…¥æµçš„ç®¡é“è¾“å‡ºæµã€‚ PipedOutputStream(PipedInputStream snk) åˆ›å»ºè¿æ¥åˆ°æŒ‡å®šç®¡é“è¾“å…¥æµçš„ç®¡é“è¾“å‡ºæµã€‚ void connect(PipedInputStream snk) å°†æ­¤ç®¡é“è¾“å‡ºæµè¿æ¥åˆ°è¾“å…¥æµã€‚ void write(int b) å†™å…¥æŒ‡å®šbyteåˆ°ç®¡é“è¾“å‡ºæµã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import java.io.*;class Read implements Runnable{ private PipedInputStream in; Read(PipedInputStream in){ this.in = in; } public void run(){ try{ byte[] buf = new byte[1024]; System.out.println(&quot;è¯»å–å‰æ²¡æœ‰æ•°æ®ï¼Œå°±å µå¡ã€‚&quot;); int len = in.read(buf); System.out.println(&quot;è¯»åˆ°æ•°æ®ï¼Œå µå¡ç»“æŸã€‚&quot;); String s = new String(buf,0,len); System.out.println(s); in.close(); }catch(IOException e){ throw new RuntimeException(&quot;è¯»å–ç®¡é“æµå¼‚å¸¸ï¼&quot;); } }}class Write implements Runnable{ private PipedOutputStream out; Write(PipedOutputStream out){ this.out = out; } public void run(){ try{ System.out.println(&quot;å¼€å§‹å†™å…¥æ•°æ®ï¼Œç­‰å¾…å…­ç§’åã€‚&quot;); Thread.sleep(6000); out.write(&quot;gandaoliushuju ...&quot;.getBytes()); out.close(); }catch(Exception e){ throw new RuntimeException(&quot;è¾“å‡ºç®¡é“æµå¼‚å¸¸ï¼&quot;); } }}class PipedStreamDemo{ public static void main(String[] args) throws Exception{ PipedInputStream in = new PipedInputStream(); PipedOutputStream out = new PipedOutputStream(); in.connect(out); Read r = new Read(in); Write w = new Write(out); new Thread(r).start(); new Thread(w).start(); }}","link":"/2018/05/01/java/exercise/IO/PipedStreamDemo/"},{"title":"æ‰“å°æµPrintWriterä¸PrintStream","text":"æ‰“å°æµï¼šè¯¥æµæä¾›äº†æ‰“å°æ–¹æ³•ï¼Œå¯ä»¥å°†å„ç§æ•°æ®ç±»å‹çš„æ•°æ®éƒ½åŸæ ·æ‰“å°ã€‚ å­—èŠ‚æ‰“å°æµï¼šPrintStreamæ„é€ å‡½æ•°å¯ä»¥æ¥æ”¶çš„å‚æ•°ç±»å‹ã€‚1ã€fileå¯¹è±¡ã€‚File PrintStream(File file) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰“å°æµã€‚ PrintStream(File file, String csn) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶å’Œå­—ç¬¦é›†åˆ›å»ºæ–°çš„æ‰“å°æµã€‚2ã€å­—ç¬¦ä¸²è·¯å¾„ã€‚String PrintStream(String fileName) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶ååˆ›å»ºPrintStreamã€‚ PrintStream(String fileName, String csn) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶åã€å­—ç¬¦é›†åˆ›å»ºPrintStreamã€‚3ã€å­—èŠ‚è¾“å‡ºæµã€‚OutputStream PrintStream(OutputStream out) å°†OutputStreamä½œä¸ºPrintStreamçš„è¾“å‡ºæµï¼Œä¸ä¼šè‡ªåŠ¨flush PrintStream(OutputStream out, boolean autoFlush) å°†OutputStreamä½œä¸ºPrintStreamçš„è¾“å‡ºæµï¼ŒæŒ‡å®šæ˜¯å¦è‡ªåŠ¨flushã€‚ PrintStream(OutputStream out, boolean autoFlush, String encoding) å°†OutputStreamä½œä¸ºPrintStreamçš„è¾“å‡ºæµï¼ŒæŒ‡å®šæ˜¯å¦è‡ªåŠ¨flushï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ã€‚ æ–¹æ³•ï¼š void flush() åˆ·æ–°æµã€‚ void close() å…³é—­æµã€‚ boolean checkError() åˆ·æ–°æµå¹¶æ£€æŸ¥å…¶é”™è¯¯çŠ¶æ€ã€‚ void setError() å°†æµçš„é”™è¯¯çŠ¶æ€è®¾ç½®ä¸ºtrue ã€‚ void clearError() æ¸…é™¤æ­¤æµçš„å†…éƒ¨é”™è¯¯çŠ¶æ€ã€‚ void write(int b) å°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥æ­¤æµã€‚ void write(byte[] buf, int off, int len) ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥lenå­—èŠ‚ã€‚ void print(boolean b) æ‰“å°å¸ƒå°”å€¼ã€‚ void print(char c) æ‰“å°ä¸€ä¸ªå­—ç¬¦ã€‚ void print(int i) æ‰“å°ä¸€ä¸ªæ•´æ•°ã€‚ void print(long l) æ‰“å°ä¸€ä¸ªé•¿æ•´æ•°ã€‚ void print(float f) æ‰“å°åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚ void print(char[] s) æ‰“å°å­—ç¬¦æ•°ç»„ã€‚ void print(String s) æ‰“å°å­—ç¬¦ä¸²ã€‚ void print(Object obj) æ‰“å°ä¸€ä¸ªå¯¹è±¡ã€‚ void println() å†™å…¥è¡Œåˆ†éš”ç¬¦è¿›è¡Œæ¢è¡Œã€‚ void println(boolean x) æ‰“å°ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç„¶åæ¢è¡Œã€‚â€¦ PrintStream printf(String format, Objectâ€¦ args) ä½¿ç”¨æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²å’Œå‚æ•°å°†æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²å†™å…¥æ­¤è¾“å‡ºæµã€‚ PrintStream format(String format, Objectâ€¦ args) ä½¿ç”¨æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²å’Œå‚æ•°å°†æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²å†™å…¥æ­¤è¾“å‡ºæµã€‚ PrintStream append(char c) å°†æŒ‡å®šçš„å­—ç¬¦é™„åŠ åˆ°æ­¤è¾“å‡ºæµã€‚ å­—ç¬¦è¾“å‡ºæµPrintWriteræ„é€ å‡½æ•°å¯ä»¥æ¥æ”¶çš„å‚æ•°ç±»å‹ã€‚1ã€fileå¯¹è±¡ã€‚File PrintWriter(File file) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰“å°æµã€‚ PrintWriter(File file, String csn) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶å’Œå­—ç¬¦é›†åˆ›å»ºä¸€ä¸ªæ–°çš„PrintWriterã€‚2ã€å­—ç¬¦ä¸²è·¯å¾„ã€‚String PrintWriter(String fileName) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶ååˆ›å»ºPrintWriterã€‚ PrintWriter(String fileName, String csn) ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶åå’Œå­—ç¬¦é›†åˆ›å»ºä¸€ä¸ªæ–°çš„PrintWriterã€‚3ã€å­—èŠ‚è¾“å‡ºæµã€‚OutputStream PrintWriter(OutputStream out) å°†OutputStreamä½œä¸ºPrintWriterçš„è¾“å‡ºæµï¼Œä¸ä¼šè‡ªåŠ¨flushã€‚ PrintWriter(OutputStream out, boolean autoFlush) å°†OutputStreamä½œä¸ºPrintWriterçš„è¾“å‡ºæµï¼ŒæŒ‡å®šæ˜¯å¦è‡ªåŠ¨flushã€‚4ã€å­—ç¬¦è¾“å‡ºæµã€‚Writer PrintWriter(Writer out) PrintWriter(Writer out, boolean autoFlush) 12345678910111213141516171819import java.io.*;class PrintWriterDemo{ public static void main(String[] args) throws IOException{ BufferedReader bufr = new BufferedReader(new InputStreamReader(System.in)); //PrintWriter out = new PrintWriter(System.out,true); PrintWriter out = new PrintWriter(new FileWriter(&quot;a.txt&quot;),true); String line = null; while((line=bufr.readLine())!=null){ if(&quot;over&quot;.equals(line)) break; out.println(line.toUpperCase()); //out.flush(); } out.close(); bufr.close(); }}","link":"/2018/05/01/java/exercise/IO/PrintWriterDemo/"},{"title":"éšæœºè®¿é—®æµå¯¹è±¡RandomAccessFile","text":"RandomAccessFileå¯ä»¥æŒ‡å®šæ–‡ä»¶ä¸­ä»»ä½•ä¸€ä¸ªä½ç½®å»æ“ä½œä¸€ä¸ªæ–‡ä»¶ã€‚ è¯¥ç±»ä¸æ˜¯IOä½“ç³»ä¸­çš„å­ç±»ã€‚è€Œæ˜¯ç›´æ¥ç»§æ‰¿è‡ªobjectã€‚ ä½†æ˜¯å®ƒæ˜¯IOåŒ…ä¸­çš„æˆå‘˜ã€‚å› ä¸ºå®ƒå…·å¤‡è¯»å’Œå†™çš„åŠŸèƒ½ã€‚å†…éƒ¨å°è£…äº†ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸”é€šè¿‡æŒ‡é’ˆå¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ“ä½œã€‚å¯ä»¥é€šè¿‡getFilePointerè·å–æŒ‡é’ˆä½ç½®ã€‚åŒæ—¶å¯ä»¥é€šè¿‡seekæ”¹å˜æŒ‡é’ˆçš„ä½ç½®ã€‚ è¯¥ç±»å®Œæˆè¯»å†™çš„åŸç†å°±æ˜¯å†…éƒ¨å°è£…äº†å­—èŠ‚è¾“å…¥æµå’Œè¾“å‡ºæµã€‚ é€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç±»åªèƒ½æ“ä½œæ–‡ä»¶ã€‚è€Œä¸”æ“ä½œæ–‡ä»¶è¿˜æœ‰æ¨¡å¼ï¼šåªè¯»rï¼Œè¯»å†™rwç­‰ã€‚ å¦‚æœæ–‡ä»¶æ¨¡å¼ä¸ºåªè¯» rã€‚ä¸ä¼šåˆ›å»ºæ–‡ä»¶ï¼Œä¼šå»è¯»å–ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚å¦‚æœæ¨¡å¼ä¸ºrwï¼Œé‚£ä¹ˆè¦æ“ä½œçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸ä¼šè¦†ç›–ã€‚ æ„é€ å‡½æ•°ï¼š RandomAccessFile(String name, String mode) åˆ›å»ºRandomAccessFileæ–‡ä»¶æµï¼Œä»ä¸­æŒ‡å®šåç§°çš„æ–‡ä»¶è¯»å–ï¼Œå¹¶æŒ‡å®šæ“ä½œæ–‡ä»¶æ¨¡å¼ã€‚ RandomAccessFile(File file, String mode) åˆ›å»ºRandomAccessFileæ–‡ä»¶æµï¼Œä»¥Fileå‚æ•°æŒ‡å®šåæ–‡ä»¶ï¼Œå¹¶æŒ‡å®šæ“ä½œæ–‡ä»¶æ¨¡å¼ã€‚ å¸¸ç”¨æ–¹æ³•ï¼š - int read() - int read(byte[] b, int off, int len) - int read(byte[] b) ä»è¯¥æ–‡ä»¶è¯»å–æœ€å¤šb.lengthä¸ªå­—èŠ‚çš„æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚ - void readFully(byte[] b) ä»æ­¤æ–‡ä»¶è¯»å–b.lengthå­—èŠ‚åˆ°å­—èŠ‚æ•°ç»„ã€‚ - int skipBytes(int n) è·³è¿‡nå­—èŠ‚çš„è¾“å…¥ã€‚ - void write(int b) å°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥æ­¤æ–‡ä»¶ã€‚ - void write(byte[] b) å°† b.lengthå­—èŠ‚ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥æ­¤æ–‡ä»¶ã€‚ - void write(byte[] b, int off, int len) - long getFilePointer() è¿”å›æ­¤æ–‡ä»¶ä¸­çš„å½“å‰åç§»é‡ã€‚ - void seek(long pos) è®¾ç½®æ–‡ä»¶æŒ‡é’ˆåç§»ã€‚ - long length() è¿”å›æ­¤æ–‡ä»¶çš„é•¿åº¦ã€‚ - void setLength(long newLength) è®¾ç½®æ­¤æ–‡ä»¶çš„é•¿åº¦ã€‚ - void close() å…³é—­æµã€‚ - boolean readBoolean() ä»æ­¤æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªboolean ï¼Œå•ä¸ªå­—èŠ‚ã€‚ â€¦ - String readLine() ä»æ­¤æ–‡ä»¶ä¸­è¯»å–ä¸‹ä¸€è¡Œæ–‡æœ¬ã€‚ - String readUTF() ä»è¯¥æ–‡ä»¶è¯»å–å­—ç¬¦ä¸²ï¼Œä»¥ä¿®æ”¹ç‰ˆUTF-8æ ¼å¼ç¼–ç ã€‚ - void writeBoolean(boolean v) å°†booleanä½œä¸ºä¸€ä¸ªå­—èŠ‚å€¼å†™å…¥æ–‡ä»¶ã€‚ â€¦ - void writeUTF(String str) ä»¥ä¿®æ”¹ç‰ˆUTF-8æ ¼å¼ç¼–ç å†™å…¥æ–‡ä»¶ã€‚ 12345678910111213141516171819202122232425262728293031323334import java.io.*;class RandomAccessFileDemo{ public static void main(String[] args) throws IOException{ //writeFile(); readFile(); } public static void readFile() throws IOException{ RandomAccessFile raf = new RandomAccessFile(&quot;ran.txt&quot;,&quot;r&quot;); //è°ƒæ•´å¯¹è±¡ä¸­çš„æŒ‡é’ˆã€‚ raf.seek(8*1); //è·³è¿‡æŒ‡å®šçš„å­—èŠ‚æ•° //raf.skipBytes(8); byte[] buf = new byte[4]; raf.read(buf); String name = new String(buf); int age = raf.readInt(); System.out.println(&quot;name:&quot;+name); System.out.println(&quot;age:&quot;+age); } public static void writeFile() throws IOException{ RandomAccessFile raf = new RandomAccessFile(&quot;ran.txt&quot;,&quot;rw&quot;); raf.write(&quot;æå››&quot;.getBytes()); raf.writeInt(97); raf.write(&quot;ç‹äº”&quot;.getBytes()); raf.writeInt(99); raf.close(); }}","link":"/2018/05/01/java/exercise/IO/RandomAccessFileDemo/"},{"title":"åˆå¹¶æµSequenceInputStream","text":"SequenceInputStreamå°†å¤šä¸ªæµå¯¹è±¡è¿›è¡Œé€»è¾‘ä¸²è”ï¼Œåˆå¹¶å˜æˆä¸€ä¸ªæµå¯¹è±¡ã€‚ æ„é€ æ–¹æ³•ï¼š SequenceInputStream(Enumeration&lt;? extends InputStream&gt; e) ä¼ å…¥æšä¸¾å‚æ•°Enumerationçš„è¾“å…¥æµï¼Œæ¥åˆ›å»ºçš„SequenceInputStream ï¼Œæšä¸¾äº§ç”Ÿçš„è¾“å…¥æµå°†æŒ‰é¡ºåºè¯»å–ã€‚ SequenceInputStream(InputStream s1, InputStream s2) ä¼ å…¥ä¸¤ä¸ªè¾“å…¥æµå¯¹è±¡ï¼Œæ¥åˆ›å»ºçš„SequenceInputStream ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å°†æŒ‰é¡ºåºè¯»å–ã€‚ å¸¸ç”¨æ–¹æ³•ï¼š - int read() - int read(byte[] b, int off, int len) - void close() - int available() ç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637import java.io.*;import java.util.*;class SequenceDemo{ public static void main(String[] args) throws IOException{ Vector&lt;FileInputStream&gt; v = new Vector&lt;FileInputStream&gt;(); v.add(new FileInputStream(&quot;1.txt&quot;)); v.add(new FileInputStream(&quot;2.txt&quot;)); v.add(new FileInputStream(&quot;3.txt&quot;)); Enumeration&lt;FileInputStream&gt; en = v.elements(); SequenceInputStream sis =new SequenceInputStream(en); FileOutputStream fos = new FileOutputStream(&quot;4.txt&quot;); byte[] buf = new byte[1024]; int len=0; while((len=sis.read(buf))!=-1){ fos.write(buf,0,len); } fos.close(); sis.close(); } public static void sequenceInputStream_1() throws IOException{ List&lt;FileInputStream&gt; list = new ArrayList&lt;&gt;(); list.add(new FileInputStream(&quot;F:\\\\logs\\\\osw.txt&quot;)); list.add(new FileInputStream(&quot;F:\\\\logs\\\\urls.txt&quot;)); FileOutputStream fos = new FileOutputStream(&quot;F:\\\\logs\\\\sis.txt&quot;); Enumeration&lt;FileInputStream&gt; enume = Collections.enumeration(list); SequenceInputStream sis = new SequenceInputStream(enume); BufferedInputStream bis = new BufferedInputStream(sis); byte[] buf = new byte[1024]; int len = 0; while((len= bis.read(buf))!=-1) { fos.write(buf, 0, len); } bis.close(); fos.close(); }}","link":"/2018/05/01/java/exercise/IO/SequenceDemo/"},{"title":"ArrayList","text":"ArrayList ç»§æ‰¿è‡ª AbstractListåº•å±‚çš„æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯æ•°ç»„ç»“æ„ã€‚ç‰¹ç‚¹ï¼šæŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯å¢åˆ ç¨æ…¢ã€‚çº¿ç¨‹ä¸åŒæ­¥ã€‚ ArrayListå…¶å®å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚æ¯æ¬¡åˆ›å»º ArrayList å¯¹è±¡ï¼Œå†…éƒ¨çš„æ•°ç»„å¼•ç”¨éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªé•¿åº¦ä¸º0çš„æ•°ç»„å¸¸é‡ã€‚åˆæ¬¡æ‰©å®¹åï¼Œé›†åˆå®¹é‡ä¸º10.ä¹‹åæ¯æ¬¡æ‰©å®¹éƒ½ä¼šæ‰©å¼ åˆ°åŸæ¥çš„ 1.5å€ã€‚æ‰©å®¹å°±æ˜¯æ–°å»ºä¸€ä¸ªæ›´å¤§çš„æ•°ç»„å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨ System.arraycopy() å¤åˆ¶æ—§æ•°ç»„ä¸­çš„æ•°æ®ã€‚ArrayList å’Œæ•°ç»„ä¸€æ ·ï¼Œè·å–æ•°æ®å¾ˆå¿«é€Ÿï¼Œä½†æ˜¯æ’å…¥åˆ é™¤ä¼šå¾ˆæ…¢ã€‚æ’å…¥åˆ é™¤æ“ä½œä¹Ÿæ˜¯åˆ©ç”¨ System.arraycopyï¼ˆï¼‰æ¥å®ç°æ•°æ®çš„ç§»åŠ¨çš„ã€‚ArrayList ä¸­ SubList æ˜¯ ArrayList ä¸­çš„ä¸€ä¸ªè§†å›¾ï¼Œä¿®æ”¹ SubList ï¼ŒArrayList ä¸­çš„æ•°æ®ä¹Ÿä¼šæ”¹å˜ã€‚è‹¥åˆ›å»ºäº† SubList åä¿®æ”¹äº† ArrayList ï¼Œå†æ¬¡è°ƒç”¨å‰é¢åˆ›å»ºçš„ SubList çš„å®ä¾‹ï¼Œä¼šè§¦å‘ fail-fastæœºåˆ¶çš„å‘ç”Ÿã€‚ fail-fastæœºåˆ¶ æ„é€ æ–¹æ³•ï¼š ArrayList() åˆ›å»ºä¸€ä¸ªé»˜è®¤åˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ã€‚ ArrayList(int initialCapacity) åˆ›å»ºå…·æœ‰æŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨ã€‚ ArrayList(Collection&lt;? extends E&gt; c) åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ã€‚ ä¸»è¦æ–¹æ³•ï¼š boolean add(E e) å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ E get(int index) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ set(int index, E element) ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ void add(int index, E element) å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®ã€‚åé¢å…ƒç´ è¿›è¡Œåç§»ã€‚ E remove(int index) åˆ é™¤è¯¥åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚åé¢å…ƒç´ è¿›è¡Œå·¦ç§»ã€‚ int indexOf(Object o) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int lastIndexOf(Object o) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ void clear() ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚ boolean addAll(int index, Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®ã€‚ Iterator iterator() ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ ListIterator listIterator() è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ ListIterator listIterator(int index) ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ List subList(int fromIndex, int toIndex) è¿”å›æŒ‡å®šçš„fromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„åˆ—è¡¨éƒ¨åˆ†çš„è§†å›¾ã€‚ void removeRange(int fromIndex, int toIndex) ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰ç´¢å¼•ä¸ºfromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„å…ƒç´ ã€‚ éå†ï¼š1ã€è¿­ä»£å™¨(Iteratorå’ŒListIterator)2ã€forå¾ªç¯ã€‚3ã€foreachã€‚ 12345678910111213141516171819202122232425262728public static void arrayList_1() { ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 10; i++) { list.add(i); } //Iterator Iterator&lt;Integer&gt; iterator = list.iterator(); while (iterator.hasNext()) { System.out.print(iterator.next()); } //ListIterator ListIterator&lt;Integer&gt; lit = list.listIterator(); while (lit.hasNext()) { System.out.print(lit.next()); } //for for (int i = 0; i &lt; list.size(); i++) { System.out.print(list.get(i)); } //foreach for(Integer i : list) { System.out.print(i); } } ç¬¬äºŒç§æ™®é€šforå¾ªç¯éå†æ•ˆç‡æœ€é«˜ã€‚","link":"/2018/05/30/java/exercise/util/ArrayList/"},{"title":"HashMap","text":"HashMapç»§æ‰¿è‡ª AbstractMap&lt;K,V&gt; ï¼Œå®ç°äº†Mapæ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ ã€‚HashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°ã€‚ ç‰¹ç‚¹ï¼šå…ƒç´ æ˜¯æ— åºçš„ï¼Œå…è®¸null å€¼å’Œ null é”®ï¼Œå…ƒç´ ï¼ˆkeyï¼‰ä¸ä¼šé‡å¤ï¼Œçº¿ç¨‹ä¸åŒæ­¥ã€‚ æ„é€ æ–¹æ³•ï¼š HashMap() æ„é€ ä¸€ä¸ªç©ºçš„ HashMap ï¼Œé»˜è®¤åˆå§‹å®¹é‡ï¼ˆ16ï¼‰å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ã€‚ HashMap(int initialCapacity) æ„é€ ä¸€ä¸ªç©ºçš„ HashMap ï¼Œå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤è´Ÿè½½ç³»æ•°ï¼ˆ0.75ï¼‰ã€‚ HashMap(int initialCapacity, float loadFactor) æ„é€ ä¸€ä¸ªç©ºçš„ HashMap, å…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚ public HashMap(Map&lt;? extends K,? extends V&gt; m) æ„é€ ä¸€ä¸ªæ–°çš„HashMapä¸æŒ‡å®šçš„ç›¸åŒçš„æ˜ å°„Map ã€‚ HashMapçš„å®ä¾‹æœ‰ä¸¤ä¸ªå½±å“å…¶æ€§èƒ½çš„å‚æ•°: åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚ å®¹é‡æ˜¯å“ˆå¸Œè¡¨ä¸­çš„æ¡¶æ•°ï¼Œåˆå§‹å®¹é‡æ˜¯åˆ›å»ºå“ˆå¸Œè¡¨æ—¶çš„å®¹é‡ã€‚ è´Ÿè½½å› å­æ˜¯åœ¨å®¹é‡è‡ªåŠ¨å¢åŠ ä¹‹å‰å…è®¸å“ˆå¸Œè¡¨å¾—åˆ°æ»¡è¶³çš„åº¦é‡ã€‚ å½“åœ¨å“ˆå¸Œè¡¨ä¸­çš„æ¡ç›®çš„æ•°é‡è¶…è¿‡äº†è´Ÿè½½å› æ•°å’Œå½“å‰å®¹é‡çš„ä¹˜ç§¯ï¼Œå“ˆå¸Œè¡¨è¢«é‡æ–°æ•£åˆ— ï¼ˆå³ï¼Œå†…éƒ¨æ•°æ®ç»“æ„è¢«é‡å»ºï¼‰ï¼Œä½¿å¾—å“ˆå¸Œè¡¨å…·æœ‰æ¡¶çš„å¤§çº¦ä¸¤å€ã€‚ ä¸»è¦æ–¹æ³•ï¼š Iterator iterator() è¿”å›æ­¤é›†åˆä¸­å…ƒç´ çš„è¿­ä»£å™¨ã€‚ å…ƒç´ æ²¡æœ‰ç‰¹å®šçš„é¡ºåºã€‚ int size() è¿”å›æ­¤Mapé›†åˆä¸­é”®å€¼æ˜ å°„çš„æ•°é‡ã€‚ boolean isEmpty() åˆ¤æ–­Mapé›†åˆæ˜¯å¦åŒ…å«é”®å€¼æ˜ å°„ã€‚ V get(Object key) è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œå¦‚æœé”®ä¸å­˜åœ¨ï¼Œè¿”å›nullã€‚ boolean containsKey(Object key) åˆ¤æ–­Mapé›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šé”®çš„æ˜ å°„ã€‚ V put(K key, V value) å°†æŒ‡å®šçš„å€¼ä¸æ­¤æ˜ å°„ä¸­çš„æŒ‡å®šé”®ç›¸å…³è”ã€‚ å¦‚æœMapé›†åˆä¸­å·²åŒ…å«äº†è¯¥é”®çš„æ˜ å°„ï¼Œåˆ™æ›¿æ¢æ—§å€¼ã€‚ void putAll(Map&lt;? extends K,? extends V&gt; m) å°†æŒ‡å®šMapé›†åˆçš„æ‰€æœ‰æ˜ å°„å¤åˆ¶åˆ°æ­¤Mapé›†åˆä¸­ã€‚ V remove(Object key) ä»è¯¥Mapé›†åˆä¸­åˆ é™¤æŒ‡å®šé”®çš„æ˜ å°„ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ void clear() ä»Mapé›†åˆä¸­åˆ é™¤æ‰€æœ‰çš„æ˜ å°„ã€‚ boolean containsValue(Object value) å¦‚æœæ­¤Mapé›†åˆä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ˜ å°„åˆ°æŒ‡å®šçš„å€¼ï¼Œåˆ™è¿”å› true ã€‚ Set keySet() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„é”®çš„Setè§†å›¾ã€‚è¯¥Setè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒSet.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ Collection values() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„å€¼çš„Collectionè§†å›¾ã€‚è¯¥Collectionè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒCollection.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„æ˜ å°„å…³ç³»çš„Setè§†å›¾ã€‚è¯¥Setè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒSet.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ V getOrDefault(Object key, V defaultValue) è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œæˆ– defaultValueã€‚ V putIfAbsent(K key, V value) å¦‚æœæŒ‡å®šçš„é”®å°šæœªä¸æŸä¸ªå€¼ç›¸å…³è”ï¼ˆæˆ–æ˜ å°„åˆ° null ï¼‰ï¼Œåˆ™å°†å…¶ä¸ç»™å®šå€¼ç›¸å…³è”å¹¶è¿”å› null ï¼Œå¦åˆ™è¿”å›å½“å‰å€¼ã€‚ boolean remove(Object key, Object value) ä»…å½“æŒ‡å®šçš„é”®å½“å‰æ˜ å°„åˆ°æŒ‡å®šçš„å€¼æ—¶åˆ é™¤è¯¥æ¡ç›®ã€‚ boolean replace(K key, V oldValue, V newValue) ä»…å½“å½“å‰æ˜ å°„åˆ°æŒ‡å®šçš„å€¼æ—¶ï¼Œæ‰æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚ V replace(K key, V value) åªæœ‰å½“ç›®æ ‡æ˜ å°„åˆ°æŸä¸ªå€¼æ—¶ï¼Œæ‰èƒ½æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚å¦‚æœæ²¡æœ‰é”®çš„æ˜ å°„ï¼Œ è¿”å›null ã€‚ V computeIfAbsent(K key, Function&lt;? super K,? extends V&gt; mappingFunction) éå†ï¼š1ã€entrySet2ã€ketset3ã€values 123456789101112131415161718192021222324252627282930public static void byEntrySet(HashMap&lt;String, String&gt; map) { Set&lt;Entry&lt;String, String&gt;&gt; entrySet = map.entrySet(); for (Iterator&lt;Entry&lt;String, String&gt;&gt; it = entrySet.iterator(); it.hasNext();) { Entry&lt;String, String&gt; entry = it.next(); String key = entry.getKey(); String value = entry.getValue(); }}public static void byKeySet(HashMap&lt;String, String&gt; map) { Set&lt;String&gt; ketset = map.keySet(); //foreach for (Iterator&lt;String&gt; it = ketset.iterator(); it.hasNext();) { String key = it.next(); String value = map.get(key); } //while Iterator&lt;String&gt; it = ketset.iterator(); while (it.hasNext()) { String key = it.next(); String value = map.get(key); }}public static void byValues(HashMap&lt;String, String&gt; map) { Collection&lt;String&gt; col = map.values(); for (Iterator&lt;String&gt; it = col.iterator(); it.hasNext();) { String value = it.next(); }} HashMapä½¿ç”¨keyçš„hashCode()å’Œequals()æ–¹æ³•æ¥å°†å€¼åˆ’åˆ†åˆ°ä¸åŒçš„æ¡¶é‡Œï¼Œéšç€HashMapä¸­å…ƒç´ çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œå‘ç”Ÿç¢°æ’çš„æ¦‚ç‡å°±è¶Šæ¥è¶Šå¤§ï¼Œæ‰€äº§ç”Ÿçš„é“¾è¡¨é•¿åº¦å°±ä¼šè¶Šæ¥è¶Šé•¿ ã€‚ å½“ HashMap ä¸­æœ‰å¤§é‡çš„keyéƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œè¿™ä¸ªæ¡¶ä¸‹æœ‰ä¸€æ¡é•¿é•¿çš„é“¾è¡¨ï¼Œè¿™ä¸ªæ—¶å€™ HashMap å°±ç›¸å½“äºä¸€ä¸ªå•é“¾è¡¨ï¼Œå‡å¦‚å•é“¾è¡¨æœ‰ n ä¸ªå…ƒç´ ï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n)ï¼Œå®Œå…¨å¤±å»äº†å®ƒçš„ä¼˜åŠ¿ã€‚ JDK1.8ä¹‹å‰HashMapçš„å®ç°æ˜¯ æ•°ç»„+é“¾è¡¨ï¼Œå³ä½¿å“ˆå¸Œå‡½æ•°å–å¾—å†å¥½ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å…ƒç´ ç™¾åˆ†ç™¾å‡åŒ€åˆ†å¸ƒã€‚ JDK 1.8 ä¸­å¼•å…¥äº†çº¢é»‘æ ‘ï¼ˆæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º O(logn)ï¼‰ä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ã€‚ HashMap ä¸­å…³äºçº¢é»‘æ ‘çš„ä¸‰ä¸ªå…³é”®å‚æ•°ï¼šå‚è€ƒ ä¸€ä¸ªæ¡¶çš„æ ‘åŒ–é˜ˆå€¼ ä¸€ä¸ªæ ‘çš„é“¾è¡¨è¿˜åŸé˜ˆå€¼ å“ˆå¸Œè¡¨çš„æœ€å°æ ‘å½¢åŒ–å®¹é‡ TREEIFY_THRESHOLD UNTREEIFY_THRESHOLD MIN_TREEIFY_CAPACITY static final int TREEIFY_THRESHOLD = 8; static final int UNTREEIFY_THRESHOLD = 6; static final int MIN_TREEIFY_CAPACITY = 64; å½“æ¡¶ä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡è¿™ä¸ªå€¼æ—¶éœ€è¦ä½¿ç”¨çº¢é»‘æ ‘èŠ‚ç‚¹æ›¿æ¢é“¾è¡¨èŠ‚ç‚¹ å½“æ‰©å®¹æ—¶ï¼Œæ¡¶ä¸­å…ƒç´ ä¸ªæ•°å°äºè¿™ä¸ªå€¼å°±ä¼šæŠŠæ ‘å½¢çš„æ¡¶å…ƒç´  è¿˜åŸï¼ˆåˆ‡åˆ†ï¼‰ä¸ºé“¾è¡¨ç»“æ„ å½“å“ˆå¸Œè¡¨ä¸­çš„å®¹é‡å¤§äºè¿™ä¸ªå€¼æ—¶ï¼Œè¡¨ä¸­çš„æ¡¶æ‰èƒ½è¿›è¡Œæ ‘å½¢åŒ– å¦åˆ™æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ä¼šæ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äº 4 * TREEIFY_THRESHOLD","link":"/2018/06/20/java/exercise/util/HashMap/"},{"title":"HashMapä¸Hashtable","text":"Hashtableä¸HashMapçš„å‡ ä¸ªä¸åŒç‚¹ï¼š ä¸åŒç‚¹ HashMap Hashtable é”®ä¸å€¼ å…è®¸ä¸€ä¸ªkeyä¸ºnullå’Œä»»æ„ä¸ªvalueä¸ºnull ä¸å…è®¸keyå’Œvalueä¸ºnull æ•°æ®ç»“æ„ æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ æ•°ç»„+é“¾è¡¨ ç»§æ‰¿çš„ç±» AbstractMap&lt;K,V&gt; Dictionary&lt;K,V&gt; æ˜¯å¦çº¿ç¨‹å®‰å…¨ å¦ æ˜¯ æ€§èƒ½ é«˜ åº• é»˜è®¤åˆå§‹åŒ–å®¹é‡ 16 11 æ‰©å®¹æ–¹å¼ åŸå§‹å®¹é‡x2 åŸå§‹å®¹é‡x2 + 1 åº•å±‚æ•°ç»„çš„å®¹é‡ä¸º2çš„æ•´æ•°æ¬¡å¹‚ è¦æ±‚ä¸€å®šä¸º2çš„æ•´æ•°æ¬¡å¹‚ ä¸è¦æ±‚ ç¡®è®¤keyåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•çš„æ–¹æ³• i = (n - 1) &amp; hash; index = (hash &amp; 0x7FFFFFFF) % tab.length; éå†æ–¹å¼ Iterator(è¿­ä»£å™¨) Iterator(è¿­ä»£å™¨)å’ŒEnumeration(æšä¸¾) Iteratoréå†æ•°ç»„é¡ºåº ç´¢å¼•ä»å°åˆ°å¤§ ç´¢å¼•ä»å¤§åˆ°å° Hashtableå·²ä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚","link":"/2018/06/23/java/exercise/util/HashMap%E4%B8%8EHashtable/"},{"title":"Propertieså¯¹è±¡","text":"Propertiesæ˜¯hashTableçš„å­ç±»ä¹Ÿå°±æ˜¯è¯´å®ƒå…·å¤‡mapé›†åˆçš„ç‰¹ç‚¹ã€‚è€Œä¸”å®ƒé‡Œé¢å­˜å‚¨çš„é”®å€¼å¯¹éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚ æ˜¯é›†åˆä¸­å’ŒIOæŠ€æœ¯ç›¸ç»“åˆçš„é›†åˆå®¹å™¨ã€‚ è¯¥å¯¹è±¡çš„ç‰¹ç‚¹ï¼šå¯ä»¥ç”¨äºé”®å€¼å¯¹å½¢åŠ¿çš„é…ç½®æ–‡ä»¶ã€‚ é‚£ä¹ˆåœ¨åŠ è½½æ•°æ®æ—¶ï¼Œéœ€è¦æ•°æ®æœ‰å›ºå®šçš„æ ¼å¼ï¼šé”®=å€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import java.io.*;import java.util.*;class PropertiesDemo{ public static void main(String[] args)throws IOException{ loadDemo(); } public static void loadDemo()throws IOException{ FileInputStream fis = new FileInputStream(&quot;info.txt&quot;); Properties prop = new Properties(); prop.load(fis); prop.setProperty(&quot;wangwu&quot;,&quot;34&quot;); FileOutputStream fos = new FileOutputStream(&quot;info.txt&quot;); prop.store(fos,&quot;zhushi&quot;); //System.out.println(prop); prop.list(System.out); fos.close(); fis.close(); } public static void menthod_1()throws IOException{ BufferedReader bufr = new BufferedReader(new FileReader(&quot;info.txt&quot;)); String line = null; Properties prop = new Properties(); while((line=bufr.readLine())!=null){ String[] arry = line.split(&quot;=&quot;); prop.setProperty(arry[0],arry[1]); } System.out.println(prop); bufr.close(); } public static void setAndGet(){ Properties pro = new Properties(); pro.setProperty(&quot;zhangsan&quot;,&quot;12&quot;); pro.setProperty(&quot;lisi&quot;,&quot;56&quot;); System.out.println(pro); String value = pro.getProperty(&quot;lisi&quot;); System.out.println(value); pro.setProperty(&quot;lisi&quot;,&quot;89&quot;); Set&lt;String&gt; names = pro.stringPropertyNames(); for(String s : names){ System.out.println(s+&quot;:&quot;+pro.getProperty(s)); } }}","link":"/2018/04/30/java/exercise/IO/PropertiesDemo/"},{"title":"HashSet","text":"HashSetç»§æ‰¿è‡ª AbstractSet ï¼Œå®ç°äº†Setæ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ï¼Œå®é™…æ˜¯åŸºäºHashMapæ¥å®ç°çš„ï¼Œè€Œä¸”åªä½¿ç”¨äº†HashMapçš„keyæ¥å®ç°å„ç§ç‰¹æ€§ ã€‚ ç‰¹ç‚¹ï¼šå…ƒç´ æ˜¯æ— åºçš„ï¼Œå…è®¸å…ƒç´ ä¸ºnullï¼Œå…ƒç´ ä¸å¯ä»¥é‡å¤ï¼Œçº¿ç¨‹ä¸åŒæ­¥ã€‚ ä¿è¯å…ƒç´ æƒŸä¸€æ€§çš„åŸç†ï¼šåˆ¤æ–­å…ƒç´ çš„HashCodeå€¼æ˜¯å¦ç›¸åŒã€‚ å¦‚æœå…ƒç´ çš„HashCodeå€¼ç›¸åŒï¼Œä¼šç»§ç»­åˆ¤æ–­equalsæ˜¯å¦ä¸ºtrueã€‚ å¦‚æœå…ƒç´ çš„HashCodeå€¼ä¸åŒï¼Œä¸ä¼šè°ƒç”¨equalsã€‚ æ³¨æ„: å¯¹äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠåˆ é™¤ç­‰æ“ä½œï¼Œä¾èµ–çš„æ–¹æ³•æ˜¯å…ƒç´ HashCodeå’Œequalsæ–¹æ³•ã€‚ å¯¹äºHashSetä¸­ä¿å­˜çš„å¯¹è±¡ï¼Œè¯·æ³¨æ„æ­£ç¡®é‡å†™å…¶equalså’ŒhashCodeæ–¹æ³•ï¼Œä»¥ä¿è¯æ”¾å…¥çš„å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚ æ„é€ æ–¹æ³•ï¼š HashSet() æ„é€ ä¸€ä¸ªæ–°çš„ç©ºé›†åˆ; åº•å±‚å®é™…ä¼šåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„HashMapå®ä¾‹ï¼Œå¹¶å…·æœ‰é»˜è®¤åˆå§‹å®¹é‡16å’ŒåŠ è½½å› å­0.75ã€‚ HashSet(Collection&lt;? extends E&gt; c) æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ çš„æ–°é›†åˆã€‚ åº•å±‚ä½¿ç”¨é»˜è®¤åŠ è½½å› å­0.75å’Œè¶³ä»¥åŒ…å«æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ çš„åˆå§‹å®¹é‡æ¥åˆ›å»ºä¸€ä¸ªHashMapã€‚ HashSet(int initialCapacity, float loadFactor) æ„é€ ä¸€ä¸ªæ–°çš„ç©ºé›†åˆ; åº•å±‚ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å®¹é‡å’ŒæŒ‡å®šçš„è´Ÿè½½å› å­åˆ›å»ºä¸€ä¸ªHashMapå®ä¾‹ã€‚ HashSet(int initialCapacity) æ„é€ ä¸€ä¸ªæ–°çš„ç©ºé›†åˆ; åº•å±‚ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤è´Ÿè½½å› å­0.75åˆ›å»ºä¸€ä¸ªHashMapå®ä¾‹ã€‚ ä¸»è¦æ–¹æ³•ï¼š Iterator iterator() è¿”å›æ­¤é›†åˆä¸­å…ƒç´ çš„è¿­ä»£å™¨ã€‚ å…ƒç´ æ²¡æœ‰ç‰¹å®šçš„é¡ºåºã€‚ int size() è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ æ•°ã€‚ boolean isEmpty() åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«å…ƒç´ ã€‚ boolean contains(Object o) åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´  ã€‚ boolean add(E e) å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰ã€‚ boolean remove(Object o) ä»è¯¥é›†åˆä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœé›†åˆåŒ…å«è¿™ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚ void clear() åˆ é™¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ ã€‚ éå†ï¼š1ã€foreach2ã€è¿­ä»£å™¨ï¼ˆIteratorï¼‰ 1234567891011121314151617181920212223242526272829303132import java.util.HashSet;import java.util.Iterator;public class HashSetDemo { public static void main(String[] args) { HashSet&lt;Integer&gt; set = new HashSet&lt;Integer&gt;(); for (int i = 0; i &lt; 1000000; i++) { set.add(i); } byForeach(set); byIterator(set); } public static void byForeach(HashSet&lt;Integer&gt; set) { long start = System.currentTimeMillis(); for (Integer integer : set) { ; } long end = System.currentTimeMillis(); System.out.println(\"foreachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); } public static void byIterator(HashSet&lt;Integer&gt; set) { long start = System.currentTimeMillis(); for (Iterator&lt;Integer&gt; it = set.iterator(); it.hasNext();) { it.next(); } long end = System.currentTimeMillis(); System.out.println(\"iteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); }} è¾“å‡ºï¼š 12foreachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š23msiteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š17ms","link":"/2018/06/10/java/exercise/util/HashSet/"},{"title":"IOç»¼åˆç»ƒä¹ ","text":"æœ‰äº”ä¸ªå­¦ç”Ÿï¼Œæ¯ä¸ªå­¦ç”Ÿæœ‰ä¸‰é—¨è¯¾çš„æˆç»©ï¼Œä»é”®ç›˜è¾“å…¥ä»¥ä¸Šæ•°æ®ï¼ˆåŒ…å«å§“åï¼Œä¸‰é—¨è¯¾æˆç»©ï¼‰ï¼Œè¾“å…¥çš„æ ¼å¼ï¼Œå¦‚ï¼šzhangsanï¼Œ30ï¼Œ40ï¼Œ60è®¡ç®—å‡ºæ€»æˆç»©ï¼Œå¹¶æŠŠå­¦ç”Ÿçš„ä¿¡æ¯å’Œè®¡ç®—å‡ºçš„æ€»åˆ†æ•°æŒ‰é«˜ä½é¡ºåºå­˜æ”¾åœ¨ç£ç›˜æ–‡ä»¶â€stud.txtâ€œä¸­ã€‚ 1ã€æè¿°å­¦ç”Ÿå¯¹è±¡ã€‚2ã€å®šä¹‰ä¸€ä¸ªå¯æ“ä½œå­¦ç”Ÿå¯¹è±¡çš„å·¥å…·ç±»ã€‚ æ€æƒ³ï¼š1ã€é€šè¿‡é”®ç›˜å½•å…¥æ•°æ®ï¼Œ2ã€å› ä¸ºå­¦ç”Ÿæœ‰å¤šä¸ªï¼Œéœ€è¦å­˜å‚¨ï¼Œä½¿ç”¨åˆ°é›†åˆã€‚å› ä¸ºè¦å¯¹å­¦ç”Ÿçš„æ€»åˆ†æ’åºã€‚ æ‰€ä»¥å¯ä»¥ä½¿ç”¨TreeSet.3ã€å°†é›†åˆçš„ä¿¡æ¯å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283import java.io.*;import java.util.*;class Student implements Comparable&lt;Student&gt;{ private String name; private int ma,cn,en; private int sum; Student(String name,int ma,int cn,int en){ this.name= name; this.ma = ma; this.cn = cn; this.en = en; this.sum = ma+cn+en; } public String getName(){ return name; } public int getSum(){ return sum; } public int compareTo(Student stu){ int num = new Integer(this.sum).compareTo(new Integer(stu.getSum())); if(num==0) return this.name.compareTo(stu.getName()); return num; } public int hashCode(){ return name.hashCode() + sum*46; } public boolean equals(Object obj){ if(!(obj instanceof Student)){ throw new ClassCastException(&quot;ç±»å‹è½¬æ¢å¼‚å¸¸!&quot;); } Student s = (Student)obj; return this.name.equals(s.getName()); } public String toString(){ return &quot;Student[name:&quot;+this.name+&quot; ma:&quot;+this.ma+&quot; cn:&quot;+this.cn+&quot; en:&quot;+this.en+&quot; sum&quot;+this.sum+&quot;]&quot;; }}class StudentTool{ public static Set&lt;Student&gt; getStudents()throws IOException{ return getStudents(null); } public static Set&lt;Student&gt; getStudents(Comparator&lt;Student&gt; compar) throws IOException{ BufferedReader bufr = new BufferedReader(new InputStreamReader(System.in)); Set&lt;Student&gt; stus = null; if(compar==null){ stus = new TreeSet&lt;Student&gt;(); } stus = new TreeSet&lt;Student&gt;(compar); String line = null; while((line = bufr.readLine())!=null){ if(&quot;over&quot;.equals(line)) break; String[] s = line.split(&quot;,&quot;); Student stu = new Student(s[0],Integer.parseInt(s[1]),Integer.parseInt(s[2]),Integer.parseInt(s[3])); stus.add(stu); } bufr.close(); return stus; } public static void writeToFile(Set&lt;Student&gt; students) throws IOException{ BufferedWriter bufw = new BufferedWriter(new FileWriter(&quot;StudentInfo.txt&quot;)); for(Student s : students){ bufw.write(s.toString()+&quot;\\t&quot;); bufw.write(s.getSum()+&quot;&quot;); bufw.newLine(); bufw.flush(); } bufw.close(); }}class StudentInfoTest{ public static void main(String[] args) throws IOException{ Comparator&lt;Student&gt; compar = Collections.reverseOrder(); Set&lt;Student&gt; stus = StudentTool.getStudents(compar); StudentTool.writeToFile(stus); }}","link":"/2018/05/12/java/exercise/IO/StudentInfoTest/"},{"title":"Hashtable","text":"Hashtableç»§æ‰¿è‡ª Dictionary&lt;K,V&gt;ï¼Œå®ç°äº†Mapæ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ã€‚ ç‰¹ç‚¹ï¼šå…ƒç´ æ˜¯æ— åºçš„ï¼Œä¸å…è®¸null å€¼å’Œnull é”®ï¼Œå…ƒç´ ï¼ˆkeyï¼‰ä¸ä¼šé‡å¤ï¼Œçº¿ç¨‹æ˜¯åŒæ­¥çš„ã€‚ æ³¨æ„: å¯¹äºä½œä¸ºé”®çš„å¯¹è±¡å¿…é¡»å®ç°hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ï¼Œä»¥ä¿è¯ key çš„å”¯ä¸€æ€§ã€‚ å¦‚æœä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„å®ç°ï¼Œå»ºè®®ä½¿ç”¨HashMapä»£æ›¿Hashtableã€‚ æ„é€ æ–¹æ³•ï¼š Hashtable() æ„é€ ä¸€ä¸ªç©ºçš„Hashtableï¼Œé»˜è®¤åˆå§‹å®¹é‡ï¼ˆ11ï¼‰å’Œè´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ã€‚ Hashtable(int initialCapacity) æ„é€ ä¸€ä¸ªç©ºçš„Hashtableï¼Œå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ã€‚ Hashtable(int initialCapacity, float loadFactor) æ„é€ ä¸€ä¸ªç©ºçš„Hashtableï¼Œå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’ŒæŒ‡å®šçš„è´Ÿè½½å› å­ã€‚ Hashtable(Map&lt;? extends K,? extends V&gt; t) æ„é€ ä¸€ä¸ªä¸ç»™å®šMapç›¸åŒçš„æ˜ å°„çš„æ–°Hashtableã€‚ ä¸»è¦æ–¹æ³•ï¼š int size() è¿”å›æ­¤é›†åˆä¸­çš„é”®çš„æ•°é‡ã€‚ boolean isEmpty() åˆ¤æ–­è¿™ä¸ªé›†åˆä¸­æ˜¯å¦æœ‰å…ƒç´ ã€‚ Enumeration keys() è¿”å›æ­¤é›†åˆä¸­é”®çš„æšä¸¾ã€‚ Enumeration elements() è¿”å›æ­¤é›†åˆä¸­å€¼çš„æšä¸¾ã€‚ boolean contains(Object value) åˆ¤æ–­æ˜¯å¦æœ‰é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå€¼ã€‚åŒä¸‹containsValue ã€‚ boolean containsValue(Object value) åˆ¤æ–­æ˜¯å¦æœ‰é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå€¼ï¼ŒåŒä¸Šcontains ã€‚ boolean containsKey(Object key) åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šé”®çš„æ˜ å°„ã€‚ V get(Object key) è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œå¦‚æœä¸åŒ…å«è¯¥é”®çš„æ˜ å°„ï¼Œè¿”å›nullã€‚ V put(K key, V value) å°†æŒ‡å®šçš„keyæ˜ å°„åˆ°æ­¤æŒ‡å®šçš„valueã€‚ keyå’Œvalueéƒ½ä¸èƒ½æ˜¯null ã€‚ V remove(Object key) ä»æ­¤é›†åˆä¸­åˆ é™¤é”®ï¼ˆåŠå…¶å¯¹åº”çš„å€¼ï¼‰ã€‚ void putAll(Map&lt;? extends K,? extends V&gt; t) å°†æ‰€æœ‰ä»æŒ‡å®šMapçš„æ˜ å°„å¤åˆ¶åˆ°æ­¤Hashtableä¸­ã€‚ void clear() æ¸…é™¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ ã€‚ Set keySet() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„é”®çš„Setè§†å›¾ã€‚è¯¥Setè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒSet.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„æ˜ å°„å…³ç³»çš„Setè§†å›¾ã€‚è¯¥Setè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒSet.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ Collection values() è¿”å›æ­¤Mapé›†åˆä¸­åŒ…å«çš„å€¼çš„Collectionè§†å›¾ã€‚è¯¥Collectionè§†å›¾æ”¯æŒç»ç”±Iterator.removeï¼ŒCollection.removeï¼ŒremoveAllï¼ŒretainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ V getOrDefault(Object key, V defaultValue) è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œæˆ– defaultValueã€‚ boolean remove(Object key, Object value) ä»…å½“æŒ‡å®šçš„é”®å½“å‰æ˜ å°„åˆ°æŒ‡å®šçš„å€¼æ—¶åˆ é™¤è¯¥æ¡ç›®ã€‚ boolean replace(K key, V oldValue, V newValue) ä»…å½“å½“å‰æ˜ å°„åˆ°æŒ‡å®šçš„å€¼æ—¶ï¼Œæ‰æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚ V replace(K key, V value) åªæœ‰å½“ç›®æ ‡æ˜ å°„åˆ°æŸä¸ªå€¼æ—¶ï¼Œæ‰èƒ½æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚å¦‚æœæ²¡æœ‰é”®çš„æ˜ å°„ï¼Œ è¿”å›null ã€‚ éå†ï¼š1ã€Iterator â€‹ keySet() â€‹ entrySet() 2ã€Enumeration â€‹ keys() â€‹ elements() 1234567891011121314151617181920212223242526public static void byKeySet(Hashtable&lt;String, Integer&gt; hashtable) { for(Iterator&lt;String&gt; iterator = hashtable.keySet().iterator();iterator.hasNext();) { String key = iterator.next(); Integer value = hashtable.get(key); }}public static void byEntrySet(Hashtable&lt;String, Integer&gt; hashtable) { Set&lt;Entry&lt;String, Integer&gt;&gt; set = hashtable.entrySet(); for(Iterator&lt;Entry&lt;String, Integer&gt;&gt; iterator = set.iterator();iterator.hasNext();) { Entry&lt;String, Integer&gt; entry = iterator.next(); String key = entry.getKey(); Integer value = entry.getValue(); }}public static void byEnumeration_key(Hashtable&lt;String, Integer&gt; hashtable) { Enumeration&lt;String&gt; enumeration = hashtable.keys(); while (enumeration.hasMoreElements()) { String value = (String) enumeration.nextElement(); }}public static void byEnumeration_value(Hashtable&lt;String, Integer&gt; hashtable) { Enumeration&lt;Integer&gt; enumeration = hashtable.elements(); while (enumeration.hasMoreElements()) { Integer value = (Integer) enumeration.nextElement(); }}","link":"/2018/06/23/java/exercise/util/Hashtable/"},{"title":"LinkedList","text":"LinkedListç»§æ‰¿è‡ªAbstractSequentialList åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨ã€‚ å…³äºé“¾è¡¨ï¼Œé“¾è¡¨æ˜¯ä¸€ç§çº¿æ€§çš„å­˜å‚¨ç»“æ„ï¼Œæ„æ€æ˜¯å°†è¦å­˜å‚¨çš„æ•°æ®å­˜åœ¨ä¸€ä¸ªå­˜å‚¨å•å…ƒé‡Œé¢ï¼Œè¿™ä¸ªå­˜å‚¨å•å…ƒé‡Œé¢é™¤äº†å­˜æ”¾æœ‰å¾…å­˜å‚¨çš„æ•°æ®ä»¥å¤–ï¼Œè¿˜å­˜å‚¨æœ‰å…¶ä¸‹ä¸€ä¸ªå­˜å‚¨å•å…ƒçš„åœ°å€ï¼ˆæœ‰äº›å­˜å‚¨ç»“æ„è¿˜å­˜æ”¾å…¶å‰ä¸€ä¸ªå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œå¦‚ï¼šLinkedListï¼‰ ï¼Œæ¯æ¬¡æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡æŸä¸ªå­˜å‚¨å•å…ƒä¸­çš„ä¸‹ä¸€ä¸ªå­˜å‚¨å•å…ƒçš„åœ°å€å¯»æ‰¾å…¶åé¢çš„é‚£ä¸ªå­˜å‚¨å•å…ƒã€‚ å…³äºåŒå‘é“¾è¡¨ï¼Œå³é“¾è¡¨ä¸­ä»»ä¸€å­˜å‚¨å•å…ƒéƒ½å¯é€šè¿‡å‘å‰æˆ–å‘åå¯»å€çš„æ–¹å¼è·å–åˆ°å…¶å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚é“¾è¡¨çš„å°¾èŠ‚ç‚¹çš„åä¸€ä¸ªå­˜å‚¨å•å…ƒæ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œé“¾è¡¨çš„å¤´ç»“ç‚¹çš„å‰ä¸€ä¸ªå­˜å‚¨å•å…ƒæ˜¯é“¾è¡¨çš„å°¾èŠ‚ç‚¹ã€‚ LinkedListçš„åŸºæœ¬å­˜å‚¨å•å…ƒ ï¼š 123456private static class Entry&lt;E&gt; { E element; Entry&lt;E&gt; next; Entry&lt;E&gt; previous; ...} å®ƒæ˜¯LinkedListä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±» ã€‚ ç‰¹ç‚¹ï¼š æ’å…¥å’Œåˆ é™¤æ“ä½œå¾ˆå¿«ï¼Œåªéœ€è¦ä¿®æ”¹å‰åæŒ‡é’ˆã€‚ è®¿é—®é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…è®¸å…ƒç´ ä¸ºnullï¼Œå…ƒç´ å¯ä»¥é‡å¤ï¼Œçº¿ç¨‹ä¸åŒæ­¥ã€‚ æ„é€ æ–¹æ³•ï¼š LinkedList() æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ LinkedList(Collection&lt;? extends E&gt; c) æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ã€‚ ä¸»è¦æ–¹æ³•ï¼š E getFirst() è¿”å›æ­¤åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ E getLast() è¿”å›æ­¤åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ E removeFirst() ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ E removeLast() ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ void addFirst(E e) åœ¨è¯¥åˆ—è¡¨å¼€å¤´æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚ void addLast(E e) å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ boolean contains(Object o) åˆ¤æ–­æ­¤åˆ—è¡¨æ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼ŒåŒ…å«åˆ™è¿”å›true ã€‚ int size() è¿”å›æ­¤åˆ—è¡¨ä¸­çš„å…ƒç´ æ•°ã€‚ boolean add(E e) å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ boolean remove(Object o) ä»åˆ—è¡¨ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨è¿”å›trueã€‚ boolean addAll(Collection&lt;? extends E&gt; c) æŒ‰ç…§æŒ‡å®šé›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ boolean addAll(int index, Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ä»æŒ‡å®šçš„ä½ç½®å¼€å§‹æ’å…¥åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œåé¢å…ƒç´ è¿›è¡Œåç§»ã€‚ void clear() ä»åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚ E get(int index) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ E set(int index, E element) ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ void add(int index, E element) åœ¨åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚åé¢å…ƒç´ è¿›è¡Œåç§»ã€‚ E remove(int index) åˆ é™¤è¯¥åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚åé¢å…ƒç´ è¿›è¡Œå‰ç§»ã€‚ int indexOf(Object o) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int lastIndexOf(Object o) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ E peek() æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å›nullã€‚ E element() æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ E poll() æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å›nullã€‚ E remove() æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚ boolean offer(E e) å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ ä¸ºæ­¤åˆ—è¡¨çš„å°¾éƒ¨ã€‚ JDK1.6æ–°å¢ boolean offerFirst(E e) åœ¨åˆ—è¡¨çš„å‰é¢æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚ boolean offerLast(E e) åœ¨åˆ—è¡¨çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚ E peekFirst() æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ E peekLast() æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ E pollFirst() æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ E pollLast() æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ void push(E e) åœ¨è¯¥åˆ—è¡¨çš„å‰é¢æ’å…¥å…ƒç´ ï¼Œæ­¤æ–¹æ³•ç›¸å½“äºaddFirst(E) ã€‚ E pop() åˆ é™¤å¹¶è¿”å›æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å‘ç”ŸNoSuchElementException å¼‚å¸¸ã€‚æ­¤æ–¹æ³•ç›¸å½“äºremoveFirst() ã€‚ boolean removeFirstOccurrence(Object o) åˆ é™¤æ­¤åˆ—è¡¨ä¸­ä»å¤´åˆ°å°¾éå†åˆ—è¡¨æ—¶ç¬¬ä¸€ä¸ªå‡ºç°çš„æŒ‡å®šå…ƒç´ ã€‚å¦‚æœåˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å›trueï¼› å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™é›†åˆä¸ä¼šæ›´æ”¹ï¼Œä¸”è¿”å›falseã€‚ boolean removeLastOccurrence(Object o) åˆ é™¤æ­¤åˆ—è¡¨ä¸­ä»å¤´åˆ°å°¾éå†åˆ—è¡¨æ—¶æœ€åä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ã€‚å¦‚æœåˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å›trueï¼› å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™é›†åˆä¸ä¼šæ›´æ”¹ï¼Œä¸”è¿”å›falseã€‚ ListIterator listIterator(int index) ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›æ­¤åˆ—è¡¨ä¸­å…ƒç´ çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ Iterator descendingIterator() ä»¥ç›¸åçš„é¡ºåºè¿”å›æ­¤dequeä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ å…ƒç´ å°†ä»æœ€åï¼ˆå°¾ï¼‰åˆ°ç¬¬ä¸€ï¼ˆå¤´ï¼‰çš„é¡ºåºè¿”å›ã€‚ Object[] toArray() ä»¥æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ T[] toArray(T[] a) ä»¥æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„; è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ LinkedListå®ç°äº†Dequeæ¥å£ï¼Œè€ŒDequeæ¥å£å®šä¹‰äº†åœ¨åŒç«¯é˜Ÿåˆ—ä¸¤ç«¯è®¿é—®å…ƒç´ çš„æ–¹æ³•ã€‚æä¾›æ’å…¥ã€ç§»é™¤å’Œè·å–å…ƒç´ çš„æ–¹æ³•ã€‚æ¯ç§æ–¹æ³•éƒ½å­˜åœ¨ä¸¤ç§å½¢å¼ï¼šä¸€ç§å½¢å¼åœ¨æ“ä½œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€ç§å½¢å¼è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ– falseï¼Œå…·ä½“å–å†³äºæ“ä½œï¼‰ã€‚ æ€»ç»“èµ·æ¥å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå¤´éƒ¨ï¼‰ æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆå°¾éƒ¨ï¼‰ æ’å…¥ boolean add(E e) boolean offerFirst(E e) boolean addLast(e) booleanofferLast(e) æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ åˆ é™¤ E removeFirst() E pollFirst() E removeLast() E pollFirst() æŸ¥è¯¢ E getFirst() E peekFirst() E getLast() E peekLast() è€ŒDequeæ¥å£ï¼Œæ‰©å±•äº†Queueæ¥å£ï¼ŒLinkedListä¾¿å¯ä»¥ä½œä¸ºFIFO(å…ˆè¿›å…ˆå‡º)çš„é˜Ÿåˆ—ä½¿ç”¨ï¼Œä½œä¸ºFIFOçš„é˜Ÿåˆ—æ—¶ ï¼Œä¸‹é¢çš„æ–¹æ³•æ˜¯ç­‰ä»·çš„ï¼š é˜Ÿåˆ—æ–¹æ³• ç­‰æ•ˆæ–¹æ³• boolean add(E e) void addLast(E e) boolean offer(E e) boolean offerLast(E e) boolean remove(Object o) E removeFirst() E poll() E pollFirst() E element() E getFirst() E peek() E peekFirst() Dequesä¹Ÿå¯ä»¥ç”¨ä½œLIFOï¼ˆåè¿›å…ˆå‡ºï¼‰å †æ ˆã€‚LinkedListä¾¿å¯ä»¥ä½œä¸ºLIFO(åè¿›å…ˆå‡º)çš„æ ˆï¼Œä½œä¸ºLIFOçš„æ ˆæ—¶ï¼Œä¸‹é¢çš„æ–¹æ³•æ˜¯ç­‰ä»·çš„ï¼š æ ˆæ–¹æ³• ç­‰æ•ˆæ–¹æ³• void push(E e) void addFirst(E e) E pop() E removeFirst() E peek() E peekFirst() éå†ï¼š1ã€forå¾ªç¯(éšæœºè®¿é—®) 2ã€foreach 3ã€è¿­ä»£å™¨iterator ã€‚ 4ã€pollFirst()éå† ã€‚ 5ã€pollLast()éå†ã€‚ 6ã€removeFirst()éå†ã€‚ 7ã€removeLast()éå†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798import java.util.Iterator;import java.util.LinkedList;import java.util.ListIterator;import java.util.NoSuchElementException;public class LinkedListDemo { public static void main(String[] args) { LinkedList&lt;Integer&gt; list = new LinkedList&lt;Integer&gt;(); for(int i = 0;i&lt;100000;i++) { list.add(i); } byFor(list); byForeach(list); byIterator(list); byListIterator(list); byPollFirst(list); byPollLast(list); byRemoveFirst(list); byRemoveLast(list); } public static void byFor(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (int i = 0; i &lt; list.size(); i++) { list.get(i); } long end = System.currentTimeMillis(); System.out.println(\"forå¾ªç¯éå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byForeach(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (Integer integer : list) { ; } long end = System.currentTimeMillis(); System.out.println(\"foreachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byIterator(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (Iterator&lt;Integer&gt; it = list.iterator(); it.hasNext();) { it.next(); } long end = System.currentTimeMillis(); System.out.println(\"Iteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byListIterator(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (ListIterator&lt;Integer&gt; it = list.listIterator(); it.hasNext();) { it.next(); } long end = System.currentTimeMillis(); System.out.println(\"ListIteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byPollFirst(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); while (list.pollFirst()!=null) { ; } long end = System.currentTimeMillis(); System.out.println(\"pollFirstéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byPollLast(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); while (list.pollLast()!=null) { ; } long end = System.currentTimeMillis(); System.out.println(\"pollLastéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byRemoveFirst(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); try { while (list.removeFirst()!=null) { ; } } catch (NoSuchElementException e) { } long end = System.currentTimeMillis(); System.out.println(\"removeFirstéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); } public static void byRemoveLast(LinkedList&lt;Integer&gt; list) { long start = System.currentTimeMillis(); try { while (list.removeLast()!=null) { ; } } catch (NoSuchElementException e) { } long end = System.currentTimeMillis(); System.out.println(\"removeLastéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\"+(end - start)+\"ms\"); }} è¾“å‡ºï¼š 12345678forå¾ªç¯éå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š5754msforeachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š13msIteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š12msListIteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š12mspollFirstéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š7mspollLastéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š0msremoveFirstéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š0msremoveLastéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š0ms ç»“è®º: åœ¨éå†LinkedListæ—¶ï¼Œä½¿ç”¨removeFist()æˆ–removeLast()æ•ˆç‡æœ€é«˜ã€‚ä½†ç”¨å®ƒä»¬éå†æ—¶ï¼Œä¼šåˆ é™¤åŸå§‹æ•°æ®ï¼Œé›†åˆä¸ºç©ºæ—¶ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ï¼›è‹¥å•çº¯åªè¯»å–ï¼Œè€Œä¸åˆ é™¤ï¼ŒLinkedListéå†æ—¶å»ºè®®ä½¿ç”¨For-eachæˆ–è€…è¿­ä»£å™¨çš„æ–¹å¼ã€‚åƒä¸‡ä¸è¦é€šè¿‡éšæœºè®¿é—®å»éå†LinkedListï¼","link":"/2018/06/09/java/exercise/util/LinkedList/"},{"title":"TreeSet","text":"TreeSetç»§æ‰¿è‡ª AbstractSet ï¼Œå®ç°äº†Setæ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯äºŒå‰æ ‘ï¼Œå®é™…æ˜¯é€šè¿‡TreeMapå®ç°çš„ ï¼Œå¯ä»¥å¯¹Seté›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚ ç‰¹ç‚¹ï¼šå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…ƒç´ ä¸å…è®¸ä¸ºnullï¼Œå…ƒç´ ä¸ä¼šé‡å¤ï¼Œçº¿ç¨‹ä¸åŒæ­¥ã€‚ ä¿è¯å…ƒç´ æƒŸä¸€æ€§çš„åŸç†ï¼šcompareToæ–¹æ³• return 0ã€‚ TreeSetæ”¯æŒä¸¤ç§æ’åºæ–¹å¼ï¼š ä¸€ã€å…ƒç´ çš„è‡ªç„¶æ’åºï¼šå³å…ƒç´ è‡ªèº«å®ç°çš„Comparableæ¥å£ï¼Œè¦†ç›–äº†compareToæ–¹æ³•ï¼Œä½¿è‡ªèº«å…·å¤‡äº†æ¯”è¾ƒæ€§ã€‚ 123456789101112131415public class Student implements Comparable&lt;Student&gt; { private String name; private Integer age; //getã€set... @Override public int compareTo(Student student) { int num = this.age.compareTo(student.getAge()); if (num == 0) { return this.name.compareTo(student.getName()); } return num; }} äºŒã€æ¯”è¾ƒå™¨æ’åºï¼šå³å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå™¨ç±»ï¼Œå®ç°Comparatoræ¥å£ï¼Œè¦†ç›–compareæ–¹æ³•ï¼Œå°†æ¯”è¾ƒå™¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™TreeSeté›†åˆçš„æ„é€ å‡½æ•°ã€‚ 12345678910TreeSet&lt;Student&gt; set = new TreeSet&lt;&gt;(new Comparator&lt;Student&gt;() { @Override public int compare(Student s1, Student s2) { int num = s1.getAge().compareTo(s2.getAge()); if (num == 0) { return s1.getName().compareTo(s2.getName()); } return num; } }); æ„é€ å‡½æ•°ï¼š TreeSet() æ„é€ ä¸€ä¸ªç©ºçš„é›†åˆï¼Œæ ¹æ®å…¶å…ƒç´ çš„è‡ªç„¶æ’åºè¿›è¡Œæ’åºã€‚æ‰€æœ‰å…ƒç´ å¿…é¡»å·²å®ç°Comparableæ¥å£ã€‚ TreeSet(Comparator&lt;? super E&gt; comparator) æ„é€ ä¸€ä¸ªç©ºçš„é›†åˆï¼Œæ ¹æ®æŒ‡å®šçš„æ¯”è¾ƒå™¨è¿›è¡Œæ’åºã€‚ æ’å…¥åˆ°é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ç”±æŒ‡å®šçš„æ¯”è¾ƒå™¨è¿›è¡Œç›¸äº’æ¯”è¾ƒã€‚ TreeSet(Collection&lt;? extends E&gt; c) æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ çš„æ–°æ ‘é›†ï¼Œæ ¹æ®å…¶å…ƒç´ çš„è‡ªç„¶æ’åºè¿›è¡Œæ’åº ã€‚æ’å…¥åˆ°é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»å®ç°Comparableæ¥å£ã€‚ TreeSet(SortedSet s) æ„é€ ä¸€ä¸ªåŒ…å«ç›¸åŒå…ƒç´ çš„æ–°æ ‘ï¼Œå¹¶ä½¿ç”¨ä¸æŒ‡å®šæ’åºé›†ç›¸åŒçš„é¡ºåºã€‚ ä¸»è¦æ–¹æ³•ï¼š Iterator iterator() ä»¥å‡åºè¿”å›è¯¥é›†åˆä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ Iterator descendingIterator() ä»¥é™åºè¿”å›è¯¥é›†åˆä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ NavigableSet descendingSet() è¿”å›æ­¤é›†åˆä¸­åŒ…å«çš„å…ƒç´ çš„åå‘æ’åºè§†å›¾ã€‚ int size() è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ æ•°ã€‚ boolean isEmpty() åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«å…ƒç´ ã€‚ boolean contains(Object o) åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´  ã€‚ boolean add(E e) å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰ã€‚ boolean remove(Object o) ä»è¯¥é›†åˆä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœé›†åˆåŒ…å«è¿™ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚ void clear() åˆ é™¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ ã€‚ boolean addAll(Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆä¸­ã€‚ NavigableSet subSet(E fromElement, boolean fromInclusive, E toElement, boolean toInclusive) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†çš„è§†å›¾ï¼Œå…¶å…ƒç´ çš„èŒƒå›´ä»fromElementåˆ°toElement ã€‚ NavigableSet headSet(E toElement, boolean inclusive) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†çš„è§†å›¾ï¼Œå…¶å…ƒç´ å°äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœinclusiveä¸ºtrueï¼‰ toElement ã€‚ NavigableSet tailSet(E fromElement, boolean inclusive) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†çš„è§†å›¾ï¼Œå…¶å…ƒç´ å¤§äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœinclusiveä¸ºtrueï¼‰ fromElement ã€‚ SortedSet subSet(E fromElement, E toElement) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†çš„è§†å›¾ï¼Œå…¶å…ƒç´ çš„èŒƒå›´ä»fromElement ï¼ˆåŒ…å«ï¼‰åˆ°toElement (ä¸åŒ…å«)ã€‚ Comparator&lt;? super E&gt; comparator() è¿”å›ç”¨äºå¯¹è¯¥é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå¦‚æœæ­¤é›†åˆå…ƒç´ ä½¿ç”¨è‡ªç„¶æ’åºåˆ™è¿”å›nullã€‚ E first() è¿”å›æ­¤é›†åˆä¸­å½“å‰çš„ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ã€‚ E last() è¿”å›æ­¤é›†åˆä¸­å½“å‰çš„æœ€åï¼ˆæœ€é«˜ï¼‰å…ƒç´ ã€‚ E lower(E e) è¿”å›è¿™ä¸ªé›†åˆä¸­æœ€å¤§çš„å…ƒç´ ä¸¥æ ¼å°äºç»™å®šçš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› null ã€‚ E floor(E e) è¿”å›è¯¥é›†åˆä¸­æœ€å¤§çš„å…ƒç´ å°äºæˆ–ç­‰äºç»™å®šçš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› null ã€‚ E ceiling(E e) è¿”å›æ­¤é›†åˆä¸­æœ€å°å…ƒç´ å¤§äºæˆ–ç­‰äºç»™å®šå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰æ­¤å…ƒç´ åˆ™è¿”å› null ã€‚ E higher(E e) è¿”å›æ­¤é›†ä¸­çš„æœ€å°å…ƒç´ ä¸¥æ ¼å¤§äºç»™å®šå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰æ­¤å…ƒç´ ï¼Œåˆ™è¿”å› null ã€‚ E pollFirst() æ£€ç´¢å¹¶åˆ é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ï¼Œå¦‚æœæ­¤é›†åˆä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ E pollLast() æ£€ç´¢å¹¶åˆ é™¤æœ€åä¸€ä¸ªï¼ˆæœ€é«˜ï¼‰å…ƒç´ ï¼Œå¦‚æœæ­¤é›†åˆä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ éå†ï¼š1ã€foreach2ã€è¿­ä»£å™¨ï¼ˆIteratorï¼‰ 123456789101112131415161718192021222324252627282930313233343536import java.util.TreeSet;import java.util.Iterator;public class TreeSetDemo { public static void main(String[] args) { TreeSet&lt;Integer&gt; list = new TreeSet&lt;&gt;(); for(int i = 0; i &lt;10000;i++) { list.add(i); } byForeach(list); byIteratorAsc(list); byIteratorDesc(list); } public static void byForeach(TreeSet&lt;Integer&gt; list) { for (Integer integer : list) { ; } } public static void byIteratorAsc(TreeSet&lt;Integer&gt; list) { list.iterator(); for (Iterator&lt;Integer&gt; it = list.iterator(); it.hasNext();) { it.next(); } } public static void byIteratorDesc(TreeSet&lt;Integer&gt; list) { list.iterator(); for (Iterator&lt;Integer&gt; it = list.descendingIterator(); it.hasNext();) { it.next(); } }","link":"/2018/06/19/java/exercise/util/TreeSet/"},{"title":"åˆ‡å‰²ã€åˆå¹¶æ–‡ä»¶","text":"ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import java.io.*;import java.util.*;class SplitFile{ public static void main(String[] args) throws IOException{ //spitFile(); mergFile(); } public static void mergFile() throws IOException{ ArrayList&lt;FileInputStream&gt; list = new ArrayList&lt;FileInputStream&gt;(); for(int i = 1;i&lt;=3;i++){ list.add(new FileInputStream(i+&quot;.part&quot;)); } Iterator&lt;FileInputStream&gt; it = list.iterator(); Enumeration&lt;FileInputStream&gt; en = new Enumeration&lt;FileInputStream&gt;(){ public boolean hasMoreElements(){ return it.hasNext(); } public FileInputStream nextElement(){ return it.next(); } }; SequenceInputStream sis = new SequenceInputStream(en); FileOutputStream fos = new FileOutputStream(&quot;001.jpg&quot;); byte[] buf = new byte[1024]; int len = 0; while((len=sis.read(buf))!=-1){ fos.write(buf,0,len); } sis.close(); fos.close(); } public static void spitFile() throws IOException{ FileInputStream fis = new FileInputStream(&quot;000.jpg&quot;); FileOutputStream fos = null; byte[] buf = new byte[1024*40]; int len = 0; int count = 1; while ((len=fis.read(buf))!=-1){ fos = new FileOutputStream((count++)+&quot;.part&quot;); fos.write(buf,0,len); fos.close(); } fis.close(); }}","link":"/2018/05/01/java/exercise/IO/SplitFile/"},{"title":"vector","text":"Vector ç»§æ‰¿è‡ª AbstractList ç‰¹ç‚¹:1ã€Vector åº•å±‚æ˜¯æ•°ç»„æ•°æ®ç»“æ„ã€‚2ã€ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºVectoræ—¶ï¼Œé»˜è®¤å®¹é‡å¤§å°æ˜¯10ã€‚3ã€å½“Vectorå®¹é‡ä¸è¶³ä»¥å®¹çº³å…¨éƒ¨å…ƒç´ æ—¶ï¼ŒVectorçš„å®¹é‡ä¼šå¢åŠ ã€‚è‹¥å®¹é‡å¢åŠ ç³»æ•° &gt;0ï¼Œåˆ™å°†å®¹é‡çš„å€¼å¢åŠ â€œå®¹é‡å¢åŠ ç³»æ•°â€ï¼›å¦åˆ™ï¼Œå°†å®¹é‡å¤§å°å¢åŠ ä¸€å€ã€‚4ã€Vector æ˜¯çº¿ç¨‹åŒæ­¥çš„ã€‚Vectorå‡ ä¹å’ŒArrayListç›¸ç­‰ï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äºVectoræ˜¯åŒæ­¥çš„ã€‚æ­£å› ä¸ºæ­¤ï¼ŒVectoræ¯”ArrayListçš„å¼€é”€æ›´å¤§ã€‚ä¸€èˆ¬Vectorå°±è¢«ArrayListæ›¿ä»£äº†ã€‚ æ„é€ æ–¹æ³•ï¼š Vector() æ„é€ ä¸€ä¸ªç©ºçš„é›†åˆï¼Œå…¶å†…éƒ¨æ•°æ®æ•°ç»„çš„å¤§å°ä¸º 10 ï¼Œå…¶æ ‡å‡†å®¹é‡å¢é‡ä¸ºé›¶ã€‚ Vector(int initialCapacity) æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šåˆå§‹å®¹é‡å¹¶ä¸”å…¶å®¹é‡å¢é‡ç­‰äºé›¶çš„ç©ºé›†åˆã€‚ Vector(Collection&lt;? extends E&gt; c) æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„é›†åˆï¼ŒæŒ‰ç…§é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºã€‚ ä¸»è¦æ–¹æ³•ï¼š void copyInto(Object[] anArray) å°†æ­¤é›†åˆä¸­çš„å…ƒç´ å¤åˆ¶åˆ°æŒ‡å®šçš„æ•°ç»„ä¸­ã€‚ void trimToSize() ä¿®æ”¹è¯¥å‘é‡çš„å®¹é‡æˆä¸ºå‘é‡çš„å½“å‰å¤§å°ã€‚ void ensureCapacity(int minCapacity) å¦‚æœéœ€è¦ï¼Œå¢åŠ æ­¤å‘é‡çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒå¯ä»¥è‡³å°‘ä¿å­˜æŒ‡å®šçš„æœ€å°å®¹é‡å‚æ•°å…ƒç´ æ•°ã€‚ void setSize(int newSize) è®¾ç½®æ­¤é›†åˆçš„å¤§å°ã€‚å¦‚æœæ–°å®¹é‡å°äºå½“å‰å®¹é‡ï¼Œåˆ™ä¸¢å¼ƒç´¢å¼•newSizeè‡³å½“å‰å®¹é‡çš„æ‰€æœ‰å…ƒç´ ã€‚ int capacity() è¿”å›æ­¤é›†åˆçš„å½“å‰å®¹é‡ã€‚ int size() è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ æ•°ã€‚ boolean isEmpty() åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦æœ‰å…ƒç´ ã€‚ Enumeration elements() è¿”å›æ­¤é›†åˆå…ƒç´ çš„æšä¸¾ã€‚ boolean contains(Object o) åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´ ã€‚ int indexOf(Object o) è¿”å›æ­¤é›†åˆä¸­æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤é›†åˆä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int indexOf(Object o, int index) è¿”å›æ­¤é›†åˆä¸­ä»æŒ‡å®šçš„ä½ç½®å¤„å¼€å§‹å‘åæœç´¢æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int lastIndexOf(Object o) è¿”å›æ­¤é›†åˆä¸­æŒ‡å®šå…ƒç´ çš„æœ€åæ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤é›†åˆä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int lastIndexOf(Object o, int index) è¿”å›æ­¤é›†åˆä¸­ä»æŒ‡å®šçš„ä½ç½®å¼€å§‹å‘å‰æœç´¢æŒ‡å®šå…ƒç´ å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ E elementAt(int index) è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚ E firstElement() è¿”å›æ­¤é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œåˆ™æŠ›å‡ºNoSuchElementException å¼‚å¸¸ã€‚ E lastElement() è¿”å›æ­¤é›†åˆçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œåˆ™æŠ›å‡ºNoSuchElementException å¼‚å¸¸ã€‚ void setElementAt(E obj, int index) å°†è¯¥é›†åˆçš„æŒ‡å®šindexçš„å…ƒç´ è®¾ç½®ä¸ºæŒ‡å®šçš„å¯¹è±¡ã€‚ void removeElementAt(int index) åˆ é™¤æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚ void insertElementAt(E obj, int index) åœ¨æŒ‡å®šçš„indexæ’å…¥æŒ‡å®šå¯¹è±¡ ã€‚ void addElement(E obj) å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆçš„æœ«å°¾ã€‚ boolean removeElement(Object obj) ä»æ­¤é›†åˆä¸­åˆ é™¤æŒ‡å®šå¯¹è±¡çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„æ­¤å…ƒç´ ã€‚ç­‰åŒäºremove(Object)ã€‚ void removeAllElements() ä»è¯¥é›†åˆä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ï¼Œå¹¶å°†å…¶å¤§å°è®¾ç½®ä¸ºé›¶ã€‚ Object[] toArray() ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤Vectorä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ T[] toArray(T[] a) ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤Vectorä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„; è¿”å›çš„æ•°ç»„çš„ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„ç±»å‹ã€‚ E get(int index) è¿”å›æ­¤é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ E set(int index, E element) ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ boolean add(E e) å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤é›†åˆçš„æœ«å°¾ã€‚ boolean remove(Object o) åˆ é™¤æ­¤å‘é‡ä¸­æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªå‡ºç°çš„æ­¤å…ƒç´ ï¼Œå¦‚æœé›†åˆä¸­ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸ä¼šæ›´æ”¹ã€‚ void add(int index, E element) åœ¨æ­¤é›†åˆrä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚ E remove(int index) åˆ é™¤æ­¤é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ void clear() åˆ é™¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ ã€‚ boolean containsAll(Collection&lt;?&gt; c) åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ boolean addAll(Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°è¯¥é›†åˆçš„æœ«å°¾ã€‚ boolean removeAll(Collection&lt;?&gt; c) ä»æ­¤é›†åˆä¸­åˆ é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚ boolean retainAll(Collection&lt;?&gt; c) ä»…ä¿ç•™æ­¤é›†åˆä¸­ä¸æŒ‡å®šé›†åˆä¸­ç›¸åŒçš„å…ƒç´ ã€‚ boolean addAll(int index, Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°æ­¤é›†åˆä¸­çš„æŒ‡å®šä½ç½®ã€‚ List subList(int fromIndex, int toIndex )è¿”å›æ­¤é›†åˆä¸­åœ¨fromIndexï¼ˆåŒ…æ‹¬ï¼‰å’ŒtoIndexä¹‹é—´çš„è§†å›¾ã€‚ void removeRange(int fromIndex, int toIndex) ä»æ­¤é›†åˆä¸­åˆ é™¤ç´¢å¼•ä¸ºfromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ã€‚ Iterator iterator() è¿”å›è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ ListIterator listIterator() è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ ListIterator listIterator(int index) ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆæŒ‰æ­£ç¡®é¡ºåºï¼‰çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ éå†1ã€è¿­ä»£å™¨(Iteratorå’ŒListIterator)2ã€æ™®é€šforå¾ªç¯3ã€foreach4ã€Enumerationéå†ï¼ˆç‰¹æœ‰çš„ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465import java.util.Enumeration;import java.util.Iterator;import java.util.ListIterator;import java.util.Vector;public class VectorDemo { public static void main(String[] args) { Vector&lt;Integer&gt; list = new Vector&lt;Integer&gt;(); for (int i = 0; i &lt; 1000000; i++) { list.add(i); } byIterator(list); byListIterator(list); byFor(list); byForeach(list); byEnumeration(list); } public static void byIterator(Vector&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (Iterator&lt;Integer&gt; iterator = list.iterator(); iterator.hasNext();) { iterator.next(); } long end = System.currentTimeMillis(); System.out.println(\"iteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); } public static void byListIterator(Vector&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (ListIterator&lt;Integer&gt; iterator = list.listIterator(); iterator.hasNext();) { iterator.next(); } long end = System.currentTimeMillis(); System.out.println(\"listIteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); } public static void byFor(Vector&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (int i = 0; i &lt; list.size(); i++) { list.get(i); } long end = System.currentTimeMillis(); System.out.println(\"forå¾ªç¯éå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); } public static void byForeach(Vector&lt;Integer&gt; list) { long start = System.currentTimeMillis(); for (Integer integer : list) { ; } long end = System.currentTimeMillis(); System.out.println(\"foreachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); } public static void byEnumeration(Vector&lt;Integer&gt; list) { long start = System.currentTimeMillis(); Enumeration&lt;Integer&gt; enumeration = list.elements(); while (enumeration.hasMoreElements()) { enumeration.nextElement(); } long end = System.currentTimeMillis(); System.out.println(\"enumerationéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š\" + (end - start) + \"ms\"); }} è¾“å‡ºï¼š 12345iteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š38mslistIteratoréå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š38msforå¾ªç¯éå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š34msforeachéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š42msenumerationéå†æ¶ˆè€—æ—¶é—´ä¸ºï¼š40ms ç¬¬äºŒç§æ™®é€šforå¾ªç¯éå†æ•ˆç‡æœ€é«˜ã€‚","link":"/2018/06/09/java/exercise/util/Vector/"},{"title":"TreeMap","text":"TreeMapç»§æ‰¿è‡ª AbstractMap&lt;K,V&gt; ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ã€‚ ç‰¹ç‚¹ï¼šå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œkeyä¸å…è®¸ä¸ºnull ï¼Œvalueå¯ä»¥ä¸ºnull ï¼Œkeyä¸ä¼šé‡å¤ï¼Œçº¿ç¨‹ä¸åŒæ­¥ã€‚ ä¿è¯å…ƒç´ æƒŸä¸€æ€§çš„åŸç†ï¼šåˆ¤æ–­å…ƒç´ çš„HashCodeå€¼æ˜¯å¦ç›¸åŒã€‚ å¦‚æœå…ƒç´ çš„HashCodeå€¼ç›¸åŒï¼Œä¼šç»§ç»­åˆ¤æ–­equalsæ˜¯å¦ä¸ºtrueã€‚ å¦‚æœå…ƒç´ çš„HashCodeå€¼ä¸åŒï¼Œä¸ä¼šè°ƒç”¨equalsã€‚ æ³¨æ„: å¯¹äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠåˆ é™¤ç­‰æ“ä½œï¼Œä¾èµ–çš„æ–¹æ³•æ˜¯å…ƒç´ HashCodeå’Œequalsæ–¹æ³•ã€‚ å¯¹äºHashSetä¸­ä¿å­˜çš„å¯¹è±¡ï¼Œè¯·æ³¨æ„æ­£ç¡®é‡å†™å…¶equalså’ŒhashCodeæ–¹æ³•ï¼Œä»¥ä¿è¯æ”¾å…¥çš„å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚ æ„é€ æ–¹æ³•ï¼š TreeMap() ä½¿ç”¨å…¶é”®çš„è‡ªç„¶æ’åºæ„é€ ä¸€ä¸ªæ–°çš„TreeMapã€‚ TreeMap(Comparator&lt;? super K&gt; comparator) æŒ‰ç…§æŒ‡å®šçš„æ¯”è¾ƒå™¨æ’åºï¼Œæ„é€ ä¸€ä¸ªæ–°çš„TreeMapã€‚ TreeMap(Map&lt;? extends K,? extends V&gt; m) æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šMapç›¸åŒçš„æ˜ å°„ï¼Œæ ¹æ®å…¶é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åº ã€‚ TreeMap(SortedMap&lt;K,? extends V&gt; m) æ„é€ ä¸€ä¸ªåŒ…å«mç›¸åŒæ˜ å°„å¹¶ä½¿ç”¨ä¸æŒ‡å®šæ’åºæ˜ å°„ç›¸åŒé¡ºåºçš„TreeMapã€‚ ä¸»è¦æ–¹æ³•ï¼š int size() è¿”å›æ­¤é›†åˆä¸­çš„é”®å€¼æ˜ å°„çš„æ•°é‡ã€‚ boolean containsKey(Object key) åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šçš„keyã€‚ boolean containsValue(Object value) åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šçš„valueï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ã€‚ V get(Object key) è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œå¦‚æœä¸åŒ…å«è¯¥é”®çš„æ˜ å°„ï¼Œè¿”å›nullã€‚ Comparator&lt;? super K&gt; comparator() è¿”å›é›†åˆçš„æ„é€ å™¨ï¼Œå¦‚æœé›†åˆä½¿ç”¨çš„è‡ªç„¶æ’åºï¼Œè¿”å›nullã€‚ K firstKey() è¿”å›å½“å‰é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰é”®ã€‚ K lastKey() è¿”å›å½“å‰é›†åˆä¸­çš„æœ€åï¼ˆæœ€é«˜ï¼‰é”®ã€‚ void putAll(Map&lt;? extends K,? extends V&gt; map) å°†æŒ‡å®šmapé›†åˆçš„æ‰€æœ‰æ˜ å°„å¤åˆ¶åˆ°æ­¤é›†åˆä¸­ã€‚ V put(K key, V value) å°†æŒ‡å®šçš„å€¼ä¸æ­¤æ˜ å°„ä¸­çš„æŒ‡å®šé”®ç›¸å…³è”ã€‚ å¦‚æœé›†åˆå·²åŒ…å«äº†è¯¥é”®çš„æ˜ å°„ï¼Œåˆ™æ›¿æ¢æ—§å€¼ã€‚ V remove(Object key) ä»TreeMapä¸­åˆ é™¤æ­¤é”®çš„æ˜ å°„ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ void clear() åˆ é™¤æ‰€æœ‰çš„æ˜ å°„ã€‚ Map.Entry&lt;K,V&gt; firstEntry() è¿”å›é›†åˆä¸­çš„æœ€å°é”®ç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œè¿”å› null ã€‚ Map.Entry&lt;K,V&gt; lastEntry() è¿”å›é›†åˆä¸­çš„æœ€å¤§é”®ç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œè¿”å› null ã€‚Map.Entry&lt;K,V&gt; pollFirstEntry() åˆ é™¤å¹¶è¿”å›é›†åˆä¸­çš„æœ€å°é”®ç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ Map.Entry&lt;K,V&gt; pollLastEntry() åˆ é™¤å¹¶è¿”å›é›†åˆä¸­çš„æœ€å¤§é”®ç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœé›†åˆä¸ºç©ºï¼Œåˆ™è¿”å› null ã€‚ Map.Entry&lt;K,V&gt; lowerEntry(K key) è¿”å›å°äºæŒ‡å®škeyçš„æœ€å¤§keyçš„æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„keyï¼Œåˆ™è¿”å› null ã€‚ K lowerKey(K key) è¿”å›å°äºæŒ‡å®škeyçš„æœ€å¤§keyï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å› null ã€‚ Map.Entry&lt;K,V&gt; floorEntry(K key) è¿”å›å°äºæˆ–ç­‰äºæŒ‡å®škeyçš„æœ€å¤§keyç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„keyï¼Œåˆ™è¿”å›null ã€‚ K floorKey(K key) è¿”å›å°äºæˆ–ç­‰äºç»™å®škeyçš„æœ€å¤§keyï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å› null ã€‚ Map.Entry&lt;K,V&gt; ceilingEntry(K key) è¿”å›å¤§äºæˆ–ç­‰äºç»™å®škeyçš„æœ€å°keyç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„keyï¼Œåˆ™è¿”å› null ã€‚ K ceilingKey(K key) è¿”å›å¤§äºæˆ–ç­‰äºç»™å®šé”®çš„keyï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„keyï¼Œåˆ™è¿”å› null ã€‚ Map.Entry&lt;K,V&gt; higherEntry(K key) è¿”å›å¤§äºæŒ‡å®šçš„keyçš„æœ€å°keyç›¸å…³è”çš„é”®å€¼æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„é”®ï¼Œåˆ™ è¿”å›null ã€‚ K higherKey(K key) è¿”å›å¤§äºç»™å®škeyçš„æœ€å°keyï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„keyï¼Œåˆ™è¿”å› null ã€‚ Set keySet() è¿”å›æ­¤é›†åˆä¸­åŒ…å«çš„é”®çš„Setè§†å›¾ã€‚è¯¥è§†å›¾æ”¯æŒç»ç”±Iterator.remove ï¼Œ Set.remove ï¼Œ removeAll ï¼Œ retainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ NavigableSet navigableKeySet() è¿”å›æ­¤é›†åˆä¸­åŒ…å«çš„é”®çš„NavigableSetè§†å›¾ã€‚è¯¥è§†å›¾æ”¯æŒç»ç”±Iterator.remove ï¼Œ Set.remove ï¼Œ removeAll ï¼Œ retainAllå’Œclearæ“ä½œã€‚ å®ƒä¸æ”¯æŒaddæˆ–addAllæ“ä½œã€‚ NavigableSet descendingKeySet() è¿”å›æ­¤é›†åˆä¸­åŒ…å«çš„é”®çš„ç›¸åé¡ºåºçš„NavigableSet ã€‚åŒä¸Šã€‚ Collection values() è¿”å›ä¸€ä¸ªCollectionåŒ…å«é›†åˆçš„å€¼ã€‚ åŒä¸Šã€‚ Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() è¿”å›æ­¤é›†åˆä¸­åŒ…å«çš„æ˜ å°„çš„Setè§†å›¾ã€‚ åŒä¸Šã€‚ NavigableMap&lt;K,V&gt; descendingMap() è¿”å›æ­¤æ˜ å°„ä¸­åŒ…å«çš„æ˜ å°„çš„åå‘æ’åºè§†å›¾ã€‚ NavigableMap&lt;K,V&gt; subMap(K fromKey, boolean fromInclusive, K toKey, boolean toInclusive) è¿”å›è¯¥é›†åˆ2éƒ¨åˆ†çš„è§†å›¾ï¼Œå…¶å…³é”®èŒƒå›´ä¸ºfromKeyè‡³toKeyã€‚ NavigableMap&lt;K,V&gt; headMap(K toKey, boolean inclusive) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶é”®å€¼å°äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœinclusiveä¸ºtrueï¼‰ toKey ã€‚ NavigableMap&lt;K,V&gt; tailMap(K fromKey, boolean inclusive) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶é”®å¤§äºï¼ˆæˆ–ç­‰äºï¼Œå¦‚æœinclusiveä¸ºtrueï¼‰ fromKey ã€‚ SortedMap&lt;K,V&gt; subMap(K fromKey, K toKey) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶keyèŒƒå›´ä¸ºfromKey ï¼ˆå«ï¼‰ï¼Œä¸å«toKeyã€‚ SortedMap&lt;K,V&gt; headMap(K toKey) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶keyå°äºtoKey ã€‚ SortedMap&lt;K,V&gt; tailMap(K fromKey) è¿”å›æ­¤é›†åˆçš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶keyå¤§äºæˆ–ç­‰äºfromKey ã€‚ boolean replace(K key, V oldValue, V newValue) ä»…å½“å½“å‰æ˜ å°„åˆ°æŒ‡å®šçš„å€¼æ—¶ï¼Œæ‰èƒ½æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚ V replace(K key, V value) åªæœ‰å½“ç›®æ ‡keyåˆ°æŸä¸ªå€¼æ—¶ï¼Œæ‰èƒ½æ›¿æ¢æŒ‡å®šé”®çš„æ¡ç›®ã€‚ éå†ï¼šIterator entrySet() keySet() values() descendingKeySet() descendingMap() 12345678910111213141516171819202122232425262728293031323334353637public static void byEntrySet(TreeMap&lt;String, Integer&gt; treeMap) { Set&lt;Entry&lt;String, Integer&gt;&gt; set = treeMap.entrySet(); for(Iterator&lt;Entry&lt;String, Integer&gt;&gt; iterator = set.iterator();iterator.hasNext();) { Entry&lt;String, Integer&gt; entry = iterator.next(); String key = entry.getKey(); Integer value = entry.getValue(); } } public static void byKeySet(TreeMap&lt;String, Integer&gt; treeMap) { Set&lt;String&gt; set = treeMap.keySet(); for(Iterator&lt;String&gt; iterator = set.iterator();iterator.hasNext();) { String key = iterator.next(); Integer value = treeMap.get(key); } } public static void byValues(TreeMap&lt;String, Integer&gt; treeMap) { Collection&lt;Integer&gt; collection = treeMap.values(); for (Iterator&lt;Integer&gt; iterator = collection.iterator(); iterator.hasNext();) { Integer value = iterator.next(); } } public static void byDescendingKeySet(TreeMap&lt;String, Integer&gt; treeMap) { NavigableSet&lt;String&gt; set = treeMap.descendingKeySet(); //keyçš„ååºã€‚ for (Iterator&lt;String&gt; iterator = set.iterator(); iterator.hasNext();) { String key = iterator.next(); Integer value = treeMap.get(key); } } public static void byDescendingMap(TreeMap&lt;String, Integer&gt; treeMap) { NavigableMap&lt;String, Integer&gt; map = treeMap.descendingMap(); Set&lt;Entry&lt;String, Integer&gt;&gt; set = map.entrySet(); for (Iterator&lt;Entry&lt;String, Integer&gt;&gt; iterator = set.iterator(); iterator.hasNext();) { Entry&lt;String, Integer&gt; entry = iterator.next(); String key = entry.getKey(); Integer value = entry.getValue(); } }","link":"/2018/06/24/java/exercise/util/TreeMap/"},{"title":"ubuntu-18.04-desktopé—®é¢˜","text":"ubuntu-18.04-desktopä¸­é‡åˆ°çš„é—®é¢˜ï¼ˆæœ€å°åŒ–å®‰è£… ï¼‰ 1ã€ä¼‘çœ åæ— æ³•å”¤é†’ ä¼‘çœ åï¼Œå°±è¿›ä¸å»ç³»ç»Ÿäº†ï¼Œç›®å‰è§£å†³åŠæ³•æ˜¯åœ¨è®¾ç½®é‡Œç¦æ­¢ä¼‘çœ ã€‚ 2ã€ifconfigå‘½ä»¤not found æœç´¢è¯´æ˜¯ifconfigè¢«æŠ›å¼ƒäº†ï¼Œè¢«ipå‘½ä»¤å–ä»£äº†ã€‚ 1$ ip address å¯ç¼©å†™ä¸º 1$ ip a å¯å‚è€ƒï¼šhttps://www.sunzhongwei.com/ubuntu-1804-ifconfig-command-not-found?from=sidebar_related â€‹ https://news.ycombinator.com/item?id=17151046 æ–¹æ³•äºŒï¼šå¯å®‰è£…net-tools ï¼Œç»§ç»­ä½¿ç”¨ifconfig 1$ apt-get install net-tools 3ã€sshè¿ä¸ä¸Š åŸå› æ˜¯ubuntu18.04é»˜è®¤æ²¡æœ‰å®‰è£…sshæœåŠ¡ ã€‚ ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š 1$ sudo apt-get install openssh-server å®‰è£…å®Œæˆå,å¯åŠ¨sshæœåŠ¡ 1$ sudo /etc/init.d/ssh start æŸ¥çœ‹sshè¿›ç¨‹ï¼Œè‹¥å‡ºç°sshdï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸ 1$ ps -ef|grep ssh å¯å‚è€ƒï¼šhttps://segmentfault.com/a/1190000015872297","link":"/2018/08/23/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/18.04/ubuntu-desktop%E4%B8%AD%E9%97%AE%E9%A2%98/"},{"title":"é›†åˆæ¡†æ¶","text":"Java é›†åˆæ¡†æ¶ä¸»è¦ç»“æ„å›¾ Iterator æ¥å£é›†åˆçš„è¿­ä»£å™¨ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä¸»è¦æ–¹æ³•ï¼š boolean hasNext() åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ E next() è¿”å›è¿­ä»£ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ void remove() åˆ é™¤å½“å‰æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ã€‚1234Iterator li = list.iterator(); while(li.hasNext()){ System.out.println(li.next()); } Javaé›†åˆæ¡†æ¶ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šCollectionã€Map Collection |â€“List:å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…ƒç´ å¯ä»¥é‡å¤ï¼Œå› ä¸ºè¯¥é›†åˆä½“ç³»æœ‰ç´¢å¼•ã€‚ |â€“ArrayList:åº•å±‚çš„æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯æ•°ç»„ç»“æ„ã€‚ç‰¹ç‚¹ï¼šæŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯å¢åˆ ç¨æ…¢ã€‚çº¿ç¨‹ä¸åŒæ­¥ã€‚ |â€“LinkedList:åº•å±‚ä½¿ç”¨çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚ç‰¹ç‚¹ï¼šå¢åˆ é€Ÿåº¦å¾ˆå¿«ï¼ŒæŸ¥è¯¢ç¨æ…¢ã€‚ |â€“Vector:åº•å±‚æ˜¯æ•°ç»„æ•°æ®ç»“æ„ã€‚çº¿ç¨‹åŒæ­¥ã€‚è¢«ArrayListæ›¿ä»£äº†ã€‚ |â€“set:å…ƒç´ æ˜¯æ— åºçš„ï¼Œå…ƒç´ ä¸å¯ä»¥é‡å¤ã€‚ |â€“HashSet:åº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ã€‚ |â€“TreeSet:åº•å±‚æ•°æ®ç»“æ„æ˜¯äºŒå‰æ ‘ã€‚ Collection æ¥å£æ˜¯æ‰€æœ‰å•åˆ—é›†åˆçš„å…±åŒçˆ¶æ¥å£ ä¸»è¦æ–¹æ³•ï¼š int size() è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ æ•°ã€‚ boolean isEmpty() åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«å…ƒç´ ã€‚ boolean contains(Object o) å¦‚æœæ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´ ã€‚ boolean add(E e) å‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ŒæˆåŠŸè¿”å›trueã€‚ boolean remove(Object o) ä»é›†åˆä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ ï¼ŒæˆåŠŸè¿”å›trueã€‚ Iterator iterator() è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ boolean containsAll(Collection&lt;?&gt; c) åˆ¤æ–­æ­¤é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ boolean addAll(Collection&lt;? extends E&gt; c) å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆä¸­ã€‚ boolean removeAll(Collection&lt;?&gt; c) åˆ é™¤é›†åˆä¸­åŒ…å«æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ boolean retainAll(Collection&lt;?&gt; c) ä¿ç•™ä¸¤é›†åˆä¸­å…±ç”¨çš„å…ƒç´ ã€‚å¦‚æœé›†åˆæœ‰æ”¹å˜å°±è¿”å›trueã€‚ void clear() æ¸…é™¤é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ Object[] toArray() è¿”å›ä¸€ä¸ªåŒ…å«æ­¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ T[] toArray(T[] a) è¿”å›åŒ…å«æ­¤é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„; è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ List æ¥å£ ç»§æ‰¿è‡ªCollectionæœ‰åºé›†åˆï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ“ä½œå…ƒç´ ã€‚å‡¡æ˜¯å¯ä»¥æ“ä½œè§’æ ‡çš„æ–¹æ³•éƒ½æ˜¯è¯¥ä½“ç³»ç‰¹æœ‰çš„æ–¹æ³•ã€‚ç‰¹æœ‰æ–¹æ³•ï¼ˆç›¸å¯¹äºCollectionï¼‰ï¼š E get(int index) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ E set(int index, E element) ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ void add(int index, E element) å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥æ­¤é›†åˆä¸­çš„æŒ‡å®šä½ç½®ã€‚ E remove(int index) åˆ é™¤è¯¥åˆ—é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œåç»­å…ƒç´ å·¦ç§»ã€‚ int indexOf(Object o) è¿”å›æ­¤é›†åˆä¸­æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤é›†åˆä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ int lastIndexOf(Object o) æ­¤é›†åˆä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤é›†åˆä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚ ListIterator listIterator() è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ ListIterator listIterator(int index) ä»é›†åˆä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›é›†åˆä¸­çš„å…ƒç´ çš„é›†åˆè¿­ä»£å™¨ã€‚ List subList(int fromIndex, int toIndex) è¿”å›é›†åˆä¸­æŒ‡å®šçš„fromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„éƒ¨åˆ†è§†å›¾ã€‚ ListIterator æ¥å£ ç»§æ‰¿è‡ªIterator Listé›†åˆç‰¹æœ‰çš„è¿­ä»£å™¨ã€‚ç‰¹ç‚¹ï¼š1ã€å…è®¸å‘å‰ã€å‘åä¸¤ä¸ªæ–¹å‘éå† Listã€‚2ã€åœ¨éå†æ—¶å¯ä»¥è¿›è¡Œæ·»åŠ ï¼Œä¿®æ”¹ç­‰æ“ä½œã€‚3ã€è·å–è¿­ä»£å™¨å½“å‰æ¸¸æ ‡æ‰€åœ¨ä½ç½®ã€‚ç‰¹æœ‰æ–¹æ³•ï¼ˆç›¸å¯¹äºListIteratorï¼‰ï¼š boolean hasPrevious() åˆ¤æ–­æ˜¯å¦å­˜åœ¨å‰ä¸€ä¸ªå…ƒç´ ã€‚ E previous() è¿”å›è¿­ä»£ä¸­çš„å‰ä¸€ä¸ªå…ƒç´ ã€‚ int nextIndex() è¿”å›æ¸¸æ ‡åè¾¹å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚ int previousIndex() è¿”å›æ¸¸æ ‡å‰è¾¹å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚ void set(E e) ä¿®æ”¹å½“å‰è¿­ä»£çš„å…ƒç´ ä¸ºeã€‚ void add(E e) åœ¨æ¸¸æ ‡ å‰é¢ æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚ åœ¨è¿­ä»£æ—¶ï¼Œä¸å¯ä»¥é€šè¿‡é›†åˆå¯¹è±¡çš„æ–¹æ³•æ“ä½œé›†åˆä¸­çš„å…ƒç´ ã€‚å› ä¸ºä¼šå‘ç”ŸConcurrentModificationExceptionå¼‚å¸¸ã€‚æ‰€ä»¥åœ¨è¿­ä»£æ—¶ï¼Œåªèƒ½ç”¨è¿­ä»£å™¨çš„æ–¹æ³•æ“ä½œå…ƒç´ ï¼Œå¯æ˜¯Iteratoræ–¹æ³•æ˜¯æœ‰é™çš„ï¼Œåªèƒ½å¯¹å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œå–å‡ºï¼Œåˆ é™¤çš„æ“ä½œã€‚å¦‚æœæƒ³è¦å…¶å®ƒçš„æ“ä½œå¦‚æ·»åŠ ï¼Œä¿®æ”¹ç­‰ï¼Œå°±éœ€è¦ä½¿ç”¨å…¶å­æ¥å£ListIteratorã€‚è¯¥æ¥å£åªèƒ½é€šè¿‡Listé›†åˆçš„listIteratoræ–¹æ³•è·å–ã€‚","link":"/2018/05/25/java/exercise/util/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/"},{"title":"ubuntu 18.04 serverä¸­é…ç½®é™æ€IP","text":"ubuntu 18.04 serverä¸­é…ç½®é™æ€IPï¼Œæ–°çš„ç½‘ç»œå·¥å…·netplançš„ä½¿ç”¨æ–¹æ³• æœ€æ–°å‘å¸ƒçš„ubuntu18.04 serverï¼Œå¯ç”¨äº†æ–°çš„ç½‘ç»œå·¥å…·netplanï¼Œå¯¹äºå‘½ä»¤è¡Œé…ç½®ç½‘ç»œå‚æ•°è·Ÿä¹‹å‰çš„ç‰ˆæœ¬æœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ï¼Œç°åœ¨ä»‹ç»å¦‚ä¸‹ï¼š 1.å…¶ç½‘ç»œé…ç½®æ–‡ä»¶æ˜¯æ”¾åœ¨/etc/netplan/50-cloud-init.yaml, ç¼ºçœæ˜¯ç”¨dhcpæ–¹å¼ï¼Œ å¦‚ä¸‹ï¼š 123456network: ethernets: enp1s0: addresses: [] dhcp4: true version: 2 å¦‚æœè¦é…ç½®é™æ€åœ°å€ï¼Œåˆ™éœ€è¦ä¿®æ”¹æ­¤æ–‡ä»¶çš„æƒ³å…³å†…å®¹ï¼Œè§å¦‚ä¸‹çš„ä¾‹å­ï¼š 123456789network: ethernets: enp1s0: addresses: [192.168.1.80/24] dhcp4: false gateway4: 192.168.1.2 nameservers: addresses: [192.168.1.2] version: 2 ä½¿å…¶ç”Ÿæ•ˆï¼š 1$ sudo netplan apply å¦‚æœé…ç½®æœ‰é—®é¢˜ä¼šæŠ¥é”™ï¼Œå¦‚æœæ²¡é—®é¢˜ï¼Œåˆ™ä¼šæ–°çš„é…ç½®ä¼šç«‹å³ç”Ÿæ•ˆã€‚ æ³¨æ„ï¼šåªæ˜¯é’ˆå¯¹ubuntu18.04 Serverç‰ˆï¼Œå¯¹äº18.04 desktopå®ƒç¼ºçœæ˜¯ä½¿ç”¨NetworkMangeræ¥è¿›è¡Œç®¡ç†ï¼Œå¯ä½¿ç”¨å›¾å½¢ç•Œé¢è¿›è¡Œé…ç½®ï¼Œå…¶ç½‘ç»œé…ç½®æ–‡ä»¶æ˜¯ä¿å­˜åœ¨ï¼š/etc/NetworkManager/system-connectionsç›®å½•ä¸‹çš„ï¼Œè·ŸServerç‰ˆåŒºåˆ«è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚ netplan å·¥å…·è¿˜æœ‰å…¶å®ƒæ¯”è¾ƒä¸°å¯Œçš„åŠŸèƒ½ï¼Œ è¯¦ç»†å¯å‚è§å…¶çš„è¯´æ˜æ–‡æ¡£ï¼Œman netplan. å‚è€ƒï¼šhttp://forum.ubuntu.org.cn/viewtopic.php?t=487463","link":"/2018/08/24/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/18.04/ubuntu-server%E4%B8%AD%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81IP/"},{"title":"å‡çº§gcc/g++ç‰ˆæœ¬","text":"1ã€æ·»åŠ ppaæºtoolchain/testä¸‹å·²ç»æœ‰æ‰“åŒ…å¥½çš„gccï¼Œç‰ˆæœ¬æœ‰4.xã€5.0ã€6.0ç­‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªPPAå‡çº§gccã€‚ 12sudo add-apt-repository ppa:ubuntu-toolchain-r/test sudo apt-get update å¦‚æœæç¤ºæœªå®‰è£…ï¼Œè¿˜éœ€è¦å…ˆå®‰è£…å®ƒçš„åŒ… 1sudo apt-get install software-properties-common 2ã€å®‰è£…ç‰ˆæœ¬5+ 1sudo apt-get install gcc-5 g++-5 3ã€æ›´æ–°é“¾æ¥ 12345update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 53 \\--slave /usr/bin/g++ g++ /usr/bin/g++-5 \\--slave /usr/bin/gcc-ar gcc-ar /usr/bin/gcc-ar-5 \\--slave /usr/bin/gcc-nm gcc-nm /usr/bin/gcc-nm-5 \\--slave /usr/bin/gcc-ranlib gcc-ranlib /usr/bin/gcc-ranlib-5 4ã€æ£€æŸ¥ç‰ˆæœ¬ 1234567891011$ gcc --versiongcc (Ubuntu 5.5.0-12ubuntu1~14.04) 5.5.0 20171010Copyright (C) 2015 Free Software Foundation, Inc.This is free software; see the source for copying conditions. There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.$ g++ --versiong++ (Ubuntu 5.5.0-12ubuntu1~14.04) 5.5.0 20171010Copyright (C) 2015 Free Software Foundation, Inc.This is free software; see the source for copying conditions. There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. å‚è€ƒï¼šhttps://blog.csdn.net/betty13006159467/article/details/78394974","link":"/2018/05/02/%E6%9C%8D%E5%8A%A1%E5%99%A8/ubuntu/%E5%8D%87%E7%BA%A7gcc/g++%E7%89%88%E6%9C%AC/"}],"tags":[{"name":"å…¶å®ƒ","slug":"å…¶å®ƒ","link":"/tags/%E5%85%B6%E5%AE%83/"},{"name":"å‘½ä»¤","slug":"å‘½ä»¤","link":"/tags/%E5%91%BD%E4%BB%A4/"},{"name":"Clonezilla","slug":"Clonezilla","link":"/tags/Clonezilla/"},{"name":"codepush","slug":"codepush","link":"/tags/codepush/"},{"name":"nodejs","slug":"nodejs","link":"/tags/nodejs/"},{"name":"Jenkins","slug":"Jenkins","link":"/tags/Jenkins/"},{"name":"systemd","slug":"systemd","link":"/tags/systemd/"},{"name":"tomcat","slug":"tomcat","link":"/tags/tomcat/"},{"name":"RabbitMq","slug":"RabbitMq","link":"/tags/RabbitMq/"},{"name":"docker","slug":"docker","link":"/tags/docker/"},{"name":"Elasticsearch","slug":"Elasticsearch","link":"/tags/Elasticsearch/"},{"name":"æœç´¢å¼•æ“","slug":"æœç´¢å¼•æ“","link":"/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"},{"name":"Spring-boot","slug":"Spring-boot","link":"/tags/Spring-boot/"},{"name":"MongoDB","slug":"MongoDB","link":"/tags/MongoDB/"},{"name":"hexo","slug":"hexo","link":"/tags/hexo/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","link":"/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"https","slug":"https","link":"/tags/https/"},{"name":"jasperreports","slug":"jasperreports","link":"/tags/jasperreports/"},{"name":"pdf","slug":"pdf","link":"/tags/pdf/"},{"name":"åŠ å¯†","slug":"åŠ å¯†","link":"/tags/%E5%8A%A0%E5%AF%86/"},{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"rsync","slug":"rsync","link":"/tags/rsync/"},{"name":"åŒæ­¥","slug":"åŒæ­¥","link":"/tags/%E5%90%8C%E6%AD%A5/"},{"name":"sysv-rc-conf","slug":"sysv-rc-conf","link":"/tags/sysv-rc-conf/"},{"name":"selenium","slug":"selenium","link":"/tags/selenium/"},{"name":"ntp","slug":"ntp","link":"/tags/ntp/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"å¾…è¡¥å……","slug":"å¾…è¡¥å……","link":"/tags/%E5%BE%85%E8%A1%A5%E5%85%85/"},{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","link":"/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"name":"nginx","slug":"nginx","link":"/tags/nginx/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"samba","slug":"samba","link":"/tags/samba/"},{"name":"ä¸€è¨€","slug":"ä¸€è¨€","link":"/tags/%E4%B8%80%E8%A8%80/"},{"name":"å·¥å…·","slug":"å·¥å…·","link":"/tags/%E5%B7%A5%E5%85%B7/"},{"name":"inotify","slug":"inotify","link":"/tags/inotify/"},{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/tags/%E5%B7%A5%E4%BD%9C/"},{"name":"Jmeter","slug":"Jmeter","link":"/tags/Jmeter/"},{"name":"Windows","slug":"Windows","link":"/tags/Windows/"},{"name":"fastdfs","slug":"fastdfs","link":"/tags/fastdfs/"},{"name":"JVM","slug":"JVM","link":"/tags/JVM/"},{"name":"cwRsyncServer","slug":"cwRsyncServer","link":"/tags/cwRsyncServer/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","link":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","link":"/tags/%E6%97%A5%E5%BF%97/"},{"name":"æ¼æ´","slug":"æ¼æ´","link":"/tags/%E6%BC%8F%E6%B4%9E/"},{"name":"æœåŠ¡éƒ¨ç½²","slug":"æœåŠ¡éƒ¨ç½²","link":"/tags/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","link":"/tags/%E7%BC%93%E5%AD%98/"},{"name":"OCR","slug":"OCR","link":"/tags/OCR/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","link":"/tags/%E6%80%BB%E7%BB%93/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","link":"/tags/%E7%94%9F%E6%B4%BB/"},{"name":"keepalived","slug":"keepalived","link":"/tags/keepalived/"},{"name":"redis","slug":"redis","link":"/tags/redis/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/tags/%E7%88%AC%E8%99%AB/"},{"name":"mongodb","slug":"mongodb","link":"/tags/mongodb/"},{"name":"java8","slug":"java8","link":"/tags/java8/"},{"name":"spring-boot","slug":"spring-boot","link":"/tags/spring-boot/"},{"name":"HttpClient","slug":"HttpClient","link":"/tags/HttpClient/"},{"name":"json","slug":"json","link":"/tags/json/"},{"name":"SoapUI","slug":"SoapUI","link":"/tags/SoapUI/"},{"name":"webservice","slug":"webservice","link":"/tags/webservice/"},{"name":"jmeter","slug":"jmeter","link":"/tags/jmeter/"},{"name":"webscoket","slug":"webscoket","link":"/tags/webscoket/"},{"name":"linuxå‘½ä»¤","slug":"linuxå‘½ä»¤","link":"/tags/linux%E5%91%BD%E4%BB%A4/"},{"name":"rc.local","slug":"rc-local","link":"/tags/rc-local/"},{"name":"scp","slug":"scp","link":"/tags/scp/"},{"name":"HTTPS","slug":"HTTPS","link":"/tags/HTTPS/"},{"name":"nginxé…ç½®","slug":"nginxé…ç½®","link":"/tags/nginx%E9%85%8D%E7%BD%AE/"},{"name":"frp","slug":"frp","link":"/tags/frp/"},{"name":"å…±é¸£","slug":"å…±é¸£","link":"/tags/%E5%85%B1%E9%B8%A3/"},{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","link":"/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"name":"ngrok","slug":"ngrok","link":"/tags/ngrok/"},{"name":"æ•°æ®ç»“æ„äºç®—æ³•","slug":"æ•°æ®ç»“æ„äºç®—æ³•","link":"/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BA%8E%E7%AE%97%E6%B3%95/"},{"name":"å¤‡ä»½","slug":"å¤‡ä»½","link":"/tags/%E5%A4%87%E4%BB%BD/"},{"name":"aggregate","slug":"aggregate","link":"/tags/aggregate/"},{"name":"æ•°æ®æ“ä½œ","slug":"æ•°æ®æ“ä½œ","link":"/tags/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/"},{"name":"èšåˆç»Ÿè®¡","slug":"èšåˆç»Ÿè®¡","link":"/tags/%E8%81%9A%E5%90%88%E7%BB%9F%E8%AE%A1/"},{"name":"PowerDesigner","slug":"PowerDesigner","link":"/tags/PowerDesigner/"},{"name":"mysql","slug":"mysql","link":"/tags/mysql/"},{"name":"oracle","slug":"oracle","link":"/tags/oracle/"},{"name":"ubuntu","slug":"ubuntu","link":"/tags/ubuntu/"},{"name":"SRS","slug":"SRS","link":"/tags/SRS/"},{"name":"HLS","slug":"HLS","link":"/tags/HLS/"},{"name":"RTMP","slug":"RTMP","link":"/tags/RTMP/"},{"name":"svn","slug":"svn","link":"/tags/svn/"},{"name":"git","slug":"git","link":"/tags/git/"},{"name":"æ¸¸æ³³","slug":"æ¸¸æ³³","link":"/tags/%E6%B8%B8%E6%B3%B3/"},{"name":"å•å…ƒæµ‹è¯•","slug":"å•å…ƒæµ‹è¯•","link":"/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"},{"name":"21å¤©","slug":"21å¤©","link":"/tags/21%E5%A4%A9/"},{"name":"IOæµ","slug":"IOæµ","link":"/tags/IO%E6%B5%81/"},{"name":"20å¤©","slug":"20å¤©","link":"/tags/20%E5%A4%A9/"},{"name":"IO","slug":"IO","link":"/tags/IO/"},{"name":"é›†åˆ","slug":"é›†åˆ","link":"/tags/%E9%9B%86%E5%90%88/"}],"categories":[{"name":"å…¶å®ƒ","slug":"å…¶å®ƒ","link":"/categories/%E5%85%B6%E5%AE%83/"},{"name":"ç³»ç»Ÿå…‹éš†","slug":"ç³»ç»Ÿå…‹éš†","link":"/categories/%E7%B3%BB%E7%BB%9F%E5%85%8B%E9%9A%86/"},{"name":"codepush","slug":"codepush","link":"/categories/codepush/"},{"name":"Jenkins","slug":"Jenkins","link":"/categories/Jenkins/"},{"name":"RabbitMq","slug":"RabbitMq","link":"/categories/RabbitMq/"},{"name":"docker","slug":"docker","link":"/categories/docker/"},{"name":"Elasticsearch","slug":"Elasticsearch","link":"/categories/Elasticsearch/"},{"name":"hexo","slug":"hexo","link":"/categories/hexo/"},{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","link":"/categories/Java%E5%9F%BA%E7%A1%80/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"linux","slug":"linux","link":"/categories/linux/"},{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/categories/%E5%B7%A5%E4%BD%9C/"},{"name":"Linux","slug":"Linux","link":"/categories/Linux/"},{"name":"nginx","slug":"nginx","link":"/categories/nginx/"},{"name":"python","slug":"python","link":"/categories/python/"},{"name":"samba","slug":"samba","link":"/categories/samba/"},{"name":"ä¸€è¨€","slug":"ä¸€è¨€","link":"/categories/%E4%B8%80%E8%A8%80/"},{"name":"å·¥å…·","slug":"å·¥å…·","link":"/categories/%E5%B7%A5%E5%85%B7/"},{"name":"åŒæ­¥","slug":"åŒæ­¥","link":"/categories/%E5%90%8C%E6%AD%A5/"},{"name":"http","slug":"http","link":"/categories/http/"},{"name":"OCR","slug":"OCR","link":"/categories/OCR/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","link":"/categories/%E7%94%9F%E6%B4%BB/"},{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","link":"/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"name":"keepalived","slug":"keepalived","link":"/categories/keepalived/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/categories/%E7%88%AC%E8%99%AB/"},{"name":"Spring-boot","slug":"Spring-boot","link":"/categories/Spring-boot/"},{"name":"webscoket","slug":"webscoket","link":"/categories/webscoket/"},{"name":"HTTPS","slug":"HTTPS","link":"/categories/HTTPS/"},{"name":"å†…ç½‘ç©¿é€š","slug":"å†…ç½‘ç©¿é€š","link":"/categories/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%9A/"},{"name":"æ‚æ–‡","slug":"æ‚æ–‡","link":"/categories/%E6%9D%82%E6%96%87/"},{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","link":"/categories/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"name":"æ•°æ®ç»“æ„äºç®—æ³•","slug":"æ•°æ®ç»“æ„äºç®—æ³•","link":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BA%8E%E7%AE%97%E6%B3%95/"},{"name":"MongoDB","slug":"MongoDB","link":"/categories/MongoDB/"},{"name":"mongodb","slug":"mongodb","link":"/categories/mongodb/"},{"name":"mysql","slug":"mysql","link":"/categories/mysql/"},{"name":"oracle","slug":"oracle","link":"/categories/oracle/"},{"name":"redis","slug":"redis","link":"/categories/redis/"},{"name":"ubuntu","slug":"ubuntu","link":"/categories/ubuntu/"},{"name":"æµåª’ä½“","slug":"æµåª’ä½“","link":"/categories/%E6%B5%81%E5%AA%92%E4%BD%93/"},{"name":"svn","slug":"svn","link":"/categories/svn/"},{"name":"git","slug":"git","link":"/categories/git/"},{"name":"exercise","slug":"exercise","link":"/categories/exercise/"}]}